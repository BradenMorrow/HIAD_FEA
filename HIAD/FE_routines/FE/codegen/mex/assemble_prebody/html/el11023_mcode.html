<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="160,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T163U3">Kel</span>,<span class="var type1" id="S3T36U4">fint_i</span>,<span class="var type1" id="S4T36U5">Fint_i</span>,<span class="var type1" id="S5T167U6">ROT</span>,<span class="var type1" id="S6T168U7">el_out</span>] = el1(<span class="var type1" id="S7T169U10">U_in</span>,<span class="var type1" id="S8T3U11">el_in</span>,<span class="var type1" id="S9T168U12">el_in0</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="160,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%EL1</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%   Linear elastic, 3D beam element</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% Extract variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% Geometry</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,7" id="srcline7"> 7</a></span><span class="line"><span class="mxinfo " id="T4:U9"><span class="var type1" id="S10T4U15">nodes</span> = <span class="mxinfo " id="T4:U11"><span class="var type1" id="S8T3U17">el_in</span>.nodes_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,8" id="srcline8"> 8</a></span><span class="line"><span class="mxinfo " id="T5:U13"><span class="var type1" id="S11T5U21">orient</span> = <span class="mxinfo " id="T5:U15"><span class="var type1" id="S8T3U23">el_in</span>.orient_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,10" id="srcline10">10</a></span><span class="line"><span class="comment">% Materials</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T8:U17"><span class="var type1" id="S12T8U27">mat</span> = <span class="mxinfo " id="T8:U19"><span class="var type1" id="S9T168U29">el_in0</span>.mat</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T9:U21"><span class="var type1" id="S13T9U33">geom</span> = <span class="mxinfo " id="T9:U23"><span class="var type1" id="S9T168U35">el_in0</span>.geom</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T7:U25"><span class="var type1" id="S14T7U39">L0</span> = <span class="mxinfo " id="T7:U27"><span class="mxinfo " id="T7:U28">sum(<span class="mxinfo " id="T5:U29">(<span class="mxinfo " id="T5:U30"><span class="mxinfo " id="T5:U31"><span class="var type1" id="S10T4U47">nodes</span>(<span class="mxinfo " id="T49:U33">2</span>,<span class="mxinfo " id="T102:U34">:</span>)</span> - <span class="mxinfo " id="T5:U35"><span class="var type1" id="S10T4U51">nodes</span>(<span class="mxinfo " id="T7:U37">1</span>,<span class="mxinfo " id="T102:U38">:</span>)</span></span>).^2</span>)</span>.^.5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,14" id="srcline14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,15" id="srcline15">15</a></span><span class="line"><span class="comment">% Obtain displacements of interest</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,16" id="srcline16">16</a></span><span class="line"><span class="mxinfo " id="T173:U39"><span class="var type1" id="S16T173U58">Uel</span> = <span class="mxinfo " id="T173:U41"><span class="mxinfo " id="T170:U42"><span class="var type1" id="S7T169U61">U_in</span>.U</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T36:U44"><span class="var type1" id="S16T36U65">Uel</span> = <span class="mxinfo " id="T36:U46"><span class="var type1" id="S16T173U67">Uel</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,19" id="srcline19">19</a></span><span class="line"><span class="comment">% Transformation matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T163:U48"><span class="var type1" id="S17T163U71">T</span> = <span class="mxinfo " id="T163:U50"><span class="fcn" id="F1001N2:B73">T_beam_3d</span>(<span class="var type1" id="S10T4U74">nodes</span>,<span class="var type1" id="S11T5U75">orient</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,22" id="srcline22">22</a></span><span class="line"><span class="comment">% Local element displacements</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T36:U53"><span class="var type1" id="S19T36U78">u</span> = <span class="mxinfo " id="T36:U55"><span class="var type1" id="S17T163U80">T</span>*<span class="var type1" id="S16T36U81">Uel</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,24" id="srcline24">24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,25" id="srcline25">25</a></span><span class="line"><span class="comment">% Local element stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo " id="T163:U58"><span class="var type1" id="S20T163U84">k</span> = <span class="mxinfo " id="T163:U60"><span class="fcn" id="F953N23:B86">k1</span>(<span class="var type1" id="S12T8U87">mat</span>,<span class="var type1" id="S13T9U88">geom</span>,<span class="var type1" id="S14T7U89">L0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,27" id="srcline27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,28" id="srcline28">28</a></span><span class="line"><span class="comment">% Element stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo " id="T163:U64"><span class="var type1" id="S2T163U92">Kel</span> = <span class="mxinfo " id="T163:U66"><span class="mxinfo " id="T163:U67"><span class="mxinfo " id="T163:U68"><span class="var type1" id="S17T163U96">T</span>'</span>*<span class="var type1" id="S20T163U97">k</span></span>*<span class="var type1" id="S17T163U98">T</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,31" id="srcline31">31</a></span><span class="line"><span class="comment">% Element internal forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T36:U72"><span class="var type1" id="S3T36U101">fint_i</span> = <span class="mxinfo " id="T36:U74"><span class="var type1" id="S20T163U103">k</span>*<span class="var type1" id="S19T36U104">u</span></span></span>; <span class="comment">% Local</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,33" id="srcline33">33</a></span><span class="line"><span class="mxinfo " id="T36:U77"><span class="var type1" id="S4T36U107">Fint_i</span> = <span class="mxinfo " id="T36:U79"><span class="mxinfo " id="T163:U80"><span class="var type1" id="S17T163U110">T</span>'</span>*<span class="var type1" id="S3T36U111">fint_i</span></span></span>; <span class="comment">% Global</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,34" id="srcline34">34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,35" id="srcline35">35</a></span><span class="line"><span class="comment">% Extract rotations</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo " id="T4:U83"><span class="var type1" id="S22T4U114">drot</span> = <span class="mxinfo " id="T4:U85"><span class="mxinfo " id="T170:U86"><span class="var type1" id="S7T169U117">U_in</span>.delta_U</span>(<span class="mxinfo " id="T41:U88">:</span>,<span class="mxinfo " id="T5:U89"><span class="mxinfo " id="T7:U90">4</span>:<span class="mxinfo " id="T7:U91">6</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,37" id="srcline37">37</a></span><span class="line"><span class="mxinfo " id="T4:U92"><span class="var type1" id="S23T4U125">roti</span> = <span class="mxinfo " id="T4:U94"><span class="mxinfo " id="T170:U95"><span class="var type1" id="S7T169U128">U_in</span>.U</span>(<span class="mxinfo " id="T41:U97">:</span>,<span class="mxinfo " id="T5:U98"><span class="mxinfo " id="T7:U99">4</span>:<span class="mxinfo " id="T7:U100">6</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T4:U101"><span class="mxinfo " id="T4:U102"><span class="var type1" id="S5T167U137">ROT</span>.rot</span> = <span class="mxinfo " id="T4:U104"><span class="var type1" id="S23T4U140">roti</span> + <span class="var type1" id="S22T4U141">drot</span></span></span>; <span class="comment">% Total rotation</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo " id="T4:U107"><span class="mxinfo " id="T4:U108"><span class="var type1" id="S5T167U145">ROT</span>.DELTA_rot</span> = <span class="mxinfo " id="T4:U110">zeros(size(<span class="var type1" id="S23T4U151">roti</span>))</span></span>; <span class="comment">% Initialize ROT.DELTA_rot</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,40" id="srcline40">40</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo " id="T4:U112"><span class="var type1" id="S26T4U154">rot0</span> = <span class="mxinfo " id="T4:U114"><span class="mxinfo " id="T170:U115"><span class="var type1" id="S7T169U157">U_in</span>.U0</span>(<span class="mxinfo " id="T41:U117">:</span>,<span class="mxinfo " id="T5:U118"><span class="mxinfo " id="T7:U119">4</span>:<span class="mxinfo " id="T7:U120">6</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo " id="T4:U121"><span class="mxinfo " id="T4:U122"><span class="var type1" id="S5T167U166">ROT</span>.DELTA_rot</span> = <span class="mxinfo " id="T4:U124"><span class="mxinfo " id="T4:U125"><span class="var type1" id="S5T167U170">ROT</span>.rot</span> - <span class="var type1" id="S26T4U172">rot0</span></span></span>; <span class="comment">% Increment change in rotation</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,43" id="srcline43">43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,44" id="srcline44">44</a></span><span class="line"><span class="comment">% Do not need to save any variables for future iterations</span></span></span>
<span class="srcline"><span class="lineno"><a href="160,45" id="srcline45">45</a></span><span class="line"><span class="mxinfo " id="T168:U128"><span class="var type1" id="S6T168U175">el_out</span> = <span class="var type1" id="S9T168U176">el_in0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,46" id="srcline46">46</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,47" id="srcline47">47</a></span><span class="line"><span class="mxinfo " id="T7:U131"><span class="mxinfo " id="T7:U132"><span class="var type1" id="S6T168U180">el_out</span>.break</span> = <span class="mxinfo " id="T7:U134">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="160,48" id="srcline48">48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="160,49" id="srcline49">49</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
