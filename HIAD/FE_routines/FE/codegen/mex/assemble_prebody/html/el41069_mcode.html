<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="167,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T163U3">Kel</span>,<span class="var type1" id="S3T36U4">fint_i</span>,<span class="var type1" id="S4T36U5">Fint_i</span>,<span class="var type1" id="S5T167U6">ROT</span>,<span class="var type1" id="S6T168U7">el_out</span>] = el4(<span class="var type1" id="S7T169U10">U_in</span>,<span class="var type1" id="S8T3U11">el_in</span>,<span class="var type1" id="S9T168U12">el_in0</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="167,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%ELEMENT_4</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   3D corotational beam formulation, see Crisfield (1990), A consistent</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   co-rotational formulation for non-linear, three dimensional,</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   beam-elements</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   See also de Souza dissertation (2000), Force-based finite element for</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   large displacement inelastic analysis of frames</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   Generally follows de Souza</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,9" id="srcline9">  9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,10" id="srcline10"> 10</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% Extract variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% Geometry</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,13" id="srcline13"> 13</a></span><span class="line"><span class="mxinfo " id="T4:U9"><span class="var type1" id="S10T4U15">nodes</span> = <span class="mxinfo " id="T4:U11"><span class="var type1" id="S8T3U17">el_in</span>.nodes_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,14" id="srcline14"> 14</a></span><span class="line"><span class="mxinfo " id="T5:U13"><span class="var type1" id="S11T5U21">orient</span> = <span class="mxinfo " id="T5:U15"><span class="var type1" id="S8T3U23">el_in</span>.orient_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,15" id="srcline15"> 15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">% Material</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,17" id="srcline17"> 17</a></span><span class="line"><span class="mxinfo " id="T8:U17"><span class="var type1" id="S12T8U27">mat</span> = <span class="mxinfo " id="T8:U19"><span class="var type1" id="S9T168U29">el_in0</span>.mat</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,18" id="srcline18"> 18</a></span><span class="line"><span class="mxinfo " id="T9:U21"><span class="var type1" id="S13T9U33">geom</span> = <span class="mxinfo " id="T9:U23"><span class="var type1" id="S9T168U35">el_in0</span>.geom</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,19" id="srcline19"> 19</a></span><span class="line"><span class="mxinfo " id="T10:U25"><span class="var type1" id="S14T10U39">axial</span> = <span class="mxinfo " id="T10:U27"><span class="var type1" id="S9T168U41">el_in0</span>.axial</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo " id="T14:U29"><span class="var type1" id="S15T14U45">axial_k</span> = <span class="mxinfo " id="T14:U31"><span class="var type1" id="S9T168U47">el_in0</span>.axial_k</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,21" id="srcline21"> 21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">% Obtain displacements of interest</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo " id="T170:U33"><span class="var type1" id="S16T170U51">Uel</span> = <span class="mxinfo " id="T170:U35"><span class="var type1" id="S7T169U53">U_in</span>.U</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo " id="T170:U37"><span class="var type1" id="S17T170U57">delta_Uel</span> = <span class="mxinfo " id="T170:U39"><span class="var type1" id="S7T169U59">U_in</span>.delta_U</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T170:U41"><span class="var type1" id="S18T170U63">DELTA_Uel</span> = <span class="mxinfo " id="T170:U43"><span class="var type1" id="S7T169U65">U_in</span>.DELTA_U</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,26" id="srcline26"> 26</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">% Components of length and length</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">% Initial</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T7:U45"><span class="var type1" id="S19T7U69">L10</span> = <span class="mxinfo " id="T7:U47"><span class="mxinfo " id="T7:U48"><span class="var type1" id="S10T4U72">nodes</span>(<span class="mxinfo " id="T49:U50">2</span>,<span class="mxinfo " id="T49:U51">1</span>)</span> - <span class="mxinfo " id="T7:U52"><span class="var type1" id="S10T4U76">nodes</span>(<span class="mxinfo " id="T7:U54">1</span>,<span class="mxinfo " id="T7:U55">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo " id="T7:U56"><span class="var type1" id="S20T7U81">L20</span> = <span class="mxinfo " id="T7:U58"><span class="mxinfo " id="T7:U59"><span class="var type1" id="S10T4U84">nodes</span>(<span class="mxinfo " id="T49:U61">2</span>,<span class="mxinfo " id="T49:U62">2</span>)</span> - <span class="mxinfo " id="T7:U63"><span class="var type1" id="S10T4U88">nodes</span>(<span class="mxinfo " id="T7:U65">1</span>,<span class="mxinfo " id="T7:U66">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo " id="T7:U67"><span class="var type1" id="S21T7U93">L30</span> = <span class="mxinfo " id="T7:U69"><span class="mxinfo " id="T7:U70"><span class="var type1" id="S10T4U96">nodes</span>(<span class="mxinfo " id="T49:U72">2</span>,<span class="mxinfo " id="T49:U73">3</span>)</span> - <span class="mxinfo " id="T7:U74"><span class="var type1" id="S10T4U100">nodes</span>(<span class="mxinfo " id="T7:U76">1</span>,<span class="mxinfo " id="T7:U77">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo " id="T7:U78"><span class="var type1" id="S22T7U105">L0</span> = <span class="mxinfo " id="T7:U80">sqrt(<span class="mxinfo " id="T7:U81"><span class="mxinfo " id="T7:U82"><span class="mxinfo " id="T7:U83"><span class="var type1" id="S19T7U111">L10</span>^2</span> + <span class="mxinfo " id="T7:U85"><span class="var type1" id="S20T7U114">L20</span>^2</span></span> + <span class="mxinfo " id="T7:U87"><span class="var type1" id="S21T7U117">L30</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,33" id="srcline33"> 33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% Current</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo " id="T7:U89"><span class="var type1" id="S24T7U121">L1</span> = <span class="mxinfo " id="T7:U91">(<span class="mxinfo " id="T7:U92"><span class="mxinfo " id="T7:U93"><span class="var type1" id="S10T4U126">nodes</span>(<span class="mxinfo " id="T49:U95">2</span>,<span class="mxinfo " id="T49:U96">1</span>)</span> + <span class="mxinfo " id="T7:U97"><span class="var type1" id="S16T170U130">Uel</span>(<span class="mxinfo " id="T7:U99">2</span>,<span class="mxinfo " id="T7:U100">1</span>)</span></span>) - (<span class="mxinfo " id="T7:U101"><span class="mxinfo " id="T7:U102"><span class="var type1" id="S10T4U136">nodes</span>(<span class="mxinfo " id="T7:U104">1</span>,<span class="mxinfo " id="T7:U105">1</span>)</span> + <span class="mxinfo " id="T7:U106"><span class="var type1" id="S16T170U140">Uel</span>(<span class="mxinfo " id="T7:U108">1</span>,<span class="mxinfo " id="T7:U109">1</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T7:U110"><span class="var type1" id="S25T7U145">L2</span> = <span class="mxinfo " id="T7:U112">(<span class="mxinfo " id="T7:U113"><span class="mxinfo " id="T7:U114"><span class="var type1" id="S10T4U150">nodes</span>(<span class="mxinfo " id="T49:U116">2</span>,<span class="mxinfo " id="T49:U117">2</span>)</span> + <span class="mxinfo " id="T7:U118"><span class="var type1" id="S16T170U154">Uel</span>(<span class="mxinfo " id="T7:U120">2</span>,<span class="mxinfo " id="T7:U121">2</span>)</span></span>) - (<span class="mxinfo " id="T7:U122"><span class="mxinfo " id="T7:U123"><span class="var type1" id="S10T4U160">nodes</span>(<span class="mxinfo " id="T7:U125">1</span>,<span class="mxinfo " id="T7:U126">2</span>)</span> + <span class="mxinfo " id="T7:U127"><span class="var type1" id="S16T170U164">Uel</span>(<span class="mxinfo " id="T7:U129">1</span>,<span class="mxinfo " id="T7:U130">2</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo " id="T7:U131"><span class="var type1" id="S26T7U169">L3</span> = <span class="mxinfo " id="T7:U133">(<span class="mxinfo " id="T7:U134"><span class="mxinfo " id="T7:U135"><span class="var type1" id="S10T4U174">nodes</span>(<span class="mxinfo " id="T49:U137">2</span>,<span class="mxinfo " id="T49:U138">3</span>)</span> + <span class="mxinfo " id="T7:U139"><span class="var type1" id="S16T170U178">Uel</span>(<span class="mxinfo " id="T7:U141">2</span>,<span class="mxinfo " id="T7:U142">3</span>)</span></span>) - (<span class="mxinfo " id="T7:U143"><span class="mxinfo " id="T7:U144"><span class="var type1" id="S10T4U184">nodes</span>(<span class="mxinfo " id="T7:U146">1</span>,<span class="mxinfo " id="T7:U147">3</span>)</span> + <span class="mxinfo " id="T7:U148"><span class="var type1" id="S16T170U188">Uel</span>(<span class="mxinfo " id="T7:U150">1</span>,<span class="mxinfo " id="T7:U151">3</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,38" id="srcline38"> 38</a></span><span class="line"><span class="mxinfo " id="T7:U152"><span class="var type1" id="S27T7U193">L</span> = <span class="mxinfo " id="T7:U154">sqrt(<span class="mxinfo " id="T7:U155"><span class="mxinfo " id="T7:U156"><span class="mxinfo " id="T7:U157"><span class="var type1" id="S24T7U199">L1</span>^2</span> + <span class="mxinfo " id="T7:U159"><span class="var type1" id="S25T7U202">L2</span>^2</span></span> + <span class="mxinfo " id="T7:U161"><span class="var type1" id="S26T7U205">L3</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,39" id="srcline39"> 39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">% To orientation nodes</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% Initial</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">% Lo10 = orient(1:2,1) - nodes(1:2,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">% Lo20 = orient(1:2,2) - nodes(1:2,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">% Lo30 = orient(1:2,3) - nodes(1:2,3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo " id="T7:U163"><span class="var type1" id="S28T7U209">Lo10</span> = <span class="mxinfo " id="T7:U165"><span class="mxinfo " id="T7:U166"><span class="var type1" id="S11T5U212">orient</span>(<span class="mxinfo " id="T49:U168">1</span>,<span class="mxinfo " id="T49:U169">1</span>)</span> - <span class="mxinfo " id="T7:U170"><span class="var type1" id="S10T4U216">nodes</span>(<span class="mxinfo " id="T7:U172">1</span>,<span class="mxinfo " id="T7:U173">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo " id="T7:U174"><span class="var type1" id="S29T7U221">Lo20</span> = <span class="mxinfo " id="T7:U176"><span class="mxinfo " id="T7:U177"><span class="var type1" id="S11T5U224">orient</span>(<span class="mxinfo " id="T49:U179">1</span>,<span class="mxinfo " id="T49:U180">2</span>)</span> - <span class="mxinfo " id="T7:U181"><span class="var type1" id="S10T4U228">nodes</span>(<span class="mxinfo " id="T7:U183">1</span>,<span class="mxinfo " id="T7:U184">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,47" id="srcline47"> 47</a></span><span class="line"><span class="mxinfo " id="T7:U185"><span class="var type1" id="S30T7U233">Lo30</span> = <span class="mxinfo " id="T7:U187"><span class="mxinfo " id="T7:U188"><span class="var type1" id="S11T5U236">orient</span>(<span class="mxinfo " id="T49:U190">1</span>,<span class="mxinfo " id="T49:U191">3</span>)</span> - <span class="mxinfo " id="T7:U192"><span class="var type1" id="S10T4U240">nodes</span>(<span class="mxinfo " id="T7:U194">1</span>,<span class="mxinfo " id="T7:U195">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,48" id="srcline48"> 48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">% Obtain the initial nodal triads</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">% Unit vectors at i node</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo " id="T72:U196"><span class="var type1" id="S31T72U245">e10</span> = <span class="mxinfo " id="T72:U198"><span class="mxinfo " id="T5:U199">[<span class="var type1" id="S19T7U249">L10</span> <span class="var type1" id="S20T7U250">L20</span> <span class="var type1" id="S21T7U251">L30</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo " id="T72:U203"><span class="var type1" id="S31T72U254">e10</span> = <span class="mxinfo " id="T72:U205"><span class="var type1" id="S31T72U256">e10</span>/<span class="mxinfo " id="T7:U207">norm(<span class="var type1" id="S31T72U259">e10</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo " id="T72:U209"><span class="var type1" id="S33T72U262">e30</span> = <span class="mxinfo " id="T72:U211">cross(<span class="var type1" id="S31T72U265">e10</span>,<span class="mxinfo " id="T72:U213"><span class="mxinfo " id="T5:U214">[<span class="var type1" id="S28T7U270">Lo10</span>(1) <span class="var type1" id="S29T7U273">Lo20</span>(1) <span class="var type1" id="S30T7U276">Lo30</span>(1)]</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo " id="T72:U218"><span class="var type1" id="S33T72U280">e30</span> = <span class="mxinfo " id="T72:U220"><span class="var type1" id="S33T72U282">e30</span>/<span class="mxinfo " id="T7:U222">norm(<span class="var type1" id="S33T72U285">e30</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,56" id="srcline56"> 56</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo " id="T72:U224"><span class="var type1" id="S35T72U288">e20</span> = <span class="mxinfo " id="T72:U226">cross(<span class="var type1" id="S33T72U291">e30</span>,<span class="var type1" id="S31T72U292">e10</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo " id="T72:U229"><span class="var type1" id="S35T72U295">e20</span> = <span class="mxinfo " id="T72:U231"><span class="var type1" id="S35T72U297">e20</span>/<span class="mxinfo " id="T7:U233">norm(<span class="var type1" id="S35T72U300">e20</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,60" id="srcline60"> 60</a></span><span class="line"><span class="mxinfo " id="T73:U235"><span class="var type1" id="S36T73U303">E0</span> = <span class="mxinfo " id="T73:U237">[<span class="var type1" id="S31T72U306">e10</span> <span class="var type1" id="S35T72U307">e20</span> <span class="var type1" id="S33T72U308">e30</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">% Section 5.3.2a - de Souza</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% e0 = get_quat_R(E0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,64" id="srcline64"> 64</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo " id="T76:U241"><span class="var type1" id="S37T76U311">qi_old</span> = <span class="mxinfo " id="T76:U243"><span class="fcn" id="F190N20:B313">get_quat_PHI</span>(<span class="mxinfo " id="T72:U244"><span class="mxinfo " id="T5:U245"><span class="var type1" id="S16T170U316">Uel</span>(<span class="mxinfo " id="T49:U247">1</span>,<span class="mxinfo " id="T102:U248">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo " id="T76:U249"><span class="var type1" id="S39T76U323">qj_old</span> = <span class="mxinfo " id="T76:U251"><span class="fcn" id="F190N20:B325">get_quat_PHI</span>(<span class="mxinfo " id="T72:U252"><span class="mxinfo " id="T5:U253"><span class="var type1" id="S16T170U328">Uel</span>(<span class="mxinfo " id="T49:U255">2</span>,<span class="mxinfo " id="T102:U256">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,67" id="srcline67"> 67</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,68" id="srcline68"> 68</a></span><span class="line"><span class="mxinfo " id="T76:U257"><span class="var type1" id="S40T76U335">delta_qi</span> = <span class="mxinfo " id="T76:U259"><span class="fcn" id="F190N20:B337">get_quat_PHI</span>(<span class="mxinfo " id="T72:U260"><span class="mxinfo " id="T5:U261"><span class="var type1" id="S17T170U340">delta_Uel</span>(<span class="mxinfo " id="T49:U263">1</span>,<span class="mxinfo " id="T102:U264">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,69" id="srcline69"> 69</a></span><span class="line"><span class="mxinfo " id="T76:U265"><span class="var type1" id="S41T76U347">delta_qj</span> = <span class="mxinfo " id="T76:U267"><span class="fcn" id="F190N20:B349">get_quat_PHI</span>(<span class="mxinfo " id="T72:U268"><span class="mxinfo " id="T5:U269"><span class="var type1" id="S17T170U352">delta_Uel</span>(<span class="mxinfo " id="T49:U271">2</span>,<span class="mxinfo " id="T102:U272">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,70" id="srcline70"> 70</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">% STEP 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,72" id="srcline72"> 72</a></span><span class="line"><span class="mxinfo " id="T76:U273"><span class="var type1" id="S42T76U359">qI</span> = <span class="mxinfo " id="T76:U275"><span class="fcn" id="F210N26:B361">quat_prod</span>(<span class="var type1" id="S40T76U362">delta_qi</span>,<span class="var type1" id="S37T76U363">qi_old</span>)</span></span>; <span class="comment">% Equation 5.46</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,73" id="srcline73"> 73</a></span><span class="line"><span class="mxinfo " id="T76:U278"><span class="var type1" id="S44T76U366">qJ</span> = <span class="mxinfo " id="T76:U280"><span class="fcn" id="F210N26:B368">quat_prod</span>(<span class="var type1" id="S41T76U369">delta_qj</span>,<span class="var type1" id="S39T76U370">qj_old</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,74" id="srcline74"> 74</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">% Calculate nodal rotation for incorporation into displacement vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo " id="T72:U283"><span class="var type1" id="S45T72U373">rotI</span> = <span class="mxinfo " id="T72:U285"><span class="fcn" id="F222N17:B375">get_PHI_quat</span>(<span class="var type1" id="S42T76U376">qI</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo " id="T72:U287"><span class="var type1" id="S47T72U379">rotJ</span> = <span class="mxinfo " id="T72:U289"><span class="fcn" id="F222N17:B381">get_PHI_quat</span>(<span class="var type1" id="S44T76U382">qJ</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo " id="T4:U291"><span class="var type1" id="S48T4U385">rot</span> = <span class="mxinfo " id="T4:U293">[<span class="mxinfo " id="T5:U294"><span class="var type1" id="S45T72U389">rotI</span>'</span>; <span class="mxinfo " id="T5:U296"><span class="var type1" id="S47T72U392">rotJ</span>'</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,79" id="srcline79"> 79</a></span><span class="line"><span class="mxinfo " id="T4:U298"><span class="mxinfo " id="T4:U299"><span class="var type1" id="S5T167U396">ROT</span>.rot</span> = <span class="var type1" id="S48T4U398">rot</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,80" id="srcline80"> 80</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">% If U = zeros, rotI and rotJ = zeros, nI and nJ = e0 ==&gt; OK</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">% However, NI and NJ should equal E0, not the case.</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">% % % nI = quat_prod(qI,e0); % Equation 5.48</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">% % % nJ = quat_prod(qJ,e0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">% % % </span></span></span>
<span class="srcline"><span class="lineno"><a href="167,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">% % % NI = get_R_quat(nI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">% % % NJ = get_R_quat(nJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">% % % </span></span></span>
<span class="srcline"><span class="lineno"><a href="167,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">% % % % STEP 3</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">% % % gammaI = get_PHI_quat(nI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">% % % gammaJ = get_PHI_quat(nJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">% % % </span></span></span>
<span class="srcline"><span class="lineno"><a href="167,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">% % % % STEP 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">% % % R_bar = get_R_PHI((gammaI + gammaJ)/2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,96" id="srcline96"> 96</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,97" id="srcline97"> 97</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">% June 25, 2015</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,99" id="srcline99"> 99</a></span><span class="line"><span class="mxinfo " id="T73:U302"><span class="var type1" id="S49T73U401">NI</span> = <span class="mxinfo " id="T73:U304"><span class="mxinfo " id="T73:U305"><span class="fcn" id="F347N18:B404">get_R_PHI</span>(<span class="mxinfo " id="T72:U306"><span class="mxinfo " id="T5:U307"><span class="var type1" id="S48T4U407">rot</span>(<span class="mxinfo " id="T49:U309">1</span>,<span class="mxinfo " id="T102:U310">:</span>)</span>'</span>)</span>*<span class="var type1" id="S36T73U410">E0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,100" id="srcline100">100</a></span><span class="line"><span class="mxinfo " id="T73:U312"><span class="var type1" id="S51T73U413">NJ</span> = <span class="mxinfo " id="T73:U314"><span class="mxinfo " id="T73:U315"><span class="fcn" id="F347N18:B416">get_R_PHI</span>(<span class="mxinfo " id="T72:U316"><span class="mxinfo " id="T5:U317"><span class="var type1" id="S48T4U419">rot</span>(<span class="mxinfo " id="T49:U319">2</span>,<span class="mxinfo " id="T102:U320">:</span>)</span>'</span>)</span>*<span class="var type1" id="S36T73U422">E0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,101" id="srcline101">101</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,102" id="srcline102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,103" id="srcline103">103</a></span><span class="line"><span class="comment">% % % % STEP 3</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,104" id="srcline104">104</a></span><span class="line"><span class="comment">% % % gammaI = get_PHI_quat(nI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,105" id="srcline105">105</a></span><span class="line"><span class="comment">% % % gammaJ = get_PHI_quat(nJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,107" id="srcline107">107</a></span><span class="line"><span class="comment">% STEP 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo " id="T73:U322"><span class="var type1" id="S52T73U425">R_bar</span> = <span class="mxinfo " id="T73:U324">(<span class="mxinfo " id="T73:U325"><span class="var type1" id="S49T73U429">NI</span> + <span class="var type1" id="S51T73U430">NJ</span></span>)/<span class="mxinfo " id="T7:U328">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,109" id="srcline109">109</a></span><span class="line"><span class="mxinfo " id="T73:U329"><span class="var type1" id="S52T73U434">R_bar</span> = <span class="mxinfo " id="T73:U331"><span class="fcn" id="F346N24:B436">normcfast</span>(<span class="var type1" id="S52T73U437">R_bar</span>)</span></span>; <span class="comment">%normfast is faster than norm and does not do unecissary checks</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,110" id="srcline110">110</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,111" id="srcline111">111</a></span><span class="line"><span class="comment">% % Also need step change in rotations for arc-length solver (DELTA_U)</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,112" id="srcline112">112</a></span><span class="line"><span class="mxinfo " id="T76:U333"><span class="var type1" id="S54T76U440">DELTA_qi_old</span> = <span class="mxinfo " id="T76:U335"><span class="fcn" id="F190N20:B442">get_quat_PHI</span>(<span class="mxinfo " id="T72:U336"><span class="mxinfo " id="T5:U337"><span class="var type1" id="S18T170U445">DELTA_Uel</span>(<span class="mxinfo " id="T49:U339">1</span>,<span class="mxinfo " id="T102:U340">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,113" id="srcline113">113</a></span><span class="line"><span class="mxinfo " id="T76:U341"><span class="var type1" id="S55T76U452">DELTA_qj_old</span> = <span class="mxinfo " id="T76:U343"><span class="fcn" id="F190N20:B454">get_quat_PHI</span>(<span class="mxinfo " id="T72:U344"><span class="mxinfo " id="T5:U345"><span class="var type1" id="S18T170U457">DELTA_Uel</span>(<span class="mxinfo " id="T49:U347">2</span>,<span class="mxinfo " id="T102:U348">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,114" id="srcline114">114</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,115" id="srcline115">115</a></span><span class="line"><span class="mxinfo " id="T76:U349"><span class="var type1" id="S56T76U464">DELTA_qi</span> = <span class="mxinfo " id="T76:U351"><span class="fcn" id="F210N26:B466">quat_prod</span>(<span class="var type1" id="S40T76U467">delta_qi</span>,<span class="var type1" id="S54T76U468">DELTA_qi_old</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,116" id="srcline116">116</a></span><span class="line"><span class="mxinfo " id="T76:U354"><span class="var type1" id="S57T76U471">DELTA_qj</span> = <span class="mxinfo " id="T76:U356"><span class="fcn" id="F210N26:B473">quat_prod</span>(<span class="var type1" id="S41T76U474">delta_qj</span>,<span class="var type1" id="S55T76U475">DELTA_qj_old</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,117" id="srcline117">117</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,118" id="srcline118">118</a></span><span class="line"><span class="mxinfo " id="T72:U359"><span class="var type1" id="S58T72U478">DELTA_rotI</span> = <span class="mxinfo " id="T72:U361"><span class="fcn" id="F222N17:B480">get_PHI_quat</span>(<span class="var type1" id="S56T76U481">DELTA_qi</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,119" id="srcline119">119</a></span><span class="line"><span class="mxinfo " id="T72:U363"><span class="var type1" id="S59T72U484">DELTA_rotJ</span> = <span class="mxinfo " id="T72:U365"><span class="fcn" id="F222N17:B486">get_PHI_quat</span>(<span class="var type1" id="S57T76U487">DELTA_qj</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,120" id="srcline120">120</a></span><span class="line"><span class="mxinfo " id="T4:U367"><span class="var type1" id="S60T4U490">DELTA_rot</span> = <span class="mxinfo " id="T4:U369">[<span class="mxinfo " id="T5:U370"><span class="var type1" id="S58T72U494">DELTA_rotI</span>'</span>; <span class="mxinfo " id="T5:U372"><span class="var type1" id="S59T72U497">DELTA_rotJ</span>'</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,121" id="srcline121">121</a></span><span class="line"><span class="mxinfo " id="T4:U374"><span class="mxinfo " id="T4:U375"><span class="var type1" id="S5T167U501">ROT</span>.DELTA_rot</span> = <span class="var type1" id="S60T4U503">DELTA_rot</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,122" id="srcline122">122</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,123" id="srcline123">123</a></span><span class="line"><span class="comment">% RI = get_R_quat(qI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,124" id="srcline124">124</a></span><span class="line"><span class="comment">% RJ = get_R_quat(qJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,125" id="srcline125">125</a></span><span class="line"><span class="comment">% RI0 = get_R_PHI(U0(1,4:6)');</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,126" id="srcline126">126</a></span><span class="line"><span class="comment">% RJ0 = get_R_PHI(U0(2,4:6)');</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,127" id="srcline127">127</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="167,128" id="srcline128">128</a></span><span class="line"><span class="comment">% DELTA_RI = RI*(RI0\eye(3));</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,129" id="srcline129">129</a></span><span class="line"><span class="comment">% DELTA_RJ = RJ*(RJ0\eye(3));</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,130" id="srcline130">130</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="167,131" id="srcline131">131</a></span><span class="line"><span class="comment">% DELTA_rotI = get_PHI_R(DELTA_RI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,132" id="srcline132">132</a></span><span class="line"><span class="comment">% DELTA_rotJ = get_PHI_R(DELTA_RJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,133" id="srcline133">133</a></span><span class="line"><span class="comment">% DELTA_rot = [DELTA_rotI'; DELTA_rotJ'];</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,134" id="srcline134">134</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,135" id="srcline135">135</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,136" id="srcline136">136</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,137" id="srcline137">137</a></span><span class="line"><span class="comment">% Compute e1, e2 and e3 to form E</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,138" id="srcline138">138</a></span><span class="line"><span class="mxinfo " id="T72:U378"><span class="var type1" id="S61T72U506">e1</span> = <span class="mxinfo " id="T72:U380"><span class="mxinfo " id="T5:U381">[<span class="var type1" id="S24T7U510">L1</span> <span class="var type1" id="S25T7U511">L2</span> <span class="var type1" id="S26T7U512">L3</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,139" id="srcline139">139</a></span><span class="line"><span class="mxinfo " id="T72:U385"><span class="var type1" id="S61T72U515">e1</span> = <span class="mxinfo " id="T72:U387"><span class="var type1" id="S61T72U517">e1</span>/<span class="mxinfo " id="T7:U389">norm(<span class="var type1" id="S61T72U520">e1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,140" id="srcline140">140</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo " id="T72:U391"><span class="var type1" id="S62T72U523">e2</span> = <span class="mxinfo " id="T72:U393"><span class="mxinfo " id="T72:U394"><span class="var type1" id="S52T73U526">R_bar</span>(<span class="mxinfo " id="T102:U396">:</span>,<span class="mxinfo " id="T49:U397">2</span>)</span> - <span class="mxinfo " id="T72:U398"><span class="mxinfo " id="T7:U399"><span class="mxinfo " id="T7:U400"><span class="mxinfo " id="T5:U401"><span class="mxinfo " id="T72:U402"><span class="var type1" id="S52T73U534">R_bar</span>(<span class="mxinfo " id="T102:U404">:</span>,<span class="mxinfo " id="T49:U405">2</span>)</span>'</span>*<span class="var type1" id="S61T72U537">e1</span></span>/<span class="mxinfo " id="T7:U407">2</span></span>*(<span class="mxinfo " id="T72:U408"><span class="mxinfo " id="T72:U409"><span class="var type1" id="S52T73U542">R_bar</span>(<span class="mxinfo " id="T102:U411">:</span>,<span class="mxinfo " id="T49:U412">1</span>)</span> + <span class="var type1" id="S61T72U545">e1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,142" id="srcline142">142</a></span><span class="line"><span class="comment">% e2 = R_bar(:,2) - R_bar(:,2)'*e1/(1 + R_bar(:,1)'*e1)*(R_bar(:,1) + e1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,143" id="srcline143">143</a></span><span class="line"><span class="mxinfo " id="T72:U414"><span class="var type1" id="S62T72U548">e2</span> = <span class="mxinfo " id="T72:U416"><span class="var type1" id="S62T72U550">e2</span>/<span class="mxinfo " id="T7:U418">norm(<span class="var type1" id="S62T72U553">e2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,144" id="srcline144">144</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,145" id="srcline145">145</a></span><span class="line"><span class="mxinfo " id="T72:U420"><span class="var type1" id="S63T72U556">e3</span> = <span class="mxinfo " id="T72:U422"><span class="mxinfo " id="T72:U423"><span class="var type1" id="S52T73U559">R_bar</span>(<span class="mxinfo " id="T102:U425">:</span>,<span class="mxinfo " id="T49:U426">3</span>)</span> - <span class="mxinfo " id="T72:U427"><span class="mxinfo " id="T7:U428"><span class="mxinfo " id="T7:U429"><span class="mxinfo " id="T5:U430"><span class="mxinfo " id="T72:U431"><span class="var type1" id="S52T73U567">R_bar</span>(<span class="mxinfo " id="T102:U433">:</span>,<span class="mxinfo " id="T49:U434">3</span>)</span>'</span>*<span class="var type1" id="S61T72U570">e1</span></span>/<span class="mxinfo " id="T7:U436">2</span></span>*(<span class="mxinfo " id="T72:U437"><span class="mxinfo " id="T72:U438"><span class="var type1" id="S52T73U575">R_bar</span>(<span class="mxinfo " id="T102:U440">:</span>,<span class="mxinfo " id="T49:U441">1</span>)</span> + <span class="var type1" id="S61T72U578">e1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,146" id="srcline146">146</a></span><span class="line"><span class="comment">% e3 = R_bar(:,3) - R_bar(:,3)'*e1/(1 + R_bar(:,1)'*e1)*(R_bar(:,1) + e1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,147" id="srcline147">147</a></span><span class="line"><span class="mxinfo " id="T72:U443"><span class="var type1" id="S63T72U581">e3</span> = <span class="mxinfo " id="T72:U445"><span class="var type1" id="S63T72U583">e3</span>/<span class="mxinfo " id="T7:U447">norm(<span class="var type1" id="S63T72U586">e3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,148" id="srcline148">148</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,149" id="srcline149">149</a></span><span class="line"><span class="comment">% E = [e1 e2 e3];</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,150" id="srcline150">150</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,151" id="srcline151">151</a></span><span class="line"><span class="comment">% Compute basic rotations</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,152" id="srcline152">152</a></span><span class="line"><span class="mxinfo " id="T7:U449"><span class="var type1" id="S64T7U589">phiI1</span> = <span class="mxinfo " id="T7:U451">asin(<span class="mxinfo " id="T7:U452">(<span class="mxinfo " id="T7:U453"><span class="mxinfo " id="T7:U454"><span class="mxinfo " id="T5:U455"><span class="var type1" id="S63T72U597">e3</span>'</span>*<span class="mxinfo " id="T72:U457"><span class="var type1" id="S49T73U599">NI</span>(<span class="mxinfo " id="T102:U459">:</span>,<span class="mxinfo " id="T49:U460">2</span>)</span></span> - <span class="mxinfo " id="T7:U461"><span class="mxinfo " id="T5:U462"><span class="var type1" id="S62T72U604">e2</span>'</span>*<span class="mxinfo " id="T72:U464"><span class="var type1" id="S49T73U606">NI</span>(<span class="mxinfo " id="T102:U466">:</span>,<span class="mxinfo " id="T49:U467">3</span>)</span></span></span>)/<span class="mxinfo " id="T7:U468">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,153" id="srcline153">153</a></span><span class="line"><span class="mxinfo " id="T7:U469"><span class="var type1" id="S66T7U612">phiI2</span> = <span class="mxinfo " id="T7:U471">asin(<span class="mxinfo " id="T7:U472">(<span class="mxinfo " id="T7:U473"><span class="mxinfo " id="T7:U474"><span class="mxinfo " id="T5:U475"><span class="var type1" id="S61T72U620">e1</span>'</span>*<span class="mxinfo " id="T72:U477"><span class="var type1" id="S49T73U622">NI</span>(<span class="mxinfo " id="T102:U479">:</span>,<span class="mxinfo " id="T49:U480">3</span>)</span></span> - <span class="mxinfo " id="T7:U481"><span class="mxinfo " id="T5:U482"><span class="var type1" id="S63T72U627">e3</span>'</span>*<span class="mxinfo " id="T72:U484"><span class="var type1" id="S49T73U629">NI</span>(<span class="mxinfo " id="T102:U486">:</span>,<span class="mxinfo " id="T49:U487">1</span>)</span></span></span>)/<span class="mxinfo " id="T7:U488">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,154" id="srcline154">154</a></span><span class="line"><span class="mxinfo " id="T7:U489"><span class="var type1" id="S67T7U635">phiI3</span> = <span class="mxinfo " id="T7:U491">asin(<span class="mxinfo " id="T7:U492">(<span class="mxinfo " id="T7:U493"><span class="mxinfo " id="T7:U494"><span class="mxinfo " id="T5:U495"><span class="var type1" id="S62T72U643">e2</span>'</span>*<span class="mxinfo " id="T72:U497"><span class="var type1" id="S49T73U645">NI</span>(<span class="mxinfo " id="T102:U499">:</span>,<span class="mxinfo " id="T49:U500">1</span>)</span></span> - <span class="mxinfo " id="T7:U501"><span class="mxinfo " id="T5:U502"><span class="var type1" id="S61T72U650">e1</span>'</span>*<span class="mxinfo " id="T72:U504"><span class="var type1" id="S49T73U652">NI</span>(<span class="mxinfo " id="T102:U506">:</span>,<span class="mxinfo " id="T49:U507">2</span>)</span></span></span>)/<span class="mxinfo " id="T7:U508">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,155" id="srcline155">155</a></span><span class="line"><span class="mxinfo " id="T7:U509"><span class="var type1" id="S68T7U658">phiJ1</span> = <span class="mxinfo " id="T7:U511">asin(<span class="mxinfo " id="T7:U512">(<span class="mxinfo " id="T7:U513"><span class="mxinfo " id="T7:U514"><span class="mxinfo " id="T5:U515"><span class="var type1" id="S63T72U666">e3</span>'</span>*<span class="mxinfo " id="T72:U517"><span class="var type1" id="S51T73U668">NJ</span>(<span class="mxinfo " id="T102:U519">:</span>,<span class="mxinfo " id="T49:U520">2</span>)</span></span> - <span class="mxinfo " id="T7:U521"><span class="mxinfo " id="T5:U522"><span class="var type1" id="S62T72U673">e2</span>'</span>*<span class="mxinfo " id="T72:U524"><span class="var type1" id="S51T73U675">NJ</span>(<span class="mxinfo " id="T102:U526">:</span>,<span class="mxinfo " id="T49:U527">3</span>)</span></span></span>)/<span class="mxinfo " id="T7:U528">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,156" id="srcline156">156</a></span><span class="line"><span class="mxinfo " id="T7:U529"><span class="var type1" id="S69T7U681">phiJ2</span> = <span class="mxinfo " id="T7:U531">asin(<span class="mxinfo " id="T7:U532">(<span class="mxinfo " id="T7:U533"><span class="mxinfo " id="T7:U534"><span class="mxinfo " id="T5:U535"><span class="var type1" id="S61T72U689">e1</span>'</span>*<span class="mxinfo " id="T72:U537"><span class="var type1" id="S51T73U691">NJ</span>(<span class="mxinfo " id="T102:U539">:</span>,<span class="mxinfo " id="T49:U540">3</span>)</span></span> - <span class="mxinfo " id="T7:U541"><span class="mxinfo " id="T5:U542"><span class="var type1" id="S63T72U696">e3</span>'</span>*<span class="mxinfo " id="T72:U544"><span class="var type1" id="S51T73U698">NJ</span>(<span class="mxinfo " id="T102:U546">:</span>,<span class="mxinfo " id="T49:U547">1</span>)</span></span></span>)/<span class="mxinfo " id="T7:U548">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,157" id="srcline157">157</a></span><span class="line"><span class="mxinfo " id="T7:U549"><span class="var type1" id="S70T7U704">phiJ3</span> = <span class="mxinfo " id="T7:U551">asin(<span class="mxinfo " id="T7:U552">(<span class="mxinfo " id="T7:U553"><span class="mxinfo " id="T7:U554"><span class="mxinfo " id="T5:U555"><span class="var type1" id="S62T72U712">e2</span>'</span>*<span class="mxinfo " id="T72:U557"><span class="var type1" id="S51T73U714">NJ</span>(<span class="mxinfo " id="T102:U559">:</span>,<span class="mxinfo " id="T49:U560">1</span>)</span></span> - <span class="mxinfo " id="T7:U561"><span class="mxinfo " id="T5:U562"><span class="var type1" id="S61T72U719">e1</span>'</span>*<span class="mxinfo " id="T72:U564"><span class="var type1" id="S51T73U721">NJ</span>(<span class="mxinfo " id="T102:U566">:</span>,<span class="mxinfo " id="T49:U567">2</span>)</span></span></span>)/<span class="mxinfo " id="T7:U568">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,158" id="srcline158">158</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,159" id="srcline159">159</a></span><span class="line"><span class="comment">% Basic displacements and rotations</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,160" id="srcline160">160</a></span><span class="line"><span class="comment">% D = [ul r1z r2z r1y r2y rx]'</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,161" id="srcline161">161</a></span><span class="line"><span class="mxinfo " id="T22:U569"><span class="var type1" id="S71T22U727">D</span> = <span class="mxinfo " id="T22:U571">zeros(6,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,162" id="srcline162">162</a></span><span class="line"><span class="mxinfo " id="T7:U572"><span class="mxinfo " id="T7:U573"><span class="var type1" id="S71T22U735">D</span>(<span class="mxinfo " id="T49:U575">1</span>)</span> = <span class="mxinfo " id="T7:U576">(<span class="mxinfo " id="T7:U577"><span class="mxinfo " id="T7:U578"><span class="var type1" id="S27T7U741">L</span>^2</span> - <span class="mxinfo " id="T7:U580"><span class="var type1" id="S22T7U744">L0</span>^2</span></span>)/(<span class="mxinfo " id="T7:U582"><span class="var type1" id="S27T7U748">L</span> + <span class="var type1" id="S22T7U749">L0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,163" id="srcline163">163</a></span><span class="line"><span class="mxinfo " id="T7:U585"><span class="mxinfo " id="T7:U586"><span class="var type1" id="S71T22U753">D</span>(<span class="mxinfo " id="T49:U588">2</span>)</span> = <span class="var type1" id="S67T7U755">phiI3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,164" id="srcline164">164</a></span><span class="line"><span class="mxinfo " id="T7:U590"><span class="mxinfo " id="T7:U591"><span class="var type1" id="S71T22U759">D</span>(<span class="mxinfo " id="T49:U593">3</span>)</span> = <span class="var type1" id="S70T7U761">phiJ3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,165" id="srcline165">165</a></span><span class="line"><span class="mxinfo " id="T7:U595"><span class="mxinfo " id="T7:U596"><span class="var type1" id="S71T22U765">D</span>(<span class="mxinfo " id="T49:U598">4</span>)</span> = <span class="var type1" id="S66T7U767">phiI2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,166" id="srcline166">166</a></span><span class="line"><span class="mxinfo " id="T7:U600"><span class="mxinfo " id="T7:U601"><span class="var type1" id="S71T22U771">D</span>(<span class="mxinfo " id="T49:U603">5</span>)</span> = <span class="var type1" id="S69T7U773">phiJ2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,167" id="srcline167">167</a></span><span class="line"><span class="mxinfo " id="T7:U605"><span class="mxinfo " id="T7:U606"><span class="var type1" id="S71T22U777">D</span>(<span class="mxinfo " id="T49:U608">6</span>)</span> = <span class="mxinfo " id="T7:U609"><span class="var type1" id="S68T7U780">phiJ1</span> - <span class="var type1" id="S64T7U781">phiI1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,168" id="srcline168">168</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,169" id="srcline169">169</a></span><span class="line"><span class="comment">% Transformation matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,170" id="srcline170">170</a></span><span class="line"><span class="mxinfo " id="T73:U612"><span class="var type1" id="S73T73U784">A</span> = <span class="mxinfo " id="T73:U614"><span class="mxinfo " id="T7:U615"><span class="mxinfo " id="T7:U616">1</span>/<span class="var type1" id="S27T7U788">L</span></span>*(<span class="mxinfo " id="T73:U618"><span class="mxinfo " id="T73:U619">eye(3)</span> - <span class="mxinfo " id="T73:U620"><span class="var type1" id="S61T72U795">e1</span>*<span class="mxinfo " id="T5:U622"><span class="var type1" id="S61T72U797">e1</span>'</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,171" id="srcline171">171</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,172" id="srcline172">172</a></span><span class="line"><span class="comment">% Get L matrices</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,173" id="srcline173">173</a></span><span class="line"><span class="mxinfo " id="T162:U624"><span class="var type1" id="S75T162U800">L_r2</span> = <span class="mxinfo " id="T162:U626"><span class="fcn" id="F838N16:B802">get_L</span>(<span class="mxinfo " id="T72:U627"><span class="var type1" id="S52T73U804">R_bar</span>(<span class="mxinfo " id="T102:U629">:</span>,<span class="mxinfo " id="T49:U630">2</span>)</span>,<span class="var type1" id="S61T72U807">e1</span>,<span class="var type1" id="S27T7U808">L</span>,<span class="mxinfo " id="T72:U633"><span class="var type1" id="S52T73U810">R_bar</span>(<span class="mxinfo " id="T102:U635">:</span>,<span class="mxinfo " id="T49:U636">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,174" id="srcline174">174</a></span><span class="line"><span class="mxinfo " id="T162:U637"><span class="var type1" id="S77T162U815">L_r3</span> = <span class="mxinfo " id="T162:U639"><span class="fcn" id="F838N16:B817">get_L</span>(<span class="mxinfo " id="T72:U640"><span class="var type1" id="S52T73U819">R_bar</span>(<span class="mxinfo " id="T102:U642">:</span>,<span class="mxinfo " id="T49:U643">3</span>)</span>,<span class="var type1" id="S61T72U822">e1</span>,<span class="var type1" id="S27T7U823">L</span>,<span class="mxinfo " id="T72:U646"><span class="var type1" id="S52T73U825">R_bar</span>(<span class="mxinfo " id="T102:U648">:</span>,<span class="mxinfo " id="T49:U649">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,175" id="srcline175">175</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,176" id="srcline176">176</a></span><span class="line"><span class="comment">% Get h vectors</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,177" id="srcline177">177</a></span><span class="line"><span class="mxinfo " id="T73:U650"><span class="var type1" id="S78T73U830">S_nI1</span> = <span class="mxinfo " id="T73:U652"><span class="fcn" id="F223N19:B832">get_S</span>(<span class="mxinfo " id="T72:U653"><span class="var type1" id="S49T73U834">NI</span>(<span class="mxinfo " id="T102:U655">:</span>,<span class="mxinfo " id="T49:U656">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,178" id="srcline178">178</a></span><span class="line"><span class="mxinfo " id="T73:U657"><span class="var type1" id="S80T73U839">S_nI2</span> = <span class="mxinfo " id="T73:U659"><span class="fcn" id="F223N19:B841">get_S</span>(<span class="mxinfo " id="T72:U660"><span class="var type1" id="S49T73U843">NI</span>(<span class="mxinfo " id="T102:U662">:</span>,<span class="mxinfo " id="T49:U663">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,179" id="srcline179">179</a></span><span class="line"><span class="mxinfo " id="T73:U664"><span class="var type1" id="S81T73U848">S_nI3</span> = <span class="mxinfo " id="T73:U666"><span class="fcn" id="F223N19:B850">get_S</span>(<span class="mxinfo " id="T72:U667"><span class="var type1" id="S49T73U852">NI</span>(<span class="mxinfo " id="T102:U669">:</span>,<span class="mxinfo " id="T49:U670">3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,180" id="srcline180">180</a></span><span class="line"><span class="mxinfo " id="T73:U671"><span class="var type1" id="S82T73U857">S_nJ1</span> = <span class="mxinfo " id="T73:U673"><span class="fcn" id="F223N19:B859">get_S</span>(<span class="mxinfo " id="T72:U674"><span class="var type1" id="S51T73U861">NJ</span>(<span class="mxinfo " id="T102:U676">:</span>,<span class="mxinfo " id="T49:U677">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,181" id="srcline181">181</a></span><span class="line"><span class="mxinfo " id="T73:U678"><span class="var type1" id="S83T73U866">S_nJ2</span> = <span class="mxinfo " id="T73:U680"><span class="fcn" id="F223N19:B868">get_S</span>(<span class="mxinfo " id="T72:U681"><span class="var type1" id="S51T73U870">NJ</span>(<span class="mxinfo " id="T102:U683">:</span>,<span class="mxinfo " id="T49:U684">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,182" id="srcline182">182</a></span><span class="line"><span class="mxinfo " id="T73:U685"><span class="var type1" id="S84T73U875">S_nJ3</span> = <span class="mxinfo " id="T73:U687"><span class="fcn" id="F223N19:B877">get_S</span>(<span class="mxinfo " id="T72:U688"><span class="var type1" id="S51T73U879">NJ</span>(<span class="mxinfo " id="T102:U690">:</span>,<span class="mxinfo " id="T49:U691">3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,183" id="srcline183">183</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,184" id="srcline184">184</a></span><span class="line"><span class="mxinfo " id="T36:U692"><span class="var type1" id="S85T36U884">hI1</span> = <span class="mxinfo " id="T36:U694"><span class="mxinfo " id="T40:U695">[<span class="mxinfo " id="T7:U696">0</span> <span class="mxinfo " id="T7:U697">0</span> <span class="mxinfo " id="T7:U698">0</span> <span class="mxinfo " id="T5:U699">(<span class="mxinfo " id="T72:U700"><span class="mxinfo " id="T72:U701"><span class="var type1" id="S80T73U895">S_nI2</span>*<span class="var type1" id="S63T72U896">e3</span></span> - <span class="mxinfo " id="T72:U704"><span class="var type1" id="S81T73U898">S_nI3</span>*<span class="var type1" id="S62T72U899">e2</span></span></span>)'</span> <span class="mxinfo " id="T7:U707">0</span> <span class="mxinfo " id="T7:U708">0</span> <span class="mxinfo " id="T7:U709">0</span> <span class="mxinfo " id="T7:U710">0</span> <span class="mxinfo " id="T7:U711">0</span> <span class="mxinfo " id="T7:U712">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,185" id="srcline185">185</a></span><span class="line"><span class="mxinfo " id="T36:U713"><span class="var type1" id="S86T36U908">hI2</span> = <span class="mxinfo " id="T36:U715"><span class="mxinfo " id="T40:U716">[<span class="mxinfo " id="T5:U717">(<span class="mxinfo " id="T72:U718"><span class="var type1" id="S73T73U915">A</span>*<span class="mxinfo " id="T72:U720"><span class="var type1" id="S49T73U917">NI</span>(<span class="mxinfo " id="T102:U722">:</span>,<span class="mxinfo " id="T49:U723">3</span>)</span></span>)'</span> <span class="mxinfo " id="T5:U724">(<span class="mxinfo " id="T72:U725"><span class="mxinfo " id="T72:U726"><span class="var type1" id="S78T73U924">S_nI1</span>*<span class="var type1" id="S63T72U925">e3</span></span> - <span class="mxinfo " id="T72:U729"><span class="var type1" id="S81T73U927">S_nI3</span>*<span class="var type1" id="S61T72U928">e1</span></span></span>)'</span> <span class="mxinfo " id="T5:U732">-<span class="mxinfo " id="T5:U733">(<span class="mxinfo " id="T72:U734"><span class="var type1" id="S73T73U933">A</span>*<span class="mxinfo " id="T72:U736"><span class="var type1" id="S49T73U935">NI</span>(<span class="mxinfo " id="T102:U738">:</span>,<span class="mxinfo " id="T49:U739">3</span>)</span></span>)'</span></span> <span class="mxinfo " id="T7:U740">0</span> <span class="mxinfo " id="T7:U741">0</span> <span class="mxinfo " id="T7:U742">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,186" id="srcline186">186</a></span><span class="line"><span class="mxinfo " id="T36:U743"><span class="var type1" id="S87T36U943">hI3</span> = <span class="mxinfo " id="T36:U745"><span class="mxinfo " id="T40:U746">[<span class="mxinfo " id="T5:U747">(<span class="mxinfo " id="T72:U748"><span class="var type1" id="S73T73U950">A</span>*<span class="mxinfo " id="T72:U750"><span class="var type1" id="S49T73U952">NI</span>(<span class="mxinfo " id="T102:U752">:</span>,<span class="mxinfo " id="T49:U753">2</span>)</span></span>)'</span> <span class="mxinfo " id="T5:U754">(<span class="mxinfo " id="T72:U755"><span class="mxinfo " id="T72:U756"><span class="var type1" id="S78T73U959">S_nI1</span>*<span class="var type1" id="S62T72U960">e2</span></span> - <span class="mxinfo " id="T72:U759"><span class="var type1" id="S80T73U962">S_nI2</span>*<span class="var type1" id="S61T72U963">e1</span></span></span>)'</span> <span class="mxinfo " id="T5:U762">-<span class="mxinfo " id="T5:U763">(<span class="mxinfo " id="T72:U764"><span class="var type1" id="S73T73U968">A</span>*<span class="mxinfo " id="T72:U766"><span class="var type1" id="S49T73U970">NI</span>(<span class="mxinfo " id="T102:U768">:</span>,<span class="mxinfo " id="T49:U769">2</span>)</span></span>)'</span></span> <span class="mxinfo " id="T7:U770">0</span> <span class="mxinfo " id="T7:U771">0</span> <span class="mxinfo " id="T7:U772">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,187" id="srcline187">187</a></span><span class="line"><span class="mxinfo " id="T36:U773"><span class="var type1" id="S88T36U978">hJ1</span> = <span class="mxinfo " id="T36:U775"><span class="mxinfo " id="T40:U776">[<span class="mxinfo " id="T7:U777">0</span> <span class="mxinfo " id="T7:U778">0</span> <span class="mxinfo " id="T7:U779">0</span> <span class="mxinfo " id="T7:U780">0</span> <span class="mxinfo " id="T7:U781">0</span> <span class="mxinfo " id="T7:U782">0</span> <span class="mxinfo " id="T7:U783">0</span> <span class="mxinfo " id="T7:U784">0</span> <span class="mxinfo " id="T7:U785">0</span> <span class="mxinfo " id="T5:U786">(<span class="mxinfo " id="T72:U787"><span class="mxinfo " id="T72:U788"><span class="var type1" id="S83T73U995">S_nJ2</span>*<span class="var type1" id="S63T72U996">e3</span></span> - <span class="mxinfo " id="T72:U791"><span class="var type1" id="S84T73U998">S_nJ3</span>*<span class="var type1" id="S62T72U999">e2</span></span></span>)'</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,188" id="srcline188">188</a></span><span class="line"><span class="mxinfo " id="T36:U794"><span class="var type1" id="S89T36U1002">hJ2</span> = <span class="mxinfo " id="T36:U796"><span class="mxinfo " id="T40:U797">[<span class="mxinfo " id="T5:U798">(<span class="mxinfo " id="T72:U799"><span class="var type1" id="S73T73U1009">A</span>*<span class="mxinfo " id="T72:U801"><span class="var type1" id="S51T73U1011">NJ</span>(<span class="mxinfo " id="T102:U803">:</span>,<span class="mxinfo " id="T49:U804">3</span>)</span></span>)'</span> <span class="mxinfo " id="T7:U805">0</span> <span class="mxinfo " id="T7:U806">0</span> <span class="mxinfo " id="T7:U807">0</span> <span class="mxinfo " id="T5:U808">-<span class="mxinfo " id="T5:U809">(<span class="mxinfo " id="T72:U810"><span class="var type1" id="S73T73U1021">A</span>*<span class="mxinfo " id="T72:U812"><span class="var type1" id="S51T73U1023">NJ</span>(<span class="mxinfo " id="T102:U814">:</span>,<span class="mxinfo " id="T49:U815">3</span>)</span></span>)'</span></span> <span class="mxinfo " id="T5:U816">(<span class="mxinfo " id="T72:U817"><span class="mxinfo " id="T72:U818"><span class="var type1" id="S82T73U1030">S_nJ1</span>*<span class="var type1" id="S63T72U1031">e3</span></span> - <span class="mxinfo " id="T72:U821"><span class="var type1" id="S84T73U1033">S_nJ3</span>*<span class="var type1" id="S61T72U1034">e1</span></span></span>)'</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,189" id="srcline189">189</a></span><span class="line"><span class="mxinfo " id="T36:U824"><span class="var type1" id="S90T36U1037">hJ3</span> = <span class="mxinfo " id="T36:U826"><span class="mxinfo " id="T40:U827">[<span class="mxinfo " id="T5:U828">(<span class="mxinfo " id="T72:U829"><span class="var type1" id="S73T73U1044">A</span>*<span class="mxinfo " id="T72:U831"><span class="var type1" id="S51T73U1046">NJ</span>(<span class="mxinfo " id="T102:U833">:</span>,<span class="mxinfo " id="T49:U834">2</span>)</span></span>)'</span> <span class="mxinfo " id="T7:U835">0</span> <span class="mxinfo " id="T7:U836">0</span> <span class="mxinfo " id="T7:U837">0</span> <span class="mxinfo " id="T5:U838">-<span class="mxinfo " id="T5:U839">(<span class="mxinfo " id="T72:U840"><span class="var type1" id="S73T73U1056">A</span>*<span class="mxinfo " id="T72:U842"><span class="var type1" id="S51T73U1058">NJ</span>(<span class="mxinfo " id="T102:U844">:</span>,<span class="mxinfo " id="T49:U845">2</span>)</span></span>)'</span></span> <span class="mxinfo " id="T5:U846">(<span class="mxinfo " id="T72:U847"><span class="mxinfo " id="T72:U848"><span class="var type1" id="S82T73U1065">S_nJ1</span>*<span class="var type1" id="S62T72U1066">e2</span></span> - <span class="mxinfo " id="T72:U851"><span class="var type1" id="S83T73U1068">S_nJ2</span>*<span class="var type1" id="S61T72U1069">e1</span></span></span>)'</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,190" id="srcline190">190</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,191" id="srcline191">191</a></span><span class="line"><span class="comment">% Get t vectors and T matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,192" id="srcline192">192</a></span><span class="line"><span class="mxinfo " id="T40:U854"><span class="var type1" id="S91T40U1072">t1</span> = <span class="mxinfo " id="T40:U856">[<span class="mxinfo " id="T5:U857">-<span class="mxinfo " id="T5:U858"><span class="var type1" id="S61T72U1077">e1</span>'</span></span> <span class="mxinfo " id="T7:U860">0</span> <span class="mxinfo " id="T7:U861">0</span> <span class="mxinfo " id="T7:U862">0</span> <span class="mxinfo " id="T5:U863"><span class="var type1" id="S61T72U1082">e1</span>'</span> <span class="mxinfo " id="T7:U865">0</span> <span class="mxinfo " id="T7:U866">0</span> <span class="mxinfo " id="T7:U867">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,193" id="srcline193">193</a></span><span class="line"><span class="mxinfo " id="T40:U868"><span class="var type1" id="S92T40U1088">t2</span> = <span class="mxinfo " id="T40:U870"><span class="mxinfo " id="T7:U871"><span class="mxinfo " id="T7:U872">1</span>/(<span class="mxinfo " id="T7:U873"><span class="mxinfo " id="T7:U874">2</span>*<span class="mxinfo " id="T7:U875">cos(<span class="var type1" id="S67T7U1097">phiI3</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U877">(<span class="mxinfo " id="T36:U878"><span class="mxinfo " id="T36:U879"><span class="var type1" id="S75T162U1102">L_r2</span>*<span class="mxinfo " id="T72:U881"><span class="var type1" id="S49T73U1104">NI</span>(<span class="mxinfo " id="T102:U883">:</span>,<span class="mxinfo " id="T49:U884">1</span>)</span></span> + <span class="var type1" id="S87T36U1107">hI3</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,194" id="srcline194">194</a></span><span class="line"><span class="mxinfo " id="T40:U886"><span class="var type1" id="S94T40U1110">t3</span> = <span class="mxinfo " id="T40:U888"><span class="mxinfo " id="T7:U889"><span class="mxinfo " id="T7:U890">1</span>/(<span class="mxinfo " id="T7:U891"><span class="mxinfo " id="T7:U892">2</span>*<span class="mxinfo " id="T7:U893">cos(<span class="var type1" id="S70T7U1119">phiJ3</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U895">(<span class="mxinfo " id="T36:U896"><span class="mxinfo " id="T36:U897"><span class="var type1" id="S75T162U1124">L_r2</span>*<span class="mxinfo " id="T72:U899"><span class="var type1" id="S51T73U1126">NJ</span>(<span class="mxinfo " id="T102:U901">:</span>,<span class="mxinfo " id="T49:U902">1</span>)</span></span> + <span class="var type1" id="S90T36U1129">hJ3</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,195" id="srcline195">195</a></span><span class="line"><span class="mxinfo " id="T40:U904"><span class="var type1" id="S95T40U1132">t4</span> = <span class="mxinfo " id="T40:U906"><span class="mxinfo " id="T7:U907"><span class="mxinfo " id="T7:U908">1</span>/(<span class="mxinfo " id="T7:U909"><span class="mxinfo " id="T7:U910">2</span>*<span class="mxinfo " id="T7:U911">cos(<span class="var type1" id="S66T7U1141">phiI2</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U913">(<span class="mxinfo " id="T36:U914"><span class="mxinfo " id="T36:U915"><span class="mxinfo " id="T162:U916">-<span class="var type1" id="S77T162U1147">L_r3</span></span>*<span class="mxinfo " id="T72:U918"><span class="var type1" id="S49T73U1149">NI</span>(<span class="mxinfo " id="T102:U920">:</span>,<span class="mxinfo " id="T49:U921">1</span>)</span></span> - <span class="var type1" id="S86T36U1152">hI2</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,196" id="srcline196">196</a></span><span class="line"><span class="mxinfo " id="T40:U923"><span class="var type1" id="S96T40U1155">t5</span> = <span class="mxinfo " id="T40:U925"><span class="mxinfo " id="T7:U926"><span class="mxinfo " id="T7:U927">1</span>/(<span class="mxinfo " id="T7:U928"><span class="mxinfo " id="T7:U929">2</span>*<span class="mxinfo " id="T7:U930">cos(<span class="var type1" id="S69T7U1164">phiJ2</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U932">(<span class="mxinfo " id="T36:U933"><span class="mxinfo " id="T36:U934"><span class="mxinfo " id="T162:U935">-<span class="var type1" id="S77T162U1170">L_r3</span></span>*<span class="mxinfo " id="T72:U937"><span class="var type1" id="S51T73U1172">NJ</span>(<span class="mxinfo " id="T102:U939">:</span>,<span class="mxinfo " id="T49:U940">1</span>)</span></span> - <span class="var type1" id="S89T36U1175">hJ2</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,197" id="srcline197">197</a></span><span class="line"><span class="mxinfo " id="T40:U942"><span class="var type1" id="S97T40U1178">t6J</span> = <span class="mxinfo " id="T40:U944"><span class="mxinfo " id="T7:U945"><span class="mxinfo " id="T7:U946">1</span>/(<span class="mxinfo " id="T7:U947"><span class="mxinfo " id="T7:U948">2</span>*<span class="mxinfo " id="T7:U949">cos(<span class="var type1" id="S68T7U1187">phiJ1</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U951">(<span class="mxinfo " id="T36:U952"><span class="mxinfo " id="T36:U953"><span class="mxinfo " id="T36:U954"><span class="var type1" id="S77T162U1193">L_r3</span>*<span class="mxinfo " id="T72:U956"><span class="var type1" id="S51T73U1195">NJ</span>(<span class="mxinfo " id="T102:U958">:</span>,<span class="mxinfo " id="T49:U959">2</span>)</span></span> - <span class="mxinfo " id="T36:U960"><span class="var type1" id="S75T162U1199">L_r2</span>*<span class="mxinfo " id="T72:U962"><span class="var type1" id="S51T73U1201">NJ</span>(<span class="mxinfo " id="T102:U964">:</span>,<span class="mxinfo " id="T49:U965">3</span>)</span></span></span> + <span class="var type1" id="S88T36U1204">hJ1</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,198" id="srcline198">198</a></span><span class="line"><span class="mxinfo " id="T40:U967"><span class="var type1" id="S98T40U1207">t6I</span> = <span class="mxinfo " id="T40:U969"><span class="mxinfo " id="T7:U970"><span class="mxinfo " id="T7:U971">1</span>/(<span class="mxinfo " id="T7:U972"><span class="mxinfo " id="T7:U973">2</span>*<span class="mxinfo " id="T7:U974">cos(<span class="var type1" id="S64T7U1216">phiI1</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U976">(<span class="mxinfo " id="T36:U977"><span class="mxinfo " id="T36:U978"><span class="mxinfo " id="T36:U979"><span class="var type1" id="S77T162U1222">L_r3</span>*<span class="mxinfo " id="T72:U981"><span class="var type1" id="S49T73U1224">NI</span>(<span class="mxinfo " id="T102:U983">:</span>,<span class="mxinfo " id="T49:U984">2</span>)</span></span> - <span class="mxinfo " id="T36:U985"><span class="var type1" id="S75T162U1228">L_r2</span>*<span class="mxinfo " id="T72:U987"><span class="var type1" id="S49T73U1230">NI</span>(<span class="mxinfo " id="T102:U989">:</span>,<span class="mxinfo " id="T49:U990">3</span>)</span></span></span> + <span class="var type1" id="S85T36U1233">hI1</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,199" id="srcline199">199</a></span><span class="line"><span class="mxinfo " id="T40:U992"><span class="var type1" id="S99T40U1236">t6</span> = <span class="mxinfo " id="T40:U994"><span class="var type1" id="S97T40U1238">t6J</span> - <span class="var type1" id="S98T40U1239">t6I</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,200" id="srcline200">200</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,201" id="srcline201">201</a></span><span class="line"><span class="mxinfo " id="T166:U997"><span class="var type1" id="S100T166U1242">T</span> = <span class="mxinfo " id="T166:U999">[<span class="var type1" id="S91T40U1245">t1</span>; <span class="var type1" id="S92T40U1247">t2</span>; <span class="var type1" id="S94T40U1249">t3</span>; <span class="var type1" id="S95T40U1251">t4</span>; <span class="var type1" id="S96T40U1253">t5</span>; <span class="var type1" id="S99T40U1255">t6</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,202" id="srcline202">202</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,203" id="srcline203">203</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,204" id="srcline204">204</a></span><span class="line"><span class="comment">% % % % Axial stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,205" id="srcline205">205</a></span><span class="line"><span class="comment">% % % eps_ax = D(1)/L0; % Axial strain</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,206" id="srcline206">206</a></span><span class="line"><span class="comment">% % % d_eps = 1e-4; % step size</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,207" id="srcline207">207</a></span><span class="line"><span class="comment">% % % f = ppval(axial,[eps_ax eps_ax + d_eps]'); % interp1(axial(:,2),axial(:,1),[eps_ax eps_ax + d_eps]'); % Interpolate for force</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,208" id="srcline208">208</a></span><span class="line"><span class="comment">% % % EAax = (f(2) - f(1))/d_eps; % Stiffness is derivative of force-stain relationship</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,209" id="srcline209">209</a></span><span class="line"><span class="comment">% % % geom(1) = EAax/mat(1); % Vary cross sectional area</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,210" id="srcline210">210</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,211" id="srcline211">211</a></span><span class="line"><span class="comment">% % % % Axial stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,212" id="srcline212">212</a></span><span class="line"><span class="comment">% % % d_eps = 1e-4; % step size</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,213" id="srcline213">213</a></span><span class="line"><span class="comment">% % % eps_ax = D(1)/L0; % Axial strain</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,214" id="srcline214">214</a></span><span class="line"><span class="comment">% % % f = interp1(axial(:,2),axial(:,1),[eps_ax eps_ax + d_eps]'); % Interpolate for force % ppval(axial,eps_ax); % </span></span></span>
<span class="srcline"><span class="lineno"><a href="167,215" id="srcline215">215</a></span><span class="line"><span class="comment">% % % EAax = (f(2) - f(1))/d_eps; % interp1(axial_k(:,2),axial_k(:,1),eps_ax); % ppval(axial_k,eps_ax); % Stiffness is derivative of force-stain relationship % </span></span></span>
<span class="srcline"><span class="lineno"><a href="167,216" id="srcline216">216</a></span><span class="line"><span class="comment">% % % geom(1) = EAax/mat(1); % Vary cross sectional area</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,217" id="srcline217">217</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,218" id="srcline218">218</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,219" id="srcline219">219</a></span><span class="line"><span class="comment">% Axial stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,220" id="srcline220">220</a></span><span class="line"><span class="comment">% try</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,221" id="srcline221">221</a></span><span class="line"><span class="comment">%     eps0 = el_in0.eps0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,222" id="srcline222">222</a></span><span class="line"><span class="comment">% catch</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,223" id="srcline223">223</a></span><span class="line"><span class="comment">%     eps0 = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,224" id="srcline224">224</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,225" id="srcline225">225</a></span><span class="line"><span class="mxinfo " id="T7:U1006"><span class="var type1" id="S101T7U1258">eps0</span> = <span class="mxinfo " id="T7:U1008"><span class="var type1" id="S9T168U1260">el_in0</span>.eps0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,226" id="srcline226">226</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,227" id="srcline227">227</a></span><span class="line"><span class="mxinfo " id="T7:U1010"><span class="var type1" id="S102T7U1264">eps_ax</span> = <span class="mxinfo " id="T7:U1012"><span class="mxinfo " id="T7:U1013"><span class="mxinfo " id="T7:U1014"><span class="var type1" id="S71T22U1268">D</span>(<span class="mxinfo " id="T49:U1016">1</span>)</span>/<span class="var type1" id="S22T7U1270">L0</span></span> + <span class="var type1" id="S101T7U1271">eps0</span></span></span>; <span class="comment">% Axial strain</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,228" id="srcline228">228</a></span><span class="line"><span class="mxinfo " id="T7:U1019"><span class="var type1" id="S103T7U1274">f</span> = <span class="mxinfo " id="T7:U1021"><span class="fcn" id="F1060N25:B1276">ppval_fast</span>(<span class="var type1" id="S14T10U1277">axial</span>,<span class="var type1" id="S102T7U1278">eps_ax</span>)</span></span>; <span class="comment">% interp1(axial(:,2),axial(:,1),[eps_ax eps_ax + d_eps]'); % Interpolate for force % </span></span></span>
<span class="srcline"><span class="lineno"><a href="167,229" id="srcline229">229</a></span><span class="line"><span class="mxinfo " id="T7:U1024"><span class="var type1" id="S105T7U1281">EAax</span> = <span class="mxinfo " id="T7:U1026"><span class="fcn" id="F1067N25:B1283">ppval_fast</span>(<span class="var type1" id="S15T14U1284">axial_k</span>,<span class="var type1" id="S102T7U1285">eps_ax</span>)</span></span>; <span class="comment">% Stiffness is derivative of force-stain relationship % (f(2) - f(1))/d_eps; % interp1(axial_k(:,2),axial_k(:,1),eps_ax); % </span></span></span>
<span class="srcline"><span class="lineno"><a href="167,230" id="srcline230">230</a></span><span class="line"><span class="mxinfo " id="T7:U1029"><span class="mxinfo " id="T7:U1030"><span class="var type1" id="S13T9U1289">geom</span>(<span class="mxinfo " id="T49:U1032">1</span>)</span> = <span class="mxinfo " id="T7:U1033"><span class="var type1" id="S105T7U1292">EAax</span>/<span class="mxinfo " id="T7:U1035"><span class="var type1" id="S12T8U1294">mat</span>(<span class="mxinfo " id="T49:U1037">1</span>)</span></span></span>; <span class="comment">% Vary cross sectional area</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,231" id="srcline231">231</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,232" id="srcline232">232</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,233" id="srcline233">233</a></span><span class="line"><span class="comment">% if el_in0.el &gt; 12729</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,234" id="srcline234">234</a></span><span class="line"><span class="comment">%     geom(1) = 114000/mat(1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,235" id="srcline235">235</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,236" id="srcline236">236</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,237" id="srcline237">237</a></span><span class="line"><span class="comment">% % % % Axial stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,238" id="srcline238">238</a></span><span class="line"><span class="comment">% % % eps_ax = D(1)/L0; % Axial strain</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,239" id="srcline239">239</a></span><span class="line"><span class="comment">% % % f = 114000*eps_ax; % interp1(axial(:,2),axial(:,1),[eps_ax eps_ax + d_eps]'); % Interpolate for force</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,240" id="srcline240">240</a></span><span class="line"><span class="comment">% % % EAax = 114000; % Stiffness is derivative of force-stain relationship</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,241" id="srcline241">241</a></span><span class="line"><span class="comment">% % % geom(1) = EAax/mat(1); % Vary cross sectional area</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,242" id="srcline242">242</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,243" id="srcline243">243</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,244" id="srcline244">244</a></span><span class="line"><span class="comment">% Linear stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,245" id="srcline245">245</a></span><span class="line"><span class="mxinfo " id="T163:U1038"><span class="var type1" id="S106T163U1298">k</span> = <span class="mxinfo " id="T163:U1040"><span class="fcn" id="F953N23:B1300">k1</span>(<span class="var type1" id="S12T8U1301">mat</span>,<span class="var type1" id="S13T9U1302">geom</span>,<span class="var type1" id="S22T7U1303">L0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,246" id="srcline246">246</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,247" id="srcline247">247</a></span><span class="line"><span class="comment">% Condense into relevant entries for corotational formulation</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,248" id="srcline248">248</a></span><span class="line"><span class="mxinfo " id="T165:U1044"><span class="var type1" id="S106T165U1306">k</span> = <span class="mxinfo " id="T165:U1046">[<span class="mxinfo " id="T36:U1047"><span class="var type1" id="S106T163U1310">k</span>(<span class="mxinfo " id="T37:U1049">:</span>,<span class="mxinfo " id="T49:U1050">1</span>)</span> <span class="mxinfo " id="T36:U1051"><span class="var type1" id="S106T163U1314">k</span>(<span class="mxinfo " id="T37:U1053">:</span>,<span class="mxinfo " id="T49:U1054">6</span>)</span> <span class="mxinfo " id="T36:U1055"><span class="var type1" id="S106T163U1318">k</span>(<span class="mxinfo " id="T37:U1057">:</span>,<span class="mxinfo " id="T49:U1058">12</span>)</span> <span class="mxinfo " id="T36:U1059"><span class="var type1" id="S106T163U1322">k</span>(<span class="mxinfo " id="T37:U1061">:</span>,<span class="mxinfo " id="T49:U1062">5</span>)</span> <span class="mxinfo " id="T36:U1063"><span class="var type1" id="S106T163U1326">k</span>(<span class="mxinfo " id="T37:U1065">:</span>,<span class="mxinfo " id="T49:U1066">11</span>)</span> <span class="mxinfo " id="T36:U1067"><span class="var type1" id="S106T163U1330">k</span>(<span class="mxinfo " id="T37:U1069">:</span>,<span class="mxinfo " id="T49:U1070">4</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,249" id="srcline249">249</a></span><span class="line"><span class="mxinfo " id="T15:U1071"><span class="var type1" id="S108T15U1335">KL</span> = <span class="mxinfo " id="T15:U1073">[<span class="mxinfo " id="T110:U1074"><span class="var type1" id="S106T165U1339">k</span>(<span class="mxinfo " id="T49:U1076">1</span>,<span class="mxinfo " id="T172:U1077">:</span>)</span> <span class="comment">% [u1x r1z r2z r1y r2y r1x]</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,250" id="srcline250">250</a></span><span class="line">    <span class="mxinfo " id="T110:U1078"><span class="var type1" id="S106T165U1344">k</span>(<span class="mxinfo " id="T49:U1080">6</span>,<span class="mxinfo " id="T172:U1081">:</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,251" id="srcline251">251</a></span><span class="line">    <span class="mxinfo " id="T110:U1082"><span class="var type1" id="S106T165U1349">k</span>(<span class="mxinfo " id="T49:U1084">12</span>,<span class="mxinfo " id="T172:U1085">:</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,252" id="srcline252">252</a></span><span class="line">    <span class="mxinfo " id="T110:U1086"><span class="var type1" id="S106T165U1354">k</span>(<span class="mxinfo " id="T49:U1088">5</span>,<span class="mxinfo " id="T172:U1089">:</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,253" id="srcline253">253</a></span><span class="line">    <span class="mxinfo " id="T110:U1090"><span class="var type1" id="S106T165U1359">k</span>(<span class="mxinfo " id="T49:U1092">11</span>,<span class="mxinfo " id="T172:U1093">:</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,254" id="srcline254">254</a></span><span class="line">    <span class="mxinfo " id="T110:U1094"><span class="var type1" id="S106T165U1364">k</span>(<span class="mxinfo " id="T49:U1096">4</span>,<span class="mxinfo " id="T172:U1097">:</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,255" id="srcline255">255</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,256" id="srcline256">256</a></span><span class="line"><span class="mxinfo " id="T22:U1098"><span class="var type1" id="S109T22U1369">P</span> = <span class="mxinfo " id="T22:U1100"><span class="var type1" id="S108T15U1371">KL</span>*<span class="var type1" id="S71T22U1372">D</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,257" id="srcline257">257</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,258" id="srcline258">258</a></span><span class="line"><span class="comment">% Interpoate for axial force</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,259" id="srcline259">259</a></span><span class="line"><span class="mxinfo " id="T7:U1103"><span class="mxinfo " id="T7:U1104"><span class="var type1" id="S109T22U1376">P</span>(<span class="mxinfo " id="T49:U1106">1</span>)</span> = <span class="var type1" id="S103T7U1379">f</span>(1)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,260" id="srcline260">260</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,261" id="srcline261">261</a></span><span class="line"><span class="comment">% Internal forces in local coordinate system</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,262" id="srcline262">262</a></span><span class="line"><span class="mxinfo " id="T36:U1108"><span class="var type1" id="S3T36U1383">fint_i</span> = <span class="mxinfo " id="T36:U1110">[<span class="mxinfo " id="T7:U1111">-<span class="mxinfo " id="T7:U1112"><span class="var type1" id="S109T22U1388">P</span>(<span class="mxinfo " id="T49:U1114">1</span>)</span></span>       <span class="comment">% Vx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,263" id="srcline263">263</a></span><span class="line">    <span class="mxinfo " id="T7:U1115">(<span class="mxinfo " id="T7:U1116"><span class="mxinfo " id="T7:U1117"><span class="var type1" id="S109T22U1395">P</span>(<span class="mxinfo " id="T49:U1119">3</span>)</span> + <span class="mxinfo " id="T7:U1120"><span class="var type1" id="S109T22U1398">P</span>(<span class="mxinfo " id="T7:U1122">2</span>)</span></span>)/<span class="var type1" id="S27T7U1400">L</span></span>   <span class="comment">% Vy1</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,264" id="srcline264">264</a></span><span class="line">    <span class="mxinfo " id="T7:U1124"><span class="mxinfo " id="T7:U1125">-(<span class="mxinfo " id="T7:U1126"><span class="mxinfo " id="T7:U1127"><span class="var type1" id="S109T22U1407">P</span>(<span class="mxinfo " id="T49:U1129">5</span>)</span> + <span class="mxinfo " id="T7:U1130"><span class="var type1" id="S109T22U1410">P</span>(<span class="mxinfo " id="T7:U1132">4</span>)</span></span>)</span>/<span class="var type1" id="S27T7U1412">L</span></span>  <span class="comment">% Vz1</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,265" id="srcline265">265</a></span><span class="line">    <span class="mxinfo " id="T7:U1134">-<span class="mxinfo " id="T7:U1135"><span class="var type1" id="S109T22U1416">P</span>(<span class="mxinfo " id="T49:U1137">6</span>)</span></span>             <span class="comment">% Mx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,266" id="srcline266">266</a></span><span class="line">    <span class="mxinfo " id="T7:U1138"><span class="var type1" id="S109T22U1420">P</span>(<span class="mxinfo " id="T49:U1140">4</span>)</span>              <span class="comment">% My1</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,267" id="srcline267">267</a></span><span class="line">    <span class="mxinfo " id="T7:U1141"><span class="var type1" id="S109T22U1424">P</span>(<span class="mxinfo " id="T49:U1143">2</span>)</span>              <span class="comment">% Mz1</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,268" id="srcline268">268</a></span><span class="line">    <span class="mxinfo " id="T7:U1144"><span class="var type1" id="S109T22U1428">P</span>(<span class="mxinfo " id="T49:U1146">1</span>)</span>              <span class="comment">% Vx2</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,269" id="srcline269">269</a></span><span class="line">    <span class="mxinfo " id="T7:U1147"><span class="mxinfo " id="T7:U1148">-(<span class="mxinfo " id="T7:U1149"><span class="mxinfo " id="T7:U1150"><span class="var type1" id="S109T22U1436">P</span>(<span class="mxinfo " id="T49:U1152">3</span>)</span> + <span class="mxinfo " id="T7:U1153"><span class="var type1" id="S109T22U1439">P</span>(<span class="mxinfo " id="T7:U1155">2</span>)</span></span>)</span>/<span class="var type1" id="S27T7U1441">L</span></span>  <span class="comment">% Vy2</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,270" id="srcline270">270</a></span><span class="line">    <span class="mxinfo " id="T7:U1157">(<span class="mxinfo " id="T7:U1158"><span class="mxinfo " id="T7:U1159"><span class="var type1" id="S109T22U1447">P</span>(<span class="mxinfo " id="T49:U1161">5</span>)</span> + <span class="mxinfo " id="T7:U1162"><span class="var type1" id="S109T22U1450">P</span>(<span class="mxinfo " id="T7:U1164">4</span>)</span></span>)/<span class="var type1" id="S27T7U1452">L</span></span>   <span class="comment">% Vz2</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,271" id="srcline271">271</a></span><span class="line">    <span class="mxinfo " id="T7:U1166"><span class="var type1" id="S109T22U1455">P</span>(<span class="mxinfo " id="T49:U1168">6</span>)</span>              <span class="comment">% Mx2</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,272" id="srcline272">272</a></span><span class="line">    <span class="mxinfo " id="T7:U1169"><span class="var type1" id="S109T22U1459">P</span>(<span class="mxinfo " id="T49:U1171">5</span>)</span>              <span class="comment">% My2</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,273" id="srcline273">273</a></span><span class="line">    <span class="mxinfo " id="T7:U1172"><span class="var type1" id="S109T22U1463">P</span>(<span class="mxinfo " id="T49:U1174">3</span>)</span>]</span></span>;            <span class="comment">% Mz2</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,274" id="srcline274">274</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,275" id="srcline275">275</a></span><span class="line"><span class="comment">% Scaled internal forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,276" id="srcline276">276</a></span><span class="line"><span class="mxinfo " id="T7:U1175"><span class="var type1" id="S110T7U1467">m2</span> = <span class="mxinfo " id="T7:U1177"><span class="mxinfo " id="T7:U1178"><span class="var type1" id="S109T22U1470">P</span>(<span class="mxinfo " id="T49:U1180">2</span>)</span>/(<span class="mxinfo " id="T7:U1181"><span class="mxinfo " id="T7:U1182">2</span>*<span class="mxinfo " id="T7:U1183">cos(<span class="var type1" id="S67T7U1477">phiI3</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,277" id="srcline277">277</a></span><span class="line"><span class="mxinfo " id="T7:U1185"><span class="var type1" id="S111T7U1480">m3</span> = <span class="mxinfo " id="T7:U1187"><span class="mxinfo " id="T7:U1188"><span class="var type1" id="S109T22U1483">P</span>(<span class="mxinfo " id="T49:U1190">3</span>)</span>/(<span class="mxinfo " id="T7:U1191"><span class="mxinfo " id="T7:U1192">2</span>*<span class="mxinfo " id="T7:U1193">cos(<span class="var type1" id="S70T7U1490">phiJ3</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,278" id="srcline278">278</a></span><span class="line"><span class="mxinfo " id="T7:U1195"><span class="var type1" id="S112T7U1493">m4</span> = <span class="mxinfo " id="T7:U1197"><span class="mxinfo " id="T7:U1198"><span class="var type1" id="S109T22U1496">P</span>(<span class="mxinfo " id="T49:U1200">4</span>)</span>/(<span class="mxinfo " id="T7:U1201"><span class="mxinfo " id="T7:U1202">2</span>*<span class="mxinfo " id="T7:U1203">cos(<span class="var type1" id="S66T7U1503">phiI2</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,279" id="srcline279">279</a></span><span class="line"><span class="mxinfo " id="T7:U1205"><span class="var type1" id="S113T7U1506">m5</span> = <span class="mxinfo " id="T7:U1207"><span class="mxinfo " id="T7:U1208"><span class="var type1" id="S109T22U1509">P</span>(<span class="mxinfo " id="T49:U1210">5</span>)</span>/(<span class="mxinfo " id="T7:U1211"><span class="mxinfo " id="T7:U1212">2</span>*<span class="mxinfo " id="T7:U1213">cos(<span class="var type1" id="S69T7U1516">phiJ2</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,280" id="srcline280">280</a></span><span class="line"><span class="mxinfo " id="T7:U1215"><span class="var type1" id="S114T7U1519">m6I</span> = <span class="mxinfo " id="T7:U1217"><span class="mxinfo " id="T7:U1218"><span class="var type1" id="S109T22U1522">P</span>(<span class="mxinfo " id="T49:U1220">6</span>)</span>/(<span class="mxinfo " id="T7:U1221"><span class="mxinfo " id="T7:U1222">2</span>*<span class="mxinfo " id="T7:U1223">cos(<span class="var type1" id="S64T7U1529">phiI1</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,281" id="srcline281">281</a></span><span class="line"><span class="mxinfo " id="T7:U1225"><span class="var type1" id="S115T7U1532">m6J</span> = <span class="mxinfo " id="T7:U1227"><span class="mxinfo " id="T7:U1228"><span class="var type1" id="S109T22U1535">P</span>(<span class="mxinfo " id="T49:U1230">6</span>)</span>/(<span class="mxinfo " id="T7:U1231"><span class="mxinfo " id="T7:U1232">2</span>*<span class="mxinfo " id="T7:U1233">cos(<span class="var type1" id="S68T7U1542">phiJ1</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,282" id="srcline282">282</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,283" id="srcline283">283</a></span><span class="line"><span class="comment">% Geometric stiffness matrix, KG</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,284" id="srcline284">284</a></span><span class="line"><span class="comment">% KA</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,285" id="srcline285">285</a></span><span class="line"><span class="mxinfo " id="T163:U1235"><span class="var type1" id="S116T163U1545">KA</span> = <span class="mxinfo " id="T163:U1237"><span class="mxinfo " id="T7:U1238"><span class="var type1" id="S109T22U1548">P</span>(<span class="mxinfo " id="T49:U1240">1</span>)</span>*<span class="mxinfo " id="T163:U1241">[<span class="mxinfo " id="T171:U1242"><span class="var type1" id="S73T73U1552">A</span> <span class="mxinfo " id="T73:U1244">zeros(3)</span> <span class="mxinfo " id="T73:U1245">-<span class="var type1" id="S73T73U1557">A</span></span> <span class="mxinfo " id="T73:U1247">zeros(3)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="167,286" id="srcline286">286</a></span><span class="line">    <span class="mxinfo " id="T171:U1248">zeros(3) zeros(3) zeros(3) zeros(3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,287" id="srcline287">287</a></span><span class="line">    <span class="mxinfo " id="T171:U1249"><span class="mxinfo " id="T73:U1250">-<span class="var type1" id="S73T73U1576">A</span></span> <span class="mxinfo " id="T73:U1252">zeros(3)</span> <span class="var type1" id="S73T73U1580">A</span> <span class="mxinfo " id="T73:U1254">zeros(3)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="167,288" id="srcline288">288</a></span><span class="line">    <span class="mxinfo " id="T171:U1255">zeros(3) zeros(3) zeros(3) zeros(3)</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,289" id="srcline289">289</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,290" id="srcline290">290</a></span><span class="line"><span class="comment">% KB</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,291" id="srcline291">291</a></span><span class="line"><span class="mxinfo " id="T163:U1256"><span class="var type1" id="S117T163U1599">KB</span> = <span class="mxinfo " id="T163:U1258"><span class="mxinfo " id="T163:U1259"><span class="mxinfo " id="T163:U1260"><span class="mxinfo " id="T163:U1261"><span class="mxinfo " id="T163:U1262"><span class="mxinfo " id="T163:U1263"><span class="mxinfo " id="T7:U1264"><span class="var type1" id="S109T22U1607">P</span>(<span class="mxinfo " id="T49:U1266">2</span>)</span>*(<span class="mxinfo " id="T163:U1267"><span class="mxinfo " id="T36:U1268"><span class="var type1" id="S92T40U1612">t2</span>'</span>*<span class="var type1" id="S92T40U1613">t2</span></span>)</span>*<span class="mxinfo " id="T7:U1271">tan(<span class="var type1" id="S67T7U1616">phiI3</span>)</span></span> + <span class="mxinfo " id="T163:U1273"><span class="mxinfo " id="T163:U1274"><span class="mxinfo " id="T7:U1275"><span class="var type1" id="S109T22U1620">P</span>(<span class="mxinfo " id="T49:U1277">3</span>)</span>*(<span class="mxinfo " id="T163:U1278"><span class="mxinfo " id="T36:U1279"><span class="var type1" id="S94T40U1625">t3</span>'</span>*<span class="var type1" id="S94T40U1626">t3</span></span>)</span>*<span class="mxinfo " id="T7:U1282">tan(<span class="var type1" id="S70T7U1629">phiJ3</span>)</span></span></span> + <span class="mxinfo " id="T163:U1284"><span class="mxinfo " id="T163:U1285"><span class="mxinfo " id="T7:U1286"><span class="var type1" id="S109T22U1633">P</span>(<span class="mxinfo " id="T49:U1288">4</span>)</span>*(<span class="mxinfo " id="T163:U1289"><span class="mxinfo " id="T36:U1290"><span class="var type1" id="S95T40U1638">t4</span>'</span>*<span class="var type1" id="S95T40U1639">t4</span></span>)</span>*<span class="mxinfo " id="T7:U1293">tan(<span class="var type1" id="S66T7U1642">phiI2</span>)</span></span></span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,292" id="srcline292">292</a></span><span class="line">    <span class="mxinfo " id="T163:U1295"><span class="mxinfo " id="T163:U1296"><span class="mxinfo " id="T7:U1297"><span class="var type1" id="S109T22U1646">P</span>(<span class="mxinfo " id="T49:U1299">5</span>)</span>*(<span class="mxinfo " id="T163:U1300"><span class="mxinfo " id="T36:U1301"><span class="var type1" id="S96T40U1651">t5</span>'</span>*<span class="var type1" id="S96T40U1652">t5</span></span>)</span>*<span class="mxinfo " id="T7:U1304">tan(<span class="var type1" id="S69T7U1655">phiJ2</span>)</span></span></span> + <span class="mxinfo " id="T163:U1306"><span class="mxinfo " id="T7:U1307"><span class="var type1" id="S109T22U1658">P</span>(<span class="mxinfo " id="T49:U1309">6</span>)</span>*(<span class="mxinfo " id="T163:U1310"><span class="mxinfo " id="T163:U1311">(<span class="mxinfo " id="T163:U1312"><span class="mxinfo " id="T36:U1313">-<span class="mxinfo " id="T36:U1314"><span class="var type1" id="S98T40U1667">t6I</span>'</span></span>*<span class="var type1" id="S98T40U1668">t6I</span></span>)*<span class="mxinfo " id="T7:U1317">tan(<span class="var type1" id="S64T7U1671">phiI1</span>)</span></span> + <span class="mxinfo " id="T163:U1319">(<span class="mxinfo " id="T163:U1320"><span class="mxinfo " id="T36:U1321"><span class="var type1" id="S97T40U1676">t6J</span>'</span>*<span class="var type1" id="S97T40U1677">t6J</span></span>)*<span class="mxinfo " id="T7:U1324">tan(<span class="var type1" id="S68T7U1680">phiJ1</span>)</span></span></span>)</span></span></span>; <span class="comment">% P(6)I?</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,293" id="srcline293">293</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,294" id="srcline294">294</a></span><span class="line"><span class="mxinfo " id="T163:U1326"><span class="var type1" id="S119T163U1683">G1</span> = <span class="mxinfo " id="T163:U1328"><span class="fcn" id="F877N12:B1685">get_G</span>(<span class="mxinfo " id="T72:U1329"><span class="var type1" id="S52T73U1687">R_bar</span>(<span class="mxinfo " id="T102:U1331">:</span>,<span class="mxinfo " id="T49:U1332">2</span>)</span>,<span class="mxinfo " id="T72:U1333"><span class="var type1" id="S49T73U1691">NI</span>(<span class="mxinfo " id="T102:U1335">:</span>,<span class="mxinfo " id="T49:U1336">1</span>)</span>,<span class="var type1" id="S61T72U1694">e1</span>,<span class="var type1" id="S27T7U1695">L</span>,<span class="mxinfo " id="T72:U1339"><span class="var type1" id="S52T73U1697">R_bar</span>(<span class="mxinfo " id="T102:U1341">:</span>,<span class="mxinfo " id="T49:U1342">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,295" id="srcline295">295</a></span><span class="line"><span class="mxinfo " id="T163:U1343"><span class="var type1" id="S121T163U1702">G2</span> = <span class="mxinfo " id="T163:U1345"><span class="fcn" id="F877N12:B1704">get_G</span>(<span class="mxinfo " id="T72:U1346"><span class="var type1" id="S52T73U1706">R_bar</span>(<span class="mxinfo " id="T102:U1348">:</span>,<span class="mxinfo " id="T49:U1349">2</span>)</span>,<span class="mxinfo " id="T72:U1350"><span class="var type1" id="S51T73U1710">NJ</span>(<span class="mxinfo " id="T102:U1352">:</span>,<span class="mxinfo " id="T49:U1353">1</span>)</span>,<span class="var type1" id="S61T72U1713">e1</span>,<span class="var type1" id="S27T7U1714">L</span>,<span class="mxinfo " id="T72:U1356"><span class="var type1" id="S52T73U1716">R_bar</span>(<span class="mxinfo " id="T102:U1358">:</span>,<span class="mxinfo " id="T49:U1359">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,296" id="srcline296">296</a></span><span class="line"><span class="mxinfo " id="T163:U1360"><span class="var type1" id="S122T163U1721">G3</span> = <span class="mxinfo " id="T163:U1362"><span class="fcn" id="F877N12:B1723">get_G</span>(<span class="mxinfo " id="T72:U1363"><span class="var type1" id="S52T73U1725">R_bar</span>(<span class="mxinfo " id="T102:U1365">:</span>,<span class="mxinfo " id="T49:U1366">3</span>)</span>,<span class="mxinfo " id="T72:U1367"><span class="var type1" id="S49T73U1729">NI</span>(<span class="mxinfo " id="T102:U1369">:</span>,<span class="mxinfo " id="T49:U1370">1</span>)</span>,<span class="var type1" id="S61T72U1732">e1</span>,<span class="var type1" id="S27T7U1733">L</span>,<span class="mxinfo " id="T72:U1373"><span class="var type1" id="S52T73U1735">R_bar</span>(<span class="mxinfo " id="T102:U1375">:</span>,<span class="mxinfo " id="T49:U1376">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,297" id="srcline297">297</a></span><span class="line"><span class="mxinfo " id="T163:U1377"><span class="var type1" id="S123T163U1740">G4</span> = <span class="mxinfo " id="T163:U1379"><span class="fcn" id="F877N12:B1742">get_G</span>(<span class="mxinfo " id="T72:U1380"><span class="var type1" id="S52T73U1744">R_bar</span>(<span class="mxinfo " id="T102:U1382">:</span>,<span class="mxinfo " id="T49:U1383">3</span>)</span>,<span class="mxinfo " id="T72:U1384"><span class="var type1" id="S51T73U1748">NJ</span>(<span class="mxinfo " id="T102:U1386">:</span>,<span class="mxinfo " id="T49:U1387">1</span>)</span>,<span class="var type1" id="S61T72U1751">e1</span>,<span class="var type1" id="S27T7U1752">L</span>,<span class="mxinfo " id="T72:U1390"><span class="var type1" id="S52T73U1754">R_bar</span>(<span class="mxinfo " id="T102:U1392">:</span>,<span class="mxinfo " id="T49:U1393">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,298" id="srcline298">298</a></span><span class="line"><span class="mxinfo " id="T163:U1394"><span class="var type1" id="S124T163U1759">G5</span> = <span class="mxinfo " id="T163:U1396"><span class="fcn" id="F877N12:B1761">get_G</span>(<span class="mxinfo " id="T72:U1397"><span class="var type1" id="S52T73U1763">R_bar</span>(<span class="mxinfo " id="T102:U1399">:</span>,<span class="mxinfo " id="T49:U1400">3</span>)</span>,<span class="mxinfo " id="T72:U1401"><span class="var type1" id="S51T73U1767">NJ</span>(<span class="mxinfo " id="T102:U1403">:</span>,<span class="mxinfo " id="T49:U1404">2</span>)</span>,<span class="var type1" id="S61T72U1770">e1</span>,<span class="var type1" id="S27T7U1771">L</span>,<span class="mxinfo " id="T72:U1407"><span class="var type1" id="S52T73U1773">R_bar</span>(<span class="mxinfo " id="T102:U1409">:</span>,<span class="mxinfo " id="T49:U1410">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,299" id="srcline299">299</a></span><span class="line"><span class="mxinfo " id="T163:U1411"><span class="var type1" id="S125T163U1778">G6</span> = <span class="mxinfo " id="T163:U1413"><span class="fcn" id="F877N12:B1780">get_G</span>(<span class="mxinfo " id="T72:U1414"><span class="var type1" id="S52T73U1782">R_bar</span>(<span class="mxinfo " id="T102:U1416">:</span>,<span class="mxinfo " id="T49:U1417">2</span>)</span>,<span class="mxinfo " id="T72:U1418"><span class="var type1" id="S51T73U1786">NJ</span>(<span class="mxinfo " id="T102:U1420">:</span>,<span class="mxinfo " id="T49:U1421">3</span>)</span>,<span class="var type1" id="S61T72U1789">e1</span>,<span class="var type1" id="S27T7U1790">L</span>,<span class="mxinfo " id="T72:U1424"><span class="var type1" id="S52T73U1792">R_bar</span>(<span class="mxinfo " id="T102:U1426">:</span>,<span class="mxinfo " id="T49:U1427">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,300" id="srcline300">300</a></span><span class="line"><span class="mxinfo " id="T163:U1428"><span class="var type1" id="S126T163U1797">G7</span> = <span class="mxinfo " id="T163:U1430"><span class="fcn" id="F877N12:B1799">get_G</span>(<span class="mxinfo " id="T72:U1431"><span class="var type1" id="S52T73U1801">R_bar</span>(<span class="mxinfo " id="T102:U1433">:</span>,<span class="mxinfo " id="T49:U1434">3</span>)</span>,<span class="mxinfo " id="T72:U1435"><span class="var type1" id="S49T73U1805">NI</span>(<span class="mxinfo " id="T102:U1437">:</span>,<span class="mxinfo " id="T49:U1438">2</span>)</span>,<span class="var type1" id="S61T72U1808">e1</span>,<span class="var type1" id="S27T7U1809">L</span>,<span class="mxinfo " id="T72:U1441"><span class="var type1" id="S52T73U1811">R_bar</span>(<span class="mxinfo " id="T102:U1443">:</span>,<span class="mxinfo " id="T49:U1444">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,301" id="srcline301">301</a></span><span class="line"><span class="mxinfo " id="T163:U1445"><span class="var type1" id="S127T163U1816">G8</span> = <span class="mxinfo " id="T163:U1447"><span class="fcn" id="F877N12:B1818">get_G</span>(<span class="mxinfo " id="T72:U1448"><span class="var type1" id="S52T73U1820">R_bar</span>(<span class="mxinfo " id="T102:U1450">:</span>,<span class="mxinfo " id="T49:U1451">2</span>)</span>,<span class="mxinfo " id="T72:U1452"><span class="var type1" id="S49T73U1824">NI</span>(<span class="mxinfo " id="T102:U1454">:</span>,<span class="mxinfo " id="T49:U1455">3</span>)</span>,<span class="var type1" id="S61T72U1827">e1</span>,<span class="var type1" id="S27T7U1828">L</span>,<span class="mxinfo " id="T72:U1458"><span class="var type1" id="S52T73U1830">R_bar</span>(<span class="mxinfo " id="T102:U1460">:</span>,<span class="mxinfo " id="T49:U1461">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,302" id="srcline302">302</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,303" id="srcline303">303</a></span><span class="line"><span class="comment">% KC</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,304" id="srcline304">304</a></span><span class="line"><span class="mxinfo " id="T163:U1462"><span class="var type1" id="S128T163U1835">KC</span> = <span class="mxinfo " id="T163:U1464"><span class="mxinfo " id="T163:U1465"><span class="mxinfo " id="T163:U1466"><span class="mxinfo " id="T163:U1467"><span class="mxinfo " id="T163:U1468"><span class="mxinfo " id="T163:U1469"><span class="var type1" id="S110T7U1842">m2</span>*<span class="var type1" id="S119T163U1843">G1</span></span> + <span class="mxinfo " id="T163:U1472"><span class="var type1" id="S111T7U1845">m3</span>*<span class="var type1" id="S121T163U1846">G2</span></span></span> - <span class="mxinfo " id="T163:U1475"><span class="var type1" id="S112T7U1848">m4</span>*<span class="var type1" id="S122T163U1849">G3</span></span></span> - <span class="mxinfo " id="T163:U1478"><span class="var type1" id="S113T7U1851">m5</span>*<span class="var type1" id="S123T163U1852">G4</span></span></span> + <span class="mxinfo " id="T163:U1481"><span class="var type1" id="S114T7U1854">m6I</span>*(<span class="mxinfo " id="T163:U1483"><span class="var type1" id="S124T163U1857">G5</span> - <span class="var type1" id="S125T163U1858">G6</span></span>)</span></span> - <span class="mxinfo " id="T163:U1486"><span class="var type1" id="S115T7U1860">m6J</span>*(<span class="mxinfo " id="T163:U1488"><span class="var type1" id="S126T163U1863">G7</span> - <span class="var type1" id="S127T163U1864">G8</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,305" id="srcline305">305</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,306" id="srcline306">306</a></span><span class="line"><span class="comment">% KD</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,307" id="srcline307">307</a></span><span class="line"><span class="mxinfo " id="T162:U1491"><span class="var type1" id="S129T162U1867">KD2</span> = <span class="mxinfo " id="T162:U1493"><span class="mxinfo " id="T162:U1494"><span class="mxinfo " id="T162:U1495">-<span class="var type1" id="S75T162U1871">L_r2</span></span>*(<span class="mxinfo " id="T73:U1497"><span class="mxinfo " id="T73:U1498"><span class="var type1" id="S110T7U1875">m2</span>*<span class="var type1" id="S78T73U1876">S_nI1</span></span> + <span class="mxinfo " id="T73:U1501"><span class="var type1" id="S114T7U1878">m6I</span>*<span class="var type1" id="S81T73U1879">S_nI3</span></span></span>)</span> + <span class="mxinfo " id="T162:U1504"><span class="var type1" id="S77T162U1881">L_r3</span>*(<span class="mxinfo " id="T73:U1506"><span class="mxinfo " id="T73:U1507"><span class="var type1" id="S112T7U1885">m4</span>*<span class="var type1" id="S78T73U1886">S_nI1</span></span> + <span class="mxinfo " id="T73:U1510"><span class="var type1" id="S114T7U1888">m6I</span>*<span class="var type1" id="S80T73U1889">S_nI2</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,308" id="srcline308">308</a></span><span class="line"><span class="mxinfo " id="T162:U1513"><span class="var type1" id="S130T162U1892">KD4</span> = <span class="mxinfo " id="T162:U1515"><span class="mxinfo " id="T162:U1516"><span class="mxinfo " id="T162:U1517">-<span class="var type1" id="S75T162U1896">L_r2</span></span>*(<span class="mxinfo " id="T73:U1519"><span class="mxinfo " id="T73:U1520"><span class="var type1" id="S111T7U1900">m3</span>*<span class="var type1" id="S82T73U1901">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1523"><span class="var type1" id="S115T7U1903">m6J</span>*<span class="var type1" id="S84T73U1904">S_nJ3</span></span></span>)</span> + <span class="mxinfo " id="T162:U1526"><span class="var type1" id="S77T162U1906">L_r3</span>*(<span class="mxinfo " id="T73:U1528"><span class="mxinfo " id="T73:U1529"><span class="var type1" id="S113T7U1910">m5</span>*<span class="var type1" id="S82T73U1911">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1532"><span class="var type1" id="S115T7U1913">m6J</span>*<span class="var type1" id="S83T73U1914">S_nJ2</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,309" id="srcline309">309</a></span><span class="line"><span class="mxinfo " id="T163:U1535"><span class="var type1" id="S131T163U1917">KD</span> = <span class="mxinfo " id="T163:U1537">[<span class="mxinfo " id="T162:U1538">zeros(<span class="mxinfo " id="T7:U1539">12</span>,<span class="mxinfo " id="T7:U1540">3</span>)</span> <span class="var type1" id="S129T162U1924">KD2</span> <span class="mxinfo " id="T162:U1542">zeros(<span class="mxinfo " id="T7:U1543">12</span>,<span class="mxinfo " id="T7:U1544">3</span>)</span> <span class="var type1" id="S130T162U1929">KD4</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,310" id="srcline310">310</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,311" id="srcline311">311</a></span><span class="line"><span class="comment">% KE</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,312" id="srcline312">312</a></span><span class="line"><span class="mxinfo " id="T163:U1546"><span class="var type1" id="S132T163U1932">KE</span> = <span class="mxinfo " id="T163:U1548"><span class="var type1" id="S131T163U1934">KD</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,313" id="srcline313">313</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,314" id="srcline314">314</a></span><span class="line"><span class="comment">% KF</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,315" id="srcline315">315</a></span><span class="line"><span class="comment">% M_nI2 = get_M(NI(:,2),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,316" id="srcline316">316</a></span><span class="line"><span class="comment">% M_nJ2 = get_M(NJ(:,2),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,317" id="srcline317">317</a></span><span class="line"><span class="comment">% M_nI3 = get_M(NI(:,3),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,318" id="srcline318">318</a></span><span class="line"><span class="comment">% M_nJ3 = get_M(NJ(:,3),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,319" id="srcline319">319</a></span><span class="line"><span class="mxinfo " id="T73:U1550"><span class="var type1" id="S73T73U1937">A</span> = <span class="mxinfo " id="T73:U1552"><span class="mxinfo " id="T7:U1553"><span class="mxinfo " id="T7:U1554">1</span>/<span class="var type1" id="S27T7U1941">L</span></span>*(<span class="mxinfo " id="T73:U1556"><span class="mxinfo " id="T73:U1557">[<span class="mxinfo " id="T5:U1558">1 0 0</span>; <span class="mxinfo " id="T5:U1559">0 1 0</span>; <span class="mxinfo " id="T5:U1560">0 0 1</span>]</span> - <span class="mxinfo " id="T73:U1561"><span class="var type1" id="S61T72U1958">e1</span>*<span class="mxinfo " id="T5:U1563"><span class="var type1" id="S61T72U1960">e1</span>'</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,320" id="srcline320">320</a></span><span class="line"><span class="mxinfo " id="T73:U1565"><span class="var type1" id="S133T73U1963">M_nI2</span> = <span class="mxinfo " id="T73:U1567"><span class="mxinfo " id="T7:U1568"><span class="mxinfo " id="T7:U1569">-1</span>/<span class="var type1" id="S27T7U1968">L</span></span>*(<span class="mxinfo " id="T73:U1571"><span class="mxinfo " id="T73:U1572"><span class="mxinfo " id="T73:U1573"><span class="mxinfo " id="T72:U1574"><span class="var type1" id="S73T73U1974">A</span>*<span class="mxinfo " id="T72:U1576"><span class="var type1" id="S49T73U1976">NI</span>(<span class="mxinfo " id="T102:U1578">:</span>,<span class="mxinfo " id="T49:U1579">2</span>)</span></span>*<span class="mxinfo " id="T5:U1580"><span class="var type1" id="S61T72U1980">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1582">(<span class="mxinfo " id="T73:U1583"><span class="mxinfo " id="T72:U1584"><span class="var type1" id="S73T73U1985">A</span>*<span class="mxinfo " id="T72:U1586"><span class="var type1" id="S49T73U1987">NI</span>(<span class="mxinfo " id="T102:U1588">:</span>,<span class="mxinfo " id="T49:U1589">2</span>)</span></span>*<span class="mxinfo " id="T5:U1590"><span class="var type1" id="S61T72U1991">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1592"><span class="var type1" id="S73T73U1993">A</span>*(<span class="mxinfo " id="T7:U1594"><span class="mxinfo " id="T5:U1595"><span class="var type1" id="S61T72U1997">e1</span>'</span>*<span class="mxinfo " id="T72:U1597"><span class="var type1" id="S49T73U1999">NI</span>(<span class="mxinfo " id="T102:U1599">:</span>,<span class="mxinfo " id="T49:U1600">2</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,321" id="srcline321">321</a></span><span class="line"><span class="mxinfo " id="T73:U1601"><span class="var type1" id="S134T73U2004">M_nJ2</span> = <span class="mxinfo " id="T73:U1603"><span class="mxinfo " id="T7:U1604"><span class="mxinfo " id="T7:U1605">-1</span>/<span class="var type1" id="S27T7U2009">L</span></span>*(<span class="mxinfo " id="T73:U1607"><span class="mxinfo " id="T73:U1608"><span class="mxinfo " id="T73:U1609"><span class="mxinfo " id="T72:U1610"><span class="var type1" id="S73T73U2015">A</span>*<span class="mxinfo " id="T72:U1612"><span class="var type1" id="S51T73U2017">NJ</span>(<span class="mxinfo " id="T102:U1614">:</span>,<span class="mxinfo " id="T49:U1615">2</span>)</span></span>*<span class="mxinfo " id="T5:U1616"><span class="var type1" id="S61T72U2021">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1618">(<span class="mxinfo " id="T73:U1619"><span class="mxinfo " id="T72:U1620"><span class="var type1" id="S73T73U2026">A</span>*<span class="mxinfo " id="T72:U1622"><span class="var type1" id="S51T73U2028">NJ</span>(<span class="mxinfo " id="T102:U1624">:</span>,<span class="mxinfo " id="T49:U1625">2</span>)</span></span>*<span class="mxinfo " id="T5:U1626"><span class="var type1" id="S61T72U2032">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1628"><span class="var type1" id="S73T73U2034">A</span>*(<span class="mxinfo " id="T7:U1630"><span class="mxinfo " id="T5:U1631"><span class="var type1" id="S61T72U2038">e1</span>'</span>*<span class="mxinfo " id="T72:U1633"><span class="var type1" id="S51T73U2040">NJ</span>(<span class="mxinfo " id="T102:U1635">:</span>,<span class="mxinfo " id="T49:U1636">2</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,322" id="srcline322">322</a></span><span class="line"><span class="mxinfo " id="T73:U1637"><span class="var type1" id="S135T73U2045">M_nI3</span> = <span class="mxinfo " id="T73:U1639"><span class="mxinfo " id="T7:U1640"><span class="mxinfo " id="T7:U1641">-1</span>/<span class="var type1" id="S27T7U2050">L</span></span>*(<span class="mxinfo " id="T73:U1643"><span class="mxinfo " id="T73:U1644"><span class="mxinfo " id="T73:U1645"><span class="mxinfo " id="T72:U1646"><span class="var type1" id="S73T73U2056">A</span>*<span class="mxinfo " id="T72:U1648"><span class="var type1" id="S49T73U2058">NI</span>(<span class="mxinfo " id="T102:U1650">:</span>,<span class="mxinfo " id="T49:U1651">3</span>)</span></span>*<span class="mxinfo " id="T5:U1652"><span class="var type1" id="S61T72U2062">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1654">(<span class="mxinfo " id="T73:U1655"><span class="mxinfo " id="T72:U1656"><span class="var type1" id="S73T73U2067">A</span>*<span class="mxinfo " id="T72:U1658"><span class="var type1" id="S49T73U2069">NI</span>(<span class="mxinfo " id="T102:U1660">:</span>,<span class="mxinfo " id="T49:U1661">3</span>)</span></span>*<span class="mxinfo " id="T5:U1662"><span class="var type1" id="S61T72U2073">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1664"><span class="var type1" id="S73T73U2075">A</span>*(<span class="mxinfo " id="T7:U1666"><span class="mxinfo " id="T5:U1667"><span class="var type1" id="S61T72U2079">e1</span>'</span>*<span class="mxinfo " id="T72:U1669"><span class="var type1" id="S49T73U2081">NI</span>(<span class="mxinfo " id="T102:U1671">:</span>,<span class="mxinfo " id="T49:U1672">3</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,323" id="srcline323">323</a></span><span class="line"><span class="mxinfo " id="T73:U1673"><span class="var type1" id="S136T73U2086">M_nJ3</span> = <span class="mxinfo " id="T73:U1675"><span class="mxinfo " id="T7:U1676"><span class="mxinfo " id="T7:U1677">-1</span>/<span class="var type1" id="S27T7U2091">L</span></span>*(<span class="mxinfo " id="T73:U1679"><span class="mxinfo " id="T73:U1680"><span class="mxinfo " id="T73:U1681"><span class="mxinfo " id="T72:U1682"><span class="var type1" id="S73T73U2097">A</span>*<span class="mxinfo " id="T72:U1684"><span class="var type1" id="S51T73U2099">NJ</span>(<span class="mxinfo " id="T102:U1686">:</span>,<span class="mxinfo " id="T49:U1687">3</span>)</span></span>*<span class="mxinfo " id="T5:U1688"><span class="var type1" id="S61T72U2103">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1690">(<span class="mxinfo " id="T73:U1691"><span class="mxinfo " id="T72:U1692"><span class="var type1" id="S73T73U2108">A</span>*<span class="mxinfo " id="T72:U1694"><span class="var type1" id="S51T73U2110">NJ</span>(<span class="mxinfo " id="T102:U1696">:</span>,<span class="mxinfo " id="T49:U1697">3</span>)</span></span>*<span class="mxinfo " id="T5:U1698"><span class="var type1" id="S61T72U2114">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1700"><span class="var type1" id="S73T73U2116">A</span>*(<span class="mxinfo " id="T7:U1702"><span class="mxinfo " id="T5:U1703"><span class="var type1" id="S61T72U2120">e1</span>'</span>*<span class="mxinfo " id="T72:U1705"><span class="var type1" id="S51T73U2122">NJ</span>(<span class="mxinfo " id="T102:U1707">:</span>,<span class="mxinfo " id="T49:U1708">3</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,324" id="srcline324">324</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,325" id="srcline325">325</a></span><span class="line"><span class="mxinfo " id="T73:U1709"><span class="var type1" id="S137T73U2127">S_e2</span> = <span class="mxinfo " id="T73:U1711"><span class="fcn" id="F223N19:B2129">get_S</span>(<span class="var type1" id="S62T72U2130">e2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,326" id="srcline326">326</a></span><span class="line"><span class="mxinfo " id="T73:U1713"><span class="var type1" id="S138T73U2133">S_e1</span> = <span class="mxinfo " id="T73:U1715"><span class="fcn" id="F223N19:B2135">get_S</span>(<span class="var type1" id="S61T72U2136">e1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,327" id="srcline327">327</a></span><span class="line"><span class="mxinfo " id="T73:U1717"><span class="var type1" id="S139T73U2139">S_e3</span> = <span class="mxinfo " id="T73:U1719"><span class="fcn" id="F223N19:B2141">get_S</span>(<span class="var type1" id="S63T72U2142">e3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,328" id="srcline328">328</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,329" id="srcline329">329</a></span><span class="line"><span class="mxinfo " id="T73:U1721"><span class="var type1" id="S140T73U2145">KF11</span> = <span class="mxinfo " id="T73:U1723"><span class="mxinfo " id="T73:U1724"><span class="mxinfo " id="T73:U1725"><span class="mxinfo " id="T73:U1726"><span class="mxinfo " id="T7:U1727">-<span class="var type1" id="S110T7U2151">m2</span></span>*<span class="var type1" id="S133T73U2152">M_nI2</span></span> - <span class="mxinfo " id="T73:U1730"><span class="var type1" id="S111T7U2154">m3</span>*<span class="var type1" id="S134T73U2155">M_nJ2</span></span></span> + <span class="mxinfo " id="T73:U1733"><span class="var type1" id="S112T7U2157">m4</span>*<span class="var type1" id="S135T73U2158">M_nI3</span></span></span> + <span class="mxinfo " id="T73:U1736"><span class="var type1" id="S113T7U2160">m5</span>*<span class="var type1" id="S136T73U2161">M_nJ3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,330" id="srcline330">330</a></span><span class="line"><span class="mxinfo " id="T73:U1739"><span class="var type1" id="S141T73U2164">KF12</span> = <span class="mxinfo " id="T73:U1741"><span class="mxinfo " id="T73:U1742"><span class="mxinfo " id="T73:U1743"><span class="mxinfo " id="T7:U1744">-<span class="var type1" id="S110T7U2169">m2</span></span>*<span class="var type1" id="S73T73U2170">A</span></span>*<span class="var type1" id="S80T73U2171">S_nI2</span></span> + <span class="mxinfo " id="T73:U1748"><span class="mxinfo " id="T73:U1749"><span class="var type1" id="S112T7U2174">m4</span>*<span class="var type1" id="S73T73U2175">A</span></span>*<span class="var type1" id="S81T73U2176">S_nI3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,331" id="srcline331">331</a></span><span class="line"><span class="mxinfo " id="T73:U1753"><span class="var type1" id="S142T73U2179">KF14</span> = <span class="mxinfo " id="T73:U1755"><span class="mxinfo " id="T73:U1756"><span class="mxinfo " id="T73:U1757"><span class="mxinfo " id="T7:U1758">-<span class="var type1" id="S111T7U2184">m3</span></span>*<span class="var type1" id="S73T73U2185">A</span></span>*<span class="var type1" id="S83T73U2186">S_nJ2</span></span> + <span class="mxinfo " id="T73:U1762"><span class="mxinfo " id="T73:U1763"><span class="var type1" id="S113T7U2189">m5</span>*<span class="var type1" id="S73T73U2190">A</span></span>*<span class="var type1" id="S84T73U2191">S_nJ3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,332" id="srcline332">332</a></span><span class="line"><span class="mxinfo " id="T73:U1767"><span class="var type1" id="S143T73U2194">KF22</span> = <span class="mxinfo " id="T73:U1769"><span class="mxinfo " id="T73:U1770"><span class="mxinfo " id="T73:U1771"><span class="var type1" id="S110T7U2198">m2</span>*(<span class="mxinfo " id="T73:U1773"><span class="mxinfo " id="T73:U1774"><span class="var type1" id="S137T73U2202">S_e2</span>*<span class="var type1" id="S78T73U2203">S_nI1</span></span> - <span class="mxinfo " id="T73:U1777"><span class="var type1" id="S138T73U2205">S_e1</span>*<span class="var type1" id="S80T73U2206">S_nI2</span></span></span>)</span> - <span class="mxinfo " id="T73:U1780"><span class="var type1" id="S112T7U2208">m4</span>*(<span class="mxinfo " id="T73:U1782"><span class="mxinfo " id="T73:U1783"><span class="var type1" id="S139T73U2212">S_e3</span>*<span class="var type1" id="S78T73U2213">S_nI1</span></span> - <span class="mxinfo " id="T73:U1786"><span class="var type1" id="S138T73U2215">S_e1</span>*<span class="var type1" id="S81T73U2216">S_nI3</span></span></span>)</span></span> - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,333" id="srcline333">333</a></span><span class="line">    <span class="mxinfo " id="T73:U1789"><span class="var type1" id="S114T7U2218">m6I</span>*(<span class="mxinfo " id="T73:U1791"><span class="mxinfo " id="T73:U1792"><span class="var type1" id="S139T73U2222">S_e3</span>*<span class="var type1" id="S80T73U2223">S_nI2</span></span> - <span class="mxinfo " id="T73:U1795"><span class="var type1" id="S137T73U2225">S_e2</span>*<span class="var type1" id="S81T73U2226">S_nI3</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,334" id="srcline334">334</a></span><span class="line"><span class="mxinfo " id="T73:U1798"><span class="var type1" id="S144T73U2229">KF44</span> = <span class="mxinfo " id="T73:U1800"><span class="mxinfo " id="T73:U1801"><span class="mxinfo " id="T73:U1802"><span class="var type1" id="S111T7U2233">m3</span>*(<span class="mxinfo " id="T73:U1804"><span class="mxinfo " id="T73:U1805"><span class="var type1" id="S137T73U2237">S_e2</span>*<span class="var type1" id="S82T73U2238">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1808"><span class="var type1" id="S138T73U2240">S_e1</span>*<span class="var type1" id="S83T73U2241">S_nJ2</span></span></span>)</span> - <span class="mxinfo " id="T73:U1811"><span class="var type1" id="S113T7U2243">m5</span>*(<span class="mxinfo " id="T73:U1813"><span class="mxinfo " id="T73:U1814"><span class="var type1" id="S139T73U2247">S_e3</span>*<span class="var type1" id="S82T73U2248">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1817"><span class="var type1" id="S138T73U2250">S_e1</span>*<span class="var type1" id="S84T73U2251">S_nJ3</span></span></span>)</span></span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,335" id="srcline335">335</a></span><span class="line">    <span class="mxinfo " id="T73:U1820"><span class="var type1" id="S115T7U2253">m6J</span>*(<span class="mxinfo " id="T73:U1822"><span class="mxinfo " id="T73:U1823"><span class="var type1" id="S139T73U2257">S_e3</span>*<span class="var type1" id="S83T73U2258">S_nJ2</span></span> - <span class="mxinfo " id="T73:U1826"><span class="var type1" id="S137T73U2260">S_e2</span>*<span class="var type1" id="S84T73U2261">S_nJ3</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,336" id="srcline336">336</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,337" id="srcline337">337</a></span><span class="line"><span class="mxinfo " id="T163:U1829"><span class="var type1" id="S145T163U2264">KF</span> = <span class="mxinfo " id="T163:U1831">[<span class="mxinfo " id="T171:U1832"><span class="var type1" id="S140T73U2267">KF11</span> <span class="var type1" id="S141T73U2268">KF12</span> <span class="mxinfo " id="T73:U1835">-<span class="var type1" id="S140T73U2270">KF11</span></span> <span class="var type1" id="S142T73U2271">KF14</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="167,338" id="srcline338">338</a></span><span class="line">    <span class="mxinfo " id="T171:U1838"><span class="mxinfo " id="T73:U1839"><span class="var type1" id="S141T73U2274">KF12</span>'</span> <span class="var type1" id="S143T73U2275">KF22</span> <span class="mxinfo " id="T73:U1842">-<span class="mxinfo " id="T73:U1843"><span class="var type1" id="S141T73U2278">KF12</span>'</span></span> <span class="mxinfo " id="T73:U1845">zeros(<span class="mxinfo " id="T7:U1846">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="167,339" id="srcline339">339</a></span><span class="line">    <span class="mxinfo " id="T171:U1847"><span class="mxinfo " id="T73:U1848">-<span class="var type1" id="S140T73U2284">KF11</span></span> <span class="mxinfo " id="T73:U1850">-<span class="var type1" id="S141T73U2286">KF12</span></span> <span class="var type1" id="S140T73U2287">KF11</span> <span class="mxinfo " id="T73:U1853">-<span class="var type1" id="S142T73U2289">KF14</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="167,340" id="srcline340">340</a></span><span class="line">    <span class="mxinfo " id="T171:U1855"><span class="mxinfo " id="T73:U1856"><span class="var type1" id="S142T73U2292">KF14</span>'</span> <span class="mxinfo " id="T73:U1858">zeros(<span class="mxinfo " id="T7:U1859">3</span>)</span> <span class="mxinfo " id="T73:U1860">-<span class="mxinfo " id="T73:U1861"><span class="var type1" id="S142T73U2298">KF14</span>'</span></span> <span class="var type1" id="S144T73U2299">KF44</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,341" id="srcline341">341</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,342" id="srcline342">342</a></span><span class="line"><span class="comment">% KG - geometric stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,343" id="srcline343">343</a></span><span class="line"><span class="mxinfo " id="T163:U1864"><span class="var type1" id="S146T163U2302">KG</span> = <span class="mxinfo " id="T163:U1866"><span class="mxinfo " id="T163:U1867"><span class="mxinfo " id="T163:U1868"><span class="mxinfo " id="T163:U1869"><span class="mxinfo " id="T163:U1870"><span class="var type1" id="S116T163U2308">KA</span> + <span class="var type1" id="S117T163U2309">KB</span></span> + <span class="var type1" id="S128T163U2310">KC</span></span> + <span class="var type1" id="S131T163U2311">KD</span></span> + <span class="var type1" id="S132T163U2312">KE</span></span> + <span class="var type1" id="S145T163U2313">KF</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,344" id="srcline344">344</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,345" id="srcline345">345</a></span><span class="line"><span class="comment">% Element global tangent stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,346" id="srcline346">346</a></span><span class="line"><span class="mxinfo " id="T163:U1877"><span class="var type1" id="S2T163U2316">Kel</span> = <span class="mxinfo " id="T163:U1879"><span class="mxinfo " id="T163:U1880"><span class="mxinfo " id="T165:U1881"><span class="mxinfo " id="T165:U1882"><span class="var type1" id="S100T166U2321">T</span>'</span>*<span class="var type1" id="S108T15U2322">KL</span></span>*<span class="var type1" id="S100T166U2323">T</span></span> + <span class="var type1" id="S146T163U2324">KG</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,347" id="srcline347">347</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,348" id="srcline348">348</a></span><span class="line"><span class="comment">% Element global internal force vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,349" id="srcline349">349</a></span><span class="line"><span class="mxinfo " id="T36:U1887"><span class="var type1" id="S4T36U2327">Fint_i</span> = <span class="mxinfo " id="T36:U1889"><span class="mxinfo " id="T165:U1890"><span class="var type1" id="S100T166U2330">T</span>'</span>*<span class="var type1" id="S109T22U2331">P</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,350" id="srcline350">350</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,351" id="srcline351">351</a></span><span class="line"><span class="comment">% Do not need to save any variables for future iterations</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,352" id="srcline352">352</a></span><span class="line"><span class="mxinfo " id="T168:U1893"><span class="var type1" id="S6T168U2334">el_out</span> = <span class="var type1" id="S9T168U2335">el_in0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,353" id="srcline353">353</a></span><span class="line"><span class="comment">% el_out.D = D;</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,354" id="srcline354">354</a></span><span class="line"><span class="comment">% el_out.P = P;</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,355" id="srcline355">355</a></span><span class="line"><span class="comment">% el_out.eps_ax = eps_ax;</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,356" id="srcline356">356</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,357" id="srcline357">357</a></span><span class="line"><span class="mxinfo " id="T7:U1896"><span class="mxinfo " id="T7:U1897"><span class="var type1" id="S6T168U2339">el_out</span>.break</span> = <span class="mxinfo " id="T7:U1899">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="167,358" id="srcline358">358</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,359" id="srcline359">359</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,360" id="srcline360">360</a></span><span class="line"><span class="comment">% figure(11)</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,361" id="srcline361">361</a></span><span class="line"><span class="comment">% plot(D(1)/L,P(1),'ro')</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,362" id="srcline362">362</a></span><span class="line"><span class="comment">% drawnow</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,363" id="srcline363">363</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,364" id="srcline364">364</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,365" id="srcline365">365</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,366" id="srcline366">366</a></span><span class="line"><span class="comment">% % % figure(100)</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,367" id="srcline367">367</a></span><span class="line"><span class="comment">% % % % clf</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,368" id="srcline368">368</a></span><span class="line"><span class="comment">% % % box on</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,369" id="srcline369">369</a></span><span class="line"><span class="comment">% % % hold on</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,370" id="srcline370">370</a></span><span class="line"><span class="comment">% % % % plot(EL(4129).el_in0.axial(:,2),EL(4129).el_in0.axial(:,1),'b-')</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,371" id="srcline371">371</a></span><span class="line"><span class="comment">% % % </span></span></span>
<span class="srcline"><span class="lineno"><a href="167,372" id="srcline372">372</a></span><span class="line"><span class="comment">% % % plot(eps_ax,P(1),'cx')</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,373" id="srcline373">373</a></span><span class="line"><span class="comment">% % % % xlim([-.01 .03])</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,374" id="srcline374">374</a></span><span class="line"><span class="comment">% % % drawnow</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,375" id="srcline375">375</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,376" id="srcline376">376</a></span><span class="line"><span class="comment">% % % if el_in0.el == 12839</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,377" id="srcline377">377</a></span><span class="line"><span class="comment">% % %     disp([eps_ax P(1)])</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,378" id="srcline378">378</a></span><span class="line"><span class="comment">% % % end</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,379" id="srcline379">379</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="167,380" id="srcline380">380</a></span><span class="line"><span class="comment">% % % if el_in0.el == 4129</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,381" id="srcline381">381</a></span><span class="line"><span class="comment">% % %     figure(100)</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,382" id="srcline382">382</a></span><span class="line"><span class="comment">% % %     hold on</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,383" id="srcline383">383</a></span><span class="line"><span class="comment">% % % %     plot(eps_ax,P(1),'rs')</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,384" id="srcline384">384</a></span><span class="line"><span class="comment">% % %     plot(0,0,'rs')</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,385" id="srcline385">385</a></span><span class="line"><span class="comment">% % %     drawnow</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,386" id="srcline386">386</a></span><span class="line"><span class="comment">% % %     disp([D P])</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,387" id="srcline387">387</a></span><span class="line"><span class="comment">% % % end</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,388" id="srcline388">388</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="167,389" id="srcline389">389</a></span><span class="line"></span></span>
</pre>
