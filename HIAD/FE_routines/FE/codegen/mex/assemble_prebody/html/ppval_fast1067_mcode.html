<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="164,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T7U3">v</span>=ppval_fast(<span class="var type1" id="S3T14U6">pp</span>,<span class="var type1" id="S4T7U7">xx</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="164,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%PPVAL  Evaluate piecewise polynomial.</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%   V = PPVAL(PP,XX) returns the value, at the entries of XX, of the </span></span></span>
<span class="srcline"><span class="lineno"><a href="164,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%   piecewise polynomial f contained in PP, as constructed by PCHIP, SPLINE,</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%   INTERP1, or the spline utility MKPP.</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%   V is obtained by replacing each entry of XX by the value of f there.</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%   If f is scalar-valued, then V is of the same size as XX. XX may be ND.</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,10" id="srcline10">10</a></span><span class="line"><span class="comment">%   If PP was constructed by PCHIP, SPLINE or MKPP using the orientation of</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,11" id="srcline11">11</a></span><span class="line"><span class="comment">%   non-scalar function values specified for those functions, then:</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,12" id="srcline12">12</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,13" id="srcline13">13</a></span><span class="line"><span class="comment">%   If f is [D1,..,Dr]-valued, and XX is a vector of length N, then V has</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,14" id="srcline14">14</a></span><span class="line"><span class="comment">%   size [D1,<span class="keyword">...</span><span class="comment">,Dr, N], with V(:,...,:,J) the value of f at XX(J).</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,15" id="srcline15">15</a></span><span class="line"><span class="comment">%   If f is [D1,..,Dr]-valued, and XX has size [N1,<span class="keyword">...</span><span class="comment">,Ns], then V has size</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,16" id="srcline16">16</a></span><span class="line"><span class="comment">%   [D1,<span class="keyword">...</span><span class="comment">,Dr, N1,...,Ns], with V(:,...,:, J1,...,Js) the value of f at</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,17" id="srcline17">17</a></span><span class="line"><span class="comment">%   XX(J1,<span class="keyword">...</span><span class="comment">,Js).</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,18" id="srcline18">18</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,19" id="srcline19">19</a></span><span class="line"><span class="comment">%   If PP was constructed by INTERP1 using the orientation of non-scalar</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,20" id="srcline20">20</a></span><span class="line"><span class="comment">%   function values specified for that function, then:</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,21" id="srcline21">21</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,22" id="srcline22">22</a></span><span class="line"><span class="comment">%   If f is [D1,..,Dr]-valued, and XX is a scalar, then V has size</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,23" id="srcline23">23</a></span><span class="line"><span class="comment">%   [D1,<span class="keyword">...</span><span class="comment">,Dr], with V the value of f at XX.</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,24" id="srcline24">24</a></span><span class="line"><span class="comment">%   If f is [D1,..,Dr]-valued, and XX is a vector of length N, then V has</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,25" id="srcline25">25</a></span><span class="line"><span class="comment">%   size [N,D1,<span class="keyword">...</span><span class="comment">,Dr], with V(J,:,...,:) the value of f at XX(J).</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,26" id="srcline26">26</a></span><span class="line"><span class="comment">%   If f is [D1,..,Dr]-valued, and XX has size [N1,<span class="keyword">...</span><span class="comment">,Ns], then V has size</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,27" id="srcline27">27</a></span><span class="line"><span class="comment">%   [N1,<span class="keyword">...</span><span class="comment">,Ns,D1,...,Dr], with V(J1,...,Js,:,...,:) the value of f at</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,28" id="srcline28">28</a></span><span class="line"><span class="comment">%   XX(J1,<span class="keyword">...</span><span class="comment">,Js).</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,29" id="srcline29">29</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,30" id="srcline30">30</a></span><span class="line"><span class="comment">%   Example:</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,31" id="srcline31">31</a></span><span class="line"><span class="comment">%   Compare the results of integrating the function cos and its spline</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,32" id="srcline32">32</a></span><span class="line"><span class="comment">%   interpolant:</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,33" id="srcline33">33</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,34" id="srcline34">34</a></span><span class="line"><span class="comment">%     a = 0; b = 10;</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,35" id="srcline35">35</a></span><span class="line"><span class="comment">%     int1 = integral(@cos,a,b);</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,36" id="srcline36">36</a></span><span class="line"><span class="comment">%     x = a:b; y = cos(x); pp = spline(x,y); </span></span></span>
<span class="srcline"><span class="lineno"><a href="164,37" id="srcline37">37</a></span><span class="line"><span class="comment">%     int2 = integral(@(x)ppval(pp,x),a,b);</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,38" id="srcline38">38</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,39" id="srcline39">39</a></span><span class="line"><span class="comment">%   int1 provides the integral of the cosine function over the interval [a,b]</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,40" id="srcline40">40</a></span><span class="line"><span class="comment">%   while int2 provides the integral, over the same interval, of the piecewise</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,41" id="srcline41">41</a></span><span class="line"><span class="comment">%   polynomial pp that approximates the cosine function by interpolating the</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,42" id="srcline42">42</a></span><span class="line"><span class="comment">%   computed x,y values.</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,43" id="srcline43">43</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,44" id="srcline44">44</a></span><span class="line"><span class="comment">%   Class support for input X and the fields of PP:</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,45" id="srcline45">45</a></span><span class="line"><span class="comment">%      float: double, single</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,46" id="srcline46">46</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,47" id="srcline47">47</a></span><span class="line"><span class="comment">%   See also SPLINE, PCHIP, INTERP1, MKPP, UNMKPP.</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,48" id="srcline48">48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="164,49" id="srcline49">49</a></span><span class="line"><span class="comment">%   Carl de Boor</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,50" id="srcline50">50</a></span><span class="line"><span class="comment">%   Copyright 1984-2015 The MathWorks, Inc.</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="164,52" id="srcline52">52</a></span><span class="line"><span class="comment">%  obtain the row vector xs equivalent to XX</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,53" id="srcline53">53</a></span><span class="line"><span class="mxinfo " id="T8:U4"><span class="var type1" id="S5T8U10">sizexx</span> = <span class="mxinfo " id="T8:U6">size(<span class="var type1" id="S4T7U13">xx</span>)</span></span>; <span class="mxinfo " id="T7:U8"><span class="var type1" id="S7T7U16">lx</span> = <span class="mxinfo " id="T7:U10">numel(<span class="var type1" id="S4T7U19">xx</span>)</span></span>; <span class="mxinfo " id="T7:U12"><span class="var type1" id="S9T7U22">xs</span> = <span class="mxinfo " id="T7:U14">reshape(<span class="var type1" id="S4T7U25">xx</span>,1,<span class="var type1" id="S7T7U27">lx</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="164,54" id="srcline54">54</a></span><span class="line"><span class="comment">%  if XX is row vector, suppress its first dimension</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,55" id="srcline55">55</a></span><span class="line"><span class="keyword">if</span> length(<span class="var type1" id="S5T8U34">sizexx</span>)==2&amp;&amp;<span class="var type1" id="S5T8U38">sizexx</span>(1)==1 </span></span>
<span class="srcline"><span class="lineno"><a href="164,56" id="srcline56">56</a></span><span class="line"><span class="comment">%     sizexx(1) = [];</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,57" id="srcline57">57</a></span><span class="line">    <span class="mxinfo " id="T7:U19"><span class="var type1" id="S12T7U43">size1xx</span> = <span class="mxinfo " id="T7:U21"><span class="var type1" id="S5T8U45">sizexx</span>(2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="164,58" id="srcline58">58</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,59" id="srcline59">59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="164,60" id="srcline60">60</a></span><span class="line"><span class="comment">% take apart PP</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,61" id="srcline61">61</a></span><span class="line">[<span class="var type1" id="S13T13U50">b</span>,<span class="var type1" id="S14T13U51">c</span>,<span class="var type1" id="S15T7U52">l</span>,<span class="var type1" id="S16T7U53">k</span>,<span class="mxinfo " id="T7:U27">~</span>]=unmkpp(<span class="var type1" id="S3T14U57">pp</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="164,62" id="srcline62">62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="164,63" id="srcline63">63</a></span><span class="line"><span class="comment">% for each evaluation site, compute its breakpoint interval</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,64" id="srcline64">64</a></span><span class="line"><span class="comment">% (mindful of the possibility that xx might be empty)</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,65" id="srcline65">65</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S7T7U60">lx</span>, [<span class="mxinfo " id="T175:U30">~</span>,<span class="var type1" id="S18T7U65">index</span>] = histc(<span class="var type1" id="S9T7U68">xs</span>,<span class="mxinfo " id="T175:U33">[<span class="mxinfo " id="T7:U34">-<span class="mxinfo " id="T7:U35">inf</span></span>,<span class="mxinfo " id="T182:U36"><span class="var type1" id="S13T13U75">b</span>(<span class="mxinfo " id="T183:U38"><span class="mxinfo " id="T7:U39">2</span>:<span class="var type1" id="S15T7U78">l</span></span>)</span>,<span class="mxinfo " id="T7:U41">inf</span>]</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="164,66" id="srcline66">66</a></span><span class="line"><span class="keyword">else</span> <span class="var type0" id="S18T0U84">index</span> = ones(1,<span class="var type0" id="S7T0U88">lx</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="164,67" id="srcline67">67</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,68" id="srcline68">68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="164,69" id="srcline69">69</a></span><span class="line"><span class="comment">% adjust for troubles, like evaluation sites that are NaN or +-inf</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,70" id="srcline70">70</a></span><span class="line"><span class="mxinfo " id="T178:U42"><span class="var type1" id="S22T178U91">infxs</span> = <span class="mxinfo " id="T178:U44">find(<span class="mxinfo " id="T28:U45"><span class="var type1" id="S9T7U95">xs</span>==<span class="mxinfo " id="T7:U47">inf</span></span>)</span></span>; <span class="keyword">if</span> <span class="mxinfo " id="T28:U48">~<span class="mxinfo " id="T28:U49">isempty(<span class="var type1" id="S22T178U103">infxs</span>)</span></span>, <span class="mxinfo " id="T178:U51"><span class="mxinfo " id="T178:U52"><span class="var type1" id="S18T7U107">index</span>(<span class="var type1" id="S22T178U108">infxs</span>)</span> = <span class="var type1" id="S15T7U109">l</span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,71" id="srcline71">71</a></span><span class="line"><span class="mxinfo " id="T178:U56"><span class="var type1" id="S25T178U112">nogoodxs</span> = <span class="mxinfo " id="T178:U58">find(<span class="mxinfo " id="T28:U59"><span class="var type1" id="S18T7U116">index</span>==<span class="mxinfo " id="T7:U61">0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="164,72" id="srcline72">72</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T28:U62">~<span class="mxinfo " id="T28:U63">isempty(<span class="var type1" id="S25T178U123">nogoodxs</span>)</span></span>, <span class="mxinfo " id="T178:U65"><span class="mxinfo " id="T178:U66"><span class="var type1" id="S9T7U127">xs</span>(<span class="var type1" id="S25T178U128">nogoodxs</span>)</span> = <span class="mxinfo " id="T7:U69">NaN</span></span>; <span class="mxinfo " id="T178:U70"><span class="mxinfo " id="T178:U71"><span class="var type1" id="S18T7U134">index</span>(<span class="var type1" id="S25T178U135">nogoodxs</span>)</span> = <span class="mxinfo " id="T7:U74">1</span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,73" id="srcline73">73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="164,74" id="srcline74">74</a></span><span class="line"><span class="comment">% now go to local coordinates <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,75" id="srcline75">75</a></span><span class="line"><span class="mxinfo " id="T7:U75"><span class="var type1" id="S9T7U139">xs</span> = <span class="mxinfo " id="T7:U77"><span class="var type1" id="S9T7U141">xs</span>-<span class="mxinfo " id="T7:U79"><span class="var type1" id="S13T13U143">b</span>(<span class="var type1" id="S18T7U144">index</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="164,76" id="srcline76">76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="164,77" id="srcline77">77</a></span><span class="line"><span class="keyword">if</span> length(<span class="var type1" id="S12T7U150">size1xx</span>)&gt;1, <span class="var type0" id="S27T0U154">dd</span> = []; <span class="keyword">else</span> <span class="mxinfo " id="T7:U83"><span class="var type1" id="S27T7U160">dd</span> = <span class="mxinfo " id="T7:U85">1</span></span>; <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,78" id="srcline78">78</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="164,79" id="srcline79">79</a></span><span class="line"><span class="comment">% <span class="keyword">...</span><span class="comment"> and apply nested multiplication:</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="164,80" id="srcline80">80</a></span><span class="line"><span class="mxinfo " id="T7:U86"><span class="var type1" id="S2T7U164">v</span> = <span class="mxinfo " id="T7:U88"><span class="var type1" id="S14T13U166">c</span>(<span class="var type1" id="S18T7U167">index</span>,<span class="mxinfo " id="T7:U91">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="164,81" id="srcline81">81</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S28T7U171">i</span>=<span class="mxinfo " id="T7:U93">2</span>:<span class="var type1" id="S16T7U174">k</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,82" id="srcline82">82</a></span><span class="line">   <span class="mxinfo " id="T7:U95"><span class="var type1" id="S2T7U177">v</span> = <span class="mxinfo " id="T7:U97"><span class="mxinfo " id="T7:U98"><span class="var type1" id="S9T7U181">xs</span>(:).*<span class="var type1" id="S2T7U183">v</span></span> + <span class="mxinfo " id="T7:U101"><span class="var type1" id="S14T13U185">c</span>(<span class="var type1" id="S18T7U186">index</span>,<span class="var type1" id="S28T7U187">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="164,83" id="srcline83">83</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,84" id="srcline84">84</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="164,85" id="srcline85">85</a></span><span class="line"><span class="comment">% If evaluating a piecewise constant with more than one piece at NaN, return</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,86" id="srcline86">86</a></span><span class="line"><span class="comment">% NaN.  With one piece return the constant.</span></span></span>
<span class="srcline"><span class="lineno"><a href="164,87" id="srcline87">87</a></span><span class="line"><span class="mxinfo " id="T7:U105"><span class="var type1" id="S2T7U190">v</span> = <span class="mxinfo " id="T7:U107">reshape(<span class="var type1" id="S2T7U193">v</span>,[<span class="var type1" id="S27T7U196">dd</span>,<span class="var type1" id="S12T7U197">size1xx</span>])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="164,88" id="srcline88">88</a></span><span class="line"></span></span>
</pre>
