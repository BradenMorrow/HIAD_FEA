<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="64,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T76U3">qi</span>] = get_quat_R(<span class="var type1" id="S3T73U6">R</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="64,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%GET_QUAT_R</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%   Get unit quaternions from a rotation matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,4" id="srcline4"> 4</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,5" id="srcline5"> 5</a></span><span class="line">[<span class="var type1" id="S4T7U10">m</span>,<span class="var type1" id="S5T7U11">i</span>] = max(<span class="mxinfo " id="T74:U5">[<span class="mxinfo " id="T7:U6">trace(<span class="var type1" id="S3T73U18">R</span>)</span> <span class="mxinfo " id="T7:U8"><span class="var type1" id="S3T73U20">R</span>(<span class="mxinfo " id="T49:U10">1</span>,<span class="mxinfo " id="T49:U11">1</span>)</span> <span class="mxinfo " id="T7:U12"><span class="var type1" id="S3T73U24">R</span>(<span class="mxinfo " id="T49:U14">2</span>,<span class="mxinfo " id="T49:U15">2</span>)</span> <span class="mxinfo " id="T7:U16"><span class="var type1" id="S3T73U28">R</span>(<span class="mxinfo " id="T49:U18">3</span>,<span class="mxinfo " id="T49:U19">3</span>)</span>]</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="64,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,7" id="srcline7"> 7</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T28:U20"><span class="var type1" id="S4T7U34">m</span> == <span class="mxinfo " id="T7:U22">trace(<span class="var type1" id="S3T73U37">R</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="64,8" id="srcline8"> 8</a></span><span class="line">    <span class="mxinfo " id="T7:U24"><span class="var type1" id="S8T7U40">q0</span> = <span class="mxinfo " id="T7:U26"><span class="mxinfo " id="T7:U27"><span class="mxinfo " id="T7:U28">1</span>/<span class="mxinfo " id="T7:U29">2</span></span>*<span class="mxinfo " id="T7:U30">sqrt(<span class="mxinfo " id="T7:U31"><span class="var type1" id="S4T7U48">m</span> + <span class="mxinfo " id="T7:U33">1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,9" id="srcline9"> 9</a></span><span class="line">    <span class="mxinfo " id="T7:U34"><span class="var type1" id="S10T7U52">q1</span> = <span class="mxinfo " id="T7:U36"><span class="mxinfo " id="T7:U37"><span class="mxinfo " id="T7:U38">1</span>/(<span class="mxinfo " id="T7:U39"><span class="mxinfo " id="T7:U40">4</span>*<span class="var type1" id="S8T7U59">q0</span></span>)</span>*(<span class="mxinfo " id="T7:U42"><span class="mxinfo " id="T7:U43"><span class="var type1" id="S3T73U63">R</span>(<span class="mxinfo " id="T7:U45">3</span>,<span class="mxinfo " id="T7:U46">2</span>)</span> - <span class="mxinfo " id="T7:U47"><span class="var type1" id="S3T73U67">R</span>(<span class="mxinfo " id="T7:U49">2</span>,<span class="mxinfo " id="T7:U50">3</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,10" id="srcline10">10</a></span><span class="line">    <span class="mxinfo " id="T7:U51"><span class="var type1" id="S11T7U72">q2</span> = <span class="mxinfo " id="T7:U53"><span class="mxinfo " id="T7:U54"><span class="mxinfo " id="T7:U55">1</span>/(<span class="mxinfo " id="T7:U56"><span class="mxinfo " id="T7:U57">4</span>*<span class="var type1" id="S8T7U79">q0</span></span>)</span>*(<span class="mxinfo " id="T7:U59"><span class="mxinfo " id="T7:U60"><span class="var type1" id="S3T73U83">R</span>(<span class="mxinfo " id="T7:U62">1</span>,<span class="mxinfo " id="T7:U63">3</span>)</span> - <span class="mxinfo " id="T7:U64"><span class="var type1" id="S3T73U87">R</span>(<span class="mxinfo " id="T7:U66">3</span>,<span class="mxinfo " id="T7:U67">1</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,11" id="srcline11">11</a></span><span class="line">    <span class="mxinfo " id="T7:U68"><span class="var type1" id="S12T7U92">q3</span> = <span class="mxinfo " id="T7:U70"><span class="mxinfo " id="T7:U71"><span class="mxinfo " id="T7:U72">1</span>/(<span class="mxinfo " id="T7:U73"><span class="mxinfo " id="T7:U74">4</span>*<span class="var type1" id="S8T7U99">q0</span></span>)</span>*(<span class="mxinfo " id="T7:U76"><span class="mxinfo " id="T7:U77"><span class="var type1" id="S3T73U103">R</span>(<span class="mxinfo " id="T7:U79">2</span>,<span class="mxinfo " id="T7:U80">1</span>)</span> - <span class="mxinfo " id="T7:U81"><span class="var type1" id="S3T73U107">R</span>(<span class="mxinfo " id="T7:U83">1</span>,<span class="mxinfo " id="T7:U84">2</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,12" id="srcline12">12</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,13" id="srcline13">13</a></span><span class="line"><span class="keyword">elseif</span> <span class="mxinfo " id="T28:U85"><span class="mxinfo " id="T7:U86"><span class="var type1" id="S5T7U113">i</span> - <span class="mxinfo " id="T7:U88">1</span></span> == <span class="mxinfo " id="T7:U89">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="64,14" id="srcline14">14</a></span><span class="line">    <span class="mxinfo " id="T7:U90"><span class="var type1" id="S10T7U118">q1</span> = <span class="mxinfo " id="T7:U92">sqrt(<span class="mxinfo " id="T7:U93"><span class="mxinfo " id="T7:U94"><span class="var type1" id="S4T7U123">m</span>/<span class="mxinfo " id="T7:U96">2</span></span> + <span class="mxinfo " id="T7:U97">(<span class="mxinfo " id="T7:U98"><span class="mxinfo " id="T7:U99">1</span> - <span class="mxinfo " id="T7:U100">trace(<span class="var type1" id="S3T73U131">R</span>)</span></span>)/<span class="mxinfo " id="T7:U102">4</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,15" id="srcline15">15</a></span><span class="line">    <span class="mxinfo " id="T7:U103"><span class="var type1" id="S8T7U135">q0</span> = <span class="mxinfo " id="T7:U105">(<span class="mxinfo " id="T7:U106"><span class="mxinfo " id="T7:U107"><span class="var type1" id="S3T73U140">R</span>(<span class="mxinfo " id="T49:U109">3</span>,<span class="mxinfo " id="T49:U110">2</span>)</span> - <span class="mxinfo " id="T7:U111"><span class="var type1" id="S3T73U144">R</span>(<span class="mxinfo " id="T7:U113">2</span>,<span class="mxinfo " id="T7:U114">3</span>)</span></span>)/(<span class="mxinfo " id="T7:U115"><span class="mxinfo " id="T7:U116">4</span>*<span class="var type1" id="S10T7U150">q1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,16" id="srcline16">16</a></span><span class="line">    <span class="mxinfo " id="T7:U118"><span class="var type1" id="S11T7U153">q2</span> = <span class="mxinfo " id="T7:U120">(<span class="mxinfo " id="T7:U121"><span class="mxinfo " id="T7:U122"><span class="var type1" id="S3T73U158">R</span>(<span class="mxinfo " id="T49:U124">2</span>,<span class="mxinfo " id="T49:U125">1</span>)</span> + <span class="mxinfo " id="T7:U126"><span class="var type1" id="S3T73U162">R</span>(<span class="mxinfo " id="T7:U128">1</span>,<span class="mxinfo " id="T7:U129">2</span>)</span></span>)/(<span class="mxinfo " id="T7:U130"><span class="mxinfo " id="T7:U131">4</span>*<span class="var type1" id="S10T7U168">q1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,17" id="srcline17">17</a></span><span class="line">    <span class="mxinfo " id="T7:U133"><span class="var type1" id="S12T7U171">q3</span> = <span class="mxinfo " id="T7:U135">(<span class="mxinfo " id="T7:U136"><span class="mxinfo " id="T7:U137"><span class="var type1" id="S3T73U176">R</span>(<span class="mxinfo " id="T49:U139">3</span>,<span class="mxinfo " id="T49:U140">1</span>)</span> + <span class="mxinfo " id="T7:U141"><span class="var type1" id="S3T73U180">R</span>(<span class="mxinfo " id="T7:U143">1</span>,<span class="mxinfo " id="T7:U144">3</span>)</span></span>)/(<span class="mxinfo " id="T7:U145"><span class="mxinfo " id="T7:U146">4</span>*<span class="var type1" id="S10T7U186">q1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,18" id="srcline18">18</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,19" id="srcline19">19</a></span><span class="line"><span class="keyword">elseif</span> <span class="mxinfo " id="T28:U148"><span class="mxinfo " id="T7:U149"><span class="var type1" id="S5T7U190">i</span> - <span class="mxinfo " id="T7:U151">1</span></span> == <span class="mxinfo " id="T7:U152">2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="64,20" id="srcline20">20</a></span><span class="line">    <span class="mxinfo " id="T7:U153"><span class="var type1" id="S11T7U195">q2</span> = <span class="mxinfo " id="T7:U155">sqrt(<span class="mxinfo " id="T7:U156"><span class="mxinfo " id="T7:U157"><span class="var type1" id="S4T7U200">m</span>/<span class="mxinfo " id="T7:U159">2</span></span> + <span class="mxinfo " id="T7:U160">(<span class="mxinfo " id="T7:U161"><span class="mxinfo " id="T7:U162">1</span> - <span class="mxinfo " id="T7:U163">trace(<span class="var type1" id="S3T73U208">R</span>)</span></span>)/<span class="mxinfo " id="T7:U165">4</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,21" id="srcline21">21</a></span><span class="line">    <span class="mxinfo " id="T7:U166"><span class="var type1" id="S8T7U212">q0</span> = <span class="mxinfo " id="T7:U168">(<span class="mxinfo " id="T7:U169"><span class="mxinfo " id="T7:U170"><span class="var type1" id="S3T73U217">R</span>(<span class="mxinfo " id="T49:U172">1</span>,<span class="mxinfo " id="T49:U173">3</span>)</span> - <span class="mxinfo " id="T7:U174"><span class="var type1" id="S3T73U221">R</span>(<span class="mxinfo " id="T7:U176">3</span>,<span class="mxinfo " id="T7:U177">1</span>)</span></span>)/(<span class="mxinfo " id="T7:U178"><span class="mxinfo " id="T7:U179">4</span>*<span class="var type1" id="S11T7U227">q2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,22" id="srcline22">22</a></span><span class="line">    <span class="mxinfo " id="T7:U181"><span class="var type1" id="S10T7U230">q1</span> = <span class="mxinfo " id="T7:U183">(<span class="mxinfo " id="T7:U184"><span class="mxinfo " id="T7:U185"><span class="var type1" id="S3T73U235">R</span>(<span class="mxinfo " id="T49:U187">1</span>,<span class="mxinfo " id="T49:U188">2</span>)</span> + <span class="mxinfo " id="T7:U189"><span class="var type1" id="S3T73U239">R</span>(<span class="mxinfo " id="T7:U191">2</span>,<span class="mxinfo " id="T7:U192">1</span>)</span></span>)/(<span class="mxinfo " id="T7:U193"><span class="mxinfo " id="T7:U194">4</span>*<span class="var type1" id="S11T7U245">q2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,23" id="srcline23">23</a></span><span class="line">    <span class="mxinfo " id="T7:U196"><span class="var type1" id="S12T7U248">q3</span> = <span class="mxinfo " id="T7:U198">(<span class="mxinfo " id="T7:U199"><span class="mxinfo " id="T7:U200"><span class="var type1" id="S3T73U253">R</span>(<span class="mxinfo " id="T49:U202">3</span>,<span class="mxinfo " id="T49:U203">2</span>)</span> + <span class="mxinfo " id="T7:U204"><span class="var type1" id="S3T73U257">R</span>(<span class="mxinfo " id="T7:U206">2</span>,<span class="mxinfo " id="T7:U207">3</span>)</span></span>)/(<span class="mxinfo " id="T7:U208"><span class="mxinfo " id="T7:U209">4</span>*<span class="var type1" id="S11T7U263">q2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,24" id="srcline24">24</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="64,25" id="srcline25">25</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,26" id="srcline26">26</a></span><span class="line">    <span class="mxinfo " id="T7:U211"><span class="var type1" id="S12T7U267">q3</span> = <span class="mxinfo " id="T7:U213">sqrt(<span class="mxinfo " id="T7:U214"><span class="mxinfo " id="T7:U215"><span class="var type1" id="S4T7U272">m</span>/<span class="mxinfo " id="T7:U217">2</span></span> + <span class="mxinfo " id="T7:U218">(<span class="mxinfo " id="T7:U219"><span class="mxinfo " id="T7:U220">1</span> - <span class="mxinfo " id="T7:U221">trace(<span class="var type1" id="S3T73U280">R</span>)</span></span>)/<span class="mxinfo " id="T7:U223">4</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,27" id="srcline27">27</a></span><span class="line">    <span class="mxinfo " id="T7:U224"><span class="var type1" id="S8T7U284">q0</span> = <span class="mxinfo " id="T7:U226">(<span class="mxinfo " id="T7:U227"><span class="mxinfo " id="T7:U228"><span class="var type1" id="S3T73U289">R</span>(<span class="mxinfo " id="T49:U230">1</span>,<span class="mxinfo " id="T49:U231">3</span>)</span> - <span class="mxinfo " id="T7:U232"><span class="var type1" id="S3T73U293">R</span>(<span class="mxinfo " id="T7:U234">3</span>,<span class="mxinfo " id="T7:U235">1</span>)</span></span>)/(<span class="mxinfo " id="T7:U236"><span class="mxinfo " id="T7:U237">4</span>*<span class="var type1" id="S12T7U299">q3</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,28" id="srcline28">28</a></span><span class="line">    <span class="mxinfo " id="T7:U239"><span class="var type1" id="S10T7U302">q1</span> = <span class="mxinfo " id="T7:U241">(<span class="mxinfo " id="T7:U242"><span class="mxinfo " id="T7:U243"><span class="var type1" id="S3T73U307">R</span>(<span class="mxinfo " id="T49:U245">1</span>,<span class="mxinfo " id="T49:U246">3</span>)</span> + <span class="mxinfo " id="T7:U247"><span class="var type1" id="S3T73U311">R</span>(<span class="mxinfo " id="T7:U249">3</span>,<span class="mxinfo " id="T7:U250">1</span>)</span></span>)/(<span class="mxinfo " id="T7:U251"><span class="mxinfo " id="T7:U252">4</span>*<span class="var type1" id="S12T7U317">q3</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,29" id="srcline29">29</a></span><span class="line">    <span class="mxinfo " id="T7:U254"><span class="var type1" id="S11T7U320">q2</span> = <span class="mxinfo " id="T7:U256">(<span class="mxinfo " id="T7:U257"><span class="mxinfo " id="T7:U258"><span class="var type1" id="S3T73U325">R</span>(<span class="mxinfo " id="T49:U260">2</span>,<span class="mxinfo " id="T49:U261">3</span>)</span> + <span class="mxinfo " id="T7:U262"><span class="var type1" id="S3T73U329">R</span>(<span class="mxinfo " id="T7:U264">3</span>,<span class="mxinfo " id="T7:U265">2</span>)</span></span>)/(<span class="mxinfo " id="T7:U266"><span class="mxinfo " id="T7:U267">4</span>*<span class="var type1" id="S12T7U335">q3</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,30" id="srcline30">30</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,31" id="srcline31">31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,32" id="srcline32">32</a></span><span class="line"><span class="mxinfo " id="T76:U269"><span class="var type1" id="S2T76U338">qi</span> = <span class="mxinfo " id="T76:U271"><span class="mxinfo " id="T74:U272">[<span class="var type1" id="S8T7U342">q0</span> <span class="var type1" id="S10T7U343">q1</span> <span class="var type1" id="S11T7U344">q2</span> <span class="var type1" id="S12T7U345">q3</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="64,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="64,34" id="srcline34">34</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="64,35" id="srcline35">35</a></span><span class="line"></span></span>
</pre>
