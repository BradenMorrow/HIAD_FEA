<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="156,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T163U3">Kel</span>,<span class="var type1" id="S3T36U4">fint_i</span>,<span class="var type1" id="S4T36U5">Fint_i</span>,<span class="var type1" id="S5T167U6">ROT</span>,<span class="var type1" id="S6T168U7">el_out</span>] = el3(<span class="var type1" id="S7T169U10">U_in</span>,<span class="var type1" id="S8T3U11">el_in</span>,<span class="var type1" id="S9T168U12">el_in0</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="156,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%ELEMENT_5</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   3D corotational beam formulation, see Crisfield (1990), A consistent</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   co-rotational formulation for non-linear, three dimensional,</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   beam-elements</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   </span></span></span>
<span class="srcline"><span class="lineno"><a href="156,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   With material nonlinearity</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   </span></span></span>
<span class="srcline"><span class="lineno"><a href="156,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%   See also de Souza dissertation (2000), Force-based finite element for</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%   large displacement inelastic analysis of frames</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%   Generally follows de Souza</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,12" id="srcline12"> 12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">% Extract variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">% Geometry</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,15" id="srcline15"> 15</a></span><span class="line"><span class="mxinfo " id="T4:U9"><span class="var type1" id="S10T4U15">nodes</span> = <span class="mxinfo " id="T4:U11"><span class="var type1" id="S8T3U17">el_in</span>.nodes_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,16" id="srcline16"> 16</a></span><span class="line"><span class="mxinfo " id="T5:U13"><span class="var type1" id="S11T5U21">orient</span> = <span class="mxinfo " id="T5:U15"><span class="var type1" id="S8T3U23">el_in</span>.orient_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,17" id="srcline17"> 17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% Obtain displacements of interest</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,19" id="srcline19"> 19</a></span><span class="line"><span class="mxinfo " id="T170:U17"><span class="var type1" id="S12T170U27">Uel</span> = <span class="mxinfo " id="T170:U19"><span class="var type1" id="S7T169U29">U_in</span>.U</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo " id="T170:U21"><span class="var type1" id="S13T170U33">delta_Uel</span> = <span class="mxinfo " id="T170:U23"><span class="var type1" id="S7T169U35">U_in</span>.delta_U</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,21" id="srcline21"> 21</a></span><span class="line"><span class="mxinfo " id="T170:U25"><span class="var type1" id="S14T170U39">DELTA_Uel</span> = <span class="mxinfo " id="T170:U27"><span class="var type1" id="S7T169U41">U_in</span>.DELTA_U</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,22" id="srcline22"> 22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% Components of length and length</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% Initial</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T7:U29"><span class="var type1" id="S15T7U45">L10</span> = <span class="mxinfo " id="T7:U31"><span class="mxinfo " id="T7:U32"><span class="var type1" id="S10T4U48">nodes</span>(<span class="mxinfo " id="T49:U34">2</span>,<span class="mxinfo " id="T49:U35">1</span>)</span> - <span class="mxinfo " id="T7:U36"><span class="var type1" id="S10T4U52">nodes</span>(<span class="mxinfo " id="T7:U38">1</span>,<span class="mxinfo " id="T7:U39">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo " id="T7:U40"><span class="var type1" id="S16T7U57">L20</span> = <span class="mxinfo " id="T7:U42"><span class="mxinfo " id="T7:U43"><span class="var type1" id="S10T4U60">nodes</span>(<span class="mxinfo " id="T49:U45">2</span>,<span class="mxinfo " id="T49:U46">2</span>)</span> - <span class="mxinfo " id="T7:U47"><span class="var type1" id="S10T4U64">nodes</span>(<span class="mxinfo " id="T7:U49">1</span>,<span class="mxinfo " id="T7:U50">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T7:U51"><span class="var type1" id="S17T7U69">L30</span> = <span class="mxinfo " id="T7:U53"><span class="mxinfo " id="T7:U54"><span class="var type1" id="S10T4U72">nodes</span>(<span class="mxinfo " id="T49:U56">2</span>,<span class="mxinfo " id="T49:U57">3</span>)</span> - <span class="mxinfo " id="T7:U58"><span class="var type1" id="S10T4U76">nodes</span>(<span class="mxinfo " id="T7:U60">1</span>,<span class="mxinfo " id="T7:U61">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo " id="T7:U62"><span class="var type1" id="S18T7U81">L0</span> = <span class="mxinfo " id="T7:U64">sqrt(<span class="mxinfo " id="T7:U65"><span class="mxinfo " id="T7:U66"><span class="mxinfo " id="T7:U67"><span class="var type1" id="S15T7U87">L10</span>^2</span> + <span class="mxinfo " id="T7:U69"><span class="var type1" id="S16T7U90">L20</span>^2</span></span> + <span class="mxinfo " id="T7:U71"><span class="var type1" id="S17T7U93">L30</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,29" id="srcline29"> 29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">% Current</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,31" id="srcline31"> 31</a></span><span class="line"><span class="mxinfo " id="T7:U73"><span class="var type1" id="S20T7U97">L1</span> = <span class="mxinfo " id="T7:U75">(<span class="mxinfo " id="T7:U76"><span class="mxinfo " id="T7:U77"><span class="var type1" id="S10T4U102">nodes</span>(<span class="mxinfo " id="T49:U79">2</span>,<span class="mxinfo " id="T49:U80">1</span>)</span> + <span class="mxinfo " id="T7:U81"><span class="var type1" id="S12T170U106">Uel</span>(<span class="mxinfo " id="T7:U83">2</span>,<span class="mxinfo " id="T7:U84">1</span>)</span></span>) - (<span class="mxinfo " id="T7:U85"><span class="mxinfo " id="T7:U86"><span class="var type1" id="S10T4U112">nodes</span>(<span class="mxinfo " id="T7:U88">1</span>,<span class="mxinfo " id="T7:U89">1</span>)</span> + <span class="mxinfo " id="T7:U90"><span class="var type1" id="S12T170U116">Uel</span>(<span class="mxinfo " id="T7:U92">1</span>,<span class="mxinfo " id="T7:U93">1</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,32" id="srcline32"> 32</a></span><span class="line"><span class="mxinfo " id="T7:U94"><span class="var type1" id="S21T7U121">L2</span> = <span class="mxinfo " id="T7:U96">(<span class="mxinfo " id="T7:U97"><span class="mxinfo " id="T7:U98"><span class="var type1" id="S10T4U126">nodes</span>(<span class="mxinfo " id="T49:U100">2</span>,<span class="mxinfo " id="T49:U101">2</span>)</span> + <span class="mxinfo " id="T7:U102"><span class="var type1" id="S12T170U130">Uel</span>(<span class="mxinfo " id="T7:U104">2</span>,<span class="mxinfo " id="T7:U105">2</span>)</span></span>) - (<span class="mxinfo " id="T7:U106"><span class="mxinfo " id="T7:U107"><span class="var type1" id="S10T4U136">nodes</span>(<span class="mxinfo " id="T7:U109">1</span>,<span class="mxinfo " id="T7:U110">2</span>)</span> + <span class="mxinfo " id="T7:U111"><span class="var type1" id="S12T170U140">Uel</span>(<span class="mxinfo " id="T7:U113">1</span>,<span class="mxinfo " id="T7:U114">2</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T7:U115"><span class="var type1" id="S22T7U145">L3</span> = <span class="mxinfo " id="T7:U117">(<span class="mxinfo " id="T7:U118"><span class="mxinfo " id="T7:U119"><span class="var type1" id="S10T4U150">nodes</span>(<span class="mxinfo " id="T49:U121">2</span>,<span class="mxinfo " id="T49:U122">3</span>)</span> + <span class="mxinfo " id="T7:U123"><span class="var type1" id="S12T170U154">Uel</span>(<span class="mxinfo " id="T7:U125">2</span>,<span class="mxinfo " id="T7:U126">3</span>)</span></span>) - (<span class="mxinfo " id="T7:U127"><span class="mxinfo " id="T7:U128"><span class="var type1" id="S10T4U160">nodes</span>(<span class="mxinfo " id="T7:U130">1</span>,<span class="mxinfo " id="T7:U131">3</span>)</span> + <span class="mxinfo " id="T7:U132"><span class="var type1" id="S12T170U164">Uel</span>(<span class="mxinfo " id="T7:U134">1</span>,<span class="mxinfo " id="T7:U135">3</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T7:U136"><span class="var type1" id="S23T7U169">L</span> = <span class="mxinfo " id="T7:U138">sqrt(<span class="mxinfo " id="T7:U139"><span class="mxinfo " id="T7:U140"><span class="mxinfo " id="T7:U141"><span class="var type1" id="S20T7U175">L1</span>^2</span> + <span class="mxinfo " id="T7:U143"><span class="var type1" id="S21T7U178">L2</span>^2</span></span> + <span class="mxinfo " id="T7:U145"><span class="var type1" id="S22T7U181">L3</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,35" id="srcline35"> 35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">% To orientation nodes</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">% Initial</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">% Lo10 = orient(1:2,1) - nodes(1:2,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">% Lo20 = orient(1:2,2) - nodes(1:2,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">% Lo30 = orient(1:2,3) - nodes(1:2,3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,41" id="srcline41"> 41</a></span><span class="line"><span class="mxinfo " id="T7:U147"><span class="var type1" id="S24T7U185">Lo10</span> = <span class="mxinfo " id="T7:U149"><span class="mxinfo " id="T7:U150"><span class="var type1" id="S11T5U188">orient</span>(<span class="mxinfo " id="T49:U152">1</span>,<span class="mxinfo " id="T49:U153">1</span>)</span> - <span class="mxinfo " id="T7:U154"><span class="var type1" id="S10T4U192">nodes</span>(<span class="mxinfo " id="T7:U156">1</span>,<span class="mxinfo " id="T7:U157">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,42" id="srcline42"> 42</a></span><span class="line"><span class="mxinfo " id="T7:U158"><span class="var type1" id="S25T7U197">Lo20</span> = <span class="mxinfo " id="T7:U160"><span class="mxinfo " id="T7:U161"><span class="var type1" id="S11T5U200">orient</span>(<span class="mxinfo " id="T49:U163">1</span>,<span class="mxinfo " id="T49:U164">2</span>)</span> - <span class="mxinfo " id="T7:U165"><span class="var type1" id="S10T4U204">nodes</span>(<span class="mxinfo " id="T7:U167">1</span>,<span class="mxinfo " id="T7:U168">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo " id="T7:U169"><span class="var type1" id="S26T7U209">Lo30</span> = <span class="mxinfo " id="T7:U171"><span class="mxinfo " id="T7:U172"><span class="var type1" id="S11T5U212">orient</span>(<span class="mxinfo " id="T49:U174">1</span>,<span class="mxinfo " id="T49:U175">3</span>)</span> - <span class="mxinfo " id="T7:U176"><span class="var type1" id="S10T4U216">nodes</span>(<span class="mxinfo " id="T7:U178">1</span>,<span class="mxinfo " id="T7:U179">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% Obtain the initial nodal triads</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">% Unit vectors at i node</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,47" id="srcline47"> 47</a></span><span class="line"><span class="mxinfo " id="T72:U180"><span class="var type1" id="S27T72U221">e10</span> = <span class="mxinfo " id="T72:U182"><span class="mxinfo " id="T5:U183">[<span class="var type1" id="S15T7U225">L10</span> <span class="var type1" id="S16T7U226">L20</span> <span class="var type1" id="S17T7U227">L30</span>]</span>'</span></span>; <span class="comment">% Along element (x)</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,48" id="srcline48"> 48</a></span><span class="line"><span class="mxinfo " id="T72:U187"><span class="var type1" id="S27T72U230">e10</span> = <span class="mxinfo " id="T72:U189"><span class="var type1" id="S27T72U232">e10</span>/<span class="mxinfo " id="T7:U191">norm(<span class="var type1" id="S27T72U235">e10</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,49" id="srcline49"> 49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo " id="T72:U193"><span class="var type1" id="S29T72U238">e30</span> = <span class="mxinfo " id="T72:U195">cross(<span class="var type1" id="S27T72U241">e10</span>,<span class="mxinfo " id="T72:U197"><span class="mxinfo " id="T5:U198">[<span class="var type1" id="S24T7U246">Lo10</span>(1) <span class="var type1" id="S25T7U249">Lo20</span>(1) <span class="var type1" id="S26T7U252">Lo30</span>(1)]</span>'</span>)</span></span>; <span class="comment">% Cross with i orientation (z)</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo " id="T72:U202"><span class="var type1" id="S29T72U256">e30</span> = <span class="mxinfo " id="T72:U204"><span class="var type1" id="S29T72U258">e30</span>/<span class="mxinfo " id="T7:U206">norm(<span class="var type1" id="S29T72U261">e30</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,52" id="srcline52"> 52</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo " id="T72:U208"><span class="var type1" id="S31T72U264">e20</span> = <span class="mxinfo " id="T72:U210">cross(<span class="var type1" id="S29T72U267">e30</span>,<span class="var type1" id="S27T72U268">e10</span>)</span></span>; <span class="comment">% Cross with x (y)</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo " id="T72:U213"><span class="var type1" id="S31T72U271">e20</span> = <span class="mxinfo " id="T72:U215"><span class="var type1" id="S31T72U273">e20</span>/<span class="mxinfo " id="T7:U217">norm(<span class="var type1" id="S31T72U276">e20</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,55" id="srcline55"> 55</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo " id="T73:U219"><span class="var type1" id="S32T73U279">E0</span> = <span class="mxinfo " id="T73:U221">[<span class="var type1" id="S27T72U282">e10</span> <span class="var type1" id="S31T72U283">e20</span> <span class="var type1" id="S29T72U284">e30</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">% Compute nodal triads and average rotation</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">% Section 5.3.2a - de Souza</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,62" id="srcline62"> 62</a></span><span class="line"><span class="mxinfo " id="T76:U225"><span class="var type1" id="S33T76U287">e0</span> = <span class="mxinfo " id="T76:U227"><span class="fcn" id="F181N21:B289">get_quat_R</span>(<span class="var type1" id="S32T73U290">E0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,63" id="srcline63"> 63</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,64" id="srcline64"> 64</a></span><span class="line"><span class="mxinfo " id="T76:U229"><span class="var type1" id="S35T76U293">qi_old</span> = <span class="mxinfo " id="T76:U231"><span class="fcn" id="F190N20:B295">get_quat_PHI</span>(<span class="mxinfo " id="T72:U232"><span class="mxinfo " id="T5:U233"><span class="var type1" id="S12T170U298">Uel</span>(<span class="mxinfo " id="T49:U235">1</span>,<span class="mxinfo " id="T102:U236">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,65" id="srcline65"> 65</a></span><span class="line"><span class="mxinfo " id="T76:U237"><span class="var type1" id="S37T76U305">qj_old</span> = <span class="mxinfo " id="T76:U239"><span class="fcn" id="F190N20:B307">get_quat_PHI</span>(<span class="mxinfo " id="T72:U240"><span class="mxinfo " id="T5:U241"><span class="var type1" id="S12T170U310">Uel</span>(<span class="mxinfo " id="T49:U243">2</span>,<span class="mxinfo " id="T102:U244">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,66" id="srcline66"> 66</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo " id="T76:U245"><span class="var type1" id="S38T76U317">delta_qi</span> = <span class="mxinfo " id="T76:U247"><span class="fcn" id="F190N20:B319">get_quat_PHI</span>(<span class="mxinfo " id="T72:U248"><span class="mxinfo " id="T5:U249"><span class="var type1" id="S13T170U322">delta_Uel</span>(<span class="mxinfo " id="T49:U251">1</span>,<span class="mxinfo " id="T102:U252">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,68" id="srcline68"> 68</a></span><span class="line"><span class="mxinfo " id="T76:U253"><span class="var type1" id="S39T76U329">delta_qj</span> = <span class="mxinfo " id="T76:U255"><span class="fcn" id="F190N20:B331">get_quat_PHI</span>(<span class="mxinfo " id="T72:U256"><span class="mxinfo " id="T5:U257"><span class="var type1" id="S13T170U334">delta_Uel</span>(<span class="mxinfo " id="T49:U259">2</span>,<span class="mxinfo " id="T102:U260">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,69" id="srcline69"> 69</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">% STEP 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,71" id="srcline71"> 71</a></span><span class="line"><span class="mxinfo " id="T76:U261"><span class="var type1" id="S40T76U341">qI</span> = <span class="mxinfo " id="T76:U263"><span class="fcn" id="F210N26:B343">quat_prod</span>(<span class="var type1" id="S38T76U344">delta_qi</span>,<span class="var type1" id="S35T76U345">qi_old</span>)</span></span>; <span class="comment">% Equation 5.46</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,72" id="srcline72"> 72</a></span><span class="line"><span class="mxinfo " id="T76:U266"><span class="var type1" id="S42T76U348">qJ</span> = <span class="mxinfo " id="T76:U268"><span class="fcn" id="F210N26:B350">quat_prod</span>(<span class="var type1" id="S39T76U351">delta_qj</span>,<span class="var type1" id="S37T76U352">qj_old</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">% Calculate nodal rotation for incorporation into displacement vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,75" id="srcline75"> 75</a></span><span class="line"><span class="mxinfo " id="T72:U271"><span class="var type1" id="S43T72U355">rotI</span> = <span class="mxinfo " id="T72:U273"><span class="fcn" id="F222N17:B357">get_PHI_quat</span>(<span class="var type1" id="S40T76U358">qI</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo " id="T72:U275"><span class="var type1" id="S45T72U361">rotJ</span> = <span class="mxinfo " id="T72:U277"><span class="fcn" id="F222N17:B363">get_PHI_quat</span>(<span class="var type1" id="S42T76U364">qJ</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo " id="T4:U279"><span class="var type1" id="S46T4U367">rot</span> = <span class="mxinfo " id="T4:U281">[<span class="mxinfo " id="T5:U282"><span class="var type1" id="S43T72U371">rotI</span>'</span>; <span class="mxinfo " id="T5:U284"><span class="var type1" id="S45T72U374">rotJ</span>'</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo " id="T4:U286"><span class="mxinfo " id="T4:U287"><span class="var type1" id="S5T167U378">ROT</span>.rot</span> = <span class="var type1" id="S46T4U380">rot</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,79" id="srcline79"> 79</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,80" id="srcline80"> 80</a></span><span class="line"><span class="mxinfo " id="T76:U290"><span class="var type1" id="S47T76U383">nI</span> = <span class="mxinfo " id="T76:U292"><span class="fcn" id="F210N26:B385">quat_prod</span>(<span class="var type1" id="S40T76U386">qI</span>,<span class="var type1" id="S33T76U387">e0</span>)</span></span>; <span class="comment">% Equation 5.48</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo " id="T76:U295"><span class="var type1" id="S48T76U390">nJ</span> = <span class="mxinfo " id="T76:U297"><span class="fcn" id="F210N26:B392">quat_prod</span>(<span class="var type1" id="S42T76U393">qJ</span>,<span class="var type1" id="S33T76U394">e0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,82" id="srcline82"> 82</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">% If U = zeros, rotI and rotJ = zeros, nI and nJ = e0 ==&gt; OK</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">% However, NI and NJ should equal E0, not the case. (fixed now)</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">% % % NI = get_R_quat(nI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">% % % NJ = get_R_quat(nJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,88" id="srcline88"> 88</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">% June 25, 2015</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,90" id="srcline90"> 90</a></span><span class="line"><span class="mxinfo " id="T73:U300"><span class="var type1" id="S49T73U397">NI</span> = <span class="mxinfo " id="T73:U302"><span class="mxinfo " id="T73:U303"><span class="fcn" id="F347N18:B400">get_R_PHI</span>(<span class="mxinfo " id="T72:U304"><span class="mxinfo " id="T5:U305"><span class="var type1" id="S46T4U403">rot</span>(<span class="mxinfo " id="T49:U307">1</span>,<span class="mxinfo " id="T102:U308">:</span>)</span>'</span>)</span>*<span class="var type1" id="S32T73U406">E0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,91" id="srcline91"> 91</a></span><span class="line"><span class="mxinfo " id="T73:U310"><span class="var type1" id="S51T73U409">NJ</span> = <span class="mxinfo " id="T73:U312"><span class="mxinfo " id="T73:U313"><span class="fcn" id="F347N18:B412">get_R_PHI</span>(<span class="mxinfo " id="T72:U314"><span class="mxinfo " id="T5:U315"><span class="var type1" id="S46T4U415">rot</span>(<span class="mxinfo " id="T49:U317">2</span>,<span class="mxinfo " id="T102:U318">:</span>)</span>'</span>)</span>*<span class="var type1" id="S32T73U418">E0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,92" id="srcline92"> 92</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">% STEP 3</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,94" id="srcline94"> 94</a></span><span class="line"><span class="mxinfo " id="T72:U320"><span class="var type1" id="S52T72U421">gammaI</span> = <span class="mxinfo " id="T72:U322"><span class="fcn" id="F222N17:B423">get_PHI_quat</span>(<span class="var type1" id="S47T76U424">nI</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo " id="T72:U324"><span class="var type1" id="S53T72U427">gammaJ</span> = <span class="mxinfo " id="T72:U326"><span class="fcn" id="F222N17:B429">get_PHI_quat</span>(<span class="var type1" id="S48T76U430">nJ</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,96" id="srcline96"> 96</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">% STEP 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,98" id="srcline98"> 98</a></span><span class="line"><span class="mxinfo " id="T73:U328"><span class="var type1" id="S54T73U433">R_bar</span> = <span class="mxinfo " id="T73:U330"><span class="fcn" id="F347N18:B435">get_R_PHI</span>(<span class="mxinfo " id="T72:U331">(<span class="mxinfo " id="T72:U332"><span class="var type1" id="S52T72U439">gammaI</span> + <span class="var type1" id="S53T72U440">gammaJ</span></span>)/<span class="mxinfo " id="T7:U335">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,99" id="srcline99"> 99</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,100" id="srcline100">100</a></span><span class="line"><span class="comment">% Also need step change in rotations for arc-length solver (DELTA_U)</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,101" id="srcline101">101</a></span><span class="line"><span class="mxinfo " id="T76:U336"><span class="var type1" id="S55T76U444">DELTA_qi_old</span> = <span class="mxinfo " id="T76:U338"><span class="fcn" id="F190N20:B446">get_quat_PHI</span>(<span class="mxinfo " id="T72:U339"><span class="mxinfo " id="T5:U340"><span class="var type1" id="S14T170U449">DELTA_Uel</span>(<span class="mxinfo " id="T49:U342">1</span>,<span class="mxinfo " id="T102:U343">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,102" id="srcline102">102</a></span><span class="line"><span class="mxinfo " id="T76:U344"><span class="var type1" id="S56T76U456">DELTA_qj_old</span> = <span class="mxinfo " id="T76:U346"><span class="fcn" id="F190N20:B458">get_quat_PHI</span>(<span class="mxinfo " id="T72:U347"><span class="mxinfo " id="T5:U348"><span class="var type1" id="S14T170U461">DELTA_Uel</span>(<span class="mxinfo " id="T49:U350">2</span>,<span class="mxinfo " id="T102:U351">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,103" id="srcline103">103</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,104" id="srcline104">104</a></span><span class="line"><span class="mxinfo " id="T76:U352"><span class="var type1" id="S57T76U468">DELTA_qi</span> = <span class="mxinfo " id="T76:U354"><span class="fcn" id="F210N26:B470">quat_prod</span>(<span class="var type1" id="S38T76U471">delta_qi</span>,<span class="var type1" id="S55T76U472">DELTA_qi_old</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,105" id="srcline105">105</a></span><span class="line"><span class="mxinfo " id="T76:U357"><span class="var type1" id="S58T76U475">DELTA_qj</span> = <span class="mxinfo " id="T76:U359"><span class="fcn" id="F210N26:B477">quat_prod</span>(<span class="var type1" id="S39T76U478">delta_qj</span>,<span class="var type1" id="S56T76U479">DELTA_qj_old</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,106" id="srcline106">106</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo " id="T72:U362"><span class="var type1" id="S59T72U482">DELTA_rotI</span> = <span class="mxinfo " id="T72:U364"><span class="fcn" id="F222N17:B484">get_PHI_quat</span>(<span class="var type1" id="S57T76U485">DELTA_qi</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,108" id="srcline108">108</a></span><span class="line"><span class="mxinfo " id="T72:U366"><span class="var type1" id="S60T72U488">DELTA_rotJ</span> = <span class="mxinfo " id="T72:U368"><span class="fcn" id="F222N17:B490">get_PHI_quat</span>(<span class="var type1" id="S58T76U491">DELTA_qj</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,109" id="srcline109">109</a></span><span class="line"><span class="mxinfo " id="T4:U370"><span class="var type1" id="S61T4U494">DELTA_rot</span> = <span class="mxinfo " id="T4:U372">[<span class="mxinfo " id="T5:U373"><span class="var type1" id="S59T72U498">DELTA_rotI</span>'</span>; <span class="mxinfo " id="T5:U375"><span class="var type1" id="S60T72U501">DELTA_rotJ</span>'</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,110" id="srcline110">110</a></span><span class="line"><span class="mxinfo " id="T4:U377"><span class="mxinfo " id="T4:U378"><span class="var type1" id="S5T167U505">ROT</span>.DELTA_rot</span> = <span class="var type1" id="S61T4U507">DELTA_rot</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,111" id="srcline111">111</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,112" id="srcline112">112</a></span><span class="line"><span class="comment">% STEP 5</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,113" id="srcline113">113</a></span><span class="line"><span class="comment">% Compute e1, e2 and e3 to form E</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,114" id="srcline114">114</a></span><span class="line"><span class="mxinfo " id="T72:U381"><span class="var type1" id="S62T72U510">e1</span> = <span class="mxinfo " id="T72:U383"><span class="mxinfo " id="T5:U384">[<span class="var type1" id="S20T7U514">L1</span> <span class="var type1" id="S21T7U515">L2</span> <span class="var type1" id="S22T7U516">L3</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,115" id="srcline115">115</a></span><span class="line"><span class="mxinfo " id="T72:U388"><span class="var type1" id="S62T72U519">e1</span> = <span class="mxinfo " id="T72:U390"><span class="var type1" id="S62T72U521">e1</span>/<span class="mxinfo " id="T7:U392">norm(<span class="var type1" id="S62T72U524">e1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,116" id="srcline116">116</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,117" id="srcline117">117</a></span><span class="line"><span class="mxinfo " id="T72:U394"><span class="var type1" id="S63T72U527">e2</span> = <span class="mxinfo " id="T72:U396"><span class="mxinfo " id="T72:U397"><span class="var type1" id="S54T73U530">R_bar</span>(<span class="mxinfo " id="T102:U399">:</span>,<span class="mxinfo " id="T49:U400">2</span>)</span> - <span class="mxinfo " id="T72:U401"><span class="mxinfo " id="T7:U402"><span class="mxinfo " id="T7:U403"><span class="mxinfo " id="T5:U404"><span class="mxinfo " id="T72:U405"><span class="var type1" id="S54T73U538">R_bar</span>(<span class="mxinfo " id="T102:U407">:</span>,<span class="mxinfo " id="T49:U408">2</span>)</span>'</span>*<span class="var type1" id="S62T72U541">e1</span></span>/<span class="mxinfo " id="T7:U410">2</span></span>*(<span class="mxinfo " id="T72:U411"><span class="mxinfo " id="T72:U412"><span class="var type1" id="S54T73U546">R_bar</span>(<span class="mxinfo " id="T102:U414">:</span>,<span class="mxinfo " id="T49:U415">1</span>)</span> + <span class="var type1" id="S62T72U549">e1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,118" id="srcline118">118</a></span><span class="line"><span class="comment">% e2 = R_bar(:,2) - R_bar(:,2)'*e1/(1 + R_bar(:,1)'*e1)*(R_bar(:,1) + e1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,119" id="srcline119">119</a></span><span class="line"><span class="mxinfo " id="T72:U417"><span class="var type1" id="S63T72U552">e2</span> = <span class="mxinfo " id="T72:U419"><span class="var type1" id="S63T72U554">e2</span>/<span class="mxinfo " id="T7:U421">norm(<span class="var type1" id="S63T72U557">e2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,120" id="srcline120">120</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,121" id="srcline121">121</a></span><span class="line"><span class="mxinfo " id="T72:U423"><span class="var type1" id="S64T72U560">e3</span> = <span class="mxinfo " id="T72:U425"><span class="mxinfo " id="T72:U426"><span class="var type1" id="S54T73U563">R_bar</span>(<span class="mxinfo " id="T102:U428">:</span>,<span class="mxinfo " id="T49:U429">3</span>)</span> - <span class="mxinfo " id="T72:U430"><span class="mxinfo " id="T7:U431"><span class="mxinfo " id="T7:U432"><span class="mxinfo " id="T5:U433"><span class="mxinfo " id="T72:U434"><span class="var type1" id="S54T73U571">R_bar</span>(<span class="mxinfo " id="T102:U436">:</span>,<span class="mxinfo " id="T49:U437">3</span>)</span>'</span>*<span class="var type1" id="S62T72U574">e1</span></span>/<span class="mxinfo " id="T7:U439">2</span></span>*(<span class="mxinfo " id="T72:U440"><span class="mxinfo " id="T72:U441"><span class="var type1" id="S54T73U579">R_bar</span>(<span class="mxinfo " id="T102:U443">:</span>,<span class="mxinfo " id="T49:U444">1</span>)</span> + <span class="var type1" id="S62T72U582">e1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,122" id="srcline122">122</a></span><span class="line"><span class="comment">% e3 = R_bar(:,3) - R_bar(:,3)'*e1/(1 + R_bar(:,1)'*e1)*(R_bar(:,1) + e1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,123" id="srcline123">123</a></span><span class="line"><span class="mxinfo " id="T72:U446"><span class="var type1" id="S64T72U585">e3</span> = <span class="mxinfo " id="T72:U448"><span class="var type1" id="S64T72U587">e3</span>/<span class="mxinfo " id="T7:U450">norm(<span class="var type1" id="S64T72U590">e3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,124" id="srcline124">124</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,125" id="srcline125">125</a></span><span class="line"><span class="comment">% E = [e1 e2 e3];</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,126" id="srcline126">126</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,127" id="srcline127">127</a></span><span class="line"><span class="comment">% Compute basic rotations</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,128" id="srcline128">128</a></span><span class="line"><span class="mxinfo " id="T7:U452"><span class="var type1" id="S65T7U593">phiI1</span> = <span class="mxinfo " id="T7:U454">asin(<span class="mxinfo " id="T7:U455">(<span class="mxinfo " id="T7:U456"><span class="mxinfo " id="T7:U457"><span class="mxinfo " id="T5:U458"><span class="var type1" id="S64T72U601">e3</span>'</span>*<span class="mxinfo " id="T72:U460"><span class="var type1" id="S49T73U603">NI</span>(<span class="mxinfo " id="T102:U462">:</span>,<span class="mxinfo " id="T49:U463">2</span>)</span></span> - <span class="mxinfo " id="T7:U464"><span class="mxinfo " id="T5:U465"><span class="var type1" id="S63T72U608">e2</span>'</span>*<span class="mxinfo " id="T72:U467"><span class="var type1" id="S49T73U610">NI</span>(<span class="mxinfo " id="T102:U469">:</span>,<span class="mxinfo " id="T49:U470">3</span>)</span></span></span>)/<span class="mxinfo " id="T7:U471">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,129" id="srcline129">129</a></span><span class="line"><span class="mxinfo " id="T7:U472"><span class="var type1" id="S67T7U616">phiI2</span> = <span class="mxinfo " id="T7:U474">asin(<span class="mxinfo " id="T7:U475">(<span class="mxinfo " id="T7:U476"><span class="mxinfo " id="T7:U477"><span class="mxinfo " id="T5:U478"><span class="var type1" id="S62T72U624">e1</span>'</span>*<span class="mxinfo " id="T72:U480"><span class="var type1" id="S49T73U626">NI</span>(<span class="mxinfo " id="T102:U482">:</span>,<span class="mxinfo " id="T49:U483">3</span>)</span></span> - <span class="mxinfo " id="T7:U484"><span class="mxinfo " id="T5:U485"><span class="var type1" id="S64T72U631">e3</span>'</span>*<span class="mxinfo " id="T72:U487"><span class="var type1" id="S49T73U633">NI</span>(<span class="mxinfo " id="T102:U489">:</span>,<span class="mxinfo " id="T49:U490">1</span>)</span></span></span>)/<span class="mxinfo " id="T7:U491">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,130" id="srcline130">130</a></span><span class="line"><span class="mxinfo " id="T7:U492"><span class="var type1" id="S68T7U639">phiI3</span> = <span class="mxinfo " id="T7:U494">asin(<span class="mxinfo " id="T7:U495">(<span class="mxinfo " id="T7:U496"><span class="mxinfo " id="T7:U497"><span class="mxinfo " id="T5:U498"><span class="var type1" id="S63T72U647">e2</span>'</span>*<span class="mxinfo " id="T72:U500"><span class="var type1" id="S49T73U649">NI</span>(<span class="mxinfo " id="T102:U502">:</span>,<span class="mxinfo " id="T49:U503">1</span>)</span></span> - <span class="mxinfo " id="T7:U504"><span class="mxinfo " id="T5:U505"><span class="var type1" id="S62T72U654">e1</span>'</span>*<span class="mxinfo " id="T72:U507"><span class="var type1" id="S49T73U656">NI</span>(<span class="mxinfo " id="T102:U509">:</span>,<span class="mxinfo " id="T49:U510">2</span>)</span></span></span>)/<span class="mxinfo " id="T7:U511">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,131" id="srcline131">131</a></span><span class="line"><span class="mxinfo " id="T7:U512"><span class="var type1" id="S69T7U662">phiJ1</span> = <span class="mxinfo " id="T7:U514">asin(<span class="mxinfo " id="T7:U515">(<span class="mxinfo " id="T7:U516"><span class="mxinfo " id="T7:U517"><span class="mxinfo " id="T5:U518"><span class="var type1" id="S64T72U670">e3</span>'</span>*<span class="mxinfo " id="T72:U520"><span class="var type1" id="S51T73U672">NJ</span>(<span class="mxinfo " id="T102:U522">:</span>,<span class="mxinfo " id="T49:U523">2</span>)</span></span> - <span class="mxinfo " id="T7:U524"><span class="mxinfo " id="T5:U525"><span class="var type1" id="S63T72U677">e2</span>'</span>*<span class="mxinfo " id="T72:U527"><span class="var type1" id="S51T73U679">NJ</span>(<span class="mxinfo " id="T102:U529">:</span>,<span class="mxinfo " id="T49:U530">3</span>)</span></span></span>)/<span class="mxinfo " id="T7:U531">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,132" id="srcline132">132</a></span><span class="line"><span class="mxinfo " id="T7:U532"><span class="var type1" id="S70T7U685">phiJ2</span> = <span class="mxinfo " id="T7:U534">asin(<span class="mxinfo " id="T7:U535">(<span class="mxinfo " id="T7:U536"><span class="mxinfo " id="T7:U537"><span class="mxinfo " id="T5:U538"><span class="var type1" id="S62T72U693">e1</span>'</span>*<span class="mxinfo " id="T72:U540"><span class="var type1" id="S51T73U695">NJ</span>(<span class="mxinfo " id="T102:U542">:</span>,<span class="mxinfo " id="T49:U543">3</span>)</span></span> - <span class="mxinfo " id="T7:U544"><span class="mxinfo " id="T5:U545"><span class="var type1" id="S64T72U700">e3</span>'</span>*<span class="mxinfo " id="T72:U547"><span class="var type1" id="S51T73U702">NJ</span>(<span class="mxinfo " id="T102:U549">:</span>,<span class="mxinfo " id="T49:U550">1</span>)</span></span></span>)/<span class="mxinfo " id="T7:U551">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,133" id="srcline133">133</a></span><span class="line"><span class="mxinfo " id="T7:U552"><span class="var type1" id="S71T7U708">phiJ3</span> = <span class="mxinfo " id="T7:U554">asin(<span class="mxinfo " id="T7:U555">(<span class="mxinfo " id="T7:U556"><span class="mxinfo " id="T7:U557"><span class="mxinfo " id="T5:U558"><span class="var type1" id="S63T72U716">e2</span>'</span>*<span class="mxinfo " id="T72:U560"><span class="var type1" id="S51T73U718">NJ</span>(<span class="mxinfo " id="T102:U562">:</span>,<span class="mxinfo " id="T49:U563">1</span>)</span></span> - <span class="mxinfo " id="T7:U564"><span class="mxinfo " id="T5:U565"><span class="var type1" id="S62T72U723">e1</span>'</span>*<span class="mxinfo " id="T72:U567"><span class="var type1" id="S51T73U725">NJ</span>(<span class="mxinfo " id="T102:U569">:</span>,<span class="mxinfo " id="T49:U570">2</span>)</span></span></span>)/<span class="mxinfo " id="T7:U571">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,134" id="srcline134">134</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,135" id="srcline135">135</a></span><span class="line"><span class="comment">% Basic displacements and rotations</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,136" id="srcline136">136</a></span><span class="line"><span class="comment">% D = [ul r1z r2z r1y r2y rx]'</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,137" id="srcline137">137</a></span><span class="line"><span class="mxinfo " id="T22:U572"><span class="var type1" id="S72T22U731">D</span> = <span class="mxinfo " id="T22:U574">zeros(6,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,138" id="srcline138">138</a></span><span class="line"><span class="mxinfo " id="T7:U575"><span class="mxinfo " id="T7:U576"><span class="var type1" id="S72T22U739">D</span>(<span class="mxinfo " id="T49:U578">1</span>)</span> = <span class="mxinfo " id="T7:U579">(<span class="mxinfo " id="T7:U580"><span class="mxinfo " id="T7:U581"><span class="var type1" id="S23T7U745">L</span>^2</span> - <span class="mxinfo " id="T7:U583"><span class="var type1" id="S18T7U748">L0</span>^2</span></span>)/(<span class="mxinfo " id="T7:U585"><span class="var type1" id="S23T7U752">L</span> + <span class="var type1" id="S18T7U753">L0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,139" id="srcline139">139</a></span><span class="line"><span class="mxinfo " id="T7:U588"><span class="mxinfo " id="T7:U589"><span class="var type1" id="S72T22U757">D</span>(<span class="mxinfo " id="T49:U591">2</span>)</span> = <span class="var type1" id="S68T7U759">phiI3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,140" id="srcline140">140</a></span><span class="line"><span class="mxinfo " id="T7:U593"><span class="mxinfo " id="T7:U594"><span class="var type1" id="S72T22U763">D</span>(<span class="mxinfo " id="T49:U596">3</span>)</span> = <span class="var type1" id="S71T7U765">phiJ3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo " id="T7:U598"><span class="mxinfo " id="T7:U599"><span class="var type1" id="S72T22U769">D</span>(<span class="mxinfo " id="T49:U601">4</span>)</span> = <span class="var type1" id="S67T7U771">phiI2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,142" id="srcline142">142</a></span><span class="line"><span class="mxinfo " id="T7:U603"><span class="mxinfo " id="T7:U604"><span class="var type1" id="S72T22U775">D</span>(<span class="mxinfo " id="T49:U606">5</span>)</span> = <span class="var type1" id="S70T7U777">phiJ2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,143" id="srcline143">143</a></span><span class="line"><span class="mxinfo " id="T7:U608"><span class="mxinfo " id="T7:U609"><span class="var type1" id="S72T22U781">D</span>(<span class="mxinfo " id="T49:U611">6</span>)</span> = <span class="mxinfo " id="T7:U612"><span class="var type1" id="S69T7U784">phiJ1</span> - <span class="var type1" id="S65T7U785">phiI1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,144" id="srcline144">144</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,145" id="srcline145">145</a></span><span class="line"><span class="comment">% Get the linearized stiffness matrix and internal force vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,146" id="srcline146">146</a></span><span class="line"><span class="mxinfo " id="T148:U615"><span class="var type1" id="S74T148U788">el_in1</span> = <span class="var type1" id="S9T168U789">el_in0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,147" id="srcline147">147</a></span><span class="line"><span class="mxinfo " id="T22:U618"><span class="mxinfo " id="T22:U619"><span class="var type1" id="S74T148U793">el_in1</span>.D</span> = <span class="var type1" id="S72T22U795">D</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,148" id="srcline148">148</a></span><span class="line"><span class="mxinfo " id="T22:U622"><span class="mxinfo " id="T22:U623"><span class="var type1" id="S74T148U799">el_in1</span>.dD</span> = <span class="mxinfo " id="T22:U625"><span class="var type1" id="S72T22U802">D</span> - <span class="mxinfo " id="T22:U627"><span class="var type1" id="S9T168U804">el_in0</span>.D0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,149" id="srcline149">149</a></span><span class="line"><span class="mxinfo " id="T7:U629"><span class="mxinfo " id="T7:U630"><span class="var type1" id="S74T148U809">el_in1</span>.L</span> = <span class="var type1" id="S23T7U811">L</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,150" id="srcline150">150</a></span><span class="line"><span class="mxinfo " id="T7:U633"><span class="mxinfo " id="T7:U634"><span class="var type1" id="S74T148U815">el_in1</span>.L0</span> = <span class="var type1" id="S18T7U817">L0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,151" id="srcline151">151</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,152" id="srcline152">152</a></span><span class="line"><span class="comment">% Obtain element stiffness matrix and element forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,153" id="srcline153">153</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T28:U637"><span class="var type1" id="S9T168U821">el_in0</span>.state_it</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,154" id="srcline154">154</a></span><span class="line">    <span class="comment">% Iterative form of the state determination process</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,155" id="srcline155">155</a></span><span class="line">    [<span class="var type1" id="S75T15U826">KL</span>,<span class="var type1" id="S76T22U827">P</span>,<span class="var type1" id="S77T147U828">el_out0</span>] = <span class="fcn" id="F773N14:B830">get_KL_P_flex_shear_iter</span>(<span class="var type1" id="S74T148U831">el_in1</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="156,156" id="srcline156">156</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,157" id="srcline157">157</a></span><span class="line">    <span class="comment">% Non-iterative form of the state determination process</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,158" id="srcline158">158</a></span><span class="line">    [<span class="var type1" id="S75T15U836">KL</span>,<span class="var type1" id="S76T22U837">P</span>,<span class="var type1" id="S77T147U838">el_out0</span>] = <span class="fcn" id="F822N15:B840">get_KL_P_flex_shear_noniter</span>(<span class="var type1" id="S74T148U841">el_in1</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="156,159" id="srcline159">159</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,160" id="srcline160">160</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,161" id="srcline161">161</a></span><span class="line"><span class="comment">% Transformation matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,162" id="srcline162">162</a></span><span class="line"><span class="mxinfo " id="T73:U647"><span class="var type1" id="S80T73U844">A</span> = <span class="mxinfo " id="T73:U649"><span class="mxinfo " id="T7:U650"><span class="mxinfo " id="T7:U651">1</span>/<span class="var type1" id="S23T7U848">L</span></span>*(<span class="mxinfo " id="T73:U653"><span class="mxinfo " id="T73:U654">eye(3)</span> - <span class="mxinfo " id="T73:U655"><span class="var type1" id="S62T72U855">e1</span>*<span class="mxinfo " id="T5:U657"><span class="var type1" id="S62T72U857">e1</span>'</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,163" id="srcline163">163</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,164" id="srcline164">164</a></span><span class="line"><span class="comment">% Get L matrices</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,165" id="srcline165">165</a></span><span class="line"><span class="mxinfo " id="T162:U659"><span class="var type1" id="S82T162U860">L_r2</span> = <span class="mxinfo " id="T162:U661"><span class="fcn" id="F838N16:B862">get_L</span>(<span class="mxinfo " id="T72:U662"><span class="var type1" id="S54T73U864">R_bar</span>(<span class="mxinfo " id="T102:U664">:</span>,<span class="mxinfo " id="T49:U665">2</span>)</span>,<span class="var type1" id="S62T72U867">e1</span>,<span class="var type1" id="S23T7U868">L</span>,<span class="mxinfo " id="T72:U668"><span class="var type1" id="S54T73U870">R_bar</span>(<span class="mxinfo " id="T102:U670">:</span>,<span class="mxinfo " id="T49:U671">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,166" id="srcline166">166</a></span><span class="line"><span class="mxinfo " id="T162:U672"><span class="var type1" id="S84T162U875">L_r3</span> = <span class="mxinfo " id="T162:U674"><span class="fcn" id="F838N16:B877">get_L</span>(<span class="mxinfo " id="T72:U675"><span class="var type1" id="S54T73U879">R_bar</span>(<span class="mxinfo " id="T102:U677">:</span>,<span class="mxinfo " id="T49:U678">3</span>)</span>,<span class="var type1" id="S62T72U882">e1</span>,<span class="var type1" id="S23T7U883">L</span>,<span class="mxinfo " id="T72:U681"><span class="var type1" id="S54T73U885">R_bar</span>(<span class="mxinfo " id="T102:U683">:</span>,<span class="mxinfo " id="T49:U684">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,167" id="srcline167">167</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,168" id="srcline168">168</a></span><span class="line"><span class="comment">% Get h vectors</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,169" id="srcline169">169</a></span><span class="line"><span class="mxinfo " id="T73:U685"><span class="var type1" id="S85T73U890">S_nI1</span> = <span class="mxinfo " id="T73:U687"><span class="fcn" id="F223N19:B892">get_S</span>(<span class="mxinfo " id="T72:U688"><span class="var type1" id="S49T73U894">NI</span>(<span class="mxinfo " id="T102:U690">:</span>,<span class="mxinfo " id="T49:U691">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,170" id="srcline170">170</a></span><span class="line"><span class="mxinfo " id="T73:U692"><span class="var type1" id="S87T73U899">S_nI2</span> = <span class="mxinfo " id="T73:U694"><span class="fcn" id="F223N19:B901">get_S</span>(<span class="mxinfo " id="T72:U695"><span class="var type1" id="S49T73U903">NI</span>(<span class="mxinfo " id="T102:U697">:</span>,<span class="mxinfo " id="T49:U698">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,171" id="srcline171">171</a></span><span class="line"><span class="mxinfo " id="T73:U699"><span class="var type1" id="S88T73U908">S_nI3</span> = <span class="mxinfo " id="T73:U701"><span class="fcn" id="F223N19:B910">get_S</span>(<span class="mxinfo " id="T72:U702"><span class="var type1" id="S49T73U912">NI</span>(<span class="mxinfo " id="T102:U704">:</span>,<span class="mxinfo " id="T49:U705">3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,172" id="srcline172">172</a></span><span class="line"><span class="mxinfo " id="T73:U706"><span class="var type1" id="S89T73U917">S_nJ1</span> = <span class="mxinfo " id="T73:U708"><span class="fcn" id="F223N19:B919">get_S</span>(<span class="mxinfo " id="T72:U709"><span class="var type1" id="S51T73U921">NJ</span>(<span class="mxinfo " id="T102:U711">:</span>,<span class="mxinfo " id="T49:U712">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,173" id="srcline173">173</a></span><span class="line"><span class="mxinfo " id="T73:U713"><span class="var type1" id="S90T73U926">S_nJ2</span> = <span class="mxinfo " id="T73:U715"><span class="fcn" id="F223N19:B928">get_S</span>(<span class="mxinfo " id="T72:U716"><span class="var type1" id="S51T73U930">NJ</span>(<span class="mxinfo " id="T102:U718">:</span>,<span class="mxinfo " id="T49:U719">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,174" id="srcline174">174</a></span><span class="line"><span class="mxinfo " id="T73:U720"><span class="var type1" id="S91T73U935">S_nJ3</span> = <span class="mxinfo " id="T73:U722"><span class="fcn" id="F223N19:B937">get_S</span>(<span class="mxinfo " id="T72:U723"><span class="var type1" id="S51T73U939">NJ</span>(<span class="mxinfo " id="T102:U725">:</span>,<span class="mxinfo " id="T49:U726">3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,175" id="srcline175">175</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,176" id="srcline176">176</a></span><span class="line"><span class="mxinfo " id="T36:U727"><span class="var type1" id="S92T36U944">hI1</span> = <span class="mxinfo " id="T36:U729"><span class="mxinfo " id="T40:U730">[<span class="mxinfo " id="T7:U731">0</span> <span class="mxinfo " id="T7:U732">0</span> <span class="mxinfo " id="T7:U733">0</span> <span class="mxinfo " id="T5:U734">(<span class="mxinfo " id="T72:U735"><span class="mxinfo " id="T72:U736"><span class="var type1" id="S87T73U955">S_nI2</span>*<span class="var type1" id="S64T72U956">e3</span></span> - <span class="mxinfo " id="T72:U739"><span class="var type1" id="S88T73U958">S_nI3</span>*<span class="var type1" id="S63T72U959">e2</span></span></span>)'</span> <span class="mxinfo " id="T7:U742">0</span> <span class="mxinfo " id="T7:U743">0</span> <span class="mxinfo " id="T7:U744">0</span> <span class="mxinfo " id="T7:U745">0</span> <span class="mxinfo " id="T7:U746">0</span> <span class="mxinfo " id="T7:U747">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,177" id="srcline177">177</a></span><span class="line"><span class="mxinfo " id="T36:U748"><span class="var type1" id="S93T36U968">hI2</span> = <span class="mxinfo " id="T36:U750"><span class="mxinfo " id="T40:U751">[<span class="mxinfo " id="T5:U752">(<span class="mxinfo " id="T72:U753"><span class="var type1" id="S80T73U975">A</span>*<span class="mxinfo " id="T72:U755"><span class="var type1" id="S49T73U977">NI</span>(<span class="mxinfo " id="T102:U757">:</span>,<span class="mxinfo " id="T49:U758">3</span>)</span></span>)'</span> <span class="mxinfo " id="T5:U759">(<span class="mxinfo " id="T72:U760"><span class="mxinfo " id="T72:U761"><span class="var type1" id="S85T73U984">S_nI1</span>*<span class="var type1" id="S64T72U985">e3</span></span> - <span class="mxinfo " id="T72:U764"><span class="var type1" id="S88T73U987">S_nI3</span>*<span class="var type1" id="S62T72U988">e1</span></span></span>)'</span> <span class="mxinfo " id="T5:U767">-<span class="mxinfo " id="T5:U768">(<span class="mxinfo " id="T72:U769"><span class="var type1" id="S80T73U993">A</span>*<span class="mxinfo " id="T72:U771"><span class="var type1" id="S49T73U995">NI</span>(<span class="mxinfo " id="T102:U773">:</span>,<span class="mxinfo " id="T49:U774">3</span>)</span></span>)'</span></span> <span class="mxinfo " id="T7:U775">0</span> <span class="mxinfo " id="T7:U776">0</span> <span class="mxinfo " id="T7:U777">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,178" id="srcline178">178</a></span><span class="line"><span class="mxinfo " id="T36:U778"><span class="var type1" id="S94T36U1003">hI3</span> = <span class="mxinfo " id="T36:U780"><span class="mxinfo " id="T40:U781">[<span class="mxinfo " id="T5:U782">(<span class="mxinfo " id="T72:U783"><span class="var type1" id="S80T73U1010">A</span>*<span class="mxinfo " id="T72:U785"><span class="var type1" id="S49T73U1012">NI</span>(<span class="mxinfo " id="T102:U787">:</span>,<span class="mxinfo " id="T49:U788">2</span>)</span></span>)'</span> <span class="mxinfo " id="T5:U789">(<span class="mxinfo " id="T72:U790"><span class="mxinfo " id="T72:U791"><span class="var type1" id="S85T73U1019">S_nI1</span>*<span class="var type1" id="S63T72U1020">e2</span></span> - <span class="mxinfo " id="T72:U794"><span class="var type1" id="S87T73U1022">S_nI2</span>*<span class="var type1" id="S62T72U1023">e1</span></span></span>)'</span> <span class="mxinfo " id="T5:U797">-<span class="mxinfo " id="T5:U798">(<span class="mxinfo " id="T72:U799"><span class="var type1" id="S80T73U1028">A</span>*<span class="mxinfo " id="T72:U801"><span class="var type1" id="S49T73U1030">NI</span>(<span class="mxinfo " id="T102:U803">:</span>,<span class="mxinfo " id="T49:U804">2</span>)</span></span>)'</span></span> <span class="mxinfo " id="T7:U805">0</span> <span class="mxinfo " id="T7:U806">0</span> <span class="mxinfo " id="T7:U807">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,179" id="srcline179">179</a></span><span class="line"><span class="mxinfo " id="T36:U808"><span class="var type1" id="S95T36U1038">hJ1</span> = <span class="mxinfo " id="T36:U810"><span class="mxinfo " id="T40:U811">[<span class="mxinfo " id="T7:U812">0</span> <span class="mxinfo " id="T7:U813">0</span> <span class="mxinfo " id="T7:U814">0</span> <span class="mxinfo " id="T7:U815">0</span> <span class="mxinfo " id="T7:U816">0</span> <span class="mxinfo " id="T7:U817">0</span> <span class="mxinfo " id="T7:U818">0</span> <span class="mxinfo " id="T7:U819">0</span> <span class="mxinfo " id="T7:U820">0</span> <span class="mxinfo " id="T5:U821">(<span class="mxinfo " id="T72:U822"><span class="mxinfo " id="T72:U823"><span class="var type1" id="S90T73U1055">S_nJ2</span>*<span class="var type1" id="S64T72U1056">e3</span></span> - <span class="mxinfo " id="T72:U826"><span class="var type1" id="S91T73U1058">S_nJ3</span>*<span class="var type1" id="S63T72U1059">e2</span></span></span>)'</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,180" id="srcline180">180</a></span><span class="line"><span class="mxinfo " id="T36:U829"><span class="var type1" id="S96T36U1062">hJ2</span> = <span class="mxinfo " id="T36:U831"><span class="mxinfo " id="T40:U832">[<span class="mxinfo " id="T5:U833">(<span class="mxinfo " id="T72:U834"><span class="var type1" id="S80T73U1069">A</span>*<span class="mxinfo " id="T72:U836"><span class="var type1" id="S51T73U1071">NJ</span>(<span class="mxinfo " id="T102:U838">:</span>,<span class="mxinfo " id="T49:U839">3</span>)</span></span>)'</span> <span class="mxinfo " id="T7:U840">0</span> <span class="mxinfo " id="T7:U841">0</span> <span class="mxinfo " id="T7:U842">0</span> <span class="mxinfo " id="T5:U843">-<span class="mxinfo " id="T5:U844">(<span class="mxinfo " id="T72:U845"><span class="var type1" id="S80T73U1081">A</span>*<span class="mxinfo " id="T72:U847"><span class="var type1" id="S51T73U1083">NJ</span>(<span class="mxinfo " id="T102:U849">:</span>,<span class="mxinfo " id="T49:U850">3</span>)</span></span>)'</span></span> <span class="mxinfo " id="T5:U851">(<span class="mxinfo " id="T72:U852"><span class="mxinfo " id="T72:U853"><span class="var type1" id="S89T73U1090">S_nJ1</span>*<span class="var type1" id="S64T72U1091">e3</span></span> - <span class="mxinfo " id="T72:U856"><span class="var type1" id="S91T73U1093">S_nJ3</span>*<span class="var type1" id="S62T72U1094">e1</span></span></span>)'</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,181" id="srcline181">181</a></span><span class="line"><span class="mxinfo " id="T36:U859"><span class="var type1" id="S97T36U1097">hJ3</span> = <span class="mxinfo " id="T36:U861"><span class="mxinfo " id="T40:U862">[<span class="mxinfo " id="T5:U863">(<span class="mxinfo " id="T72:U864"><span class="var type1" id="S80T73U1104">A</span>*<span class="mxinfo " id="T72:U866"><span class="var type1" id="S51T73U1106">NJ</span>(<span class="mxinfo " id="T102:U868">:</span>,<span class="mxinfo " id="T49:U869">2</span>)</span></span>)'</span> <span class="mxinfo " id="T7:U870">0</span> <span class="mxinfo " id="T7:U871">0</span> <span class="mxinfo " id="T7:U872">0</span> <span class="mxinfo " id="T5:U873">-<span class="mxinfo " id="T5:U874">(<span class="mxinfo " id="T72:U875"><span class="var type1" id="S80T73U1116">A</span>*<span class="mxinfo " id="T72:U877"><span class="var type1" id="S51T73U1118">NJ</span>(<span class="mxinfo " id="T102:U879">:</span>,<span class="mxinfo " id="T49:U880">2</span>)</span></span>)'</span></span> <span class="mxinfo " id="T5:U881">(<span class="mxinfo " id="T72:U882"><span class="mxinfo " id="T72:U883"><span class="var type1" id="S89T73U1125">S_nJ1</span>*<span class="var type1" id="S63T72U1126">e2</span></span> - <span class="mxinfo " id="T72:U886"><span class="var type1" id="S90T73U1128">S_nJ2</span>*<span class="var type1" id="S62T72U1129">e1</span></span></span>)'</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,182" id="srcline182">182</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,183" id="srcline183">183</a></span><span class="line"><span class="comment">% Get t vectors and T matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,184" id="srcline184">184</a></span><span class="line"><span class="mxinfo " id="T40:U889"><span class="var type1" id="S98T40U1132">t1</span> = <span class="mxinfo " id="T40:U891">[<span class="mxinfo " id="T5:U892">-<span class="mxinfo " id="T5:U893"><span class="var type1" id="S62T72U1137">e1</span>'</span></span> <span class="mxinfo " id="T7:U895">0</span> <span class="mxinfo " id="T7:U896">0</span> <span class="mxinfo " id="T7:U897">0</span> <span class="mxinfo " id="T5:U898"><span class="var type1" id="S62T72U1142">e1</span>'</span> <span class="mxinfo " id="T7:U900">0</span> <span class="mxinfo " id="T7:U901">0</span> <span class="mxinfo " id="T7:U902">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,185" id="srcline185">185</a></span><span class="line"><span class="mxinfo " id="T40:U903"><span class="var type1" id="S99T40U1148">t2</span> = <span class="mxinfo " id="T40:U905"><span class="mxinfo " id="T7:U906"><span class="mxinfo " id="T7:U907">1</span>/(<span class="mxinfo " id="T7:U908"><span class="mxinfo " id="T7:U909">2</span>*<span class="mxinfo " id="T7:U910">cos(<span class="var type1" id="S68T7U1157">phiI3</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U912">(<span class="mxinfo " id="T36:U913"><span class="mxinfo " id="T36:U914"><span class="var type1" id="S82T162U1162">L_r2</span>*<span class="mxinfo " id="T72:U916"><span class="var type1" id="S49T73U1164">NI</span>(<span class="mxinfo " id="T102:U918">:</span>,<span class="mxinfo " id="T49:U919">1</span>)</span></span> + <span class="var type1" id="S94T36U1167">hI3</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,186" id="srcline186">186</a></span><span class="line"><span class="mxinfo " id="T40:U921"><span class="var type1" id="S101T40U1170">t3</span> = <span class="mxinfo " id="T40:U923"><span class="mxinfo " id="T7:U924"><span class="mxinfo " id="T7:U925">1</span>/(<span class="mxinfo " id="T7:U926"><span class="mxinfo " id="T7:U927">2</span>*<span class="mxinfo " id="T7:U928">cos(<span class="var type1" id="S71T7U1179">phiJ3</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U930">(<span class="mxinfo " id="T36:U931"><span class="mxinfo " id="T36:U932"><span class="var type1" id="S82T162U1184">L_r2</span>*<span class="mxinfo " id="T72:U934"><span class="var type1" id="S51T73U1186">NJ</span>(<span class="mxinfo " id="T102:U936">:</span>,<span class="mxinfo " id="T49:U937">1</span>)</span></span> + <span class="var type1" id="S97T36U1189">hJ3</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,187" id="srcline187">187</a></span><span class="line"><span class="mxinfo " id="T40:U939"><span class="var type1" id="S102T40U1192">t4</span> = <span class="mxinfo " id="T40:U941"><span class="mxinfo " id="T7:U942"><span class="mxinfo " id="T7:U943">1</span>/(<span class="mxinfo " id="T7:U944"><span class="mxinfo " id="T7:U945">2</span>*<span class="mxinfo " id="T7:U946">cos(<span class="var type1" id="S67T7U1201">phiI2</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U948">(<span class="mxinfo " id="T36:U949"><span class="mxinfo " id="T36:U950"><span class="mxinfo " id="T162:U951">-<span class="var type1" id="S84T162U1207">L_r3</span></span>*<span class="mxinfo " id="T72:U953"><span class="var type1" id="S49T73U1209">NI</span>(<span class="mxinfo " id="T102:U955">:</span>,<span class="mxinfo " id="T49:U956">1</span>)</span></span> - <span class="var type1" id="S93T36U1212">hI2</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,188" id="srcline188">188</a></span><span class="line"><span class="mxinfo " id="T40:U958"><span class="var type1" id="S103T40U1215">t5</span> = <span class="mxinfo " id="T40:U960"><span class="mxinfo " id="T7:U961"><span class="mxinfo " id="T7:U962">1</span>/(<span class="mxinfo " id="T7:U963"><span class="mxinfo " id="T7:U964">2</span>*<span class="mxinfo " id="T7:U965">cos(<span class="var type1" id="S70T7U1224">phiJ2</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U967">(<span class="mxinfo " id="T36:U968"><span class="mxinfo " id="T36:U969"><span class="mxinfo " id="T162:U970">-<span class="var type1" id="S84T162U1230">L_r3</span></span>*<span class="mxinfo " id="T72:U972"><span class="var type1" id="S51T73U1232">NJ</span>(<span class="mxinfo " id="T102:U974">:</span>,<span class="mxinfo " id="T49:U975">1</span>)</span></span> - <span class="var type1" id="S96T36U1235">hJ2</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,189" id="srcline189">189</a></span><span class="line"><span class="mxinfo " id="T40:U977"><span class="var type1" id="S104T40U1238">t6J</span> = <span class="mxinfo " id="T40:U979"><span class="mxinfo " id="T7:U980"><span class="mxinfo " id="T7:U981">1</span>/(<span class="mxinfo " id="T7:U982"><span class="mxinfo " id="T7:U983">2</span>*<span class="mxinfo " id="T7:U984">cos(<span class="var type1" id="S69T7U1247">phiJ1</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U986">(<span class="mxinfo " id="T36:U987"><span class="mxinfo " id="T36:U988"><span class="mxinfo " id="T36:U989"><span class="var type1" id="S84T162U1253">L_r3</span>*<span class="mxinfo " id="T72:U991"><span class="var type1" id="S51T73U1255">NJ</span>(<span class="mxinfo " id="T102:U993">:</span>,<span class="mxinfo " id="T49:U994">2</span>)</span></span> - <span class="mxinfo " id="T36:U995"><span class="var type1" id="S82T162U1259">L_r2</span>*<span class="mxinfo " id="T72:U997"><span class="var type1" id="S51T73U1261">NJ</span>(<span class="mxinfo " id="T102:U999">:</span>,<span class="mxinfo " id="T49:U1000">3</span>)</span></span></span> + <span class="var type1" id="S95T36U1264">hJ1</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,190" id="srcline190">190</a></span><span class="line"><span class="mxinfo " id="T40:U1002"><span class="var type1" id="S105T40U1267">t6I</span> = <span class="mxinfo " id="T40:U1004"><span class="mxinfo " id="T7:U1005"><span class="mxinfo " id="T7:U1006">1</span>/(<span class="mxinfo " id="T7:U1007"><span class="mxinfo " id="T7:U1008">2</span>*<span class="mxinfo " id="T7:U1009">cos(<span class="var type1" id="S65T7U1276">phiI1</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U1011">(<span class="mxinfo " id="T36:U1012"><span class="mxinfo " id="T36:U1013"><span class="mxinfo " id="T36:U1014"><span class="var type1" id="S84T162U1282">L_r3</span>*<span class="mxinfo " id="T72:U1016"><span class="var type1" id="S49T73U1284">NI</span>(<span class="mxinfo " id="T102:U1018">:</span>,<span class="mxinfo " id="T49:U1019">2</span>)</span></span> - <span class="mxinfo " id="T36:U1020"><span class="var type1" id="S82T162U1288">L_r2</span>*<span class="mxinfo " id="T72:U1022"><span class="var type1" id="S49T73U1290">NI</span>(<span class="mxinfo " id="T102:U1024">:</span>,<span class="mxinfo " id="T49:U1025">3</span>)</span></span></span> + <span class="var type1" id="S92T36U1293">hI1</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,191" id="srcline191">191</a></span><span class="line"><span class="mxinfo " id="T40:U1027"><span class="var type1" id="S106T40U1296">t6</span> = <span class="mxinfo " id="T40:U1029"><span class="var type1" id="S104T40U1298">t6J</span> - <span class="var type1" id="S105T40U1299">t6I</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,192" id="srcline192">192</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,193" id="srcline193">193</a></span><span class="line"><span class="mxinfo " id="T166:U1032"><span class="var type1" id="S107T166U1302">T</span> = <span class="mxinfo " id="T166:U1034">[<span class="var type1" id="S98T40U1305">t1</span>; <span class="var type1" id="S99T40U1307">t2</span>; <span class="var type1" id="S101T40U1309">t3</span>; <span class="var type1" id="S102T40U1311">t4</span>; <span class="var type1" id="S103T40U1313">t5</span>; <span class="var type1" id="S106T40U1315">t6</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,194" id="srcline194">194</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,195" id="srcline195">195</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,196" id="srcline196">196</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,197" id="srcline197">197</a></span><span class="line"><span class="comment">% Scaled internal forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,198" id="srcline198">198</a></span><span class="line"><span class="mxinfo " id="T7:U1041"><span class="var type1" id="S108T7U1318">m2</span> = <span class="mxinfo " id="T7:U1043"><span class="mxinfo " id="T7:U1044"><span class="var type1" id="S76T22U1321">P</span>(<span class="mxinfo " id="T49:U1046">2</span>)</span>/(<span class="mxinfo " id="T7:U1047"><span class="mxinfo " id="T7:U1048">2</span>*<span class="mxinfo " id="T7:U1049">cos(<span class="var type1" id="S68T7U1328">phiI3</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,199" id="srcline199">199</a></span><span class="line"><span class="mxinfo " id="T7:U1051"><span class="var type1" id="S109T7U1331">m3</span> = <span class="mxinfo " id="T7:U1053"><span class="mxinfo " id="T7:U1054"><span class="var type1" id="S76T22U1334">P</span>(<span class="mxinfo " id="T49:U1056">3</span>)</span>/(<span class="mxinfo " id="T7:U1057"><span class="mxinfo " id="T7:U1058">2</span>*<span class="mxinfo " id="T7:U1059">cos(<span class="var type1" id="S71T7U1341">phiJ3</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,200" id="srcline200">200</a></span><span class="line"><span class="mxinfo " id="T7:U1061"><span class="var type1" id="S110T7U1344">m4</span> = <span class="mxinfo " id="T7:U1063"><span class="mxinfo " id="T7:U1064"><span class="var type1" id="S76T22U1347">P</span>(<span class="mxinfo " id="T49:U1066">4</span>)</span>/(<span class="mxinfo " id="T7:U1067"><span class="mxinfo " id="T7:U1068">2</span>*<span class="mxinfo " id="T7:U1069">cos(<span class="var type1" id="S67T7U1354">phiI2</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,201" id="srcline201">201</a></span><span class="line"><span class="mxinfo " id="T7:U1071"><span class="var type1" id="S111T7U1357">m5</span> = <span class="mxinfo " id="T7:U1073"><span class="mxinfo " id="T7:U1074"><span class="var type1" id="S76T22U1360">P</span>(<span class="mxinfo " id="T49:U1076">5</span>)</span>/(<span class="mxinfo " id="T7:U1077"><span class="mxinfo " id="T7:U1078">2</span>*<span class="mxinfo " id="T7:U1079">cos(<span class="var type1" id="S70T7U1367">phiJ2</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,202" id="srcline202">202</a></span><span class="line"><span class="mxinfo " id="T7:U1081"><span class="var type1" id="S112T7U1370">m6I</span> = <span class="mxinfo " id="T7:U1083"><span class="mxinfo " id="T7:U1084"><span class="var type1" id="S76T22U1373">P</span>(<span class="mxinfo " id="T49:U1086">6</span>)</span>/(<span class="mxinfo " id="T7:U1087"><span class="mxinfo " id="T7:U1088">2</span>*<span class="mxinfo " id="T7:U1089">cos(<span class="var type1" id="S65T7U1380">phiI1</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,203" id="srcline203">203</a></span><span class="line"><span class="mxinfo " id="T7:U1091"><span class="var type1" id="S113T7U1383">m6J</span> = <span class="mxinfo " id="T7:U1093"><span class="mxinfo " id="T7:U1094"><span class="var type1" id="S76T22U1386">P</span>(<span class="mxinfo " id="T49:U1096">6</span>)</span>/(<span class="mxinfo " id="T7:U1097"><span class="mxinfo " id="T7:U1098">2</span>*<span class="mxinfo " id="T7:U1099">cos(<span class="var type1" id="S69T7U1393">phiJ1</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,204" id="srcline204">204</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,205" id="srcline205">205</a></span><span class="line"><span class="comment">% Geometric stiffness matrix, KG</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,206" id="srcline206">206</a></span><span class="line"><span class="comment">% KA</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,207" id="srcline207">207</a></span><span class="line"><span class="mxinfo " id="T163:U1101"><span class="var type1" id="S114T163U1396">KA</span> = <span class="mxinfo " id="T163:U1103"><span class="mxinfo " id="T7:U1104"><span class="var type1" id="S76T22U1399">P</span>(<span class="mxinfo " id="T49:U1106">1</span>)</span>*<span class="mxinfo " id="T163:U1107">[<span class="mxinfo " id="T171:U1108"><span class="var type1" id="S80T73U1403">A</span> <span class="mxinfo " id="T73:U1110">zeros(3)</span> <span class="mxinfo " id="T73:U1111">-<span class="var type1" id="S80T73U1408">A</span></span> <span class="mxinfo " id="T73:U1113">zeros(3)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="156,208" id="srcline208">208</a></span><span class="line">    <span class="mxinfo " id="T171:U1114">zeros(3) zeros(3) zeros(3) zeros(3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,209" id="srcline209">209</a></span><span class="line">    <span class="mxinfo " id="T171:U1115"><span class="mxinfo " id="T73:U1116">-<span class="var type1" id="S80T73U1427">A</span></span> <span class="mxinfo " id="T73:U1118">zeros(3)</span> <span class="var type1" id="S80T73U1431">A</span> <span class="mxinfo " id="T73:U1120">zeros(3)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="156,210" id="srcline210">210</a></span><span class="line">    <span class="mxinfo " id="T171:U1121">zeros(3) zeros(3) zeros(3) zeros(3)</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,211" id="srcline211">211</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,212" id="srcline212">212</a></span><span class="line"><span class="comment">% KB</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,213" id="srcline213">213</a></span><span class="line"><span class="mxinfo " id="T163:U1122"><span class="var type1" id="S115T163U1450">KB</span> = <span class="mxinfo " id="T163:U1124"><span class="mxinfo " id="T163:U1125"><span class="mxinfo " id="T163:U1126"><span class="mxinfo " id="T163:U1127"><span class="mxinfo " id="T163:U1128"><span class="mxinfo " id="T163:U1129"><span class="mxinfo " id="T7:U1130"><span class="var type1" id="S76T22U1458">P</span>(<span class="mxinfo " id="T49:U1132">2</span>)</span>*(<span class="mxinfo " id="T163:U1133"><span class="mxinfo " id="T36:U1134"><span class="var type1" id="S99T40U1463">t2</span>'</span>*<span class="var type1" id="S99T40U1464">t2</span></span>)</span>*<span class="mxinfo " id="T7:U1137">tan(<span class="var type1" id="S68T7U1467">phiI3</span>)</span></span> + <span class="mxinfo " id="T163:U1139"><span class="mxinfo " id="T163:U1140"><span class="mxinfo " id="T7:U1141"><span class="var type1" id="S76T22U1471">P</span>(<span class="mxinfo " id="T49:U1143">3</span>)</span>*(<span class="mxinfo " id="T163:U1144"><span class="mxinfo " id="T36:U1145"><span class="var type1" id="S101T40U1476">t3</span>'</span>*<span class="var type1" id="S101T40U1477">t3</span></span>)</span>*<span class="mxinfo " id="T7:U1148">tan(<span class="var type1" id="S71T7U1480">phiJ3</span>)</span></span></span> + <span class="mxinfo " id="T163:U1150"><span class="mxinfo " id="T163:U1151"><span class="mxinfo " id="T7:U1152"><span class="var type1" id="S76T22U1484">P</span>(<span class="mxinfo " id="T49:U1154">4</span>)</span>*(<span class="mxinfo " id="T163:U1155"><span class="mxinfo " id="T36:U1156"><span class="var type1" id="S102T40U1489">t4</span>'</span>*<span class="var type1" id="S102T40U1490">t4</span></span>)</span>*<span class="mxinfo " id="T7:U1159">tan(<span class="var type1" id="S67T7U1493">phiI2</span>)</span></span></span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,214" id="srcline214">214</a></span><span class="line">    <span class="mxinfo " id="T163:U1161"><span class="mxinfo " id="T163:U1162"><span class="mxinfo " id="T7:U1163"><span class="var type1" id="S76T22U1497">P</span>(<span class="mxinfo " id="T49:U1165">5</span>)</span>*(<span class="mxinfo " id="T163:U1166"><span class="mxinfo " id="T36:U1167"><span class="var type1" id="S103T40U1502">t5</span>'</span>*<span class="var type1" id="S103T40U1503">t5</span></span>)</span>*<span class="mxinfo " id="T7:U1170">tan(<span class="var type1" id="S70T7U1506">phiJ2</span>)</span></span></span> + <span class="mxinfo " id="T163:U1172"><span class="mxinfo " id="T7:U1173"><span class="var type1" id="S76T22U1509">P</span>(<span class="mxinfo " id="T49:U1175">6</span>)</span>*(<span class="mxinfo " id="T163:U1176"><span class="mxinfo " id="T163:U1177">(<span class="mxinfo " id="T163:U1178"><span class="mxinfo " id="T36:U1179">-<span class="mxinfo " id="T36:U1180"><span class="var type1" id="S105T40U1518">t6I</span>'</span></span>*<span class="var type1" id="S105T40U1519">t6I</span></span>)*<span class="mxinfo " id="T7:U1183">tan(<span class="var type1" id="S65T7U1522">phiI1</span>)</span></span> + <span class="mxinfo " id="T163:U1185">(<span class="mxinfo " id="T163:U1186"><span class="mxinfo " id="T36:U1187"><span class="var type1" id="S104T40U1527">t6J</span>'</span>*<span class="var type1" id="S104T40U1528">t6J</span></span>)*<span class="mxinfo " id="T7:U1190">tan(<span class="var type1" id="S69T7U1531">phiJ1</span>)</span></span></span>)</span></span></span>; <span class="comment">% P(6)I?</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,215" id="srcline215">215</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,216" id="srcline216">216</a></span><span class="line"><span class="mxinfo " id="T163:U1192"><span class="var type1" id="S117T163U1534">G1</span> = <span class="mxinfo " id="T163:U1194"><span class="fcn" id="F877N12:B1536">get_G</span>(<span class="mxinfo " id="T72:U1195"><span class="var type1" id="S54T73U1538">R_bar</span>(<span class="mxinfo " id="T102:U1197">:</span>,<span class="mxinfo " id="T49:U1198">2</span>)</span>,<span class="mxinfo " id="T72:U1199"><span class="var type1" id="S49T73U1542">NI</span>(<span class="mxinfo " id="T102:U1201">:</span>,<span class="mxinfo " id="T49:U1202">1</span>)</span>,<span class="var type1" id="S62T72U1545">e1</span>,<span class="var type1" id="S23T7U1546">L</span>,<span class="mxinfo " id="T72:U1205"><span class="var type1" id="S54T73U1548">R_bar</span>(<span class="mxinfo " id="T102:U1207">:</span>,<span class="mxinfo " id="T49:U1208">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,217" id="srcline217">217</a></span><span class="line"><span class="mxinfo " id="T163:U1209"><span class="var type1" id="S119T163U1553">G2</span> = <span class="mxinfo " id="T163:U1211"><span class="fcn" id="F877N12:B1555">get_G</span>(<span class="mxinfo " id="T72:U1212"><span class="var type1" id="S54T73U1557">R_bar</span>(<span class="mxinfo " id="T102:U1214">:</span>,<span class="mxinfo " id="T49:U1215">2</span>)</span>,<span class="mxinfo " id="T72:U1216"><span class="var type1" id="S51T73U1561">NJ</span>(<span class="mxinfo " id="T102:U1218">:</span>,<span class="mxinfo " id="T49:U1219">1</span>)</span>,<span class="var type1" id="S62T72U1564">e1</span>,<span class="var type1" id="S23T7U1565">L</span>,<span class="mxinfo " id="T72:U1222"><span class="var type1" id="S54T73U1567">R_bar</span>(<span class="mxinfo " id="T102:U1224">:</span>,<span class="mxinfo " id="T49:U1225">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,218" id="srcline218">218</a></span><span class="line"><span class="mxinfo " id="T163:U1226"><span class="var type1" id="S120T163U1572">G3</span> = <span class="mxinfo " id="T163:U1228"><span class="fcn" id="F877N12:B1574">get_G</span>(<span class="mxinfo " id="T72:U1229"><span class="var type1" id="S54T73U1576">R_bar</span>(<span class="mxinfo " id="T102:U1231">:</span>,<span class="mxinfo " id="T49:U1232">3</span>)</span>,<span class="mxinfo " id="T72:U1233"><span class="var type1" id="S49T73U1580">NI</span>(<span class="mxinfo " id="T102:U1235">:</span>,<span class="mxinfo " id="T49:U1236">1</span>)</span>,<span class="var type1" id="S62T72U1583">e1</span>,<span class="var type1" id="S23T7U1584">L</span>,<span class="mxinfo " id="T72:U1239"><span class="var type1" id="S54T73U1586">R_bar</span>(<span class="mxinfo " id="T102:U1241">:</span>,<span class="mxinfo " id="T49:U1242">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,219" id="srcline219">219</a></span><span class="line"><span class="mxinfo " id="T163:U1243"><span class="var type1" id="S121T163U1591">G4</span> = <span class="mxinfo " id="T163:U1245"><span class="fcn" id="F877N12:B1593">get_G</span>(<span class="mxinfo " id="T72:U1246"><span class="var type1" id="S54T73U1595">R_bar</span>(<span class="mxinfo " id="T102:U1248">:</span>,<span class="mxinfo " id="T49:U1249">3</span>)</span>,<span class="mxinfo " id="T72:U1250"><span class="var type1" id="S51T73U1599">NJ</span>(<span class="mxinfo " id="T102:U1252">:</span>,<span class="mxinfo " id="T49:U1253">1</span>)</span>,<span class="var type1" id="S62T72U1602">e1</span>,<span class="var type1" id="S23T7U1603">L</span>,<span class="mxinfo " id="T72:U1256"><span class="var type1" id="S54T73U1605">R_bar</span>(<span class="mxinfo " id="T102:U1258">:</span>,<span class="mxinfo " id="T49:U1259">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,220" id="srcline220">220</a></span><span class="line"><span class="mxinfo " id="T163:U1260"><span class="var type1" id="S122T163U1610">G5</span> = <span class="mxinfo " id="T163:U1262"><span class="fcn" id="F877N12:B1612">get_G</span>(<span class="mxinfo " id="T72:U1263"><span class="var type1" id="S54T73U1614">R_bar</span>(<span class="mxinfo " id="T102:U1265">:</span>,<span class="mxinfo " id="T49:U1266">3</span>)</span>,<span class="mxinfo " id="T72:U1267"><span class="var type1" id="S51T73U1618">NJ</span>(<span class="mxinfo " id="T102:U1269">:</span>,<span class="mxinfo " id="T49:U1270">2</span>)</span>,<span class="var type1" id="S62T72U1621">e1</span>,<span class="var type1" id="S23T7U1622">L</span>,<span class="mxinfo " id="T72:U1273"><span class="var type1" id="S54T73U1624">R_bar</span>(<span class="mxinfo " id="T102:U1275">:</span>,<span class="mxinfo " id="T49:U1276">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,221" id="srcline221">221</a></span><span class="line"><span class="mxinfo " id="T163:U1277"><span class="var type1" id="S123T163U1629">G6</span> = <span class="mxinfo " id="T163:U1279"><span class="fcn" id="F877N12:B1631">get_G</span>(<span class="mxinfo " id="T72:U1280"><span class="var type1" id="S54T73U1633">R_bar</span>(<span class="mxinfo " id="T102:U1282">:</span>,<span class="mxinfo " id="T49:U1283">2</span>)</span>,<span class="mxinfo " id="T72:U1284"><span class="var type1" id="S51T73U1637">NJ</span>(<span class="mxinfo " id="T102:U1286">:</span>,<span class="mxinfo " id="T49:U1287">3</span>)</span>,<span class="var type1" id="S62T72U1640">e1</span>,<span class="var type1" id="S23T7U1641">L</span>,<span class="mxinfo " id="T72:U1290"><span class="var type1" id="S54T73U1643">R_bar</span>(<span class="mxinfo " id="T102:U1292">:</span>,<span class="mxinfo " id="T49:U1293">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,222" id="srcline222">222</a></span><span class="line"><span class="mxinfo " id="T163:U1294"><span class="var type1" id="S124T163U1648">G7</span> = <span class="mxinfo " id="T163:U1296"><span class="fcn" id="F877N12:B1650">get_G</span>(<span class="mxinfo " id="T72:U1297"><span class="var type1" id="S54T73U1652">R_bar</span>(<span class="mxinfo " id="T102:U1299">:</span>,<span class="mxinfo " id="T49:U1300">3</span>)</span>,<span class="mxinfo " id="T72:U1301"><span class="var type1" id="S49T73U1656">NI</span>(<span class="mxinfo " id="T102:U1303">:</span>,<span class="mxinfo " id="T49:U1304">2</span>)</span>,<span class="var type1" id="S62T72U1659">e1</span>,<span class="var type1" id="S23T7U1660">L</span>,<span class="mxinfo " id="T72:U1307"><span class="var type1" id="S54T73U1662">R_bar</span>(<span class="mxinfo " id="T102:U1309">:</span>,<span class="mxinfo " id="T49:U1310">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,223" id="srcline223">223</a></span><span class="line"><span class="mxinfo " id="T163:U1311"><span class="var type1" id="S125T163U1667">G8</span> = <span class="mxinfo " id="T163:U1313"><span class="fcn" id="F877N12:B1669">get_G</span>(<span class="mxinfo " id="T72:U1314"><span class="var type1" id="S54T73U1671">R_bar</span>(<span class="mxinfo " id="T102:U1316">:</span>,<span class="mxinfo " id="T49:U1317">2</span>)</span>,<span class="mxinfo " id="T72:U1318"><span class="var type1" id="S49T73U1675">NI</span>(<span class="mxinfo " id="T102:U1320">:</span>,<span class="mxinfo " id="T49:U1321">3</span>)</span>,<span class="var type1" id="S62T72U1678">e1</span>,<span class="var type1" id="S23T7U1679">L</span>,<span class="mxinfo " id="T72:U1324"><span class="var type1" id="S54T73U1681">R_bar</span>(<span class="mxinfo " id="T102:U1326">:</span>,<span class="mxinfo " id="T49:U1327">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,224" id="srcline224">224</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,225" id="srcline225">225</a></span><span class="line"><span class="comment">% KC</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,226" id="srcline226">226</a></span><span class="line"><span class="mxinfo " id="T163:U1328"><span class="var type1" id="S126T163U1686">KC</span> = <span class="mxinfo " id="T163:U1330"><span class="mxinfo " id="T163:U1331"><span class="mxinfo " id="T163:U1332"><span class="mxinfo " id="T163:U1333"><span class="mxinfo " id="T163:U1334"><span class="mxinfo " id="T163:U1335"><span class="var type1" id="S108T7U1693">m2</span>*<span class="var type1" id="S117T163U1694">G1</span></span> + <span class="mxinfo " id="T163:U1338"><span class="var type1" id="S109T7U1696">m3</span>*<span class="var type1" id="S119T163U1697">G2</span></span></span> - <span class="mxinfo " id="T163:U1341"><span class="var type1" id="S110T7U1699">m4</span>*<span class="var type1" id="S120T163U1700">G3</span></span></span> - <span class="mxinfo " id="T163:U1344"><span class="var type1" id="S111T7U1702">m5</span>*<span class="var type1" id="S121T163U1703">G4</span></span></span> + <span class="mxinfo " id="T163:U1347"><span class="var type1" id="S112T7U1705">m6I</span>*(<span class="mxinfo " id="T163:U1349"><span class="var type1" id="S122T163U1708">G5</span> - <span class="var type1" id="S123T163U1709">G6</span></span>)</span></span> - <span class="mxinfo " id="T163:U1352"><span class="var type1" id="S113T7U1711">m6J</span>*(<span class="mxinfo " id="T163:U1354"><span class="var type1" id="S124T163U1714">G7</span> - <span class="var type1" id="S125T163U1715">G8</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,227" id="srcline227">227</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,228" id="srcline228">228</a></span><span class="line"><span class="comment">% KD</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,229" id="srcline229">229</a></span><span class="line"><span class="mxinfo " id="T162:U1357"><span class="var type1" id="S127T162U1718">KD2</span> = <span class="mxinfo " id="T162:U1359"><span class="mxinfo " id="T162:U1360"><span class="mxinfo " id="T162:U1361">-<span class="var type1" id="S82T162U1722">L_r2</span></span>*(<span class="mxinfo " id="T73:U1363"><span class="mxinfo " id="T73:U1364"><span class="var type1" id="S108T7U1726">m2</span>*<span class="var type1" id="S85T73U1727">S_nI1</span></span> + <span class="mxinfo " id="T73:U1367"><span class="var type1" id="S112T7U1729">m6I</span>*<span class="var type1" id="S88T73U1730">S_nI3</span></span></span>)</span> + <span class="mxinfo " id="T162:U1370"><span class="var type1" id="S84T162U1732">L_r3</span>*(<span class="mxinfo " id="T73:U1372"><span class="mxinfo " id="T73:U1373"><span class="var type1" id="S110T7U1736">m4</span>*<span class="var type1" id="S85T73U1737">S_nI1</span></span> + <span class="mxinfo " id="T73:U1376"><span class="var type1" id="S112T7U1739">m6I</span>*<span class="var type1" id="S87T73U1740">S_nI2</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,230" id="srcline230">230</a></span><span class="line"><span class="mxinfo " id="T162:U1379"><span class="var type1" id="S128T162U1743">KD4</span> = <span class="mxinfo " id="T162:U1381"><span class="mxinfo " id="T162:U1382"><span class="mxinfo " id="T162:U1383">-<span class="var type1" id="S82T162U1747">L_r2</span></span>*(<span class="mxinfo " id="T73:U1385"><span class="mxinfo " id="T73:U1386"><span class="var type1" id="S109T7U1751">m3</span>*<span class="var type1" id="S89T73U1752">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1389"><span class="var type1" id="S113T7U1754">m6J</span>*<span class="var type1" id="S91T73U1755">S_nJ3</span></span></span>)</span> + <span class="mxinfo " id="T162:U1392"><span class="var type1" id="S84T162U1757">L_r3</span>*(<span class="mxinfo " id="T73:U1394"><span class="mxinfo " id="T73:U1395"><span class="var type1" id="S111T7U1761">m5</span>*<span class="var type1" id="S89T73U1762">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1398"><span class="var type1" id="S113T7U1764">m6J</span>*<span class="var type1" id="S90T73U1765">S_nJ2</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,231" id="srcline231">231</a></span><span class="line"><span class="mxinfo " id="T163:U1401"><span class="var type1" id="S129T163U1768">KD</span> = <span class="mxinfo " id="T163:U1403">[<span class="mxinfo " id="T162:U1404">zeros(<span class="mxinfo " id="T7:U1405">12</span>,<span class="mxinfo " id="T7:U1406">3</span>)</span> <span class="var type1" id="S127T162U1775">KD2</span> <span class="mxinfo " id="T162:U1408">zeros(<span class="mxinfo " id="T7:U1409">12</span>,<span class="mxinfo " id="T7:U1410">3</span>)</span> <span class="var type1" id="S128T162U1780">KD4</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,232" id="srcline232">232</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,233" id="srcline233">233</a></span><span class="line"><span class="comment">% KE</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,234" id="srcline234">234</a></span><span class="line"><span class="mxinfo " id="T163:U1412"><span class="var type1" id="S130T163U1783">KE</span> = <span class="mxinfo " id="T163:U1414"><span class="var type1" id="S129T163U1785">KD</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,235" id="srcline235">235</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,236" id="srcline236">236</a></span><span class="line"><span class="comment">% KF</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,237" id="srcline237">237</a></span><span class="line"><span class="comment">% M_nI2 = get_M(NI(:,2),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,238" id="srcline238">238</a></span><span class="line"><span class="comment">% M_nJ2 = get_M(NJ(:,2),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,239" id="srcline239">239</a></span><span class="line"><span class="comment">% M_nI3 = get_M(NI(:,3),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,240" id="srcline240">240</a></span><span class="line"><span class="comment">% M_nJ3 = get_M(NJ(:,3),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,241" id="srcline241">241</a></span><span class="line"><span class="mxinfo " id="T73:U1416"><span class="var type1" id="S80T73U1788">A</span> = <span class="mxinfo " id="T73:U1418"><span class="mxinfo " id="T7:U1419"><span class="mxinfo " id="T7:U1420">1</span>/<span class="var type1" id="S23T7U1792">L</span></span>*(<span class="mxinfo " id="T73:U1422"><span class="mxinfo " id="T73:U1423">[<span class="mxinfo " id="T5:U1424">1 0 0</span>; <span class="mxinfo " id="T5:U1425">0 1 0</span>; <span class="mxinfo " id="T5:U1426">0 0 1</span>]</span> - <span class="mxinfo " id="T73:U1427"><span class="var type1" id="S62T72U1809">e1</span>*<span class="mxinfo " id="T5:U1429"><span class="var type1" id="S62T72U1811">e1</span>'</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,242" id="srcline242">242</a></span><span class="line"><span class="mxinfo " id="T73:U1431"><span class="var type1" id="S131T73U1814">M_nI2</span> = <span class="mxinfo " id="T73:U1433"><span class="mxinfo " id="T7:U1434"><span class="mxinfo " id="T7:U1435">-1</span>/<span class="var type1" id="S23T7U1819">L</span></span>*(<span class="mxinfo " id="T73:U1437"><span class="mxinfo " id="T73:U1438"><span class="mxinfo " id="T73:U1439"><span class="mxinfo " id="T72:U1440"><span class="var type1" id="S80T73U1825">A</span>*<span class="mxinfo " id="T72:U1442"><span class="var type1" id="S49T73U1827">NI</span>(<span class="mxinfo " id="T102:U1444">:</span>,<span class="mxinfo " id="T49:U1445">2</span>)</span></span>*<span class="mxinfo " id="T5:U1446"><span class="var type1" id="S62T72U1831">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1448">(<span class="mxinfo " id="T73:U1449"><span class="mxinfo " id="T72:U1450"><span class="var type1" id="S80T73U1836">A</span>*<span class="mxinfo " id="T72:U1452"><span class="var type1" id="S49T73U1838">NI</span>(<span class="mxinfo " id="T102:U1454">:</span>,<span class="mxinfo " id="T49:U1455">2</span>)</span></span>*<span class="mxinfo " id="T5:U1456"><span class="var type1" id="S62T72U1842">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1458"><span class="var type1" id="S80T73U1844">A</span>*(<span class="mxinfo " id="T7:U1460"><span class="mxinfo " id="T5:U1461"><span class="var type1" id="S62T72U1848">e1</span>'</span>*<span class="mxinfo " id="T72:U1463"><span class="var type1" id="S49T73U1850">NI</span>(<span class="mxinfo " id="T102:U1465">:</span>,<span class="mxinfo " id="T49:U1466">2</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,243" id="srcline243">243</a></span><span class="line"><span class="mxinfo " id="T73:U1467"><span class="var type1" id="S132T73U1855">M_nJ2</span> = <span class="mxinfo " id="T73:U1469"><span class="mxinfo " id="T7:U1470"><span class="mxinfo " id="T7:U1471">-1</span>/<span class="var type1" id="S23T7U1860">L</span></span>*(<span class="mxinfo " id="T73:U1473"><span class="mxinfo " id="T73:U1474"><span class="mxinfo " id="T73:U1475"><span class="mxinfo " id="T72:U1476"><span class="var type1" id="S80T73U1866">A</span>*<span class="mxinfo " id="T72:U1478"><span class="var type1" id="S51T73U1868">NJ</span>(<span class="mxinfo " id="T102:U1480">:</span>,<span class="mxinfo " id="T49:U1481">2</span>)</span></span>*<span class="mxinfo " id="T5:U1482"><span class="var type1" id="S62T72U1872">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1484">(<span class="mxinfo " id="T73:U1485"><span class="mxinfo " id="T72:U1486"><span class="var type1" id="S80T73U1877">A</span>*<span class="mxinfo " id="T72:U1488"><span class="var type1" id="S51T73U1879">NJ</span>(<span class="mxinfo " id="T102:U1490">:</span>,<span class="mxinfo " id="T49:U1491">2</span>)</span></span>*<span class="mxinfo " id="T5:U1492"><span class="var type1" id="S62T72U1883">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1494"><span class="var type1" id="S80T73U1885">A</span>*(<span class="mxinfo " id="T7:U1496"><span class="mxinfo " id="T5:U1497"><span class="var type1" id="S62T72U1889">e1</span>'</span>*<span class="mxinfo " id="T72:U1499"><span class="var type1" id="S51T73U1891">NJ</span>(<span class="mxinfo " id="T102:U1501">:</span>,<span class="mxinfo " id="T49:U1502">2</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,244" id="srcline244">244</a></span><span class="line"><span class="mxinfo " id="T73:U1503"><span class="var type1" id="S133T73U1896">M_nI3</span> = <span class="mxinfo " id="T73:U1505"><span class="mxinfo " id="T7:U1506"><span class="mxinfo " id="T7:U1507">-1</span>/<span class="var type1" id="S23T7U1901">L</span></span>*(<span class="mxinfo " id="T73:U1509"><span class="mxinfo " id="T73:U1510"><span class="mxinfo " id="T73:U1511"><span class="mxinfo " id="T72:U1512"><span class="var type1" id="S80T73U1907">A</span>*<span class="mxinfo " id="T72:U1514"><span class="var type1" id="S49T73U1909">NI</span>(<span class="mxinfo " id="T102:U1516">:</span>,<span class="mxinfo " id="T49:U1517">3</span>)</span></span>*<span class="mxinfo " id="T5:U1518"><span class="var type1" id="S62T72U1913">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1520">(<span class="mxinfo " id="T73:U1521"><span class="mxinfo " id="T72:U1522"><span class="var type1" id="S80T73U1918">A</span>*<span class="mxinfo " id="T72:U1524"><span class="var type1" id="S49T73U1920">NI</span>(<span class="mxinfo " id="T102:U1526">:</span>,<span class="mxinfo " id="T49:U1527">3</span>)</span></span>*<span class="mxinfo " id="T5:U1528"><span class="var type1" id="S62T72U1924">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1530"><span class="var type1" id="S80T73U1926">A</span>*(<span class="mxinfo " id="T7:U1532"><span class="mxinfo " id="T5:U1533"><span class="var type1" id="S62T72U1930">e1</span>'</span>*<span class="mxinfo " id="T72:U1535"><span class="var type1" id="S49T73U1932">NI</span>(<span class="mxinfo " id="T102:U1537">:</span>,<span class="mxinfo " id="T49:U1538">3</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,245" id="srcline245">245</a></span><span class="line"><span class="mxinfo " id="T73:U1539"><span class="var type1" id="S134T73U1937">M_nJ3</span> = <span class="mxinfo " id="T73:U1541"><span class="mxinfo " id="T7:U1542"><span class="mxinfo " id="T7:U1543">-1</span>/<span class="var type1" id="S23T7U1942">L</span></span>*(<span class="mxinfo " id="T73:U1545"><span class="mxinfo " id="T73:U1546"><span class="mxinfo " id="T73:U1547"><span class="mxinfo " id="T72:U1548"><span class="var type1" id="S80T73U1948">A</span>*<span class="mxinfo " id="T72:U1550"><span class="var type1" id="S51T73U1950">NJ</span>(<span class="mxinfo " id="T102:U1552">:</span>,<span class="mxinfo " id="T49:U1553">3</span>)</span></span>*<span class="mxinfo " id="T5:U1554"><span class="var type1" id="S62T72U1954">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1556">(<span class="mxinfo " id="T73:U1557"><span class="mxinfo " id="T72:U1558"><span class="var type1" id="S80T73U1959">A</span>*<span class="mxinfo " id="T72:U1560"><span class="var type1" id="S51T73U1961">NJ</span>(<span class="mxinfo " id="T102:U1562">:</span>,<span class="mxinfo " id="T49:U1563">3</span>)</span></span>*<span class="mxinfo " id="T5:U1564"><span class="var type1" id="S62T72U1965">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1566"><span class="var type1" id="S80T73U1967">A</span>*(<span class="mxinfo " id="T7:U1568"><span class="mxinfo " id="T5:U1569"><span class="var type1" id="S62T72U1971">e1</span>'</span>*<span class="mxinfo " id="T72:U1571"><span class="var type1" id="S51T73U1973">NJ</span>(<span class="mxinfo " id="T102:U1573">:</span>,<span class="mxinfo " id="T49:U1574">3</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,246" id="srcline246">246</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,247" id="srcline247">247</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,248" id="srcline248">248</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,249" id="srcline249">249</a></span><span class="line"><span class="mxinfo " id="T73:U1575"><span class="var type1" id="S135T73U1978">S_e2</span> = <span class="mxinfo " id="T73:U1577"><span class="fcn" id="F223N19:B1980">get_S</span>(<span class="var type1" id="S63T72U1981">e2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,250" id="srcline250">250</a></span><span class="line"><span class="mxinfo " id="T73:U1579"><span class="var type1" id="S136T73U1984">S_e1</span> = <span class="mxinfo " id="T73:U1581"><span class="fcn" id="F223N19:B1986">get_S</span>(<span class="var type1" id="S62T72U1987">e1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,251" id="srcline251">251</a></span><span class="line"><span class="mxinfo " id="T73:U1583"><span class="var type1" id="S137T73U1990">S_e3</span> = <span class="mxinfo " id="T73:U1585"><span class="fcn" id="F223N19:B1992">get_S</span>(<span class="var type1" id="S64T72U1993">e3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,252" id="srcline252">252</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,253" id="srcline253">253</a></span><span class="line"><span class="mxinfo " id="T73:U1587"><span class="var type1" id="S138T73U1996">KF11</span> = <span class="mxinfo " id="T73:U1589"><span class="mxinfo " id="T73:U1590"><span class="mxinfo " id="T73:U1591"><span class="mxinfo " id="T73:U1592"><span class="mxinfo " id="T7:U1593">-<span class="var type1" id="S108T7U2002">m2</span></span>*<span class="var type1" id="S131T73U2003">M_nI2</span></span> - <span class="mxinfo " id="T73:U1596"><span class="var type1" id="S109T7U2005">m3</span>*<span class="var type1" id="S132T73U2006">M_nJ2</span></span></span> + <span class="mxinfo " id="T73:U1599"><span class="var type1" id="S110T7U2008">m4</span>*<span class="var type1" id="S133T73U2009">M_nI3</span></span></span> + <span class="mxinfo " id="T73:U1602"><span class="var type1" id="S111T7U2011">m5</span>*<span class="var type1" id="S134T73U2012">M_nJ3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,254" id="srcline254">254</a></span><span class="line"><span class="mxinfo " id="T73:U1605"><span class="var type1" id="S139T73U2015">KF12</span> = <span class="mxinfo " id="T73:U1607"><span class="mxinfo " id="T73:U1608"><span class="mxinfo " id="T73:U1609"><span class="mxinfo " id="T7:U1610">-<span class="var type1" id="S108T7U2020">m2</span></span>*<span class="var type1" id="S80T73U2021">A</span></span>*<span class="var type1" id="S87T73U2022">S_nI2</span></span> + <span class="mxinfo " id="T73:U1614"><span class="mxinfo " id="T73:U1615"><span class="var type1" id="S110T7U2025">m4</span>*<span class="var type1" id="S80T73U2026">A</span></span>*<span class="var type1" id="S88T73U2027">S_nI3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,255" id="srcline255">255</a></span><span class="line"><span class="mxinfo " id="T73:U1619"><span class="var type1" id="S140T73U2030">KF14</span> = <span class="mxinfo " id="T73:U1621"><span class="mxinfo " id="T73:U1622"><span class="mxinfo " id="T73:U1623"><span class="mxinfo " id="T7:U1624">-<span class="var type1" id="S109T7U2035">m3</span></span>*<span class="var type1" id="S80T73U2036">A</span></span>*<span class="var type1" id="S90T73U2037">S_nJ2</span></span> + <span class="mxinfo " id="T73:U1628"><span class="mxinfo " id="T73:U1629"><span class="var type1" id="S111T7U2040">m5</span>*<span class="var type1" id="S80T73U2041">A</span></span>*<span class="var type1" id="S91T73U2042">S_nJ3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,256" id="srcline256">256</a></span><span class="line"><span class="mxinfo " id="T73:U1633"><span class="var type1" id="S141T73U2045">KF22</span> = <span class="mxinfo " id="T73:U1635"><span class="mxinfo " id="T73:U1636"><span class="mxinfo " id="T73:U1637"><span class="var type1" id="S108T7U2049">m2</span>*(<span class="mxinfo " id="T73:U1639"><span class="mxinfo " id="T73:U1640"><span class="var type1" id="S135T73U2053">S_e2</span>*<span class="var type1" id="S85T73U2054">S_nI1</span></span> - <span class="mxinfo " id="T73:U1643"><span class="var type1" id="S136T73U2056">S_e1</span>*<span class="var type1" id="S87T73U2057">S_nI2</span></span></span>)</span> - <span class="mxinfo " id="T73:U1646"><span class="var type1" id="S110T7U2059">m4</span>*(<span class="mxinfo " id="T73:U1648"><span class="mxinfo " id="T73:U1649"><span class="var type1" id="S137T73U2063">S_e3</span>*<span class="var type1" id="S85T73U2064">S_nI1</span></span> - <span class="mxinfo " id="T73:U1652"><span class="var type1" id="S136T73U2066">S_e1</span>*<span class="var type1" id="S88T73U2067">S_nI3</span></span></span>)</span></span> - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,257" id="srcline257">257</a></span><span class="line">    <span class="mxinfo " id="T73:U1655"><span class="var type1" id="S112T7U2069">m6I</span>*(<span class="mxinfo " id="T73:U1657"><span class="mxinfo " id="T73:U1658"><span class="var type1" id="S137T73U2073">S_e3</span>*<span class="var type1" id="S87T73U2074">S_nI2</span></span> - <span class="mxinfo " id="T73:U1661"><span class="var type1" id="S135T73U2076">S_e2</span>*<span class="var type1" id="S88T73U2077">S_nI3</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,258" id="srcline258">258</a></span><span class="line"><span class="mxinfo " id="T73:U1664"><span class="var type1" id="S142T73U2080">KF44</span> = <span class="mxinfo " id="T73:U1666"><span class="mxinfo " id="T73:U1667"><span class="mxinfo " id="T73:U1668"><span class="var type1" id="S109T7U2084">m3</span>*(<span class="mxinfo " id="T73:U1670"><span class="mxinfo " id="T73:U1671"><span class="var type1" id="S135T73U2088">S_e2</span>*<span class="var type1" id="S89T73U2089">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1674"><span class="var type1" id="S136T73U2091">S_e1</span>*<span class="var type1" id="S90T73U2092">S_nJ2</span></span></span>)</span> - <span class="mxinfo " id="T73:U1677"><span class="var type1" id="S111T7U2094">m5</span>*(<span class="mxinfo " id="T73:U1679"><span class="mxinfo " id="T73:U1680"><span class="var type1" id="S137T73U2098">S_e3</span>*<span class="var type1" id="S89T73U2099">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1683"><span class="var type1" id="S136T73U2101">S_e1</span>*<span class="var type1" id="S91T73U2102">S_nJ3</span></span></span>)</span></span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,259" id="srcline259">259</a></span><span class="line">    <span class="mxinfo " id="T73:U1686"><span class="var type1" id="S113T7U2104">m6J</span>*(<span class="mxinfo " id="T73:U1688"><span class="mxinfo " id="T73:U1689"><span class="var type1" id="S137T73U2108">S_e3</span>*<span class="var type1" id="S90T73U2109">S_nJ2</span></span> - <span class="mxinfo " id="T73:U1692"><span class="var type1" id="S135T73U2111">S_e2</span>*<span class="var type1" id="S91T73U2112">S_nJ3</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,260" id="srcline260">260</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,261" id="srcline261">261</a></span><span class="line"><span class="mxinfo " id="T163:U1695"><span class="var type1" id="S143T163U2115">KF</span> = <span class="mxinfo " id="T163:U1697">[<span class="mxinfo " id="T171:U1698"><span class="var type1" id="S138T73U2118">KF11</span> <span class="var type1" id="S139T73U2119">KF12</span> <span class="mxinfo " id="T73:U1701">-<span class="var type1" id="S138T73U2121">KF11</span></span> <span class="var type1" id="S140T73U2122">KF14</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="156,262" id="srcline262">262</a></span><span class="line">    <span class="mxinfo " id="T171:U1704"><span class="mxinfo " id="T73:U1705"><span class="var type1" id="S139T73U2125">KF12</span>'</span> <span class="var type1" id="S141T73U2126">KF22</span> <span class="mxinfo " id="T73:U1708">-<span class="mxinfo " id="T73:U1709"><span class="var type1" id="S139T73U2129">KF12</span>'</span></span> <span class="mxinfo " id="T73:U1711">zeros(<span class="mxinfo " id="T7:U1712">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="156,263" id="srcline263">263</a></span><span class="line">    <span class="mxinfo " id="T171:U1713"><span class="mxinfo " id="T73:U1714">-<span class="var type1" id="S138T73U2135">KF11</span></span> <span class="mxinfo " id="T73:U1716">-<span class="var type1" id="S139T73U2137">KF12</span></span> <span class="var type1" id="S138T73U2138">KF11</span> <span class="mxinfo " id="T73:U1719">-<span class="var type1" id="S140T73U2140">KF14</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="156,264" id="srcline264">264</a></span><span class="line">    <span class="mxinfo " id="T171:U1721"><span class="mxinfo " id="T73:U1722"><span class="var type1" id="S140T73U2143">KF14</span>'</span> <span class="mxinfo " id="T73:U1724">zeros(<span class="mxinfo " id="T7:U1725">3</span>)</span> <span class="mxinfo " id="T73:U1726">-<span class="mxinfo " id="T73:U1727"><span class="var type1" id="S140T73U2149">KF14</span>'</span></span> <span class="var type1" id="S142T73U2150">KF44</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,265" id="srcline265">265</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,266" id="srcline266">266</a></span><span class="line"><span class="comment">% KG - geometric stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,267" id="srcline267">267</a></span><span class="line"><span class="mxinfo " id="T163:U1730"><span class="var type1" id="S144T163U2153">KG</span> = <span class="mxinfo " id="T163:U1732"><span class="mxinfo " id="T163:U1733"><span class="mxinfo " id="T163:U1734"><span class="mxinfo " id="T163:U1735"><span class="mxinfo " id="T163:U1736"><span class="var type1" id="S114T163U2159">KA</span> + <span class="var type1" id="S115T163U2160">KB</span></span> + <span class="var type1" id="S126T163U2161">KC</span></span> + <span class="var type1" id="S129T163U2162">KD</span></span> + <span class="var type1" id="S130T163U2163">KE</span></span> + <span class="var type1" id="S143T163U2164">KF</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,268" id="srcline268">268</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,269" id="srcline269">269</a></span><span class="line"><span class="comment">% Element global tangent stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,270" id="srcline270">270</a></span><span class="line"><span class="mxinfo " id="T163:U1743"><span class="var type1" id="S2T163U2167">Kel</span> = <span class="mxinfo " id="T163:U1745"><span class="mxinfo " id="T163:U1746"><span class="mxinfo " id="T165:U1747"><span class="mxinfo " id="T165:U1748"><span class="var type1" id="S107T166U2172">T</span>'</span>*<span class="var type1" id="S75T15U2173">KL</span></span>*<span class="var type1" id="S107T166U2174">T</span></span> + <span class="var type1" id="S144T163U2175">KG</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,271" id="srcline271">271</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,272" id="srcline272">272</a></span><span class="line"><span class="comment">% Internal forces in local coordinate system</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,273" id="srcline273">273</a></span><span class="line"><span class="mxinfo " id="T36:U1753"><span class="var type1" id="S3T36U2178">fint_i</span> = <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,274" id="srcline274">274</a></span><span class="line">    <span class="mxinfo " id="T36:U1755">[<span class="mxinfo " id="T7:U1756">-<span class="mxinfo " id="T7:U1757"><span class="var type1" id="S76T22U2183">P</span>(<span class="mxinfo " id="T49:U1759">1</span>)</span></span>              <span class="comment">% Vx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,275" id="srcline275">275</a></span><span class="line">    <span class="mxinfo " id="T7:U1760">(<span class="mxinfo " id="T7:U1761"><span class="mxinfo " id="T7:U1762"><span class="var type1" id="S76T22U2190">P</span>(<span class="mxinfo " id="T49:U1764">3</span>)</span> + <span class="mxinfo " id="T7:U1765"><span class="var type1" id="S76T22U2193">P</span>(<span class="mxinfo " id="T7:U1767">2</span>)</span></span>)/<span class="var type1" id="S23T7U2195">L</span></span>     <span class="comment">% Vy1</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,276" id="srcline276">276</a></span><span class="line">    <span class="mxinfo " id="T7:U1769"><span class="mxinfo " id="T7:U1770">-(<span class="mxinfo " id="T7:U1771"><span class="mxinfo " id="T7:U1772"><span class="var type1" id="S76T22U2202">P</span>(<span class="mxinfo " id="T49:U1774">5</span>)</span> + <span class="mxinfo " id="T7:U1775"><span class="var type1" id="S76T22U2205">P</span>(<span class="mxinfo " id="T7:U1777">4</span>)</span></span>)</span>/<span class="var type1" id="S23T7U2207">L</span></span>    <span class="comment">% Vz1</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,277" id="srcline277">277</a></span><span class="line">    <span class="mxinfo " id="T7:U1779">-<span class="mxinfo " id="T7:U1780"><span class="var type1" id="S76T22U2211">P</span>(<span class="mxinfo " id="T49:U1782">6</span>)</span></span>               <span class="comment">% Mx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,278" id="srcline278">278</a></span><span class="line">    <span class="mxinfo " id="T7:U1783"><span class="var type1" id="S76T22U2215">P</span>(<span class="mxinfo " id="T49:U1785">4</span>)</span>                <span class="comment">% My1</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,279" id="srcline279">279</a></span><span class="line">    <span class="mxinfo " id="T7:U1786"><span class="var type1" id="S76T22U2219">P</span>(<span class="mxinfo " id="T49:U1788">2</span>)</span>                <span class="comment">% Mz1</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,280" id="srcline280">280</a></span><span class="line">    <span class="mxinfo " id="T7:U1789"><span class="var type1" id="S76T22U2223">P</span>(<span class="mxinfo " id="T49:U1791">1</span>)</span>                <span class="comment">% Vx2</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,281" id="srcline281">281</a></span><span class="line">    <span class="mxinfo " id="T7:U1792"><span class="mxinfo " id="T7:U1793">-(<span class="mxinfo " id="T7:U1794"><span class="mxinfo " id="T7:U1795"><span class="var type1" id="S76T22U2231">P</span>(<span class="mxinfo " id="T49:U1797">3</span>)</span> + <span class="mxinfo " id="T7:U1798"><span class="var type1" id="S76T22U2234">P</span>(<span class="mxinfo " id="T7:U1800">2</span>)</span></span>)</span>/<span class="var type1" id="S23T7U2236">L</span></span>    <span class="comment">% Vy2</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,282" id="srcline282">282</a></span><span class="line">    <span class="mxinfo " id="T7:U1802">(<span class="mxinfo " id="T7:U1803"><span class="mxinfo " id="T7:U1804"><span class="var type1" id="S76T22U2242">P</span>(<span class="mxinfo " id="T49:U1806">5</span>)</span> + <span class="mxinfo " id="T7:U1807"><span class="var type1" id="S76T22U2245">P</span>(<span class="mxinfo " id="T7:U1809">4</span>)</span></span>)/<span class="var type1" id="S23T7U2247">L</span></span>     <span class="comment">% Vz2</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,283" id="srcline283">283</a></span><span class="line">    <span class="mxinfo " id="T7:U1811"><span class="var type1" id="S76T22U2250">P</span>(<span class="mxinfo " id="T49:U1813">6</span>)</span>                <span class="comment">% Mx2</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,284" id="srcline284">284</a></span><span class="line">    <span class="mxinfo " id="T7:U1814"><span class="var type1" id="S76T22U2254">P</span>(<span class="mxinfo " id="T49:U1816">5</span>)</span>                <span class="comment">% My2</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,285" id="srcline285">285</a></span><span class="line">    <span class="mxinfo " id="T7:U1817"><span class="var type1" id="S76T22U2258">P</span>(<span class="mxinfo " id="T49:U1819">3</span>)</span>]</span></span>;              <span class="comment">% Mz2</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,286" id="srcline286">286</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,287" id="srcline287">287</a></span><span class="line"><span class="comment">% Element global internal force vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,288" id="srcline288">288</a></span><span class="line"><span class="mxinfo " id="T36:U1820"><span class="var type1" id="S4T36U2262">Fint_i</span> = <span class="mxinfo " id="T36:U1822"><span class="mxinfo " id="T165:U1823"><span class="var type1" id="S107T166U2265">T</span>'</span>*<span class="var type1" id="S76T22U2266">P</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,289" id="srcline289">289</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,290" id="srcline290">290</a></span><span class="line"><span class="comment">% Update element output;</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,291" id="srcline291">291</a></span><span class="line"><span class="mxinfo " id="T168:U1826"><span class="var type1" id="S6T168U2269">el_out</span> = <span class="var type1" id="S9T168U2270">el_in0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,292" id="srcline292">292</a></span><span class="line"><span class="mxinfo " id="T147:U1829"><span class="mxinfo " id="T147:U1830"><span class="var type1" id="S6T168U2274">el_out</span>.flex</span> = <span class="var type1" id="S77T147U2276">el_out0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,293" id="srcline293">293</a></span><span class="line"><span class="mxinfo " id="T7:U1833"><span class="mxinfo " id="T7:U1834"><span class="var type1" id="S6T168U2280">el_out</span>.break</span> = <span class="mxinfo " id="T7:U1836"><span class="var type1" id="S77T147U2283">el_out0</span>.break</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,294" id="srcline294">294</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,295" id="srcline295">295</a></span><span class="line"><span class="mxinfo " id="T22:U1838"><span class="mxinfo " id="T22:U1839"><span class="var type1" id="S6T168U2288">el_out</span>.D0</span> = <span class="var type1" id="S72T22U2290">D</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,296" id="srcline296">296</a></span><span class="line"><span class="mxinfo " id="T22:U1842"><span class="mxinfo " id="T22:U1843"><span class="var type1" id="S6T168U2294">el_out</span>.P0</span> = <span class="var type1" id="S76T22U2296">P</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,297" id="srcline297">297</a></span><span class="line"><span class="mxinfo " id="T15:U1846"><span class="mxinfo " id="T15:U1847"><span class="var type1" id="S6T168U2300">el_out</span>.K0</span> = <span class="var type1" id="S75T15U2302">KL</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="156,298" id="srcline298">298</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="156,299" id="srcline299">299</a></span><span class="line"><span class="comment">% D(1)</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,300" id="srcline300">300</a></span><span class="line"><span class="comment">% KL_el = T'*KL*T;</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,301" id="srcline301">301</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="156,302" id="srcline302">302</a></span><span class="line"></span></span>
</pre>
