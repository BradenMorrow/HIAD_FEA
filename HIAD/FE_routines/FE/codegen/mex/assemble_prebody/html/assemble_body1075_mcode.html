<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="168,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [ <span class="var type1" id="S2T168U3">el_out</span>, <span class="var type1" id="S3T36U4">fint_ii</span>, <span class="var type1" id="S4T36U5">Fint_ii</span>, <span class="var type1" id="S5T107U6">el_dof</span>, <span class="var type1" id="S6T38U7">Kel_out</span>, <span class="var type1" id="S7T107U8">dof_i</span>, <span class="var type1" id="S8T107U9">dof_j</span>, <span class="var type1" id="S9T40U10">ROT_out</span>,  <span class="var type1" id="S10T7U11">break_iter</span>] = <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,2" id="srcline2"> 2</a></span><span class="line">    assemble_body( <span class="var type1" id="S11T8U14">con</span>, <span class="var type1" id="S12T186U15">EL</span>, <span class="var type1" id="S13T42U16">U_input</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="168,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%The loop body for the assemble function</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">%   Calls element functions and assembles element K matrices.</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%   Sets the nodal dof locations to assemble global K matrix.</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%   Prepares the internal force vector to be assembled.</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%   Desgined for 2 node elements with 6 dof per node.</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,8" id="srcline8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="168,9" id="srcline9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="168,10" id="srcline10">10</a></span><span class="line"><span class="comment">% Element nodal displacements</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,11" id="srcline11">11</a></span><span class="line"><span class="mxinfo " id="T170:U13"><span class="mxinfo " id="T170:U14"><span class="var type1" id="S14T169U20">U_in</span>.U0</span> = <span class="mxinfo " id="T170:U16">[<span class="mxinfo " id="T110:U17"><span class="var type1" id="S13T42U25">U_input</span>(<span class="mxinfo " id="T49:U19">:</span>,<span class="mxinfo " id="T172:U20">1:6</span>,<span class="mxinfo " id="T49:U21">1</span>)</span>; <span class="mxinfo " id="T110:U22"><span class="var type1" id="S13T42U33">U_input</span>(<span class="mxinfo " id="T49:U24">:</span>,<span class="mxinfo " id="T172:U25">7:12</span>,<span class="mxinfo " id="T49:U26">1</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,12" id="srcline12">12</a></span><span class="line"><span class="mxinfo " id="T170:U27"><span class="mxinfo " id="T170:U28"><span class="var type1" id="S14T169U42">U_in</span>.U</span> = <span class="mxinfo " id="T170:U30">[<span class="mxinfo " id="T110:U31"><span class="var type1" id="S13T42U47">U_input</span>(<span class="mxinfo " id="T49:U33">:</span>,<span class="mxinfo " id="T172:U34">1:6</span>,<span class="mxinfo " id="T49:U35">2</span>)</span>; <span class="mxinfo " id="T110:U36"><span class="var type1" id="S13T42U55">U_input</span>(<span class="mxinfo " id="T49:U38">:</span>,<span class="mxinfo " id="T172:U39">7:12</span>,<span class="mxinfo " id="T49:U40">2</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,13" id="srcline13">13</a></span><span class="line"><span class="mxinfo " id="T170:U41"><span class="mxinfo " id="T170:U42"><span class="var type1" id="S14T169U64">U_in</span>.delta_U</span> = <span class="mxinfo " id="T170:U44">[<span class="mxinfo " id="T110:U45"><span class="var type1" id="S13T42U69">U_input</span>(<span class="mxinfo " id="T49:U47">:</span>,<span class="mxinfo " id="T172:U48">1:6</span>,<span class="mxinfo " id="T49:U49">3</span>)</span>; <span class="mxinfo " id="T110:U50"><span class="var type1" id="S13T42U77">U_input</span>(<span class="mxinfo " id="T49:U52">:</span>,<span class="mxinfo " id="T172:U53">7:12</span>,<span class="mxinfo " id="T49:U54">3</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,14" id="srcline14">14</a></span><span class="line"><span class="mxinfo " id="T170:U55"><span class="mxinfo " id="T170:U56"><span class="var type1" id="S14T169U86">U_in</span>.DELTA_U</span> = <span class="mxinfo " id="T170:U58">[<span class="mxinfo " id="T110:U59"><span class="var type1" id="S13T42U91">U_input</span>(<span class="mxinfo " id="T49:U61">:</span>,<span class="mxinfo " id="T172:U62">1:6</span>,<span class="mxinfo " id="T49:U63">4</span>)</span>; <span class="mxinfo " id="T110:U64"><span class="var type1" id="S13T42U99">U_input</span>(<span class="mxinfo " id="T49:U66">:</span>,<span class="mxinfo " id="T172:U67">7:12</span>,<span class="mxinfo " id="T49:U68">4</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,15" id="srcline15">15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="168,16" id="srcline16">16</a></span><span class="line"><span class="comment">% Prepare internal force vector (where the internal force vector will be added to)</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,17" id="srcline17">17</a></span><span class="line"><span class="mxinfo " id="T57:U69"><span class="var type1" id="S15T57U107">el_dof1</span> = <span class="mxinfo " id="T57:U71">(<span class="mxinfo " id="T7:U72"><span class="mxinfo " id="T7:U73"><span class="mxinfo " id="T7:U74"><span class="var type1" id="S11T8U113">con</span>(<span class="mxinfo " id="T49:U76">1</span>)</span>*<span class="mxinfo " id="T7:U77">6</span></span>-<span class="mxinfo " id="T7:U78">5</span></span>):(<span class="mxinfo " id="T7:U79"><span class="mxinfo " id="T7:U80"><span class="var type1" id="S11T8U120">con</span>(<span class="mxinfo " id="T49:U82">1</span>)</span>*<span class="mxinfo " id="T7:U83">6</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,18" id="srcline18">18</a></span><span class="line"><span class="mxinfo " id="T57:U84"><span class="var type1" id="S16T57U125">el_dof2</span> = <span class="mxinfo " id="T57:U86">(<span class="mxinfo " id="T7:U87"><span class="mxinfo " id="T7:U88"><span class="mxinfo " id="T7:U89"><span class="var type1" id="S11T8U131">con</span>(<span class="mxinfo " id="T49:U91">2</span>)</span>*<span class="mxinfo " id="T7:U92">6</span></span>-<span class="mxinfo " id="T7:U93">5</span></span>):(<span class="mxinfo " id="T7:U94"><span class="mxinfo " id="T7:U95"><span class="var type1" id="S11T8U138">con</span>(<span class="mxinfo " id="T49:U97">2</span>)</span>*<span class="mxinfo " id="T7:U98">6</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,19" id="srcline19">19</a></span><span class="line"><span class="mxinfo " id="T60:U99"><span class="var type1" id="S17T60U143">el_dof_temp</span> = <span class="mxinfo " id="T60:U101">(<span class="mxinfo " id="T60:U102">cat(2,<span class="var type1" id="S15T57U149">el_dof1</span>,<span class="var type1" id="S16T57U150">el_dof2</span>)</span>)'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo " id="T107:U105"><span class="var type1" id="S5T107U153">el_dof</span> = <span class="mxinfo " id="T107:U107"><span class="var type1" id="S17T60U155">el_dof_temp</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,21" id="srcline21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="168,22" id="srcline22">22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="168,23" id="srcline23">23</a></span><span class="line"><span class="mxinfo " id="T7:U109"><span class="keyword">switch</span> <span class="mxinfo " id="T2:U110"><span class="var type1" id="S12T186U159">EL</span>.el</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,24" id="srcline24">24</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'el1_nonlin'</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,25" id="srcline25">25</a></span><span class="line">        [<span class="var type1" id="S19T163U166">Kel_out_fun</span>,<span class="var type1" id="S3T36U167">fint_ii</span>,<span class="var type1" id="S4T36U168">Fint_ii</span>,<span class="var type1" id="S20T167U169">ROT</span>,<span class="var type1" id="S2T168U170">el_out</span>] = <span class="fcn" id="F1068N7:B172">el1_nonlin</span>(<span class="var type1" id="S14T169U173">U_in</span>, <span class="mxinfo " id="T3:U118"><span class="var type1" id="S12T186U175">EL</span>.el_in</span>, <span class="mxinfo " id="T168:U120"><span class="var type1" id="S12T186U178">EL</span>.el_in0</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="168,26" id="srcline26">26</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'el1'</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,27" id="srcline27">27</a></span><span class="line">        [<span class="var type1" id="S19T163U185">Kel_out_fun</span>,<span class="var type1" id="S3T36U186">fint_ii</span>,<span class="var type1" id="S4T36U187">Fint_ii</span>,<span class="var type1" id="S20T167U188">ROT</span>,<span class="var type1" id="S2T168U189">el_out</span>] = <span class="fcn" id="F1023N6:B191">el1</span>(<span class="var type1" id="S14T169U192">U_in</span>, <span class="mxinfo " id="T3:U128"><span class="var type1" id="S12T186U194">EL</span>.el_in</span>, <span class="mxinfo " id="T168:U130"><span class="var type1" id="S12T186U197">EL</span>.el_in0</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="168,28" id="srcline28">28</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'el2'</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,29" id="srcline29">29</a></span><span class="line">        [<span class="var type1" id="S19T163U204">Kel_out_fun</span>,<span class="var type1" id="S3T36U205">fint_ii</span>,<span class="var type1" id="S4T36U206">Fint_ii</span>,<span class="var type1" id="S20T167U207">ROT</span>,<span class="var type1" id="S2T168U208">el_out</span>] = <span class="fcn" id="F971N8:B210">el2</span>(<span class="var type1" id="S14T169U211">U_in</span>, <span class="mxinfo " id="T3:U138"><span class="var type1" id="S12T186U213">EL</span>.el_in</span>, <span class="mxinfo " id="T168:U140"><span class="var type1" id="S12T186U216">EL</span>.el_in0</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="168,30" id="srcline30">30</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'el3'</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,31" id="srcline31">31</a></span><span class="line">        [<span class="var type1" id="S19T163U223">Kel_out_fun</span>,<span class="var type1" id="S3T36U224">fint_ii</span>,<span class="var type1" id="S4T36U225">Fint_ii</span>,<span class="var type1" id="S20T167U226">ROT</span>,<span class="var type1" id="S2T168U227">el_out</span>] = <span class="fcn" id="F952N9:B229">el3</span>(<span class="var type1" id="S14T169U230">U_in</span>, <span class="mxinfo " id="T3:U148"><span class="var type1" id="S12T186U232">EL</span>.el_in</span>, <span class="mxinfo " id="T168:U150"><span class="var type1" id="S12T186U235">EL</span>.el_in0</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="168,32" id="srcline32">32</a></span><span class="line">    <span class="keyword">otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,33" id="srcline33">33</a></span><span class="line">        [<span class="var type1" id="S19T163U241">Kel_out_fun</span>,<span class="var type1" id="S3T36U242">fint_ii</span>,<span class="var type1" id="S4T36U243">Fint_ii</span>,<span class="var type1" id="S20T167U244">ROT</span>,<span class="var type1" id="S2T168U245">el_out</span>] = <span class="fcn" id="F1069N10:B247">el4</span>(<span class="var type1" id="S14T169U248">U_in</span>, <span class="mxinfo " id="T3:U158"><span class="var type1" id="S12T186U250">EL</span>.el_in</span>, <span class="mxinfo " id="T168:U160"><span class="var type1" id="S12T186U253">EL</span>.el_in0</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="168,34" id="srcline34">34</a></span><span class="line"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="168,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="168,36" id="srcline36">36</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="168,37" id="srcline37">37</a></span><span class="line"><span class="comment">% Store element function outputs</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,38" id="srcline38">38</a></span><span class="line"><span class="mxinfo " id="T40:U162"><span class="var type1" id="S9T40U257">ROT_out</span> = <span class="mxinfo " id="T40:U164">zeros(<span class="mxinfo " id="T7:U165">1</span>,<span class="mxinfo " id="T7:U166">12</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,39" id="srcline39">39</a></span><span class="line"><span class="mxinfo " id="T5:U167"><span class="mxinfo " id="T5:U168"><span class="var type1" id="S9T40U265">ROT_out</span>(<span class="mxinfo " id="T5:U170"><span class="mxinfo " id="T7:U171">1</span>:<span class="mxinfo " id="T7:U172">3</span></span>)</span> = <span class="mxinfo " id="T5:U173"><span class="mxinfo " id="T4:U174"><span class="var type1" id="S20T167U271">ROT</span>.rot</span>(<span class="mxinfo " id="T7:U176">1</span>,<span class="mxinfo " id="T102:U177">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo " id="T5:U178"><span class="mxinfo " id="T5:U179"><span class="var type1" id="S9T40U278">ROT_out</span>(<span class="mxinfo " id="T5:U181"><span class="mxinfo " id="T7:U182">4</span>:<span class="mxinfo " id="T7:U183">6</span></span>)</span> = <span class="mxinfo " id="T5:U184"><span class="mxinfo " id="T4:U185"><span class="var type1" id="S20T167U284">ROT</span>.rot</span>(<span class="mxinfo " id="T7:U187">2</span>,<span class="mxinfo " id="T102:U188">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo " id="T5:U189"><span class="mxinfo " id="T5:U190"><span class="var type1" id="S9T40U291">ROT_out</span>(<span class="mxinfo " id="T5:U192"><span class="mxinfo " id="T7:U193">7</span>:<span class="mxinfo " id="T7:U194">9</span></span>)</span> = <span class="mxinfo " id="T5:U195"><span class="mxinfo " id="T4:U196"><span class="var type1" id="S20T167U297">ROT</span>.DELTA_rot</span>(<span class="mxinfo " id="T7:U198">1</span>,<span class="mxinfo " id="T102:U199">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,42" id="srcline42">42</a></span><span class="line"><span class="mxinfo " id="T5:U200"><span class="mxinfo " id="T5:U201"><span class="var type1" id="S9T40U304">ROT_out</span>(<span class="mxinfo " id="T5:U203"><span class="mxinfo " id="T7:U204">10</span>:<span class="mxinfo " id="T7:U205">12</span></span>)</span> = <span class="mxinfo " id="T5:U206"><span class="mxinfo " id="T4:U207"><span class="var type1" id="S20T167U310">ROT</span>.DELTA_rot</span>(<span class="mxinfo " id="T7:U209">2</span>,<span class="mxinfo " id="T102:U210">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo " id="T7:U211"><span class="var type1" id="S10T7U316">break_iter</span> = <span class="mxinfo " id="T7:U213"><span class="var type1" id="S2T168U318">el_out</span>.break</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,44" id="srcline44">44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="168,45" id="srcline45">45</a></span><span class="line"><span class="comment">% Add global element stiffness matrix to system stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="168,46" id="srcline46">46</a></span><span class="line">    <span class="mxinfo " id="T185:U215"><span class="var type1" id="S27T185U322">temp2</span> = <span class="mxinfo " id="T185:U217">repmat(<span class="mxinfo " id="T57:U218"><span class="var type1" id="S5T107U326">el_dof</span>'</span>, 12,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,47" id="srcline47">47</a></span><span class="line">    <span class="mxinfo " id="T107:U220"><span class="var type1" id="S7T107U331">dof_i</span> = <span class="mxinfo " id="T107:U222">repmat(<span class="var type1" id="S5T107U334">el_dof</span>,12,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,48" id="srcline48">48</a></span><span class="line">    <span class="mxinfo " id="T107:U224"><span class="var type1" id="S8T107U339">dof_j</span> = <span class="mxinfo " id="T107:U226"><span class="var type1" id="S27T185U341">temp2</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,49" id="srcline49">49</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="168,50" id="srcline50">50</a></span><span class="line">    <span class="mxinfo " id="T38:U228"><span class="var type1" id="S6T38U345">Kel_out</span> = <span class="mxinfo " id="T38:U230"><span class="var type1" id="S19T163U347">Kel_out_fun</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="168,51" id="srcline51">51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="168,52" id="srcline52">52</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
