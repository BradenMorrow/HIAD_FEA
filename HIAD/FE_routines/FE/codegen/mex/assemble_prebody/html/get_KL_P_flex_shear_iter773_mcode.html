<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="146,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T15U3">KL</span>,<span class="var type1" id="S3T22U4">P</span>,<span class="var type1" id="S4T147U5">el_out</span>] = get_KL_P_flex_shear_iter(<span class="var type1" id="S5T148U8">el_in</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="146,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%GET_KL_P_FLEX</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   Calculate the element stiffness matrix and element forces using the</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   flexibility method.  Following Taucer et al. (1991), A Fiber</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   Beam-Column Element<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   Shear deformability from Marini and Spacone (2006), Analysis of</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   Reinforced Concrete Elemnents Including Shear Effects</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,8" id="srcline8">  8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% Extract variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,10" id="srcline10"> 10</a></span><span class="line"><span class="mxinfo " id="T7:U5"><span class="var type1" id="S6T7U11">L</span> = <span class="mxinfo " id="T7:U7"><span class="var type1" id="S5T148U13">el_in</span>.L</span></span>; <span class="comment">% Element length</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,11" id="srcline11"> 11</a></span><span class="line"><span class="mxinfo " id="T7:U9"><span class="var type1" id="S7T7U17">R</span> = <span class="mxinfo " id="T7:U11"><span class="var type1" id="S5T148U19">el_in</span>.r</span></span>; <span class="comment">% Radius of tube</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,12" id="srcline12"> 12</a></span><span class="line"><span class="mxinfo " id="T18:U13"><span class="var type1" id="S8T18U23">cords</span> = <span class="mxinfo " id="T18:U15"><span class="var type1" id="S5T148U25">el_in</span>.nodes</span></span>; <span class="comment">% Fiber constitutive relationships</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,13" id="srcline13"> 13</a></span><span class="line"><span class="mxinfo " id="T7:U17"><span class="var type1" id="S9T7U29">p</span> = <span class="mxinfo " id="T7:U19"><span class="var type1" id="S5T148U31">el_in</span>.p</span></span>; <span class="comment">% Internal pressure</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,14" id="srcline14"> 14</a></span><span class="line"><span class="mxinfo " id="T7:U21"><span class="var type1" id="S10T7U35">beta</span> = <span class="mxinfo " id="T7:U23"><span class="var type1" id="S5T148U37">el_in</span>.beta</span></span>; <span class="comment">% Braid angle</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,15" id="srcline15"> 15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,16" id="srcline16"> 16</a></span><span class="line"><span class="mxinfo " id="T7:U25"><span class="var type1" id="S11T7U41">EL</span> = <span class="mxinfo " id="T7:U27"><span class="mxinfo " id="T21:U28"><span class="var type1" id="S5T148U44">el_in</span>.propsLH</span>(<span class="mxinfo " id="T49:U30">1</span>)</span></span>; <span class="comment">% Longitudinal modulus</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,17" id="srcline17"> 17</a></span><span class="line"><span class="mxinfo " id="T7:U31"><span class="var type1" id="S12T7U49">GLH</span> = <span class="mxinfo " id="T7:U33"><span class="mxinfo " id="T21:U34"><span class="var type1" id="S5T148U52">el_in</span>.propsLH</span>(<span class="mxinfo " id="T49:U36">3</span>)</span></span>; <span class="comment">% Inplane shear modulus</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,18" id="srcline18"> 18</a></span><span class="line"><span class="mxinfo " id="T7:U37"><span class="var type1" id="S13T7U57">t</span> = <span class="mxinfo " id="T7:U39"><span class="mxinfo " id="T7:U40">3</span>*<span class="mxinfo " id="T7:U41"><span class="mxinfo " id="T21:U42"><span class="var type1" id="S5T148U62">el_in</span>.propsLH</span>(<span class="mxinfo " id="T7:U44">5</span>)</span></span></span>; <span class="comment">% Shell thickness</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,19" id="srcline19"> 19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,20" id="srcline20"> 20</a></span><span class="line"><span class="mxinfo " id="T7:U45"><span class="var type1" id="S14T7U67">A</span> = <span class="mxinfo " id="T7:U47"><span class="mxinfo " id="T7:U48"><span class="mxinfo " id="T7:U49"><span class="mxinfo " id="T7:U50">2</span>*<span class="mxinfo " id="T7:U51">pi</span></span>*<span class="var type1" id="S7T7U74">R</span></span>*<span class="var type1" id="S13T7U75">t</span></span></span>; <span class="comment">% Shell area</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,21" id="srcline21"> 21</a></span><span class="line"><span class="mxinfo " id="T7:U54"><span class="var type1" id="S16T7U78">I</span> = <span class="mxinfo " id="T7:U56"><span class="mxinfo " id="T7:U57"><span class="mxinfo " id="T7:U58">pi</span>*<span class="mxinfo " id="T7:U59"><span class="var type1" id="S7T7U84">R</span>^3</span></span>*<span class="var type1" id="S13T7U86">t</span></span></span>; <span class="comment">% Shell moment of inertia</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,22" id="srcline22"> 22</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">% State determination variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,24" id="srcline24"> 24</a></span><span class="line"><span class="mxinfo " id="T24:U62"><span class="var type1" id="S17T24U89">K</span> = <span class="mxinfo " id="T24:U64"><span class="mxinfo " id="T147:U65"><span class="var type1" id="S5T148U92">el_in</span>.flex</span>.K</span></span>; <span class="comment">% Element stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,25" id="srcline25"> 25</a></span><span class="line"><span class="mxinfo " id="T25:U67"><span class="var type1" id="S18T25U97">D</span> = <span class="mxinfo " id="T143:U69"><span class="mxinfo " id="T147:U70"><span class="var type1" id="S5T148U100">el_in</span>.flex</span>.D</span></span>; <span class="comment">% Section forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,26" id="srcline26"> 26</a></span><span class="line"><span class="mxinfo " id="T21:U72"><span class="var type1" id="S19T21U105">Q</span> = <span class="mxinfo " id="T21:U74"><span class="mxinfo " id="T147:U75"><span class="var type1" id="S5T148U108">el_in</span>.flex</span>.Q</span></span>; <span class="comment">% Element forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T26:U77"><span class="var type1" id="S20T26U113">f</span> = <span class="mxinfo " id="T26:U79"><span class="mxinfo " id="T147:U80"><span class="var type1" id="S5T148U116">el_in</span>.flex</span>.f</span></span>; <span class="comment">% Section compliance matrices</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo " id="T25:U82"><span class="var type1" id="S21T25U121">d</span> = <span class="mxinfo " id="T25:U84"><span class="mxinfo " id="T147:U85"><span class="var type1" id="S5T148U124">el_in</span>.flex</span>.d</span></span>; <span class="comment">% Section deformations</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T27:U87"><span class="var type1" id="S22T27U129">e</span> = <span class="mxinfo " id="T27:U89"><span class="mxinfo " id="T147:U90"><span class="var type1" id="S5T148U132">el_in</span>.flex</span>.e</span></span>; <span class="comment">% Section fiber strains</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo " id="T28:U92"><span class="var type1" id="S23T28U137">state_it</span> = <span class="mxinfo " id="T28:U94"><span class="var type1" id="S5T148U139">el_in</span>.state_it</span></span>; <span class="comment">% Iterative or non-iterative state determination procedure</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">% Number of integration points</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T7:U96"><span class="var type1" id="S24T7U143">n</span> = <span class="mxinfo " id="T7:U98"><span class="var type1" id="S5T148U145">el_in</span>.n</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,34" id="srcline34"> 34</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">% Initialize</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T16:U100"><span class="var type1" id="S25T16U149">alpha</span> = <span class="mxinfo " id="T16:U102"><span class="var type1" id="S5T148U151">el_in</span>.alpha</span></span>; <span class="comment">% Location of fibers</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,37" id="srcline37"> 37</a></span><span class="line"><span class="mxinfo " id="T149:U104"><span class="var type1" id="S26T149U155">l</span> = <span class="mxinfo " id="T149:U106">zeros(<span class="mxinfo " id="T7:U107">size(<span class="var type1" id="S25T16U160">alpha</span>,1)</span>,<span class="mxinfo " id="T7:U109">3</span>,<span class="var type1" id="S24T7U163">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,38" id="srcline38"> 38</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S29T7U166">i</span> = <span class="mxinfo " id="T7:U112">1</span>:<span class="var type1" id="S24T7U169">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,39" id="srcline39"> 39</a></span><span class="line">    <span class="mxinfo " id="T121:U114"><span class="mxinfo " id="T121:U115"><span class="var type1" id="S26T149U173">l</span>(<span class="mxinfo " id="T150:U117">:</span>,<span class="mxinfo " id="T102:U118">:</span>,<span class="var type1" id="S29T7U176">i</span>)</span> = <span class="mxinfo " id="T121:U120">[<span class="mxinfo " id="T105:U121">ones(<span class="mxinfo " id="T7:U122">size(<span class="var type1" id="S25T16U183">alpha</span>,1)</span>,1)</span> <span class="mxinfo " id="T105:U124"><span class="mxinfo " id="T7:U125">-<span class="var type1" id="S7T7U188">R</span></span>*<span class="mxinfo " id="T105:U127">cosd(<span class="mxinfo " id="T105:U128"><span class="var type1" id="S25T16U192">alpha</span>(<span class="mxinfo " id="T150:U130">:</span>,<span class="var type1" id="S29T7U194">i</span>)</span>)</span></span> <span class="mxinfo " id="T105:U132"><span class="var type1" id="S7T7U196">R</span>*<span class="mxinfo " id="T105:U134">sind(<span class="mxinfo " id="T105:U135"><span class="var type1" id="S25T16U200">alpha</span>(<span class="mxinfo " id="T150:U137">:</span>,<span class="var type1" id="S29T7U202">i</span>)</span>)</span></span>]</span></span>; <span class="comment">% Location of fibers (cartesian)</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,40" id="srcline40"> 40</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,41" id="srcline41"> 41</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">% Initialize</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo " id="T151:U139"><span class="var type1" id="S33T151U205">b</span> = <span class="mxinfo " id="T151:U141">zeros(<span class="mxinfo " id="T7:U142">5</span>,<span class="mxinfo " id="T7:U143">5</span>,<span class="var type1" id="S24T7U210">n</span>)</span></span>; <span class="comment">% Force interpolation functions</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo " id="T143:U145"><span class="var type1" id="S34T143U213">dD</span> = <span class="mxinfo " id="T143:U147">zeros(<span class="mxinfo " id="T7:U148">5</span>,<span class="var type1" id="S24T7U217">n</span>)</span></span>; <span class="comment">% Section force increment</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo " id="T143:U150"><span class="var type1" id="S35T143U220">dd</span> = <span class="mxinfo " id="T143:U152">zeros(<span class="mxinfo " id="T7:U153">5</span>,<span class="var type1" id="S24T7U224">n</span>)</span></span>; <span class="comment">% Section deformation increment</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,46" id="srcline46"> 46</a></span><span class="line"><span class="mxinfo " id="T143:U155"><span class="var type1" id="S36T143U227">r</span> = <span class="mxinfo " id="T143:U157">zeros(<span class="mxinfo " id="T7:U158">5</span>,<span class="var type1" id="S24T7U231">n</span>)</span></span>; <span class="comment">% Residual deformations</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,47" id="srcline47"> 47</a></span><span class="line"><span class="mxinfo " id="T152:U160"><span class="var type1" id="S37T152U234">de</span> = <span class="mxinfo " id="T152:U162">zeros(<span class="mxinfo " id="T7:U163">size(<span class="var type1" id="S26T149U239">l</span>,1)</span>,<span class="var type1" id="S24T7U241">n</span>)</span></span>; <span class="comment">% Fiber strain increments</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,48" id="srcline48"> 48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,49" id="srcline49"> 49</a></span><span class="line"><span class="mxinfo " id="T152:U166"><span class="var type1" id="S38T152U244">sig</span> = <span class="mxinfo " id="T152:U168">zeros(<span class="mxinfo " id="T7:U169">size(<span class="var type1" id="S26T149U249">l</span>,1)</span>,<span class="var type1" id="S24T7U251">n</span>)</span></span>; <span class="comment">% Fiber force</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo " id="T152:U172"><span class="var type1" id="S39T152U254">EA</span> = <span class="mxinfo " id="T152:U174">zeros(<span class="mxinfo " id="T7:U175">size(<span class="var type1" id="S26T149U259">l</span>,1)</span>,<span class="var type1" id="S24T7U261">n</span>)</span></span>; <span class="comment">% Fiber stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,51" id="srcline51"> 51</a></span><span class="line"><span class="mxinfo " id="T151:U178"><span class="var type1" id="S40T151U264">k</span> = <span class="mxinfo " id="T151:U180">zeros(<span class="mxinfo " id="T7:U181">5</span>,<span class="mxinfo " id="T7:U182">5</span>,<span class="var type1" id="S24T7U269">n</span>)</span></span>; <span class="comment">% Section stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo " id="T143:U184"><span class="var type1" id="S41T143U272">Dr</span> = <span class="mxinfo " id="T143:U186">zeros(<span class="mxinfo " id="T7:U187">5</span>,<span class="var type1" id="S24T7U276">n</span>)</span></span>; <span class="comment">% Section resisting forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo " id="T143:U189"><span class="var type1" id="S42T143U279">Du</span> = <span class="mxinfo " id="T143:U191">zeros(<span class="mxinfo " id="T7:U192">5</span>,<span class="var type1" id="S24T7U283">n</span>)</span></span>; <span class="comment">% Section unbalanced forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,54" id="srcline54"> 54</a></span><span class="line"><span class="mxinfo " id="T151:U194"><span class="var type1" id="S43T151U286">Fi</span> = <span class="mxinfo " id="T151:U196">zeros(<span class="mxinfo " id="T7:U197">5</span>,<span class="mxinfo " id="T7:U198">5</span>,<span class="var type1" id="S24T7U291">n</span>)</span></span>; <span class="comment">% Element flexibility matrix at section</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo " id="T24:U200"><span class="var type1" id="S44T24U294">F</span> = <span class="mxinfo " id="T24:U202">zeros(<span class="mxinfo " id="T7:U203">5</span>)</span></span>; <span class="comment">% Element flexibility matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo " id="T21:U204"><span class="var type1" id="S45T21U300">s</span> = <span class="mxinfo " id="T21:U206">zeros(<span class="mxinfo " id="T7:U207">5</span>,1)</span></span>; <span class="comment">% Residual element deformations</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,57" id="srcline57"> 57</a></span><span class="line"><span class="mxinfo " id="T21:U208"><span class="var type1" id="S46T21U307">q</span> = <span class="mxinfo " id="T21:U210">zeros(<span class="mxinfo " id="T7:U211">5</span>,1)</span></span>; <span class="comment">% Residual element deformations</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,58" id="srcline58"> 58</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% Gauss-Lobatto integration constants</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,60" id="srcline60"> 60</a></span><span class="line">[<span class="var type1" id="S47T109U315">xi</span>,<span class="var type1" id="S48T109U316">wi</span>] = <span class="fcn" id="F380N13:B318">get_GL</span>(<span class="var type1" id="S24T7U319">n</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="146,61" id="srcline61"> 61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">% Fiber beam element state determination (Taucer et al. 1991, pg 59)</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% (1) Solve global system of equations and update structure displacements</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">% Global</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,65" id="srcline65"> 65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">% (2) Update element deformations, q, (D in corotational formulation)</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo " id="T21:U215"><span class="var type1" id="S50T21U322">dq</span> = <span class="mxinfo " id="T21:U217"><span class="mxinfo " id="T22:U218"><span class="var type1" id="S5T148U325">el_in</span>.dD</span>(<span class="mxinfo " id="T9:U220"><span class="mxinfo " id="T7:U221">1</span>:<span class="mxinfo " id="T7:U222">5</span></span>)</span></span>; <span class="comment">% Taucer notation</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,68" id="srcline68"> 68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">% (3) Start fiber beam-column element state determination</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,70" id="srcline70"> 70</a></span><span class="line"><span class="mxinfo " id="T7:U223"><span class="var type1" id="S51T7U332">j</span> = <span class="mxinfo " id="T7:U225">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,71" id="srcline71"> 71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,72" id="srcline72"> 72</a></span><span class="line"><span class="mxinfo " id="T7:U226"><span class="var type1" id="S52T7U336">conv</span> = <span class="mxinfo " id="T7:U228">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,73" id="srcline73"> 73</a></span><span class="line"><span class="mxinfo " id="T7:U229"><span class="var type1" id="S53T7U340">tol</span> = <span class="mxinfo " id="T7:U231">1e-6</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,74" id="srcline74"> 74</a></span><span class="line"><span class="mxinfo " id="T25:U232"><span class="var type1" id="S54T25U344">tol_D</span> = <span class="mxinfo " id="T25:U234">zeros(<span class="mxinfo " id="T8:U235">size(<span class="var type1" id="S18T25U349">D</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,75" id="srcline75"> 75</a></span><span class="line"><span class="mxinfo " id="T7:U237"><span class="var type1" id="S55T7U352">EC</span> = <span class="mxinfo " id="T7:U239"><span class="mxinfo " id="T7:U240">5</span>*<span class="var type1" id="S24T7U355">n</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,76" id="srcline76"> 76</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo " id="T7:U242"><span class="var type1" id="S56T7U358">max_iter</span> = <span class="mxinfo " id="T7:U244">100</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo " id="T7:U245"><span class="var type1" id="S57T7U362">iterate</span> = <span class="mxinfo " id="T7:U247">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,79" id="srcline79"> 79</a></span><span class="line"><span class="keyword">while</span> <span class="var type1" id="S57T7U365">iterate</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,80" id="srcline80"> 80</a></span><span class="line">    <span class="mxinfo " id="T7:U249"><span class="var type1" id="S51T7U368">j</span> = <span class="mxinfo " id="T7:U251"><span class="var type1" id="S51T7U370">j</span> + <span class="mxinfo " id="T7:U253">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,81" id="srcline81"> 81</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="146,82" id="srcline82"> 82</a></span><span class="line">    <span class="comment">% (4) Compute the element force increments</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,83" id="srcline83"> 83</a></span><span class="line">    <span class="mxinfo " id="T21:U254"><span class="var type1" id="S58T21U374">dQ</span> = <span class="mxinfo " id="T21:U256"><span class="var type1" id="S17T24U376">K</span>*<span class="var type1" id="S50T21U377">dq</span></span></span>; <span class="comment">% Change in element forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,84" id="srcline84"> 84</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="146,85" id="srcline85"> 85</a></span><span class="line">    <span class="comment">% (5) Update the element forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,86" id="srcline86"> 86</a></span><span class="line">    <span class="mxinfo " id="T21:U259"><span class="var type1" id="S19T21U380">Q</span> = <span class="mxinfo " id="T21:U261"><span class="var type1" id="S19T21U382">Q</span> + <span class="var type1" id="S58T21U383">dQ</span></span></span>; <span class="comment">% New element forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,87" id="srcline87"> 87</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="146,88" id="srcline88"> 88</a></span><span class="line">    <span class="comment">% Loop through sections</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,89" id="srcline89"> 89</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S29T7U386">i</span> = <span class="mxinfo " id="T7:U265">1</span>:<span class="var type1" id="S24T7U389">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,90" id="srcline90"> 90</a></span><span class="line">        <span class="mxinfo " id="T7:U267"><span class="var type1" id="S59T7U392">x</span> = <span class="mxinfo " id="T7:U269"><span class="mxinfo " id="T7:U270"><span class="mxinfo " id="T7:U271"><span class="var type1" id="S6T7U396">L</span>/<span class="mxinfo " id="T7:U273">2</span></span>*<span class="mxinfo " id="T7:U274"><span class="var type1" id="S47T109U399">xi</span>(<span class="var type1" id="S29T7U400">i</span>)</span></span> + <span class="mxinfo " id="T7:U277"><span class="var type1" id="S6T7U402">L</span>/<span class="mxinfo " id="T7:U279">2</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,91" id="srcline91"> 91</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,92" id="srcline92"> 92</a></span><span class="line">        <span class="comment">% Force interpolation at sections</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,93" id="srcline93"> 93</a></span><span class="line">        <span class="mxinfo " id="T24:U280"><span class="mxinfo " id="T24:U281"><span class="var type1" id="S33T151U407">b</span>(<span class="mxinfo " id="T153:U283">:</span>,<span class="mxinfo " id="T153:U284">:</span>,<span class="var type1" id="S29T7U410">i</span>)</span> = <span class="mxinfo " id="T24:U286">[<span class="mxinfo " id="T9:U287"><span class="mxinfo " id="T7:U288">1</span> <span class="mxinfo " id="T7:U289">0</span> <span class="mxinfo " id="T7:U290">0</span> <span class="mxinfo " id="T7:U291">0</span> <span class="mxinfo " id="T7:U292">0</span></span> <span class="comment">% [axial Mz My Vz Vy]'</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,94" id="srcline94"> 94</a></span><span class="line">            <span class="mxinfo " id="T9:U293"><span class="mxinfo " id="T7:U294">0</span> (<span class="mxinfo " id="T7:U295"><span class="mxinfo " id="T7:U296"><span class="var type1" id="S59T7U423">x</span>/<span class="var type1" id="S6T7U424">L</span></span> - <span class="mxinfo " id="T7:U299">1</span></span>) (<span class="mxinfo " id="T7:U300"><span class="var type1" id="S59T7U428">x</span>/<span class="var type1" id="S6T7U429">L</span></span>) <span class="mxinfo " id="T7:U303">0</span> <span class="mxinfo " id="T7:U304">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,95" id="srcline95"> 95</a></span><span class="line">            <span class="mxinfo " id="T9:U305"><span class="mxinfo " id="T7:U306">0</span> <span class="mxinfo " id="T7:U307">0</span> <span class="mxinfo " id="T7:U308">0</span> (<span class="mxinfo " id="T7:U309"><span class="mxinfo " id="T7:U310"><span class="var type1" id="S59T7U439">x</span>/<span class="var type1" id="S6T7U440">L</span></span> - <span class="mxinfo " id="T7:U313">1</span></span>) (<span class="mxinfo " id="T7:U314"><span class="var type1" id="S59T7U444">x</span>/<span class="var type1" id="S6T7U445">L</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,96" id="srcline96"> 96</a></span><span class="line">            <span class="mxinfo " id="T9:U317"><span class="mxinfo " id="T7:U318">0</span> <span class="mxinfo " id="T7:U319"><span class="mxinfo " id="T7:U320">-1</span>/<span class="var type1" id="S6T7U451">L</span></span> <span class="mxinfo " id="T7:U322"><span class="mxinfo " id="T7:U323">-1</span>/<span class="var type1" id="S6T7U455">L</span></span> <span class="mxinfo " id="T7:U325">0</span> <span class="mxinfo " id="T7:U326">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,97" id="srcline97"> 97</a></span><span class="line">            <span class="mxinfo " id="T9:U327"><span class="mxinfo " id="T7:U328">0</span> <span class="mxinfo " id="T7:U329">0</span> <span class="mxinfo " id="T7:U330">0</span> <span class="mxinfo " id="T7:U331"><span class="mxinfo " id="T7:U332">1</span>/<span class="var type1" id="S6T7U464">L</span></span> <span class="mxinfo " id="T7:U334"><span class="mxinfo " id="T7:U335">1</span>/<span class="var type1" id="S6T7U467">L</span></span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,98" id="srcline98"> 98</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,99" id="srcline99"> 99</a></span><span class="line">        <span class="comment">% (6) Compute the section force increments</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,100" id="srcline100">100</a></span><span class="line">        <span class="comment">% Section force increment</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,101" id="srcline101">101</a></span><span class="line">        <span class="mxinfo " id="T21:U337"><span class="mxinfo " id="T21:U338"><span class="var type1" id="S34T143U471">dD</span>(<span class="mxinfo " id="T153:U340">:</span>,<span class="var type1" id="S29T7U473">i</span>)</span> = <span class="mxinfo " id="T21:U342"><span class="mxinfo " id="T24:U343"><span class="var type1" id="S33T151U476">b</span>(<span class="mxinfo " id="T153:U345">:</span>,<span class="mxinfo " id="T153:U346">:</span>,<span class="var type1" id="S29T7U479">i</span>)</span>*<span class="var type1" id="S58T21U480">dQ</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,102" id="srcline102">102</a></span><span class="line">        <span class="mxinfo " id="T21:U349"><span class="mxinfo " id="T21:U350"><span class="var type1" id="S18T25U484">D</span>(<span class="mxinfo " id="T153:U352">:</span>,<span class="var type1" id="S29T7U486">i</span>)</span> = <span class="mxinfo " id="T21:U354"><span class="mxinfo " id="T21:U355"><span class="var type1" id="S18T25U489">D</span>(<span class="mxinfo " id="T153:U357">:</span>,<span class="var type1" id="S29T7U491">i</span>)</span> + <span class="mxinfo " id="T21:U359"><span class="var type1" id="S34T143U493">dD</span>(<span class="mxinfo " id="T153:U361">:</span>,<span class="var type1" id="S29T7U495">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,103" id="srcline103">103</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,104" id="srcline104">104</a></span><span class="line">        <span class="comment">% (7) Compute the section deformation increments</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,105" id="srcline105">105</a></span><span class="line">        <span class="mxinfo " id="T21:U363"><span class="mxinfo " id="T21:U364"><span class="var type1" id="S35T143U499">dd</span>(<span class="mxinfo " id="T153:U366">:</span>,<span class="var type1" id="S29T7U501">i</span>)</span> = <span class="mxinfo " id="T21:U368"><span class="mxinfo " id="T21:U369"><span class="mxinfo " id="T24:U370"><span class="var type1" id="S20T26U505">f</span>(<span class="mxinfo " id="T153:U372">:</span>,<span class="mxinfo " id="T153:U373">:</span>,<span class="var type1" id="S29T7U508">i</span>)</span>*<span class="mxinfo " id="T21:U375"><span class="var type1" id="S34T143U510">dD</span>(<span class="mxinfo " id="T153:U377">:</span>,<span class="var type1" id="S29T7U512">i</span>)</span></span> + <span class="mxinfo " id="T21:U379"><span class="var type1" id="S36T143U514">r</span>(<span class="mxinfo " id="T153:U381">:</span>,<span class="var type1" id="S29T7U516">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,106" id="srcline106">106</a></span><span class="line">        <span class="mxinfo " id="T21:U383"><span class="mxinfo " id="T21:U384"><span class="var type1" id="S21T25U520">d</span>(<span class="mxinfo " id="T153:U386">:</span>,<span class="var type1" id="S29T7U522">i</span>)</span> = <span class="mxinfo " id="T21:U388"><span class="mxinfo " id="T21:U389"><span class="var type1" id="S21T25U525">d</span>(<span class="mxinfo " id="T153:U391">:</span>,<span class="var type1" id="S29T7U527">i</span>)</span> + <span class="mxinfo " id="T21:U393"><span class="var type1" id="S35T143U529">dd</span>(<span class="mxinfo " id="T153:U395">:</span>,<span class="var type1" id="S29T7U531">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,107" id="srcline107">107</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,108" id="srcline108">108</a></span><span class="line">        <span class="comment">% (8) Compute the fiber deformation increments</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,109" id="srcline109">109</a></span><span class="line">        <span class="mxinfo " id="T105:U397"><span class="mxinfo " id="T105:U398"><span class="var type1" id="S37T152U535">de</span>(<span class="mxinfo " id="T150:U400">:</span>,<span class="var type1" id="S29T7U537">i</span>)</span> = <span class="mxinfo " id="T105:U402"><span class="mxinfo " id="T121:U403"><span class="var type1" id="S26T149U540">l</span>(<span class="mxinfo " id="T150:U405">:</span>,<span class="mxinfo " id="T102:U406">:</span>,<span class="var type1" id="S29T7U543">i</span>)</span>*<span class="mxinfo " id="T72:U408"><span class="var type1" id="S35T143U545">dd</span>(<span class="mxinfo " id="T102:U410">1:3</span>,<span class="var type1" id="S29T7U549">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,110" id="srcline110">110</a></span><span class="line">        <span class="mxinfo " id="T154:U412"><span class="mxinfo " id="T154:U413"><span class="var type1" id="S22T27U553">e</span>(<span class="mxinfo " id="T155:U415">:</span>,<span class="var type1" id="S29T7U555">i</span>)</span> = <span class="mxinfo " id="T105:U417"><span class="mxinfo " id="T154:U418"><span class="var type1" id="S22T27U558">e</span>(<span class="mxinfo " id="T155:U420">:</span>,<span class="var type1" id="S29T7U560">i</span>)</span> + <span class="mxinfo " id="T105:U422"><span class="var type1" id="S37T152U562">de</span>(<span class="mxinfo " id="T150:U424">:</span>,<span class="var type1" id="S29T7U564">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,111" id="srcline111">111</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,112" id="srcline112">112</a></span><span class="line">        <span class="comment">% (9) Compute fiber stresses and tangent moduli</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,113" id="srcline113">113</a></span><span class="line">        <span class="comment">% Determine current fiber force and stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,114" id="srcline114">114</a></span><span class="line">        <span class="mxinfo " id="T50:U426"><span class="var type1" id="S60T50U567">interp_meth</span> = <span class="mxinfo " id="T50:U428"><span class="string">'linear'</span></span></span>; <span class="comment">% 'spline'; % 'pchip'; %</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,115" id="srcline115">115</a></span><span class="line">        <span class="mxinfo " id="T7:U429"><span class="var type1" id="S61T7U571">tol1</span> = <span class="mxinfo " id="T7:U431">1e-10</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,116" id="srcline116">116</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S62T7U575">m</span> = <span class="mxinfo " id="T7:U433">1</span>:<span class="mxinfo " id="T7:U434">size(<span class="var type1" id="S25T16U580">alpha</span>,1)</span> <span class="comment">% Fibers</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,117" id="srcline117">117</a></span><span class="line">            <span class="comment">% Extract cord force - strain relationship</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,118" id="srcline118">118</a></span><span class="line">            <span class="mxinfo " id="T20:U436"><span class="var type1" id="S63T20U584">axial</span> = <span class="mxinfo " id="T20:U438"><span class="mxinfo " id="T156:U439"><span class="mxinfo " id="T19:U440"><span class="mxinfo " id="T157:U441"><span class="var type1" id="S8T18U589">cords</span>(<span class="var type1" id="S29T7U590">i</span>)</span>.cords</span>(<span class="var type1" id="S62T7U592">m</span>)</span>.axial</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,119" id="srcline119">119</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="146,120" id="srcline120">120</a></span><span class="line">            <span class="comment">% Calculate cord stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,121" id="srcline121">121</a></span><span class="line">            <span class="mxinfo " id="T127:U445"><span class="var type1" id="S64T127U596">force</span> = <span class="mxinfo " id="T127:U447">interp1(<span class="mxinfo " id="T130:U448"><span class="var type1" id="S63T20U600">axial</span>(<span class="mxinfo " id="T158:U450">:</span>,<span class="mxinfo " id="T49:U451">2</span>)</span>,<span class="mxinfo " id="T130:U452"><span class="var type1" id="S63T20U604">axial</span>(<span class="mxinfo " id="T158:U454">:</span>,<span class="mxinfo " id="T49:U455">1</span>)</span>,<span class="mxinfo " id="T127:U456"><span class="mxinfo " id="T8:U457">[<span class="mxinfo " id="T7:U458"><span class="var type1" id="S22T27U611">e</span>(<span class="var type1" id="S62T7U612">m</span>,<span class="var type1" id="S29T7U613">i</span>)</span> <span class="mxinfo " id="T7:U462"><span class="mxinfo " id="T7:U463"><span class="var type1" id="S22T27U616">e</span>(<span class="var type1" id="S62T7U617">m</span>,<span class="var type1" id="S29T7U618">i</span>)</span> + <span class="var type1" id="S61T7U619">tol1</span></span>]</span>'</span>,<span class="var type1" id="S60T50U620">interp_meth</span>,<span class="string">'extrap'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,122" id="srcline122">122</a></span><span class="line">            <span class="mxinfo " id="T7:U469"><span class="mxinfo " id="T7:U470"><span class="var type1" id="S38T152U625">sig</span>(<span class="var type1" id="S62T7U626">m</span>,<span class="var type1" id="S29T7U627">i</span>)</span> = <span class="mxinfo " id="T7:U474"><span class="var type1" id="S64T127U629">force</span>(<span class="mxinfo " id="T7:U476">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,123" id="srcline123">123</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="146,124" id="srcline124">124</a></span><span class="line">            <span class="comment">% force_up = interp1(axial(:,2),axial(:,1),e(m,i) + tol1,interp_meth);</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,125" id="srcline125">125</a></span><span class="line">            <span class="mxinfo " id="T7:U477"><span class="mxinfo " id="T7:U478"><span class="var type1" id="S39T152U634">EA</span>(<span class="var type1" id="S62T7U635">m</span>,<span class="var type1" id="S29T7U636">i</span>)</span> = <span class="mxinfo " id="T7:U482">(<span class="mxinfo " id="T7:U483"><span class="mxinfo " id="T7:U484"><span class="var type1" id="S64T127U641">force</span>(<span class="mxinfo " id="T49:U486">2</span>)</span> - <span class="mxinfo " id="T7:U487"><span class="var type1" id="S64T127U644">force</span>(<span class="mxinfo " id="T7:U489">1</span>)</span></span>)/<span class="var type1" id="S61T7U646">tol1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,126" id="srcline126">126</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="146,127" id="srcline127">127</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,128" id="srcline128">128</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,129" id="srcline129">129</a></span><span class="line">        <span class="comment">% (10) Compute the section tangent stiffness and flexibility matrices</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,130" id="srcline130">130</a></span><span class="line">        <span class="comment">% Tangent stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,131" id="srcline131">131</a></span><span class="line">        <span class="mxinfo " id="T24:U491"><span class="mxinfo " id="T24:U492"><span class="var type1" id="S40T151U650">k</span>(<span class="mxinfo " id="T153:U494">:</span>,<span class="mxinfo " id="T153:U495">:</span>,<span class="var type1" id="S29T7U653">i</span>)</span> = <span class="mxinfo " id="T24:U497">zeros(<span class="mxinfo " id="T7:U498">5</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,132" id="srcline132">132</a></span><span class="line">        <span class="mxinfo " id="T73:U499"><span class="mxinfo " id="T73:U500"><span class="var type1" id="S40T151U660">k</span>(<span class="mxinfo " id="T5:U502"><span class="mxinfo " id="T7:U503">1</span>:<span class="mxinfo " id="T7:U504">3</span></span>,<span class="mxinfo " id="T5:U505"><span class="mxinfo " id="T7:U506">1</span>:<span class="mxinfo " id="T7:U507">3</span></span>,<span class="var type1" id="S29T7U667">i</span>)</span> = <span class="mxinfo " id="T73:U509"><span class="mxinfo " id="T137:U510"><span class="mxinfo " id="T137:U511"><span class="mxinfo " id="T121:U512"><span class="var type1" id="S26T149U672">l</span>(<span class="mxinfo " id="T150:U514">:</span>,<span class="mxinfo " id="T102:U515">:</span>,<span class="var type1" id="S29T7U675">i</span>)</span>'</span>*<span class="mxinfo " id="T135:U517">diag(<span class="mxinfo " id="T105:U518"><span class="var type1" id="S39T152U679">EA</span>(<span class="mxinfo " id="T150:U520">:</span>,<span class="var type1" id="S29T7U681">i</span>)</span>)</span></span>*<span class="mxinfo " id="T121:U522"><span class="var type1" id="S26T149U683">l</span>(<span class="mxinfo " id="T150:U524">:</span>,<span class="mxinfo " id="T102:U525">:</span>,<span class="var type1" id="S29T7U686">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,133" id="srcline133">133</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,134" id="srcline134">134</a></span><span class="line">        <span class="comment">% Including elastic shell, with work done by pressure due to shear deformation induced volume change</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,135" id="srcline135">135</a></span><span class="line">        <span class="mxinfo " id="T24:U527"><span class="var type1" id="S67T24U689">k_shell</span> = <span class="mxinfo " id="T24:U529">diag(<span class="mxinfo " id="T21:U530"><span class="mxinfo " id="T9:U531">[<span class="mxinfo " id="T7:U532"><span class="var type1" id="S11T7U696">EL</span>*<span class="var type1" id="S14T7U697">A</span></span> <span class="mxinfo " id="T7:U535"><span class="var type1" id="S11T7U699">EL</span>*<span class="var type1" id="S16T7U700">I</span></span> <span class="mxinfo " id="T7:U538"><span class="var type1" id="S11T7U702">EL</span>*<span class="var type1" id="S16T7U703">I</span></span> (<span class="mxinfo " id="T7:U541"><span class="mxinfo " id="T7:U542"><span class="mxinfo " id="T7:U543"><span class="var type1" id="S12T7U708">GLH</span>*<span class="var type1" id="S14T7U709">A</span></span>/<span class="mxinfo " id="T7:U546">2</span></span> + <span class="mxinfo " id="T7:U547"><span class="mxinfo " id="T7:U548"><span class="var type1" id="S9T7U713">p</span>*<span class="mxinfo " id="T7:U550">pi</span></span>*<span class="mxinfo " id="T7:U551"><span class="var type1" id="S7T7U717">R</span>^2</span></span></span>) (<span class="mxinfo " id="T7:U553"><span class="mxinfo " id="T7:U554"><span class="mxinfo " id="T7:U555"><span class="var type1" id="S12T7U723">GLH</span>*<span class="var type1" id="S14T7U724">A</span></span>/<span class="mxinfo " id="T7:U558">2</span></span> + <span class="mxinfo " id="T7:U559"><span class="mxinfo " id="T7:U560"><span class="var type1" id="S9T7U728">p</span>*<span class="mxinfo " id="T7:U562">pi</span></span>*<span class="mxinfo " id="T7:U563"><span class="var type1" id="S7T7U732">R</span>^2</span></span></span>)]</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,136" id="srcline136">136</a></span><span class="line">        <span class="mxinfo " id="T24:U565"><span class="mxinfo " id="T24:U566"><span class="var type1" id="S40T151U737">k</span>(<span class="mxinfo " id="T153:U568">:</span>,<span class="mxinfo " id="T153:U569">:</span>,<span class="var type1" id="S29T7U740">i</span>)</span> = <span class="mxinfo " id="T24:U571"><span class="mxinfo " id="T24:U572"><span class="var type1" id="S40T151U743">k</span>(<span class="mxinfo " id="T153:U574">:</span>,<span class="mxinfo " id="T153:U575">:</span>,<span class="var type1" id="S29T7U746">i</span>)</span> + <span class="var type1" id="S67T24U747">k_shell</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,137" id="srcline137">137</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,138" id="srcline138">138</a></span><span class="line">        <span class="comment">% Tangent flexibility</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,139" id="srcline139">139</a></span><span class="line">        <span class="mxinfo " id="T24:U578"><span class="mxinfo " id="T24:U579"><span class="var type1" id="S20T26U751">f</span>(<span class="mxinfo " id="T153:U581">:</span>,<span class="mxinfo " id="T153:U582">:</span>,<span class="var type1" id="S29T7U754">i</span>)</span> = <span class="mxinfo " id="T24:U584"><span class="mxinfo " id="T24:U585"><span class="var type1" id="S40T151U757">k</span>(<span class="mxinfo " id="T153:U587">:</span>,<span class="mxinfo " id="T153:U588">:</span>,<span class="var type1" id="S29T7U760">i</span>)</span>\<span class="mxinfo " id="T24:U590">eye(5)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,140" id="srcline140">140</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,141" id="srcline141">141</a></span><span class="line">        <span class="comment">% (11) Compute the section resisting forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,142" id="srcline142">142</a></span><span class="line">        <span class="comment">% Reordered DOFs [axial Mz My Vz Vy]'</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,143" id="srcline143">143</a></span><span class="line">        <span class="mxinfo " id="T21:U591"><span class="mxinfo " id="T21:U592"><span class="var type1" id="S41T143U767">Dr</span>(<span class="mxinfo " id="T153:U594">:</span>,<span class="var type1" id="S29T7U769">i</span>)</span> = <span class="mxinfo " id="T21:U596"><span class="mxinfo " id="T21:U597">[<span class="mxinfo " id="T7:U598"><span class="mxinfo " id="T7:U599"><span class="mxinfo " id="T7:U600"><span class="mxinfo " id="T7:U601">sum(<span class="mxinfo " id="T105:U602"><span class="var type1" id="S38T152U779">sig</span>(<span class="mxinfo " id="T150:U604">:</span>,<span class="var type1" id="S29T7U781">i</span>)</span>)</span>  + <span class="mxinfo " id="T7:U606"><span class="mxinfo " id="T7:U607"><span class="mxinfo " id="T7:U608"><span class="mxinfo " id="T7:U609"><span class="var type1" id="S9T7U786">p</span>*<span class="mxinfo " id="T7:U611">pi</span></span>*<span class="mxinfo " id="T7:U612"><span class="var type1" id="S7T7U790">R</span>^2</span></span>*<span class="mxinfo " id="T7:U614">2</span></span>*<span class="mxinfo " id="T7:U615"><span class="mxinfo " id="T7:U616">cotd(<span class="var type1" id="S10T7U796">beta</span>)</span>^2</span></span></span> + <span class="mxinfo " id="T7:U618"><span class="mxinfo " id="T7:U619"><span class="var type1" id="S11T7U800">EL</span>*<span class="var type1" id="S14T7U801">A</span></span>*<span class="mxinfo " id="T7:U622"><span class="var type1" id="S21T25U803">d</span>(<span class="mxinfo " id="T7:U624">1</span>,<span class="var type1" id="S29T7U805">i</span>)</span></span></span> - <span class="mxinfo " id="T7:U626"><span class="mxinfo " id="T7:U627"><span class="var type1" id="S9T7U808">p</span>*<span class="mxinfo " id="T7:U629">pi</span></span>*<span class="mxinfo " id="T7:U630"><span class="var type1" id="S7T7U812">R</span>^2</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,144" id="srcline144">144</a></span><span class="line">            <span class="mxinfo " id="T7:U632">sum(<span class="mxinfo " id="T105:U633"><span class="mxinfo " id="T105:U634"><span class="var type1" id="S38T152U819">sig</span>(<span class="mxinfo " id="T150:U636">:</span>,<span class="var type1" id="S29T7U821">i</span>)</span>.*<span class="mxinfo " id="T105:U638"><span class="var type1" id="S26T149U823">l</span>(<span class="mxinfo " id="T150:U640">:</span>,<span class="mxinfo " id="T7:U641">2</span>,<span class="var type1" id="S29T7U826">i</span>)</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,145" id="srcline145">145</a></span><span class="line">            <span class="mxinfo " id="T7:U643">sum(<span class="mxinfo " id="T105:U644"><span class="mxinfo " id="T105:U645"><span class="var type1" id="S38T152U832">sig</span>(<span class="mxinfo " id="T150:U647">:</span>,<span class="var type1" id="S29T7U834">i</span>)</span>.*<span class="mxinfo " id="T105:U649"><span class="var type1" id="S26T149U836">l</span>(<span class="mxinfo " id="T150:U651">:</span>,<span class="mxinfo " id="T7:U652">3</span>,<span class="var type1" id="S29T7U839">i</span>)</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,146" id="srcline146">146</a></span><span class="line">            <span class="mxinfo " id="T7:U654">0</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,147" id="srcline147">147</a></span><span class="line">            <span class="mxinfo " id="T7:U655">0</span>]</span> + <span class="mxinfo " id="T21:U656"><span class="mxinfo " id="T21:U657"><span class="var type1" id="S67T24U846">k_shell</span>*<span class="mxinfo " id="T21:U659"><span class="var type1" id="S21T25U848">d</span>(<span class="mxinfo " id="T153:U661">:</span>,<span class="var type1" id="S29T7U850">i</span>)</span></span>.*<span class="mxinfo " id="T21:U663"><span class="mxinfo " id="T9:U664">[<span class="mxinfo " id="T7:U665">0</span> <span class="mxinfo " id="T7:U666">1</span> <span class="mxinfo " id="T7:U667">1</span> <span class="mxinfo " id="T7:U668">1</span> <span class="mxinfo " id="T7:U669">1</span>]</span>'</span></span></span></span>; <span class="comment">% Includes axial prestress and shell forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,148" id="srcline148">148</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,149" id="srcline149">149</a></span><span class="line">        <span class="comment">% (12) Compute the section unbalanced forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,150" id="srcline150">150</a></span><span class="line">        <span class="mxinfo " id="T21:U670"><span class="mxinfo " id="T21:U671"><span class="var type1" id="S42T143U862">Du</span>(<span class="mxinfo " id="T153:U673">:</span>,<span class="var type1" id="S29T7U864">i</span>)</span> = <span class="mxinfo " id="T21:U675"><span class="mxinfo " id="T21:U676"><span class="var type1" id="S18T25U867">D</span>(<span class="mxinfo " id="T153:U678">:</span>,<span class="var type1" id="S29T7U869">i</span>)</span> - <span class="mxinfo " id="T21:U680"><span class="var type1" id="S41T143U871">Dr</span>(<span class="mxinfo " id="T153:U682">:</span>,<span class="var type1" id="S29T7U873">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,151" id="srcline151">151</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,152" id="srcline152">152</a></span><span class="line">        <span class="comment">% (13) Compute the residual section deformations</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,153" id="srcline153">153</a></span><span class="line">        <span class="mxinfo " id="T21:U684"><span class="mxinfo " id="T21:U685"><span class="var type1" id="S36T143U877">r</span>(<span class="mxinfo " id="T153:U687">:</span>,<span class="var type1" id="S29T7U879">i</span>)</span> = <span class="mxinfo " id="T21:U689"><span class="mxinfo " id="T24:U690"><span class="var type1" id="S20T26U882">f</span>(<span class="mxinfo " id="T153:U692">:</span>,<span class="mxinfo " id="T153:U693">:</span>,<span class="var type1" id="S29T7U885">i</span>)</span>*<span class="mxinfo " id="T21:U695"><span class="var type1" id="S42T143U887">Du</span>(<span class="mxinfo " id="T153:U697">:</span>,<span class="var type1" id="S29T7U889">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,154" id="srcline154">154</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,155" id="srcline155">155</a></span><span class="line">        <span class="comment">% (14) Compute the element flexibility matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,156" id="srcline156">156</a></span><span class="line">        <span class="comment">% Flexibility matrix at section</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,157" id="srcline157">157</a></span><span class="line">        <span class="mxinfo " id="T24:U699"><span class="mxinfo " id="T24:U700"><span class="var type1" id="S43T151U893">Fi</span>(<span class="mxinfo " id="T153:U702">:</span>,<span class="mxinfo " id="T153:U703">:</span>,<span class="var type1" id="S29T7U896">i</span>)</span> = <span class="mxinfo " id="T24:U705"><span class="mxinfo " id="T24:U706"><span class="mxinfo " id="T24:U707"><span class="mxinfo " id="T24:U708"><span class="var type1" id="S33T151U901">b</span>(<span class="mxinfo " id="T153:U710">:</span>,<span class="mxinfo " id="T153:U711">:</span>,<span class="var type1" id="S29T7U904">i</span>)</span>'</span>*<span class="mxinfo " id="T24:U713"><span class="var type1" id="S20T26U906">f</span>(<span class="mxinfo " id="T153:U715">:</span>,<span class="mxinfo " id="T153:U716">:</span>,<span class="var type1" id="S29T7U909">i</span>)</span></span>*<span class="mxinfo " id="T24:U718"><span class="var type1" id="S33T151U911">b</span>(<span class="mxinfo " id="T153:U720">:</span>,<span class="mxinfo " id="T153:U721">:</span>,<span class="var type1" id="S29T7U914">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,158" id="srcline158">158</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,159" id="srcline159">159</a></span><span class="line">        <span class="comment">% Integrate b(x)'*f(x)*b(x) over the element length to obtain the element</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,160" id="srcline160">160</a></span><span class="line">        <span class="comment">% flexibility matrix, sum products of function evaluations and weights</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,161" id="srcline161">161</a></span><span class="line">        <span class="mxinfo " id="T24:U723"><span class="var type1" id="S44T24U917">F</span> = <span class="mxinfo " id="T24:U725"><span class="var type1" id="S44T24U919">F</span> + <span class="mxinfo " id="T24:U727"><span class="mxinfo " id="T7:U728"><span class="mxinfo " id="T7:U729"><span class="var type1" id="S6T7U923">L</span>/<span class="mxinfo " id="T7:U731">2</span></span>*<span class="mxinfo " id="T7:U732"><span class="var type1" id="S48T109U926">wi</span>(<span class="var type1" id="S29T7U927">i</span>)</span></span>*<span class="mxinfo " id="T24:U735"><span class="var type1" id="S43T151U929">Fi</span>(<span class="mxinfo " id="T153:U737">:</span>,<span class="mxinfo " id="T153:U738">:</span>,<span class="var type1" id="S29T7U932">i</span>)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,162" id="srcline162">162</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,163" id="srcline163">163</a></span><span class="line">        <span class="comment">% (15) Compute the residual element deformations</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,164" id="srcline164">164</a></span><span class="line">        <span class="mxinfo " id="T21:U740"><span class="var type1" id="S71T21U935">si</span> = <span class="mxinfo " id="T21:U742"><span class="mxinfo " id="T24:U743"><span class="mxinfo " id="T24:U744"><span class="var type1" id="S33T151U939">b</span>(<span class="mxinfo " id="T153:U746">:</span>,<span class="mxinfo " id="T153:U747">:</span>,<span class="var type1" id="S29T7U942">i</span>)</span>'</span>*<span class="mxinfo " id="T21:U749"><span class="var type1" id="S36T143U944">r</span>(<span class="mxinfo " id="T153:U751">:</span>,<span class="var type1" id="S29T7U946">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,165" id="srcline165">165</a></span><span class="line">        <span class="mxinfo " id="T21:U753"><span class="var type1" id="S45T21U949">s</span> = <span class="mxinfo " id="T21:U755"><span class="var type1" id="S45T21U951">s</span> + <span class="mxinfo " id="T21:U757"><span class="mxinfo " id="T7:U758"><span class="mxinfo " id="T7:U759"><span class="var type1" id="S6T7U955">L</span>/<span class="mxinfo " id="T7:U761">2</span></span>*<span class="mxinfo " id="T7:U762"><span class="var type1" id="S48T109U958">wi</span>(<span class="var type1" id="S29T7U959">i</span>)</span></span>*<span class="var type1" id="S71T21U960">si</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,166" id="srcline166">166</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,167" id="srcline167">167</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="146,168" id="srcline168">168</a></span><span class="line">        <span class="mxinfo " id="T21:U766"><span class="var type1" id="S72T21U963">qi</span> = <span class="mxinfo " id="T21:U768"><span class="mxinfo " id="T24:U769"><span class="mxinfo " id="T24:U770"><span class="var type1" id="S33T151U967">b</span>(<span class="mxinfo " id="T153:U772">:</span>,<span class="mxinfo " id="T153:U773">:</span>,<span class="var type1" id="S29T7U970">i</span>)</span>'</span>*<span class="mxinfo " id="T21:U775"><span class="var type1" id="S21T25U972">d</span>(<span class="mxinfo " id="T153:U777">:</span>,<span class="var type1" id="S29T7U974">i</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,169" id="srcline169">169</a></span><span class="line">        <span class="mxinfo " id="T21:U779"><span class="var type1" id="S46T21U977">q</span> = <span class="mxinfo " id="T21:U781"><span class="var type1" id="S46T21U979">q</span> + <span class="mxinfo " id="T21:U783"><span class="mxinfo " id="T7:U784"><span class="mxinfo " id="T7:U785"><span class="var type1" id="S6T7U983">L</span>/<span class="mxinfo " id="T7:U787">2</span></span>*<span class="mxinfo " id="T7:U788"><span class="var type1" id="S48T109U986">wi</span>(<span class="var type1" id="S29T7U987">i</span>)</span></span>*<span class="var type1" id="S72T21U988">qi</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,170" id="srcline170">170</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,171" id="srcline171">171</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="146,172" id="srcline172">172</a></span><span class="line">    <span class="comment">% (14 continued) Compute the element stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,173" id="srcline173">173</a></span><span class="line">    <span class="comment">% Inverse of the element flexibility matrix is the element stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,174" id="srcline174">174</a></span><span class="line">    <span class="comment">% matrix, K = F^-1</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,175" id="srcline175">175</a></span><span class="line">    <span class="mxinfo " id="T24:U792"><span class="var type1" id="S17T24U991">K</span> = <span class="mxinfo " id="T24:U794"><span class="var type1" id="S44T24U993">F</span>\<span class="mxinfo " id="T24:U796">eye(5)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,176" id="srcline176">176</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="146,177" id="srcline177">177</a></span><span class="line">    <span class="comment">% (15 continued) Check for element convergence</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,178" id="srcline178">178</a></span><span class="line">    <span class="comment">% Absolute criteria</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,179" id="srcline179">179</a></span><span class="line">    <span class="mxinfo " id="T143:U797"><span class="var type1" id="S73T143U999">tol_a</span> = <span class="mxinfo " id="T143:U799">[<span class="mxinfo " id="T57:U800"><span class="var type1" id="S53T7U1003">tol</span>*<span class="mxinfo " id="T57:U802">ones(<span class="mxinfo " id="T49:U803">1</span>,<span class="var type1" id="S24T7U1007">n</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,180" id="srcline180">180</a></span><span class="line">        <span class="mxinfo " id="T142:U805"><span class="mxinfo " id="T7:U806"><span class="var type1" id="S53T7U1011">tol</span>*<span class="var type1" id="S6T7U1012">L</span></span>*<span class="mxinfo " id="T142:U809">ones(<span class="mxinfo " id="T49:U810">2</span>,<span class="var type1" id="S24T7U1016">n</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,181" id="srcline181">181</a></span><span class="line">        <span class="mxinfo " id="T142:U812"><span class="var type1" id="S53T7U1019">tol</span>*<span class="mxinfo " id="T142:U814">ones(<span class="mxinfo " id="T49:U815">2</span>,<span class="var type1" id="S24T7U1023">n</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,182" id="srcline182">182</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="146,183" id="srcline183">183</a></span><span class="line">    <span class="comment">% Relative criteria</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,184" id="srcline184">184</a></span><span class="line">    <span class="mxinfo " id="T25:U817"><span class="var type1" id="S74T25U1026">tol_b</span> = <span class="mxinfo " id="T143:U819">abs(<span class="mxinfo " id="T25:U820"><span class="var type1" id="S18T25U1030">D</span>*<span class="var type1" id="S53T7U1031">tol</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,185" id="srcline185">185</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="146,186" id="srcline186">186</a></span><span class="line">    <span class="comment">% Maximum of criteria</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,187" id="srcline187">187</a></span><span class="line">    <span class="mxinfo " id="T145:U823"><span class="var type1" id="S76T145U1034">tol_ind</span> = <span class="mxinfo " id="T145:U825"><span class="mxinfo " id="T7:U826">0</span> &lt; (<span class="mxinfo " id="T25:U827"><span class="var type1" id="S73T143U1039">tol_a</span> - <span class="var type1" id="S74T25U1040">tol_b</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,188" id="srcline188">188</a></span><span class="line">    <span class="mxinfo " id="T159:U830"><span class="mxinfo " id="T159:U831"><span class="var type1" id="S54T25U1044">tol_D</span>(<span class="var type1" id="S76T145U1045">tol_ind</span>)</span> = <span class="mxinfo " id="T159:U834"><span class="var type1" id="S73T143U1047">tol_a</span>(<span class="var type1" id="S76T145U1048">tol_ind</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,189" id="srcline189">189</a></span><span class="line">    <span class="mxinfo " id="T159:U837"><span class="mxinfo " id="T159:U838"><span class="var type1" id="S54T25U1052">tol_D</span>(<span class="mxinfo " id="T145:U840">~<span class="var type1" id="S76T145U1054">tol_ind</span></span>)</span> = <span class="mxinfo " id="T159:U842"><span class="var type1" id="S74T25U1056">tol_b</span>(<span class="mxinfo " id="T145:U844">~<span class="var type1" id="S76T145U1058">tol_ind</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,190" id="srcline190">190</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="146,191" id="srcline191">191</a></span><span class="line">    <span class="comment">% Number of converged DOFs</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,192" id="srcline192">192</a></span><span class="line">    <span class="mxinfo " id="T7:U846"><span class="var type1" id="S52T7U1061">conv</span> = <span class="mxinfo " id="T7:U848">sum(<span class="mxinfo " id="T146:U849">sum(<span class="mxinfo " id="T145:U850"><span class="mxinfo " id="T143:U851">abs(<span class="var type1" id="S42T143U1069">Du</span>)</span> &lt; <span class="var type1" id="S54T25U1070">tol_D</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,193" id="srcline193">193</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="146,194" id="srcline194">194</a></span><span class="line">    <span class="comment">% Update element deformations for next iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,195" id="srcline195">195</a></span><span class="line">    <span class="mxinfo " id="T21:U854"><span class="var type1" id="S50T21U1073">dq</span> = <span class="mxinfo " id="T21:U856">-<span class="var type1" id="S45T21U1075">s</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,196" id="srcline196">196</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="146,197" id="srcline197">197</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo " id="T28:U858"><span class="var type1" id="S23T28U1079">state_it</span> == <span class="mxinfo " id="T7:U860">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,198" id="srcline198">198</a></span><span class="line">        <span class="keyword">if</span>(<span class="mxinfo " id="T28:U861"><span class="var type1" id="S52T7U1086">conv</span> ~= <span class="var type1" id="S55T7U1087">EC</span></span> &amp;&amp; <span class="mxinfo " id="T28:U864"><span class="var type1" id="S51T7U1089">j</span> &lt; <span class="var type1" id="S56T7U1090">max_iter</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="146,199" id="srcline199">199</a></span><span class="line">            <span class="mxinfo " id="T7:U867"><span class="var type1" id="S57T7U1093">iterate</span> = <span class="mxinfo " id="T7:U869">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,200" id="srcline200">200</a></span><span class="line">        <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,201" id="srcline201">201</a></span><span class="line">            <span class="mxinfo " id="T7:U870"><span class="var type1" id="S57T7U1098">iterate</span> = <span class="mxinfo " id="T7:U872">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,202" id="srcline202">202</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,203" id="srcline203">203</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,204" id="srcline204">204</a></span><span class="line">        <span class="mxinfo " id="T7:U873"><span class="var type1" id="S57T7U1103">iterate</span> = <span class="mxinfo " id="T7:U875">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,205" id="srcline205">205</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,206" id="srcline206">206</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,207" id="srcline207">207</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,208" id="srcline208">208</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,209" id="srcline209">209</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,210" id="srcline210">210</a></span><span class="line"><span class="comment">% % (4) Compute the element force increments</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,211" id="srcline211">211</a></span><span class="line"><span class="comment">% dQ = K*dq; % Change in element forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,212" id="srcline212">212</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,213" id="srcline213">213</a></span><span class="line"><span class="comment">% (5) Update the element forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,214" id="srcline214">214</a></span><span class="line"><span class="comment">% Q = Q - K*s; % New element forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,215" id="srcline215">215</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,216" id="srcline216">216</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,217" id="srcline217">217</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,218" id="srcline218">218</a></span><span class="line"><span class="comment">% If state determination process has not converged, cutback Newton</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,219" id="srcline219">219</a></span><span class="line"><span class="comment">% iteration</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,220" id="srcline220">220</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo " id="T28:U876"><span class="var type1" id="S51T7U1109">j</span> == <span class="var type1" id="S56T7U1110">max_iter</span></span> &amp;&amp; <span class="mxinfo " id="T28:U879"><span class="var type1" id="S52T7U1112">conv</span> ~= <span class="var type1" id="S55T7U1113">EC</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="146,221" id="srcline221">221</a></span><span class="line">    <span class="comment">%     warning('State determination cutback') % Print this to a file</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,222" id="srcline222">222</a></span><span class="line">    <span class="mxinfo " id="T7:U882"><span class="mxinfo " id="T7:U883"><span class="var type1" id="S4T147U1117">el_out</span>.break</span> = <span class="mxinfo " id="T7:U885">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,223" id="srcline223">223</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,224" id="srcline224">224</a></span><span class="line">    <span class="mxinfo " id="T7:U886"><span class="mxinfo " id="T7:U887"><span class="var type1" id="S4T147U1124">el_out</span>.break</span> = <span class="mxinfo " id="T7:U889">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,225" id="srcline225">225</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,226" id="srcline226">226</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,227" id="srcline227">227</a></span><span class="line"><span class="comment">% (16) Assemble structure resisting forces and structural stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,228" id="srcline228">228</a></span><span class="line"><span class="comment">% For passing back to corotational formulation</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,229" id="srcline229">229</a></span><span class="line"><span class="mxinfo " id="T7:U890"><span class="var type1" id="S77T7U1129">J</span> = <span class="mxinfo " id="T7:U892"><span class="mxinfo " id="T7:U893"><span class="mxinfo " id="T7:U894"><span class="mxinfo " id="T7:U895">2</span>*<span class="mxinfo " id="T7:U896">pi</span></span>*<span class="mxinfo " id="T7:U897"><span class="var type1" id="S7T7U1137">R</span>^3</span></span>*<span class="var type1" id="S13T7U1139">t</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,230" id="srcline230">230</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,231" id="srcline231">231</a></span><span class="line"><span class="comment">% Element forces for corotational formulation (including linear torsion)</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,232" id="srcline232">232</a></span><span class="line"><span class="mxinfo " id="T22:U900"><span class="var type1" id="S3T22U1142">P</span> = <span class="mxinfo " id="T22:U902">[<span class="var type1" id="S19T21U1145">Q</span>; <span class="mxinfo " id="T7:U904"><span class="mxinfo " id="T7:U905"><span class="mxinfo " id="T7:U906"><span class="mxinfo " id="T7:U907"><span class="mxinfo " id="T22:U908"><span class="var type1" id="S5T148U1152">el_in</span>.D</span>(<span class="mxinfo " id="T49:U910">6</span>)</span>*<span class="var type1" id="S12T7U1155">GLH</span></span>*<span class="var type1" id="S77T7U1156">J</span></span>/<span class="var type1" id="S6T7U1157">L</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,233" id="srcline233">233</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,234" id="srcline234">234</a></span><span class="line"><span class="comment">% Element stiffness matrix for corotational formulation (including linear</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,235" id="srcline235">235</a></span><span class="line"><span class="comment">% torsion)</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,236" id="srcline236">236</a></span><span class="line"><span class="mxinfo " id="T15:U914"><span class="var type1" id="S2T15U1160">KL</span> = <span class="mxinfo " id="T15:U916">zeros(<span class="mxinfo " id="T7:U917">6</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,237" id="srcline237">237</a></span><span class="line"><span class="mxinfo " id="T7:U918"><span class="mxinfo " id="T7:U919"><span class="var type1" id="S2T15U1167">KL</span>(<span class="mxinfo " id="T7:U921">6</span>,<span class="mxinfo " id="T7:U922">6</span>)</span> = <span class="mxinfo " id="T7:U923"><span class="mxinfo " id="T7:U924"><span class="var type1" id="S12T7U1172">GLH</span>*<span class="var type1" id="S77T7U1173">J</span></span>/<span class="var type1" id="S6T7U1174">L</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,238" id="srcline238">238</a></span><span class="line"><span class="mxinfo " id="T24:U928"><span class="mxinfo " id="T24:U929"><span class="var type1" id="S2T15U1178">KL</span>(<span class="mxinfo " id="T9:U931"><span class="mxinfo " id="T7:U932">1</span>:<span class="mxinfo " id="T7:U933">5</span></span>,<span class="mxinfo " id="T9:U934"><span class="mxinfo " id="T7:U935">1</span>:<span class="mxinfo " id="T7:U936">5</span></span>)</span> = <span class="var type1" id="S17T24U1185">K</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="146,239" id="srcline239">239</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,240" id="srcline240">240</a></span><span class="line"><span class="comment">% Store variables for future iterations</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,241" id="srcline241">241</a></span><span class="line"><span class="mxinfo " id="T24:U938"><span class="mxinfo " id="T24:U939"><span class="var type1" id="S4T147U1189">el_out</span>.K</span> = <span class="var type1" id="S17T24U1191">K</span></span>; <span class="comment">% Element stiffness</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,242" id="srcline242">242</a></span><span class="line"><span class="mxinfo " id="T143:U942"><span class="mxinfo " id="T143:U943"><span class="var type1" id="S4T147U1195">el_out</span>.D</span> = <span class="var type1" id="S18T25U1197">D</span></span>; <span class="comment">% Section forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,243" id="srcline243">243</a></span><span class="line"><span class="mxinfo " id="T143:U946"><span class="mxinfo " id="T143:U947"><span class="var type1" id="S4T147U1201">el_out</span>.Du</span> = <span class="var type1" id="S42T143U1203">Du</span></span>; <span class="comment">% Unbalanced section forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,244" id="srcline244">244</a></span><span class="line"><span class="mxinfo " id="T21:U950"><span class="mxinfo " id="T21:U951"><span class="var type1" id="S4T147U1207">el_out</span>.Q</span> = <span class="var type1" id="S19T21U1209">Q</span></span>; <span class="comment">% Element forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,245" id="srcline245">245</a></span><span class="line"><span class="mxinfo " id="T26:U954"><span class="mxinfo " id="T26:U955"><span class="var type1" id="S4T147U1213">el_out</span>.f</span> = <span class="var type1" id="S20T26U1215">f</span></span>; <span class="comment">% Section compliance matrices</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,246" id="srcline246">246</a></span><span class="line"><span class="mxinfo " id="T25:U958"><span class="mxinfo " id="T25:U959"><span class="var type1" id="S4T147U1219">el_out</span>.d</span> = <span class="var type1" id="S21T25U1221">d</span></span>; <span class="comment">% Section deformations</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,247" id="srcline247">247</a></span><span class="line"><span class="mxinfo " id="T27:U962"><span class="mxinfo " id="T27:U963"><span class="var type1" id="S4T147U1225">el_out</span>.e</span> = <span class="var type1" id="S22T27U1227">e</span></span>; <span class="comment">% Section fiber strains</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,248" id="srcline248">248</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,249" id="srcline249">249</a></span><span class="line"><span class="comment">% % % % Plot strain at end of beam</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,250" id="srcline250">250</a></span><span class="line"><span class="comment">% % % if el_in.el == 3;</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,251" id="srcline251">251</a></span><span class="line"><span class="comment">% % %     plot_strain</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,252" id="srcline252">252</a></span><span class="line"><span class="comment">% % % end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,253" id="srcline253">253</a></span><span class="line"><span class="comment">% % %</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,254" id="srcline254">254</a></span><span class="line"><span class="comment">% % % % For tracking change in volumae</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,255" id="srcline255">255</a></span><span class="line"><span class="comment">% % % dV_L = L/2*wi'*(pi*R^2*d(1,:)');</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,256" id="srcline256">256</a></span><span class="line"><span class="comment">% % % dV_H = L/2*wi'*(pi*R^2*d(1,:)*nuLH.*(d(1,:)*nuLH - 2))';</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,257" id="srcline257">257</a></span><span class="line"><span class="comment">% % % dV = pi*R^2*(1 - 2*nuLH)*L/2*wi'*d(1,:)';</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,258" id="srcline258">258</a></span><span class="line"><span class="comment">% % %</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,259" id="srcline259">259</a></span><span class="line"><span class="comment">% % % el_out.dV_L = dV_L;</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,260" id="srcline260">260</a></span><span class="line"><span class="comment">% % % el_out.dV_H = dV_H;</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,261" id="srcline261">261</a></span><span class="line"><span class="comment">% % % el_out.dV = dV;</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,262" id="srcline262">262</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,263" id="srcline263">263</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="146,264" id="srcline264">264</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,265" id="srcline265">265</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,266" id="srcline266">266</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,267" id="srcline267">267</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,268" id="srcline268">268</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,269" id="srcline269">269</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,270" id="srcline270">270</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,271" id="srcline271">271</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,272" id="srcline272">272</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,273" id="srcline273">273</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,274" id="srcline274">274</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="146,275" id="srcline275">275</a></span><span class="line"></span></span>
</pre>
