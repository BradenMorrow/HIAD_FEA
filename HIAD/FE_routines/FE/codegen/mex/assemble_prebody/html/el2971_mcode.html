<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="158,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T163U3">Kel</span>,<span class="var type1" id="S3T36U4">fint_i</span>,<span class="var type1" id="S4T36U5">Fint_i</span>,<span class="var type1" id="S5T167U6">ROT</span>,<span class="var type1" id="S6T168U7">el_out</span>] = el2(<span class="var type1" id="S7T169U10">U_in</span>,<span class="var type1" id="S8T3U11">el_in</span>,<span class="var type1" id="S9T168U12">el_in0</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="158,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%ELEMENT_4</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%   3D corotational beam formulation, see Crisfield (1990), A consistent</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,4" id="srcline4">  4</a></span><span class="line"><span class="comment">%   co-rotational formulation for non-linear, three dimensional,</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%   beam-elements</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%   See also de Souza dissertation (2000), Force-based finite element for</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%   large displacement inelastic analysis of frames</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%   Generally follows de Souza</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,9" id="srcline9">  9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">% Extract variables</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% Geometry</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,12" id="srcline12"> 12</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,13" id="srcline13"> 13</a></span><span class="line"><span class="mxinfo " id="T4:U9"><span class="var type1" id="S10T4U15">nodes</span> = <span class="mxinfo " id="T4:U11"><span class="var type1" id="S8T3U17">el_in</span>.nodes_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,14" id="srcline14"> 14</a></span><span class="line"><span class="mxinfo " id="T5:U13"><span class="var type1" id="S11T5U21">orient</span> = <span class="mxinfo " id="T5:U15"><span class="var type1" id="S8T3U23">el_in</span>.orient_ij</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,15" id="srcline15"> 15</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">% Material</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,17" id="srcline17"> 17</a></span><span class="line"><span class="mxinfo " id="T8:U17"><span class="var type1" id="S12T8U27">mat</span> = <span class="mxinfo " id="T8:U19"><span class="var type1" id="S9T168U29">el_in0</span>.mat</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,18" id="srcline18"> 18</a></span><span class="line"><span class="mxinfo " id="T9:U21"><span class="var type1" id="S13T9U33">geom</span> = <span class="mxinfo " id="T9:U23"><span class="var type1" id="S9T168U35">el_in0</span>.geom</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,19" id="srcline19"> 19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">% Obtain displacements of interest</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,21" id="srcline21"> 21</a></span><span class="line"><span class="mxinfo " id="T170:U25"><span class="var type1" id="S14T170U39">Uel</span> = <span class="mxinfo " id="T170:U27"><span class="var type1" id="S7T169U41">U_in</span>.U</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,22" id="srcline22"> 22</a></span><span class="line"><span class="mxinfo " id="T170:U29"><span class="var type1" id="S15T170U45">delta_Uel</span> = <span class="mxinfo " id="T170:U31"><span class="var type1" id="S7T169U47">U_in</span>.delta_U</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,23" id="srcline23"> 23</a></span><span class="line"><span class="mxinfo " id="T170:U33"><span class="var type1" id="S16T170U51">DELTA_Uel</span> = <span class="mxinfo " id="T170:U35"><span class="var type1" id="S7T169U53">U_in</span>.DELTA_U</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,24" id="srcline24"> 24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">% Components of length and length</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">% Initial</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,27" id="srcline27"> 27</a></span><span class="line"><span class="mxinfo " id="T7:U37"><span class="var type1" id="S17T7U57">L10</span> = <span class="mxinfo " id="T7:U39"><span class="mxinfo " id="T7:U40"><span class="var type1" id="S10T4U60">nodes</span>(<span class="mxinfo " id="T49:U42">2</span>,<span class="mxinfo " id="T49:U43">1</span>)</span> - <span class="mxinfo " id="T7:U44"><span class="var type1" id="S10T4U64">nodes</span>(<span class="mxinfo " id="T7:U46">1</span>,<span class="mxinfo " id="T7:U47">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,28" id="srcline28"> 28</a></span><span class="line"><span class="mxinfo " id="T7:U48"><span class="var type1" id="S18T7U69">L20</span> = <span class="mxinfo " id="T7:U50"><span class="mxinfo " id="T7:U51"><span class="var type1" id="S10T4U72">nodes</span>(<span class="mxinfo " id="T49:U53">2</span>,<span class="mxinfo " id="T49:U54">2</span>)</span> - <span class="mxinfo " id="T7:U55"><span class="var type1" id="S10T4U76">nodes</span>(<span class="mxinfo " id="T7:U57">1</span>,<span class="mxinfo " id="T7:U58">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,29" id="srcline29"> 29</a></span><span class="line"><span class="mxinfo " id="T7:U59"><span class="var type1" id="S19T7U81">L30</span> = <span class="mxinfo " id="T7:U61"><span class="mxinfo " id="T7:U62"><span class="var type1" id="S10T4U84">nodes</span>(<span class="mxinfo " id="T49:U64">2</span>,<span class="mxinfo " id="T49:U65">3</span>)</span> - <span class="mxinfo " id="T7:U66"><span class="var type1" id="S10T4U88">nodes</span>(<span class="mxinfo " id="T7:U68">1</span>,<span class="mxinfo " id="T7:U69">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,30" id="srcline30"> 30</a></span><span class="line"><span class="mxinfo " id="T7:U70"><span class="var type1" id="S20T7U93">L0</span> = <span class="mxinfo " id="T7:U72">sqrt(<span class="mxinfo " id="T7:U73"><span class="mxinfo " id="T7:U74"><span class="mxinfo " id="T7:U75"><span class="var type1" id="S17T7U99">L10</span>^2</span> + <span class="mxinfo " id="T7:U77"><span class="var type1" id="S18T7U102">L20</span>^2</span></span> + <span class="mxinfo " id="T7:U79"><span class="var type1" id="S19T7U105">L30</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,31" id="srcline31"> 31</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">% Current</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,33" id="srcline33"> 33</a></span><span class="line"><span class="mxinfo " id="T7:U81"><span class="var type1" id="S22T7U109">L1</span> = <span class="mxinfo " id="T7:U83">(<span class="mxinfo " id="T7:U84"><span class="mxinfo " id="T7:U85"><span class="var type1" id="S10T4U114">nodes</span>(<span class="mxinfo " id="T49:U87">2</span>,<span class="mxinfo " id="T49:U88">1</span>)</span> + <span class="mxinfo " id="T7:U89"><span class="var type1" id="S14T170U118">Uel</span>(<span class="mxinfo " id="T7:U91">2</span>,<span class="mxinfo " id="T7:U92">1</span>)</span></span>) - (<span class="mxinfo " id="T7:U93"><span class="mxinfo " id="T7:U94"><span class="var type1" id="S10T4U124">nodes</span>(<span class="mxinfo " id="T7:U96">1</span>,<span class="mxinfo " id="T7:U97">1</span>)</span> + <span class="mxinfo " id="T7:U98"><span class="var type1" id="S14T170U128">Uel</span>(<span class="mxinfo " id="T7:U100">1</span>,<span class="mxinfo " id="T7:U101">1</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,34" id="srcline34"> 34</a></span><span class="line"><span class="mxinfo " id="T7:U102"><span class="var type1" id="S23T7U133">L2</span> = <span class="mxinfo " id="T7:U104">(<span class="mxinfo " id="T7:U105"><span class="mxinfo " id="T7:U106"><span class="var type1" id="S10T4U138">nodes</span>(<span class="mxinfo " id="T49:U108">2</span>,<span class="mxinfo " id="T49:U109">2</span>)</span> + <span class="mxinfo " id="T7:U110"><span class="var type1" id="S14T170U142">Uel</span>(<span class="mxinfo " id="T7:U112">2</span>,<span class="mxinfo " id="T7:U113">2</span>)</span></span>) - (<span class="mxinfo " id="T7:U114"><span class="mxinfo " id="T7:U115"><span class="var type1" id="S10T4U148">nodes</span>(<span class="mxinfo " id="T7:U117">1</span>,<span class="mxinfo " id="T7:U118">2</span>)</span> + <span class="mxinfo " id="T7:U119"><span class="var type1" id="S14T170U152">Uel</span>(<span class="mxinfo " id="T7:U121">1</span>,<span class="mxinfo " id="T7:U122">2</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,35" id="srcline35"> 35</a></span><span class="line"><span class="mxinfo " id="T7:U123"><span class="var type1" id="S24T7U157">L3</span> = <span class="mxinfo " id="T7:U125">(<span class="mxinfo " id="T7:U126"><span class="mxinfo " id="T7:U127"><span class="var type1" id="S10T4U162">nodes</span>(<span class="mxinfo " id="T49:U129">2</span>,<span class="mxinfo " id="T49:U130">3</span>)</span> + <span class="mxinfo " id="T7:U131"><span class="var type1" id="S14T170U166">Uel</span>(<span class="mxinfo " id="T7:U133">2</span>,<span class="mxinfo " id="T7:U134">3</span>)</span></span>) - (<span class="mxinfo " id="T7:U135"><span class="mxinfo " id="T7:U136"><span class="var type1" id="S10T4U172">nodes</span>(<span class="mxinfo " id="T7:U138">1</span>,<span class="mxinfo " id="T7:U139">3</span>)</span> + <span class="mxinfo " id="T7:U140"><span class="var type1" id="S14T170U176">Uel</span>(<span class="mxinfo " id="T7:U142">1</span>,<span class="mxinfo " id="T7:U143">3</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,36" id="srcline36"> 36</a></span><span class="line"><span class="mxinfo " id="T7:U144"><span class="var type1" id="S25T7U181">L</span> = <span class="mxinfo " id="T7:U146">sqrt(<span class="mxinfo " id="T7:U147"><span class="mxinfo " id="T7:U148"><span class="mxinfo " id="T7:U149"><span class="var type1" id="S22T7U187">L1</span>^2</span> + <span class="mxinfo " id="T7:U151"><span class="var type1" id="S23T7U190">L2</span>^2</span></span> + <span class="mxinfo " id="T7:U153"><span class="var type1" id="S24T7U193">L3</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,37" id="srcline37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">% To orientation nodes</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">% Initial</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">% Lo10 = orient(1:2,1) - nodes(1:2,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">% Lo20 = orient(1:2,2) - nodes(1:2,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">% Lo30 = orient(1:2,3) - nodes(1:2,3);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,43" id="srcline43"> 43</a></span><span class="line"><span class="mxinfo " id="T7:U155"><span class="var type1" id="S26T7U197">Lo10</span> = <span class="mxinfo " id="T7:U157"><span class="mxinfo " id="T7:U158"><span class="var type1" id="S11T5U200">orient</span>(<span class="mxinfo " id="T49:U160">1</span>,<span class="mxinfo " id="T49:U161">1</span>)</span> - <span class="mxinfo " id="T7:U162"><span class="var type1" id="S10T4U204">nodes</span>(<span class="mxinfo " id="T7:U164">1</span>,<span class="mxinfo " id="T7:U165">1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,44" id="srcline44"> 44</a></span><span class="line"><span class="mxinfo " id="T7:U166"><span class="var type1" id="S27T7U209">Lo20</span> = <span class="mxinfo " id="T7:U168"><span class="mxinfo " id="T7:U169"><span class="var type1" id="S11T5U212">orient</span>(<span class="mxinfo " id="T49:U171">1</span>,<span class="mxinfo " id="T49:U172">2</span>)</span> - <span class="mxinfo " id="T7:U173"><span class="var type1" id="S10T4U216">nodes</span>(<span class="mxinfo " id="T7:U175">1</span>,<span class="mxinfo " id="T7:U176">2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,45" id="srcline45"> 45</a></span><span class="line"><span class="mxinfo " id="T7:U177"><span class="var type1" id="S28T7U221">Lo30</span> = <span class="mxinfo " id="T7:U179"><span class="mxinfo " id="T7:U180"><span class="var type1" id="S11T5U224">orient</span>(<span class="mxinfo " id="T49:U182">1</span>,<span class="mxinfo " id="T49:U183">3</span>)</span> - <span class="mxinfo " id="T7:U184"><span class="var type1" id="S10T4U228">nodes</span>(<span class="mxinfo " id="T7:U186">1</span>,<span class="mxinfo " id="T7:U187">3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,46" id="srcline46"> 46</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">% Obtain the initial nodal triads</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">% Unit vectors at i node</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,49" id="srcline49"> 49</a></span><span class="line"><span class="mxinfo " id="T72:U188"><span class="var type1" id="S29T72U233">e10</span> = <span class="mxinfo " id="T72:U190"><span class="mxinfo " id="T5:U191">[<span class="var type1" id="S17T7U237">L10</span> <span class="var type1" id="S18T7U238">L20</span> <span class="var type1" id="S19T7U239">L30</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,50" id="srcline50"> 50</a></span><span class="line"><span class="mxinfo " id="T72:U195"><span class="var type1" id="S29T72U242">e10</span> = <span class="mxinfo " id="T72:U197"><span class="var type1" id="S29T72U244">e10</span>/<span class="mxinfo " id="T7:U199">norm(<span class="var type1" id="S29T72U247">e10</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,51" id="srcline51"> 51</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,52" id="srcline52"> 52</a></span><span class="line"><span class="mxinfo " id="T72:U201"><span class="var type1" id="S31T72U250">e30</span> = <span class="mxinfo " id="T72:U203">cross(<span class="var type1" id="S29T72U253">e10</span>,<span class="mxinfo " id="T72:U205"><span class="mxinfo " id="T5:U206">[<span class="var type1" id="S26T7U258">Lo10</span>(1) <span class="var type1" id="S27T7U261">Lo20</span>(1) <span class="var type1" id="S28T7U264">Lo30</span>(1)]</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,53" id="srcline53"> 53</a></span><span class="line"><span class="mxinfo " id="T72:U210"><span class="var type1" id="S31T72U268">e30</span> = <span class="mxinfo " id="T72:U212"><span class="var type1" id="S31T72U270">e30</span>/<span class="mxinfo " id="T7:U214">norm(<span class="var type1" id="S31T72U273">e30</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,54" id="srcline54"> 54</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,55" id="srcline55"> 55</a></span><span class="line"><span class="mxinfo " id="T72:U216"><span class="var type1" id="S33T72U276">e20</span> = <span class="mxinfo " id="T72:U218">cross(<span class="var type1" id="S31T72U279">e30</span>,<span class="var type1" id="S29T72U280">e10</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,56" id="srcline56"> 56</a></span><span class="line"><span class="mxinfo " id="T72:U221"><span class="var type1" id="S33T72U283">e20</span> = <span class="mxinfo " id="T72:U223"><span class="var type1" id="S33T72U285">e20</span>/<span class="mxinfo " id="T7:U225">norm(<span class="var type1" id="S33T72U288">e20</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,57" id="srcline57"> 57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,58" id="srcline58"> 58</a></span><span class="line"><span class="mxinfo " id="T73:U227"><span class="var type1" id="S34T73U291">E0</span> = <span class="mxinfo " id="T73:U229">[<span class="var type1" id="S29T72U294">e10</span> <span class="var type1" id="S33T72U295">e20</span> <span class="var type1" id="S31T72U296">e30</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,59" id="srcline59"> 59</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">% Section 5.3.2a - de Souza</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">% e0 = get_quat_R(E0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,62" id="srcline62"> 62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,63" id="srcline63"> 63</a></span><span class="line"><span class="mxinfo " id="T76:U233"><span class="var type1" id="S35T76U299">qi_old</span> = <span class="mxinfo " id="T76:U235"><span class="fcn" id="F190N20:B301">get_quat_PHI</span>(<span class="mxinfo " id="T72:U236"><span class="mxinfo " id="T5:U237"><span class="var type1" id="S14T170U304">Uel</span>(<span class="mxinfo " id="T49:U239">1</span>,<span class="mxinfo " id="T102:U240">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,64" id="srcline64"> 64</a></span><span class="line"><span class="mxinfo " id="T76:U241"><span class="var type1" id="S37T76U311">qj_old</span> = <span class="mxinfo " id="T76:U243"><span class="fcn" id="F190N20:B313">get_quat_PHI</span>(<span class="mxinfo " id="T72:U244"><span class="mxinfo " id="T5:U245"><span class="var type1" id="S14T170U316">Uel</span>(<span class="mxinfo " id="T49:U247">2</span>,<span class="mxinfo " id="T102:U248">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,65" id="srcline65"> 65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo " id="T76:U249"><span class="var type1" id="S38T76U323">delta_qi</span> = <span class="mxinfo " id="T76:U251"><span class="fcn" id="F190N20:B325">get_quat_PHI</span>(<span class="mxinfo " id="T72:U252"><span class="mxinfo " id="T5:U253"><span class="var type1" id="S15T170U328">delta_Uel</span>(<span class="mxinfo " id="T49:U255">1</span>,<span class="mxinfo " id="T102:U256">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo " id="T76:U257"><span class="var type1" id="S39T76U335">delta_qj</span> = <span class="mxinfo " id="T76:U259"><span class="fcn" id="F190N20:B337">get_quat_PHI</span>(<span class="mxinfo " id="T72:U260"><span class="mxinfo " id="T5:U261"><span class="var type1" id="S15T170U340">delta_Uel</span>(<span class="mxinfo " id="T49:U263">2</span>,<span class="mxinfo " id="T102:U264">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,68" id="srcline68"> 68</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">% STEP 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,70" id="srcline70"> 70</a></span><span class="line"><span class="mxinfo " id="T76:U265"><span class="var type1" id="S40T76U347">qI</span> = <span class="mxinfo " id="T76:U267"><span class="fcn" id="F210N26:B349">quat_prod</span>(<span class="var type1" id="S38T76U350">delta_qi</span>,<span class="var type1" id="S35T76U351">qi_old</span>)</span></span>; <span class="comment">% Equation 5.46</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,71" id="srcline71"> 71</a></span><span class="line"><span class="mxinfo " id="T76:U270"><span class="var type1" id="S42T76U354">qJ</span> = <span class="mxinfo " id="T76:U272"><span class="fcn" id="F210N26:B356">quat_prod</span>(<span class="var type1" id="S39T76U357">delta_qj</span>,<span class="var type1" id="S37T76U358">qj_old</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,72" id="srcline72"> 72</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">% Calculate nodal rotation for incorporation into displacement vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,74" id="srcline74"> 74</a></span><span class="line"><span class="mxinfo " id="T72:U275"><span class="var type1" id="S43T72U361">rotI</span> = <span class="mxinfo " id="T72:U277"><span class="fcn" id="F222N17:B363">get_PHI_quat</span>(<span class="var type1" id="S40T76U364">qI</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,75" id="srcline75"> 75</a></span><span class="line"><span class="mxinfo " id="T72:U279"><span class="var type1" id="S45T72U367">rotJ</span> = <span class="mxinfo " id="T72:U281"><span class="fcn" id="F222N17:B369">get_PHI_quat</span>(<span class="var type1" id="S42T76U370">qJ</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo " id="T4:U283"><span class="var type1" id="S46T4U373">rot</span> = <span class="mxinfo " id="T4:U285">[<span class="mxinfo " id="T5:U286"><span class="var type1" id="S43T72U377">rotI</span>'</span>; <span class="mxinfo " id="T5:U288"><span class="var type1" id="S45T72U380">rotJ</span>'</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo " id="T4:U290"><span class="mxinfo " id="T4:U291"><span class="var type1" id="S5T167U384">ROT</span>.rot</span> = <span class="var type1" id="S46T4U386">rot</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,78" id="srcline78"> 78</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">% If U = zeros, rotI and rotJ = zeros, nI and nJ = e0 ==&gt; OK</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">% However, NI and NJ should equal E0, not the case.</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">% % % nI = quat_prod(qI,e0); % Equation 5.48</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">% % % nJ = quat_prod(qJ,e0);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">% % % </span></span></span>
<span class="srcline"><span class="lineno"><a href="158,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">% % % NI = get_R_quat(nI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">% % % NJ = get_R_quat(nJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">% % % </span></span></span>
<span class="srcline"><span class="lineno"><a href="158,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">% % % % STEP 3</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">% % % gammaI = get_PHI_quat(nI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">% % % gammaJ = get_PHI_quat(nJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">% % % </span></span></span>
<span class="srcline"><span class="lineno"><a href="158,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">% % % % STEP 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">% % % R_bar = get_R_PHI((gammaI + gammaJ)/2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,94" id="srcline94"> 94</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,95" id="srcline95"> 95</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">% June 25, 2015</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo " id="T73:U294"><span class="var type1" id="S47T73U389">NI</span> = <span class="mxinfo " id="T73:U296"><span class="mxinfo " id="T73:U297"><span class="fcn" id="F347N18:B392">get_R_PHI</span>(<span class="mxinfo " id="T72:U298"><span class="mxinfo " id="T5:U299"><span class="var type1" id="S46T4U395">rot</span>(<span class="mxinfo " id="T49:U301">1</span>,<span class="mxinfo " id="T102:U302">:</span>)</span>'</span>)</span>*<span class="var type1" id="S34T73U398">E0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,98" id="srcline98"> 98</a></span><span class="line"><span class="mxinfo " id="T73:U304"><span class="var type1" id="S49T73U401">NJ</span> = <span class="mxinfo " id="T73:U306"><span class="mxinfo " id="T73:U307"><span class="fcn" id="F347N18:B404">get_R_PHI</span>(<span class="mxinfo " id="T72:U308"><span class="mxinfo " id="T5:U309"><span class="var type1" id="S46T4U407">rot</span>(<span class="mxinfo " id="T49:U311">2</span>,<span class="mxinfo " id="T102:U312">:</span>)</span>'</span>)</span>*<span class="var type1" id="S34T73U410">E0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,99" id="srcline99"> 99</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,100" id="srcline100">100</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,101" id="srcline101">101</a></span><span class="line"><span class="comment">% % % % STEP 3</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,102" id="srcline102">102</a></span><span class="line"><span class="comment">% % % gammaI = get_PHI_quat(nI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,103" id="srcline103">103</a></span><span class="line"><span class="comment">% % % gammaJ = get_PHI_quat(nJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,104" id="srcline104">104</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,105" id="srcline105">105</a></span><span class="line"><span class="comment">% STEP 4</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,106" id="srcline106">106</a></span><span class="line"><span class="mxinfo " id="T73:U314"><span class="var type1" id="S50T73U413">R_bar</span> = <span class="mxinfo " id="T73:U316">(<span class="mxinfo " id="T73:U317"><span class="var type1" id="S47T73U417">NI</span> + <span class="var type1" id="S49T73U418">NJ</span></span>)/<span class="mxinfo " id="T7:U320">2</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,107" id="srcline107">107</a></span><span class="line"><span class="mxinfo " id="T73:U321"><span class="var type1" id="S50T73U422">R_bar</span> = <span class="mxinfo " id="T73:U323"><span class="fcn" id="F346N24:B424">normcfast</span>(<span class="var type1" id="S50T73U425">R_bar</span>)</span></span>; <span class="comment">%normfast is faster than norm and does not do unecissary checks</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,108" id="srcline108">108</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,109" id="srcline109">109</a></span><span class="line"><span class="comment">% % Also need step change in rotations for arc-length solver (DELTA_U)</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,110" id="srcline110">110</a></span><span class="line"><span class="mxinfo " id="T76:U325"><span class="var type1" id="S52T76U428">DELTA_qi_old</span> = <span class="mxinfo " id="T76:U327"><span class="fcn" id="F190N20:B430">get_quat_PHI</span>(<span class="mxinfo " id="T72:U328"><span class="mxinfo " id="T5:U329"><span class="var type1" id="S16T170U433">DELTA_Uel</span>(<span class="mxinfo " id="T49:U331">1</span>,<span class="mxinfo " id="T102:U332">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,111" id="srcline111">111</a></span><span class="line"><span class="mxinfo " id="T76:U333"><span class="var type1" id="S53T76U440">DELTA_qj_old</span> = <span class="mxinfo " id="T76:U335"><span class="fcn" id="F190N20:B442">get_quat_PHI</span>(<span class="mxinfo " id="T72:U336"><span class="mxinfo " id="T5:U337"><span class="var type1" id="S16T170U445">DELTA_Uel</span>(<span class="mxinfo " id="T49:U339">2</span>,<span class="mxinfo " id="T102:U340">4:6</span>)</span>'</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,112" id="srcline112">112</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,113" id="srcline113">113</a></span><span class="line"><span class="mxinfo " id="T76:U341"><span class="var type1" id="S54T76U452">DELTA_qi</span> = <span class="mxinfo " id="T76:U343"><span class="fcn" id="F210N26:B454">quat_prod</span>(<span class="var type1" id="S38T76U455">delta_qi</span>,<span class="var type1" id="S52T76U456">DELTA_qi_old</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,114" id="srcline114">114</a></span><span class="line"><span class="mxinfo " id="T76:U346"><span class="var type1" id="S55T76U459">DELTA_qj</span> = <span class="mxinfo " id="T76:U348"><span class="fcn" id="F210N26:B461">quat_prod</span>(<span class="var type1" id="S39T76U462">delta_qj</span>,<span class="var type1" id="S53T76U463">DELTA_qj_old</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,115" id="srcline115">115</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,116" id="srcline116">116</a></span><span class="line"><span class="mxinfo " id="T72:U351"><span class="var type1" id="S56T72U466">DELTA_rotI</span> = <span class="mxinfo " id="T72:U353"><span class="fcn" id="F222N17:B468">get_PHI_quat</span>(<span class="var type1" id="S54T76U469">DELTA_qi</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,117" id="srcline117">117</a></span><span class="line"><span class="mxinfo " id="T72:U355"><span class="var type1" id="S57T72U472">DELTA_rotJ</span> = <span class="mxinfo " id="T72:U357"><span class="fcn" id="F222N17:B474">get_PHI_quat</span>(<span class="var type1" id="S55T76U475">DELTA_qj</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,118" id="srcline118">118</a></span><span class="line"><span class="mxinfo " id="T4:U359"><span class="var type1" id="S58T4U478">DELTA_rot</span> = <span class="mxinfo " id="T4:U361">[<span class="mxinfo " id="T5:U362"><span class="var type1" id="S56T72U482">DELTA_rotI</span>'</span>; <span class="mxinfo " id="T5:U364"><span class="var type1" id="S57T72U485">DELTA_rotJ</span>'</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,119" id="srcline119">119</a></span><span class="line"><span class="mxinfo " id="T4:U366"><span class="mxinfo " id="T4:U367"><span class="var type1" id="S5T167U489">ROT</span>.DELTA_rot</span> = <span class="var type1" id="S58T4U491">DELTA_rot</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,120" id="srcline120">120</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,121" id="srcline121">121</a></span><span class="line"><span class="comment">% RI = get_R_quat(qI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,122" id="srcline122">122</a></span><span class="line"><span class="comment">% RJ = get_R_quat(qJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,123" id="srcline123">123</a></span><span class="line"><span class="comment">% RI0 = get_R_PHI(U0(1,4:6)');</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,124" id="srcline124">124</a></span><span class="line"><span class="comment">% RJ0 = get_R_PHI(U0(2,4:6)');</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,125" id="srcline125">125</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="158,126" id="srcline126">126</a></span><span class="line"><span class="comment">% DELTA_RI = RI*(RI0\eye(3));</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,127" id="srcline127">127</a></span><span class="line"><span class="comment">% DELTA_RJ = RJ*(RJ0\eye(3));</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,128" id="srcline128">128</a></span><span class="line"><span class="comment">% </span></span></span>
<span class="srcline"><span class="lineno"><a href="158,129" id="srcline129">129</a></span><span class="line"><span class="comment">% DELTA_rotI = get_PHI_R(DELTA_RI);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,130" id="srcline130">130</a></span><span class="line"><span class="comment">% DELTA_rotJ = get_PHI_R(DELTA_RJ);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,131" id="srcline131">131</a></span><span class="line"><span class="comment">% DELTA_rot = [DELTA_rotI'; DELTA_rotJ'];</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,132" id="srcline132">132</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,133" id="srcline133">133</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,134" id="srcline134">134</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,135" id="srcline135">135</a></span><span class="line"><span class="comment">% Compute e1, e2 and e3 to form E</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,136" id="srcline136">136</a></span><span class="line"><span class="mxinfo " id="T72:U370"><span class="var type1" id="S59T72U494">e1</span> = <span class="mxinfo " id="T72:U372"><span class="mxinfo " id="T5:U373">[<span class="var type1" id="S22T7U498">L1</span> <span class="var type1" id="S23T7U499">L2</span> <span class="var type1" id="S24T7U500">L3</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,137" id="srcline137">137</a></span><span class="line"><span class="mxinfo " id="T72:U377"><span class="var type1" id="S59T72U503">e1</span> = <span class="mxinfo " id="T72:U379"><span class="var type1" id="S59T72U505">e1</span>/<span class="mxinfo " id="T7:U381">norm(<span class="var type1" id="S59T72U508">e1</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,138" id="srcline138">138</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,139" id="srcline139">139</a></span><span class="line"><span class="mxinfo " id="T72:U383"><span class="var type1" id="S60T72U511">e2</span> = <span class="mxinfo " id="T72:U385"><span class="mxinfo " id="T72:U386"><span class="var type1" id="S50T73U514">R_bar</span>(<span class="mxinfo " id="T102:U388">:</span>,<span class="mxinfo " id="T49:U389">2</span>)</span> - <span class="mxinfo " id="T72:U390"><span class="mxinfo " id="T7:U391"><span class="mxinfo " id="T7:U392"><span class="mxinfo " id="T5:U393"><span class="mxinfo " id="T72:U394"><span class="var type1" id="S50T73U522">R_bar</span>(<span class="mxinfo " id="T102:U396">:</span>,<span class="mxinfo " id="T49:U397">2</span>)</span>'</span>*<span class="var type1" id="S59T72U525">e1</span></span>/<span class="mxinfo " id="T7:U399">2</span></span>*(<span class="mxinfo " id="T72:U400"><span class="mxinfo " id="T72:U401"><span class="var type1" id="S50T73U530">R_bar</span>(<span class="mxinfo " id="T102:U403">:</span>,<span class="mxinfo " id="T49:U404">1</span>)</span> + <span class="var type1" id="S59T72U533">e1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,140" id="srcline140">140</a></span><span class="line"><span class="comment">% e2 = R_bar(:,2) - R_bar(:,2)'*e1/(1 + R_bar(:,1)'*e1)*(R_bar(:,1) + e1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo " id="T72:U406"><span class="var type1" id="S60T72U536">e2</span> = <span class="mxinfo " id="T72:U408"><span class="var type1" id="S60T72U538">e2</span>/<span class="mxinfo " id="T7:U410">norm(<span class="var type1" id="S60T72U541">e2</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,142" id="srcline142">142</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,143" id="srcline143">143</a></span><span class="line"><span class="mxinfo " id="T72:U412"><span class="var type1" id="S61T72U544">e3</span> = <span class="mxinfo " id="T72:U414"><span class="mxinfo " id="T72:U415"><span class="var type1" id="S50T73U547">R_bar</span>(<span class="mxinfo " id="T102:U417">:</span>,<span class="mxinfo " id="T49:U418">3</span>)</span> - <span class="mxinfo " id="T72:U419"><span class="mxinfo " id="T7:U420"><span class="mxinfo " id="T7:U421"><span class="mxinfo " id="T5:U422"><span class="mxinfo " id="T72:U423"><span class="var type1" id="S50T73U555">R_bar</span>(<span class="mxinfo " id="T102:U425">:</span>,<span class="mxinfo " id="T49:U426">3</span>)</span>'</span>*<span class="var type1" id="S59T72U558">e1</span></span>/<span class="mxinfo " id="T7:U428">2</span></span>*(<span class="mxinfo " id="T72:U429"><span class="mxinfo " id="T72:U430"><span class="var type1" id="S50T73U563">R_bar</span>(<span class="mxinfo " id="T102:U432">:</span>,<span class="mxinfo " id="T49:U433">1</span>)</span> + <span class="var type1" id="S59T72U566">e1</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,144" id="srcline144">144</a></span><span class="line"><span class="comment">% e3 = R_bar(:,3) - R_bar(:,3)'*e1/(1 + R_bar(:,1)'*e1)*(R_bar(:,1) + e1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,145" id="srcline145">145</a></span><span class="line"><span class="mxinfo " id="T72:U435"><span class="var type1" id="S61T72U569">e3</span> = <span class="mxinfo " id="T72:U437"><span class="var type1" id="S61T72U571">e3</span>/<span class="mxinfo " id="T7:U439">norm(<span class="var type1" id="S61T72U574">e3</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,146" id="srcline146">146</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,147" id="srcline147">147</a></span><span class="line"><span class="comment">% E = [e1 e2 e3];</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,148" id="srcline148">148</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,149" id="srcline149">149</a></span><span class="line"><span class="comment">% Compute basic rotations</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,150" id="srcline150">150</a></span><span class="line"><span class="mxinfo " id="T7:U441"><span class="var type1" id="S62T7U577">phiI1</span> = <span class="mxinfo " id="T7:U443">asin(<span class="mxinfo " id="T7:U444">(<span class="mxinfo " id="T7:U445"><span class="mxinfo " id="T7:U446"><span class="mxinfo " id="T5:U447"><span class="var type1" id="S61T72U585">e3</span>'</span>*<span class="mxinfo " id="T72:U449"><span class="var type1" id="S47T73U587">NI</span>(<span class="mxinfo " id="T102:U451">:</span>,<span class="mxinfo " id="T49:U452">2</span>)</span></span> - <span class="mxinfo " id="T7:U453"><span class="mxinfo " id="T5:U454"><span class="var type1" id="S60T72U592">e2</span>'</span>*<span class="mxinfo " id="T72:U456"><span class="var type1" id="S47T73U594">NI</span>(<span class="mxinfo " id="T102:U458">:</span>,<span class="mxinfo " id="T49:U459">3</span>)</span></span></span>)/<span class="mxinfo " id="T7:U460">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,151" id="srcline151">151</a></span><span class="line"><span class="mxinfo " id="T7:U461"><span class="var type1" id="S64T7U600">phiI2</span> = <span class="mxinfo " id="T7:U463">asin(<span class="mxinfo " id="T7:U464">(<span class="mxinfo " id="T7:U465"><span class="mxinfo " id="T7:U466"><span class="mxinfo " id="T5:U467"><span class="var type1" id="S59T72U608">e1</span>'</span>*<span class="mxinfo " id="T72:U469"><span class="var type1" id="S47T73U610">NI</span>(<span class="mxinfo " id="T102:U471">:</span>,<span class="mxinfo " id="T49:U472">3</span>)</span></span> - <span class="mxinfo " id="T7:U473"><span class="mxinfo " id="T5:U474"><span class="var type1" id="S61T72U615">e3</span>'</span>*<span class="mxinfo " id="T72:U476"><span class="var type1" id="S47T73U617">NI</span>(<span class="mxinfo " id="T102:U478">:</span>,<span class="mxinfo " id="T49:U479">1</span>)</span></span></span>)/<span class="mxinfo " id="T7:U480">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,152" id="srcline152">152</a></span><span class="line"><span class="mxinfo " id="T7:U481"><span class="var type1" id="S65T7U623">phiI3</span> = <span class="mxinfo " id="T7:U483">asin(<span class="mxinfo " id="T7:U484">(<span class="mxinfo " id="T7:U485"><span class="mxinfo " id="T7:U486"><span class="mxinfo " id="T5:U487"><span class="var type1" id="S60T72U631">e2</span>'</span>*<span class="mxinfo " id="T72:U489"><span class="var type1" id="S47T73U633">NI</span>(<span class="mxinfo " id="T102:U491">:</span>,<span class="mxinfo " id="T49:U492">1</span>)</span></span> - <span class="mxinfo " id="T7:U493"><span class="mxinfo " id="T5:U494"><span class="var type1" id="S59T72U638">e1</span>'</span>*<span class="mxinfo " id="T72:U496"><span class="var type1" id="S47T73U640">NI</span>(<span class="mxinfo " id="T102:U498">:</span>,<span class="mxinfo " id="T49:U499">2</span>)</span></span></span>)/<span class="mxinfo " id="T7:U500">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,153" id="srcline153">153</a></span><span class="line"><span class="mxinfo " id="T7:U501"><span class="var type1" id="S66T7U646">phiJ1</span> = <span class="mxinfo " id="T7:U503">asin(<span class="mxinfo " id="T7:U504">(<span class="mxinfo " id="T7:U505"><span class="mxinfo " id="T7:U506"><span class="mxinfo " id="T5:U507"><span class="var type1" id="S61T72U654">e3</span>'</span>*<span class="mxinfo " id="T72:U509"><span class="var type1" id="S49T73U656">NJ</span>(<span class="mxinfo " id="T102:U511">:</span>,<span class="mxinfo " id="T49:U512">2</span>)</span></span> - <span class="mxinfo " id="T7:U513"><span class="mxinfo " id="T5:U514"><span class="var type1" id="S60T72U661">e2</span>'</span>*<span class="mxinfo " id="T72:U516"><span class="var type1" id="S49T73U663">NJ</span>(<span class="mxinfo " id="T102:U518">:</span>,<span class="mxinfo " id="T49:U519">3</span>)</span></span></span>)/<span class="mxinfo " id="T7:U520">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,154" id="srcline154">154</a></span><span class="line"><span class="mxinfo " id="T7:U521"><span class="var type1" id="S67T7U669">phiJ2</span> = <span class="mxinfo " id="T7:U523">asin(<span class="mxinfo " id="T7:U524">(<span class="mxinfo " id="T7:U525"><span class="mxinfo " id="T7:U526"><span class="mxinfo " id="T5:U527"><span class="var type1" id="S59T72U677">e1</span>'</span>*<span class="mxinfo " id="T72:U529"><span class="var type1" id="S49T73U679">NJ</span>(<span class="mxinfo " id="T102:U531">:</span>,<span class="mxinfo " id="T49:U532">3</span>)</span></span> - <span class="mxinfo " id="T7:U533"><span class="mxinfo " id="T5:U534"><span class="var type1" id="S61T72U684">e3</span>'</span>*<span class="mxinfo " id="T72:U536"><span class="var type1" id="S49T73U686">NJ</span>(<span class="mxinfo " id="T102:U538">:</span>,<span class="mxinfo " id="T49:U539">1</span>)</span></span></span>)/<span class="mxinfo " id="T7:U540">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,155" id="srcline155">155</a></span><span class="line"><span class="mxinfo " id="T7:U541"><span class="var type1" id="S68T7U692">phiJ3</span> = <span class="mxinfo " id="T7:U543">asin(<span class="mxinfo " id="T7:U544">(<span class="mxinfo " id="T7:U545"><span class="mxinfo " id="T7:U546"><span class="mxinfo " id="T5:U547"><span class="var type1" id="S60T72U700">e2</span>'</span>*<span class="mxinfo " id="T72:U549"><span class="var type1" id="S49T73U702">NJ</span>(<span class="mxinfo " id="T102:U551">:</span>,<span class="mxinfo " id="T49:U552">1</span>)</span></span> - <span class="mxinfo " id="T7:U553"><span class="mxinfo " id="T5:U554"><span class="var type1" id="S59T72U707">e1</span>'</span>*<span class="mxinfo " id="T72:U556"><span class="var type1" id="S49T73U709">NJ</span>(<span class="mxinfo " id="T102:U558">:</span>,<span class="mxinfo " id="T49:U559">2</span>)</span></span></span>)/<span class="mxinfo " id="T7:U560">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,156" id="srcline156">156</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,157" id="srcline157">157</a></span><span class="line"><span class="comment">% Basic displacements and rotations</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,158" id="srcline158">158</a></span><span class="line"><span class="comment">% D = [ul r1z r2z r1y r2y rx]'</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,159" id="srcline159">159</a></span><span class="line"><span class="mxinfo " id="T22:U561"><span class="var type1" id="S69T22U715">D</span> = <span class="mxinfo " id="T22:U563">zeros(6,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,160" id="srcline160">160</a></span><span class="line"><span class="mxinfo " id="T7:U564"><span class="mxinfo " id="T7:U565"><span class="var type1" id="S69T22U723">D</span>(<span class="mxinfo " id="T49:U567">1</span>)</span> = <span class="mxinfo " id="T7:U568">(<span class="mxinfo " id="T7:U569"><span class="mxinfo " id="T7:U570"><span class="var type1" id="S25T7U729">L</span>^2</span> - <span class="mxinfo " id="T7:U572"><span class="var type1" id="S20T7U732">L0</span>^2</span></span>)/(<span class="mxinfo " id="T7:U574"><span class="var type1" id="S25T7U736">L</span> + <span class="var type1" id="S20T7U737">L0</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,161" id="srcline161">161</a></span><span class="line"><span class="mxinfo " id="T7:U577"><span class="mxinfo " id="T7:U578"><span class="var type1" id="S69T22U741">D</span>(<span class="mxinfo " id="T49:U580">2</span>)</span> = <span class="var type1" id="S65T7U743">phiI3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,162" id="srcline162">162</a></span><span class="line"><span class="mxinfo " id="T7:U582"><span class="mxinfo " id="T7:U583"><span class="var type1" id="S69T22U747">D</span>(<span class="mxinfo " id="T49:U585">3</span>)</span> = <span class="var type1" id="S68T7U749">phiJ3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,163" id="srcline163">163</a></span><span class="line"><span class="mxinfo " id="T7:U587"><span class="mxinfo " id="T7:U588"><span class="var type1" id="S69T22U753">D</span>(<span class="mxinfo " id="T49:U590">4</span>)</span> = <span class="var type1" id="S64T7U755">phiI2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,164" id="srcline164">164</a></span><span class="line"><span class="mxinfo " id="T7:U592"><span class="mxinfo " id="T7:U593"><span class="var type1" id="S69T22U759">D</span>(<span class="mxinfo " id="T49:U595">5</span>)</span> = <span class="var type1" id="S67T7U761">phiJ2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,165" id="srcline165">165</a></span><span class="line"><span class="mxinfo " id="T7:U597"><span class="mxinfo " id="T7:U598"><span class="var type1" id="S69T22U765">D</span>(<span class="mxinfo " id="T49:U600">6</span>)</span> = <span class="mxinfo " id="T7:U601"><span class="var type1" id="S66T7U768">phiJ1</span> - <span class="var type1" id="S62T7U769">phiI1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,166" id="srcline166">166</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,167" id="srcline167">167</a></span><span class="line"><span class="comment">% Transformation matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,168" id="srcline168">168</a></span><span class="line"><span class="mxinfo " id="T73:U604"><span class="var type1" id="S71T73U772">A</span> = <span class="mxinfo " id="T73:U606"><span class="mxinfo " id="T7:U607"><span class="mxinfo " id="T7:U608">1</span>/<span class="var type1" id="S25T7U776">L</span></span>*(<span class="mxinfo " id="T73:U610"><span class="mxinfo " id="T73:U611">eye(3)</span> - <span class="mxinfo " id="T73:U612"><span class="var type1" id="S59T72U783">e1</span>*<span class="mxinfo " id="T5:U614"><span class="var type1" id="S59T72U785">e1</span>'</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,169" id="srcline169">169</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,170" id="srcline170">170</a></span><span class="line"><span class="comment">% Get L matrices</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,171" id="srcline171">171</a></span><span class="line"><span class="mxinfo " id="T162:U616"><span class="var type1" id="S73T162U788">L_r2</span> = <span class="mxinfo " id="T162:U618"><span class="fcn" id="F838N16:B790">get_L</span>(<span class="mxinfo " id="T72:U619"><span class="var type1" id="S50T73U792">R_bar</span>(<span class="mxinfo " id="T102:U621">:</span>,<span class="mxinfo " id="T49:U622">2</span>)</span>,<span class="var type1" id="S59T72U795">e1</span>,<span class="var type1" id="S25T7U796">L</span>,<span class="mxinfo " id="T72:U625"><span class="var type1" id="S50T73U798">R_bar</span>(<span class="mxinfo " id="T102:U627">:</span>,<span class="mxinfo " id="T49:U628">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,172" id="srcline172">172</a></span><span class="line"><span class="mxinfo " id="T162:U629"><span class="var type1" id="S75T162U803">L_r3</span> = <span class="mxinfo " id="T162:U631"><span class="fcn" id="F838N16:B805">get_L</span>(<span class="mxinfo " id="T72:U632"><span class="var type1" id="S50T73U807">R_bar</span>(<span class="mxinfo " id="T102:U634">:</span>,<span class="mxinfo " id="T49:U635">3</span>)</span>,<span class="var type1" id="S59T72U810">e1</span>,<span class="var type1" id="S25T7U811">L</span>,<span class="mxinfo " id="T72:U638"><span class="var type1" id="S50T73U813">R_bar</span>(<span class="mxinfo " id="T102:U640">:</span>,<span class="mxinfo " id="T49:U641">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,173" id="srcline173">173</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,174" id="srcline174">174</a></span><span class="line"><span class="comment">% Get h vectors</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,175" id="srcline175">175</a></span><span class="line"><span class="mxinfo " id="T73:U642"><span class="var type1" id="S76T73U818">S_nI1</span> = <span class="mxinfo " id="T73:U644"><span class="fcn" id="F223N19:B820">get_S</span>(<span class="mxinfo " id="T72:U645"><span class="var type1" id="S47T73U822">NI</span>(<span class="mxinfo " id="T102:U647">:</span>,<span class="mxinfo " id="T49:U648">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,176" id="srcline176">176</a></span><span class="line"><span class="mxinfo " id="T73:U649"><span class="var type1" id="S78T73U827">S_nI2</span> = <span class="mxinfo " id="T73:U651"><span class="fcn" id="F223N19:B829">get_S</span>(<span class="mxinfo " id="T72:U652"><span class="var type1" id="S47T73U831">NI</span>(<span class="mxinfo " id="T102:U654">:</span>,<span class="mxinfo " id="T49:U655">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,177" id="srcline177">177</a></span><span class="line"><span class="mxinfo " id="T73:U656"><span class="var type1" id="S79T73U836">S_nI3</span> = <span class="mxinfo " id="T73:U658"><span class="fcn" id="F223N19:B838">get_S</span>(<span class="mxinfo " id="T72:U659"><span class="var type1" id="S47T73U840">NI</span>(<span class="mxinfo " id="T102:U661">:</span>,<span class="mxinfo " id="T49:U662">3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,178" id="srcline178">178</a></span><span class="line"><span class="mxinfo " id="T73:U663"><span class="var type1" id="S80T73U845">S_nJ1</span> = <span class="mxinfo " id="T73:U665"><span class="fcn" id="F223N19:B847">get_S</span>(<span class="mxinfo " id="T72:U666"><span class="var type1" id="S49T73U849">NJ</span>(<span class="mxinfo " id="T102:U668">:</span>,<span class="mxinfo " id="T49:U669">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,179" id="srcline179">179</a></span><span class="line"><span class="mxinfo " id="T73:U670"><span class="var type1" id="S81T73U854">S_nJ2</span> = <span class="mxinfo " id="T73:U672"><span class="fcn" id="F223N19:B856">get_S</span>(<span class="mxinfo " id="T72:U673"><span class="var type1" id="S49T73U858">NJ</span>(<span class="mxinfo " id="T102:U675">:</span>,<span class="mxinfo " id="T49:U676">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,180" id="srcline180">180</a></span><span class="line"><span class="mxinfo " id="T73:U677"><span class="var type1" id="S82T73U863">S_nJ3</span> = <span class="mxinfo " id="T73:U679"><span class="fcn" id="F223N19:B865">get_S</span>(<span class="mxinfo " id="T72:U680"><span class="var type1" id="S49T73U867">NJ</span>(<span class="mxinfo " id="T102:U682">:</span>,<span class="mxinfo " id="T49:U683">3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,181" id="srcline181">181</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,182" id="srcline182">182</a></span><span class="line"><span class="mxinfo " id="T36:U684"><span class="var type1" id="S83T36U872">hI1</span> = <span class="mxinfo " id="T36:U686"><span class="mxinfo " id="T40:U687">[<span class="mxinfo " id="T7:U688">0</span> <span class="mxinfo " id="T7:U689">0</span> <span class="mxinfo " id="T7:U690">0</span> <span class="mxinfo " id="T5:U691">(<span class="mxinfo " id="T72:U692"><span class="mxinfo " id="T72:U693"><span class="var type1" id="S78T73U883">S_nI2</span>*<span class="var type1" id="S61T72U884">e3</span></span> - <span class="mxinfo " id="T72:U696"><span class="var type1" id="S79T73U886">S_nI3</span>*<span class="var type1" id="S60T72U887">e2</span></span></span>)'</span> <span class="mxinfo " id="T7:U699">0</span> <span class="mxinfo " id="T7:U700">0</span> <span class="mxinfo " id="T7:U701">0</span> <span class="mxinfo " id="T7:U702">0</span> <span class="mxinfo " id="T7:U703">0</span> <span class="mxinfo " id="T7:U704">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,183" id="srcline183">183</a></span><span class="line"><span class="mxinfo " id="T36:U705"><span class="var type1" id="S84T36U896">hI2</span> = <span class="mxinfo " id="T36:U707"><span class="mxinfo " id="T40:U708">[<span class="mxinfo " id="T5:U709">(<span class="mxinfo " id="T72:U710"><span class="var type1" id="S71T73U903">A</span>*<span class="mxinfo " id="T72:U712"><span class="var type1" id="S47T73U905">NI</span>(<span class="mxinfo " id="T102:U714">:</span>,<span class="mxinfo " id="T49:U715">3</span>)</span></span>)'</span> <span class="mxinfo " id="T5:U716">(<span class="mxinfo " id="T72:U717"><span class="mxinfo " id="T72:U718"><span class="var type1" id="S76T73U912">S_nI1</span>*<span class="var type1" id="S61T72U913">e3</span></span> - <span class="mxinfo " id="T72:U721"><span class="var type1" id="S79T73U915">S_nI3</span>*<span class="var type1" id="S59T72U916">e1</span></span></span>)'</span> <span class="mxinfo " id="T5:U724">-<span class="mxinfo " id="T5:U725">(<span class="mxinfo " id="T72:U726"><span class="var type1" id="S71T73U921">A</span>*<span class="mxinfo " id="T72:U728"><span class="var type1" id="S47T73U923">NI</span>(<span class="mxinfo " id="T102:U730">:</span>,<span class="mxinfo " id="T49:U731">3</span>)</span></span>)'</span></span> <span class="mxinfo " id="T7:U732">0</span> <span class="mxinfo " id="T7:U733">0</span> <span class="mxinfo " id="T7:U734">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,184" id="srcline184">184</a></span><span class="line"><span class="mxinfo " id="T36:U735"><span class="var type1" id="S85T36U931">hI3</span> = <span class="mxinfo " id="T36:U737"><span class="mxinfo " id="T40:U738">[<span class="mxinfo " id="T5:U739">(<span class="mxinfo " id="T72:U740"><span class="var type1" id="S71T73U938">A</span>*<span class="mxinfo " id="T72:U742"><span class="var type1" id="S47T73U940">NI</span>(<span class="mxinfo " id="T102:U744">:</span>,<span class="mxinfo " id="T49:U745">2</span>)</span></span>)'</span> <span class="mxinfo " id="T5:U746">(<span class="mxinfo " id="T72:U747"><span class="mxinfo " id="T72:U748"><span class="var type1" id="S76T73U947">S_nI1</span>*<span class="var type1" id="S60T72U948">e2</span></span> - <span class="mxinfo " id="T72:U751"><span class="var type1" id="S78T73U950">S_nI2</span>*<span class="var type1" id="S59T72U951">e1</span></span></span>)'</span> <span class="mxinfo " id="T5:U754">-<span class="mxinfo " id="T5:U755">(<span class="mxinfo " id="T72:U756"><span class="var type1" id="S71T73U956">A</span>*<span class="mxinfo " id="T72:U758"><span class="var type1" id="S47T73U958">NI</span>(<span class="mxinfo " id="T102:U760">:</span>,<span class="mxinfo " id="T49:U761">2</span>)</span></span>)'</span></span> <span class="mxinfo " id="T7:U762">0</span> <span class="mxinfo " id="T7:U763">0</span> <span class="mxinfo " id="T7:U764">0</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,185" id="srcline185">185</a></span><span class="line"><span class="mxinfo " id="T36:U765"><span class="var type1" id="S86T36U966">hJ1</span> = <span class="mxinfo " id="T36:U767"><span class="mxinfo " id="T40:U768">[<span class="mxinfo " id="T7:U769">0</span> <span class="mxinfo " id="T7:U770">0</span> <span class="mxinfo " id="T7:U771">0</span> <span class="mxinfo " id="T7:U772">0</span> <span class="mxinfo " id="T7:U773">0</span> <span class="mxinfo " id="T7:U774">0</span> <span class="mxinfo " id="T7:U775">0</span> <span class="mxinfo " id="T7:U776">0</span> <span class="mxinfo " id="T7:U777">0</span> <span class="mxinfo " id="T5:U778">(<span class="mxinfo " id="T72:U779"><span class="mxinfo " id="T72:U780"><span class="var type1" id="S81T73U983">S_nJ2</span>*<span class="var type1" id="S61T72U984">e3</span></span> - <span class="mxinfo " id="T72:U783"><span class="var type1" id="S82T73U986">S_nJ3</span>*<span class="var type1" id="S60T72U987">e2</span></span></span>)'</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,186" id="srcline186">186</a></span><span class="line"><span class="mxinfo " id="T36:U786"><span class="var type1" id="S87T36U990">hJ2</span> = <span class="mxinfo " id="T36:U788"><span class="mxinfo " id="T40:U789">[<span class="mxinfo " id="T5:U790">(<span class="mxinfo " id="T72:U791"><span class="var type1" id="S71T73U997">A</span>*<span class="mxinfo " id="T72:U793"><span class="var type1" id="S49T73U999">NJ</span>(<span class="mxinfo " id="T102:U795">:</span>,<span class="mxinfo " id="T49:U796">3</span>)</span></span>)'</span> <span class="mxinfo " id="T7:U797">0</span> <span class="mxinfo " id="T7:U798">0</span> <span class="mxinfo " id="T7:U799">0</span> <span class="mxinfo " id="T5:U800">-<span class="mxinfo " id="T5:U801">(<span class="mxinfo " id="T72:U802"><span class="var type1" id="S71T73U1009">A</span>*<span class="mxinfo " id="T72:U804"><span class="var type1" id="S49T73U1011">NJ</span>(<span class="mxinfo " id="T102:U806">:</span>,<span class="mxinfo " id="T49:U807">3</span>)</span></span>)'</span></span> <span class="mxinfo " id="T5:U808">(<span class="mxinfo " id="T72:U809"><span class="mxinfo " id="T72:U810"><span class="var type1" id="S80T73U1018">S_nJ1</span>*<span class="var type1" id="S61T72U1019">e3</span></span> - <span class="mxinfo " id="T72:U813"><span class="var type1" id="S82T73U1021">S_nJ3</span>*<span class="var type1" id="S59T72U1022">e1</span></span></span>)'</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,187" id="srcline187">187</a></span><span class="line"><span class="mxinfo " id="T36:U816"><span class="var type1" id="S88T36U1025">hJ3</span> = <span class="mxinfo " id="T36:U818"><span class="mxinfo " id="T40:U819">[<span class="mxinfo " id="T5:U820">(<span class="mxinfo " id="T72:U821"><span class="var type1" id="S71T73U1032">A</span>*<span class="mxinfo " id="T72:U823"><span class="var type1" id="S49T73U1034">NJ</span>(<span class="mxinfo " id="T102:U825">:</span>,<span class="mxinfo " id="T49:U826">2</span>)</span></span>)'</span> <span class="mxinfo " id="T7:U827">0</span> <span class="mxinfo " id="T7:U828">0</span> <span class="mxinfo " id="T7:U829">0</span> <span class="mxinfo " id="T5:U830">-<span class="mxinfo " id="T5:U831">(<span class="mxinfo " id="T72:U832"><span class="var type1" id="S71T73U1044">A</span>*<span class="mxinfo " id="T72:U834"><span class="var type1" id="S49T73U1046">NJ</span>(<span class="mxinfo " id="T102:U836">:</span>,<span class="mxinfo " id="T49:U837">2</span>)</span></span>)'</span></span> <span class="mxinfo " id="T5:U838">(<span class="mxinfo " id="T72:U839"><span class="mxinfo " id="T72:U840"><span class="var type1" id="S80T73U1053">S_nJ1</span>*<span class="var type1" id="S60T72U1054">e2</span></span> - <span class="mxinfo " id="T72:U843"><span class="var type1" id="S81T73U1056">S_nJ2</span>*<span class="var type1" id="S59T72U1057">e1</span></span></span>)'</span>]</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,188" id="srcline188">188</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,189" id="srcline189">189</a></span><span class="line"><span class="comment">% Get t vectors and T matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,190" id="srcline190">190</a></span><span class="line"><span class="mxinfo " id="T40:U846"><span class="var type1" id="S89T40U1060">t1</span> = <span class="mxinfo " id="T40:U848">[<span class="mxinfo " id="T5:U849">-<span class="mxinfo " id="T5:U850"><span class="var type1" id="S59T72U1065">e1</span>'</span></span> <span class="mxinfo " id="T7:U852">0</span> <span class="mxinfo " id="T7:U853">0</span> <span class="mxinfo " id="T7:U854">0</span> <span class="mxinfo " id="T5:U855"><span class="var type1" id="S59T72U1070">e1</span>'</span> <span class="mxinfo " id="T7:U857">0</span> <span class="mxinfo " id="T7:U858">0</span> <span class="mxinfo " id="T7:U859">0</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,191" id="srcline191">191</a></span><span class="line"><span class="mxinfo " id="T40:U860"><span class="var type1" id="S90T40U1076">t2</span> = <span class="mxinfo " id="T40:U862"><span class="mxinfo " id="T7:U863"><span class="mxinfo " id="T7:U864">1</span>/(<span class="mxinfo " id="T7:U865"><span class="mxinfo " id="T7:U866">2</span>*<span class="mxinfo " id="T7:U867">cos(<span class="var type1" id="S65T7U1085">phiI3</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U869">(<span class="mxinfo " id="T36:U870"><span class="mxinfo " id="T36:U871"><span class="var type1" id="S73T162U1090">L_r2</span>*<span class="mxinfo " id="T72:U873"><span class="var type1" id="S47T73U1092">NI</span>(<span class="mxinfo " id="T102:U875">:</span>,<span class="mxinfo " id="T49:U876">1</span>)</span></span> + <span class="var type1" id="S85T36U1095">hI3</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,192" id="srcline192">192</a></span><span class="line"><span class="mxinfo " id="T40:U878"><span class="var type1" id="S92T40U1098">t3</span> = <span class="mxinfo " id="T40:U880"><span class="mxinfo " id="T7:U881"><span class="mxinfo " id="T7:U882">1</span>/(<span class="mxinfo " id="T7:U883"><span class="mxinfo " id="T7:U884">2</span>*<span class="mxinfo " id="T7:U885">cos(<span class="var type1" id="S68T7U1107">phiJ3</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U887">(<span class="mxinfo " id="T36:U888"><span class="mxinfo " id="T36:U889"><span class="var type1" id="S73T162U1112">L_r2</span>*<span class="mxinfo " id="T72:U891"><span class="var type1" id="S49T73U1114">NJ</span>(<span class="mxinfo " id="T102:U893">:</span>,<span class="mxinfo " id="T49:U894">1</span>)</span></span> + <span class="var type1" id="S88T36U1117">hJ3</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,193" id="srcline193">193</a></span><span class="line"><span class="mxinfo " id="T40:U896"><span class="var type1" id="S93T40U1120">t4</span> = <span class="mxinfo " id="T40:U898"><span class="mxinfo " id="T7:U899"><span class="mxinfo " id="T7:U900">1</span>/(<span class="mxinfo " id="T7:U901"><span class="mxinfo " id="T7:U902">2</span>*<span class="mxinfo " id="T7:U903">cos(<span class="var type1" id="S64T7U1129">phiI2</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U905">(<span class="mxinfo " id="T36:U906"><span class="mxinfo " id="T36:U907"><span class="mxinfo " id="T162:U908">-<span class="var type1" id="S75T162U1135">L_r3</span></span>*<span class="mxinfo " id="T72:U910"><span class="var type1" id="S47T73U1137">NI</span>(<span class="mxinfo " id="T102:U912">:</span>,<span class="mxinfo " id="T49:U913">1</span>)</span></span> - <span class="var type1" id="S84T36U1140">hI2</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,194" id="srcline194">194</a></span><span class="line"><span class="mxinfo " id="T40:U915"><span class="var type1" id="S94T40U1143">t5</span> = <span class="mxinfo " id="T40:U917"><span class="mxinfo " id="T7:U918"><span class="mxinfo " id="T7:U919">1</span>/(<span class="mxinfo " id="T7:U920"><span class="mxinfo " id="T7:U921">2</span>*<span class="mxinfo " id="T7:U922">cos(<span class="var type1" id="S67T7U1152">phiJ2</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U924">(<span class="mxinfo " id="T36:U925"><span class="mxinfo " id="T36:U926"><span class="mxinfo " id="T162:U927">-<span class="var type1" id="S75T162U1158">L_r3</span></span>*<span class="mxinfo " id="T72:U929"><span class="var type1" id="S49T73U1160">NJ</span>(<span class="mxinfo " id="T102:U931">:</span>,<span class="mxinfo " id="T49:U932">1</span>)</span></span> - <span class="var type1" id="S87T36U1163">hJ2</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,195" id="srcline195">195</a></span><span class="line"><span class="mxinfo " id="T40:U934"><span class="var type1" id="S95T40U1166">t6J</span> = <span class="mxinfo " id="T40:U936"><span class="mxinfo " id="T7:U937"><span class="mxinfo " id="T7:U938">1</span>/(<span class="mxinfo " id="T7:U939"><span class="mxinfo " id="T7:U940">2</span>*<span class="mxinfo " id="T7:U941">cos(<span class="var type1" id="S66T7U1175">phiJ1</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U943">(<span class="mxinfo " id="T36:U944"><span class="mxinfo " id="T36:U945"><span class="mxinfo " id="T36:U946"><span class="var type1" id="S75T162U1181">L_r3</span>*<span class="mxinfo " id="T72:U948"><span class="var type1" id="S49T73U1183">NJ</span>(<span class="mxinfo " id="T102:U950">:</span>,<span class="mxinfo " id="T49:U951">2</span>)</span></span> - <span class="mxinfo " id="T36:U952"><span class="var type1" id="S73T162U1187">L_r2</span>*<span class="mxinfo " id="T72:U954"><span class="var type1" id="S49T73U1189">NJ</span>(<span class="mxinfo " id="T102:U956">:</span>,<span class="mxinfo " id="T49:U957">3</span>)</span></span></span> + <span class="var type1" id="S86T36U1192">hJ1</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,196" id="srcline196">196</a></span><span class="line"><span class="mxinfo " id="T40:U959"><span class="var type1" id="S96T40U1195">t6I</span> = <span class="mxinfo " id="T40:U961"><span class="mxinfo " id="T7:U962"><span class="mxinfo " id="T7:U963">1</span>/(<span class="mxinfo " id="T7:U964"><span class="mxinfo " id="T7:U965">2</span>*<span class="mxinfo " id="T7:U966">cos(<span class="var type1" id="S62T7U1204">phiI1</span>)</span></span>)</span>*<span class="mxinfo " id="T40:U968">(<span class="mxinfo " id="T36:U969"><span class="mxinfo " id="T36:U970"><span class="mxinfo " id="T36:U971"><span class="var type1" id="S75T162U1210">L_r3</span>*<span class="mxinfo " id="T72:U973"><span class="var type1" id="S47T73U1212">NI</span>(<span class="mxinfo " id="T102:U975">:</span>,<span class="mxinfo " id="T49:U976">2</span>)</span></span> - <span class="mxinfo " id="T36:U977"><span class="var type1" id="S73T162U1216">L_r2</span>*<span class="mxinfo " id="T72:U979"><span class="var type1" id="S47T73U1218">NI</span>(<span class="mxinfo " id="T102:U981">:</span>,<span class="mxinfo " id="T49:U982">3</span>)</span></span></span> + <span class="var type1" id="S83T36U1221">hI1</span></span>)'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,197" id="srcline197">197</a></span><span class="line"><span class="mxinfo " id="T40:U984"><span class="var type1" id="S97T40U1224">t6</span> = <span class="mxinfo " id="T40:U986"><span class="var type1" id="S95T40U1226">t6J</span> - <span class="var type1" id="S96T40U1227">t6I</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,198" id="srcline198">198</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,199" id="srcline199">199</a></span><span class="line"><span class="mxinfo " id="T166:U989"><span class="var type1" id="S98T166U1230">T</span> = <span class="mxinfo " id="T166:U991">[<span class="var type1" id="S89T40U1233">t1</span>; <span class="var type1" id="S90T40U1235">t2</span>; <span class="var type1" id="S92T40U1237">t3</span>; <span class="var type1" id="S93T40U1239">t4</span>; <span class="var type1" id="S94T40U1241">t5</span>; <span class="var type1" id="S97T40U1243">t6</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,200" id="srcline200">200</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,201" id="srcline201">201</a></span><span class="line"><span class="comment">% Linear stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,202" id="srcline202">202</a></span><span class="line"><span class="mxinfo " id="T163:U998"><span class="var type1" id="S99T163U1246">k</span> = <span class="mxinfo " id="T163:U1000"><span class="fcn" id="F953N23:B1248">k1</span>(<span class="var type1" id="S12T8U1249">mat</span>,<span class="var type1" id="S13T9U1250">geom</span>,<span class="var type1" id="S20T7U1251">L0</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,203" id="srcline203">203</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,204" id="srcline204">204</a></span><span class="line"><span class="comment">% Condense into relevant entries for corotational formulation</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,205" id="srcline205">205</a></span><span class="line"><span class="mxinfo " id="T165:U1004"><span class="var type1" id="S99T165U1254">k</span> = <span class="mxinfo " id="T165:U1006">[<span class="mxinfo " id="T36:U1007"><span class="var type1" id="S99T163U1258">k</span>(<span class="mxinfo " id="T37:U1009">:</span>,<span class="mxinfo " id="T49:U1010">1</span>)</span> <span class="mxinfo " id="T36:U1011"><span class="var type1" id="S99T163U1262">k</span>(<span class="mxinfo " id="T37:U1013">:</span>,<span class="mxinfo " id="T49:U1014">6</span>)</span> <span class="mxinfo " id="T36:U1015"><span class="var type1" id="S99T163U1266">k</span>(<span class="mxinfo " id="T37:U1017">:</span>,<span class="mxinfo " id="T49:U1018">12</span>)</span> <span class="mxinfo " id="T36:U1019"><span class="var type1" id="S99T163U1270">k</span>(<span class="mxinfo " id="T37:U1021">:</span>,<span class="mxinfo " id="T49:U1022">5</span>)</span> <span class="mxinfo " id="T36:U1023"><span class="var type1" id="S99T163U1274">k</span>(<span class="mxinfo " id="T37:U1025">:</span>,<span class="mxinfo " id="T49:U1026">11</span>)</span> <span class="mxinfo " id="T36:U1027"><span class="var type1" id="S99T163U1278">k</span>(<span class="mxinfo " id="T37:U1029">:</span>,<span class="mxinfo " id="T49:U1030">4</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,206" id="srcline206">206</a></span><span class="line"><span class="mxinfo " id="T15:U1031"><span class="var type1" id="S101T15U1283">KL</span> = <span class="mxinfo " id="T15:U1033">[<span class="mxinfo " id="T110:U1034"><span class="var type1" id="S99T165U1287">k</span>(<span class="mxinfo " id="T49:U1036">1</span>,<span class="mxinfo " id="T172:U1037">:</span>)</span> <span class="comment">% [u1x r1z r2z r1y r2y r1x]</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,207" id="srcline207">207</a></span><span class="line">    <span class="mxinfo " id="T110:U1038"><span class="var type1" id="S99T165U1292">k</span>(<span class="mxinfo " id="T49:U1040">6</span>,<span class="mxinfo " id="T172:U1041">:</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,208" id="srcline208">208</a></span><span class="line">    <span class="mxinfo " id="T110:U1042"><span class="var type1" id="S99T165U1297">k</span>(<span class="mxinfo " id="T49:U1044">12</span>,<span class="mxinfo " id="T172:U1045">:</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,209" id="srcline209">209</a></span><span class="line">    <span class="mxinfo " id="T110:U1046"><span class="var type1" id="S99T165U1302">k</span>(<span class="mxinfo " id="T49:U1048">5</span>,<span class="mxinfo " id="T172:U1049">:</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,210" id="srcline210">210</a></span><span class="line">    <span class="mxinfo " id="T110:U1050"><span class="var type1" id="S99T165U1307">k</span>(<span class="mxinfo " id="T49:U1052">11</span>,<span class="mxinfo " id="T172:U1053">:</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,211" id="srcline211">211</a></span><span class="line">    <span class="mxinfo " id="T110:U1054"><span class="var type1" id="S99T165U1312">k</span>(<span class="mxinfo " id="T49:U1056">4</span>,<span class="mxinfo " id="T172:U1057">:</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,212" id="srcline212">212</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,213" id="srcline213">213</a></span><span class="line"><span class="mxinfo " id="T22:U1058"><span class="var type1" id="S102T22U1317">P</span> = <span class="mxinfo " id="T22:U1060"><span class="var type1" id="S101T15U1319">KL</span>*<span class="var type1" id="S69T22U1320">D</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,214" id="srcline214">214</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,215" id="srcline215">215</a></span><span class="line"><span class="comment">% Internal forces in local coordinate system</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,216" id="srcline216">216</a></span><span class="line"><span class="mxinfo " id="T36:U1063"><span class="var type1" id="S3T36U1323">fint_i</span> = <span class="mxinfo " id="T36:U1065">[<span class="mxinfo " id="T7:U1066">-<span class="mxinfo " id="T7:U1067"><span class="var type1" id="S102T22U1328">P</span>(<span class="mxinfo " id="T49:U1069">1</span>)</span></span>       <span class="comment">% Vx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,217" id="srcline217">217</a></span><span class="line">    <span class="mxinfo " id="T7:U1070">(<span class="mxinfo " id="T7:U1071"><span class="mxinfo " id="T7:U1072"><span class="var type1" id="S102T22U1335">P</span>(<span class="mxinfo " id="T49:U1074">3</span>)</span> + <span class="mxinfo " id="T7:U1075"><span class="var type1" id="S102T22U1338">P</span>(<span class="mxinfo " id="T7:U1077">2</span>)</span></span>)/<span class="var type1" id="S25T7U1340">L</span></span>   <span class="comment">% Vy1</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,218" id="srcline218">218</a></span><span class="line">    <span class="mxinfo " id="T7:U1079"><span class="mxinfo " id="T7:U1080">-(<span class="mxinfo " id="T7:U1081"><span class="mxinfo " id="T7:U1082"><span class="var type1" id="S102T22U1347">P</span>(<span class="mxinfo " id="T49:U1084">5</span>)</span> + <span class="mxinfo " id="T7:U1085"><span class="var type1" id="S102T22U1350">P</span>(<span class="mxinfo " id="T7:U1087">4</span>)</span></span>)</span>/<span class="var type1" id="S25T7U1352">L</span></span>  <span class="comment">% Vz1</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,219" id="srcline219">219</a></span><span class="line">    <span class="mxinfo " id="T7:U1089">-<span class="mxinfo " id="T7:U1090"><span class="var type1" id="S102T22U1356">P</span>(<span class="mxinfo " id="T49:U1092">6</span>)</span></span>             <span class="comment">% Mx1</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,220" id="srcline220">220</a></span><span class="line">    <span class="mxinfo " id="T7:U1093"><span class="var type1" id="S102T22U1360">P</span>(<span class="mxinfo " id="T49:U1095">4</span>)</span>              <span class="comment">% My1</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,221" id="srcline221">221</a></span><span class="line">    <span class="mxinfo " id="T7:U1096"><span class="var type1" id="S102T22U1364">P</span>(<span class="mxinfo " id="T49:U1098">2</span>)</span>              <span class="comment">% Mz1</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,222" id="srcline222">222</a></span><span class="line">    <span class="mxinfo " id="T7:U1099"><span class="var type1" id="S102T22U1368">P</span>(<span class="mxinfo " id="T49:U1101">1</span>)</span>              <span class="comment">% Vx2</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,223" id="srcline223">223</a></span><span class="line">    <span class="mxinfo " id="T7:U1102"><span class="mxinfo " id="T7:U1103">-(<span class="mxinfo " id="T7:U1104"><span class="mxinfo " id="T7:U1105"><span class="var type1" id="S102T22U1376">P</span>(<span class="mxinfo " id="T49:U1107">3</span>)</span> + <span class="mxinfo " id="T7:U1108"><span class="var type1" id="S102T22U1379">P</span>(<span class="mxinfo " id="T7:U1110">2</span>)</span></span>)</span>/<span class="var type1" id="S25T7U1381">L</span></span>  <span class="comment">% Vy2</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,224" id="srcline224">224</a></span><span class="line">    <span class="mxinfo " id="T7:U1112">(<span class="mxinfo " id="T7:U1113"><span class="mxinfo " id="T7:U1114"><span class="var type1" id="S102T22U1387">P</span>(<span class="mxinfo " id="T49:U1116">5</span>)</span> + <span class="mxinfo " id="T7:U1117"><span class="var type1" id="S102T22U1390">P</span>(<span class="mxinfo " id="T7:U1119">4</span>)</span></span>)/<span class="var type1" id="S25T7U1392">L</span></span>   <span class="comment">% Vz2</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,225" id="srcline225">225</a></span><span class="line">    <span class="mxinfo " id="T7:U1121"><span class="var type1" id="S102T22U1395">P</span>(<span class="mxinfo " id="T49:U1123">6</span>)</span>              <span class="comment">% Mx2</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,226" id="srcline226">226</a></span><span class="line">    <span class="mxinfo " id="T7:U1124"><span class="var type1" id="S102T22U1399">P</span>(<span class="mxinfo " id="T49:U1126">5</span>)</span>              <span class="comment">% My2</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,227" id="srcline227">227</a></span><span class="line">    <span class="mxinfo " id="T7:U1127"><span class="var type1" id="S102T22U1403">P</span>(<span class="mxinfo " id="T49:U1129">3</span>)</span>]</span></span>;            <span class="comment">% Mz2</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,228" id="srcline228">228</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,229" id="srcline229">229</a></span><span class="line"><span class="comment">% Scaled internal forces</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,230" id="srcline230">230</a></span><span class="line"><span class="mxinfo " id="T7:U1130"><span class="var type1" id="S103T7U1407">m2</span> = <span class="mxinfo " id="T7:U1132"><span class="mxinfo " id="T7:U1133"><span class="var type1" id="S102T22U1410">P</span>(<span class="mxinfo " id="T49:U1135">2</span>)</span>/(<span class="mxinfo " id="T7:U1136"><span class="mxinfo " id="T7:U1137">2</span>*<span class="mxinfo " id="T7:U1138">cos(<span class="var type1" id="S65T7U1417">phiI3</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,231" id="srcline231">231</a></span><span class="line"><span class="mxinfo " id="T7:U1140"><span class="var type1" id="S104T7U1420">m3</span> = <span class="mxinfo " id="T7:U1142"><span class="mxinfo " id="T7:U1143"><span class="var type1" id="S102T22U1423">P</span>(<span class="mxinfo " id="T49:U1145">3</span>)</span>/(<span class="mxinfo " id="T7:U1146"><span class="mxinfo " id="T7:U1147">2</span>*<span class="mxinfo " id="T7:U1148">cos(<span class="var type1" id="S68T7U1430">phiJ3</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,232" id="srcline232">232</a></span><span class="line"><span class="mxinfo " id="T7:U1150"><span class="var type1" id="S105T7U1433">m4</span> = <span class="mxinfo " id="T7:U1152"><span class="mxinfo " id="T7:U1153"><span class="var type1" id="S102T22U1436">P</span>(<span class="mxinfo " id="T49:U1155">4</span>)</span>/(<span class="mxinfo " id="T7:U1156"><span class="mxinfo " id="T7:U1157">2</span>*<span class="mxinfo " id="T7:U1158">cos(<span class="var type1" id="S64T7U1443">phiI2</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,233" id="srcline233">233</a></span><span class="line"><span class="mxinfo " id="T7:U1160"><span class="var type1" id="S106T7U1446">m5</span> = <span class="mxinfo " id="T7:U1162"><span class="mxinfo " id="T7:U1163"><span class="var type1" id="S102T22U1449">P</span>(<span class="mxinfo " id="T49:U1165">5</span>)</span>/(<span class="mxinfo " id="T7:U1166"><span class="mxinfo " id="T7:U1167">2</span>*<span class="mxinfo " id="T7:U1168">cos(<span class="var type1" id="S67T7U1456">phiJ2</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,234" id="srcline234">234</a></span><span class="line"><span class="mxinfo " id="T7:U1170"><span class="var type1" id="S107T7U1459">m6I</span> = <span class="mxinfo " id="T7:U1172"><span class="mxinfo " id="T7:U1173"><span class="var type1" id="S102T22U1462">P</span>(<span class="mxinfo " id="T49:U1175">6</span>)</span>/(<span class="mxinfo " id="T7:U1176"><span class="mxinfo " id="T7:U1177">2</span>*<span class="mxinfo " id="T7:U1178">cos(<span class="var type1" id="S62T7U1469">phiI1</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,235" id="srcline235">235</a></span><span class="line"><span class="mxinfo " id="T7:U1180"><span class="var type1" id="S108T7U1472">m6J</span> = <span class="mxinfo " id="T7:U1182"><span class="mxinfo " id="T7:U1183"><span class="var type1" id="S102T22U1475">P</span>(<span class="mxinfo " id="T49:U1185">6</span>)</span>/(<span class="mxinfo " id="T7:U1186"><span class="mxinfo " id="T7:U1187">2</span>*<span class="mxinfo " id="T7:U1188">cos(<span class="var type1" id="S66T7U1482">phiJ1</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,236" id="srcline236">236</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,237" id="srcline237">237</a></span><span class="line"><span class="comment">% Geometric stiffness matrix, KG</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,238" id="srcline238">238</a></span><span class="line"><span class="comment">% KA</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,239" id="srcline239">239</a></span><span class="line"><span class="mxinfo " id="T163:U1190"><span class="var type1" id="S109T163U1485">KA</span> = <span class="mxinfo " id="T163:U1192"><span class="mxinfo " id="T7:U1193"><span class="var type1" id="S102T22U1488">P</span>(<span class="mxinfo " id="T49:U1195">1</span>)</span>*<span class="mxinfo " id="T163:U1196">[<span class="mxinfo " id="T171:U1197"><span class="var type1" id="S71T73U1492">A</span> <span class="mxinfo " id="T73:U1199">zeros(3)</span> <span class="mxinfo " id="T73:U1200">-<span class="var type1" id="S71T73U1497">A</span></span> <span class="mxinfo " id="T73:U1202">zeros(3)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="158,240" id="srcline240">240</a></span><span class="line">    <span class="mxinfo " id="T171:U1203">zeros(3) zeros(3) zeros(3) zeros(3)</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,241" id="srcline241">241</a></span><span class="line">    <span class="mxinfo " id="T171:U1204"><span class="mxinfo " id="T73:U1205">-<span class="var type1" id="S71T73U1516">A</span></span> <span class="mxinfo " id="T73:U1207">zeros(3)</span> <span class="var type1" id="S71T73U1520">A</span> <span class="mxinfo " id="T73:U1209">zeros(3)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="158,242" id="srcline242">242</a></span><span class="line">    <span class="mxinfo " id="T171:U1210">zeros(3) zeros(3) zeros(3) zeros(3)</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,243" id="srcline243">243</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,244" id="srcline244">244</a></span><span class="line"><span class="comment">% KB</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,245" id="srcline245">245</a></span><span class="line"><span class="mxinfo " id="T163:U1211"><span class="var type1" id="S110T163U1539">KB</span> = <span class="mxinfo " id="T163:U1213"><span class="mxinfo " id="T163:U1214"><span class="mxinfo " id="T163:U1215"><span class="mxinfo " id="T163:U1216"><span class="mxinfo " id="T163:U1217"><span class="mxinfo " id="T163:U1218"><span class="mxinfo " id="T7:U1219"><span class="var type1" id="S102T22U1547">P</span>(<span class="mxinfo " id="T49:U1221">2</span>)</span>*(<span class="mxinfo " id="T163:U1222"><span class="mxinfo " id="T36:U1223"><span class="var type1" id="S90T40U1552">t2</span>'</span>*<span class="var type1" id="S90T40U1553">t2</span></span>)</span>*<span class="mxinfo " id="T7:U1226">tan(<span class="var type1" id="S65T7U1556">phiI3</span>)</span></span> + <span class="mxinfo " id="T163:U1228"><span class="mxinfo " id="T163:U1229"><span class="mxinfo " id="T7:U1230"><span class="var type1" id="S102T22U1560">P</span>(<span class="mxinfo " id="T49:U1232">3</span>)</span>*(<span class="mxinfo " id="T163:U1233"><span class="mxinfo " id="T36:U1234"><span class="var type1" id="S92T40U1565">t3</span>'</span>*<span class="var type1" id="S92T40U1566">t3</span></span>)</span>*<span class="mxinfo " id="T7:U1237">tan(<span class="var type1" id="S68T7U1569">phiJ3</span>)</span></span></span> + <span class="mxinfo " id="T163:U1239"><span class="mxinfo " id="T163:U1240"><span class="mxinfo " id="T7:U1241"><span class="var type1" id="S102T22U1573">P</span>(<span class="mxinfo " id="T49:U1243">4</span>)</span>*(<span class="mxinfo " id="T163:U1244"><span class="mxinfo " id="T36:U1245"><span class="var type1" id="S93T40U1578">t4</span>'</span>*<span class="var type1" id="S93T40U1579">t4</span></span>)</span>*<span class="mxinfo " id="T7:U1248">tan(<span class="var type1" id="S64T7U1582">phiI2</span>)</span></span></span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,246" id="srcline246">246</a></span><span class="line">    <span class="mxinfo " id="T163:U1250"><span class="mxinfo " id="T163:U1251"><span class="mxinfo " id="T7:U1252"><span class="var type1" id="S102T22U1586">P</span>(<span class="mxinfo " id="T49:U1254">5</span>)</span>*(<span class="mxinfo " id="T163:U1255"><span class="mxinfo " id="T36:U1256"><span class="var type1" id="S94T40U1591">t5</span>'</span>*<span class="var type1" id="S94T40U1592">t5</span></span>)</span>*<span class="mxinfo " id="T7:U1259">tan(<span class="var type1" id="S67T7U1595">phiJ2</span>)</span></span></span> + <span class="mxinfo " id="T163:U1261"><span class="mxinfo " id="T7:U1262"><span class="var type1" id="S102T22U1598">P</span>(<span class="mxinfo " id="T49:U1264">6</span>)</span>*(<span class="mxinfo " id="T163:U1265"><span class="mxinfo " id="T163:U1266">(<span class="mxinfo " id="T163:U1267"><span class="mxinfo " id="T36:U1268">-<span class="mxinfo " id="T36:U1269"><span class="var type1" id="S96T40U1607">t6I</span>'</span></span>*<span class="var type1" id="S96T40U1608">t6I</span></span>)*<span class="mxinfo " id="T7:U1272">tan(<span class="var type1" id="S62T7U1611">phiI1</span>)</span></span> + <span class="mxinfo " id="T163:U1274">(<span class="mxinfo " id="T163:U1275"><span class="mxinfo " id="T36:U1276"><span class="var type1" id="S95T40U1616">t6J</span>'</span>*<span class="var type1" id="S95T40U1617">t6J</span></span>)*<span class="mxinfo " id="T7:U1279">tan(<span class="var type1" id="S66T7U1620">phiJ1</span>)</span></span></span>)</span></span></span>; <span class="comment">% P(6)I?</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,247" id="srcline247">247</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,248" id="srcline248">248</a></span><span class="line"><span class="mxinfo " id="T163:U1281"><span class="var type1" id="S112T163U1623">G1</span> = <span class="mxinfo " id="T163:U1283"><span class="fcn" id="F877N12:B1625">get_G</span>(<span class="mxinfo " id="T72:U1284"><span class="var type1" id="S50T73U1627">R_bar</span>(<span class="mxinfo " id="T102:U1286">:</span>,<span class="mxinfo " id="T49:U1287">2</span>)</span>,<span class="mxinfo " id="T72:U1288"><span class="var type1" id="S47T73U1631">NI</span>(<span class="mxinfo " id="T102:U1290">:</span>,<span class="mxinfo " id="T49:U1291">1</span>)</span>,<span class="var type1" id="S59T72U1634">e1</span>,<span class="var type1" id="S25T7U1635">L</span>,<span class="mxinfo " id="T72:U1294"><span class="var type1" id="S50T73U1637">R_bar</span>(<span class="mxinfo " id="T102:U1296">:</span>,<span class="mxinfo " id="T49:U1297">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,249" id="srcline249">249</a></span><span class="line"><span class="mxinfo " id="T163:U1298"><span class="var type1" id="S114T163U1642">G2</span> = <span class="mxinfo " id="T163:U1300"><span class="fcn" id="F877N12:B1644">get_G</span>(<span class="mxinfo " id="T72:U1301"><span class="var type1" id="S50T73U1646">R_bar</span>(<span class="mxinfo " id="T102:U1303">:</span>,<span class="mxinfo " id="T49:U1304">2</span>)</span>,<span class="mxinfo " id="T72:U1305"><span class="var type1" id="S49T73U1650">NJ</span>(<span class="mxinfo " id="T102:U1307">:</span>,<span class="mxinfo " id="T49:U1308">1</span>)</span>,<span class="var type1" id="S59T72U1653">e1</span>,<span class="var type1" id="S25T7U1654">L</span>,<span class="mxinfo " id="T72:U1311"><span class="var type1" id="S50T73U1656">R_bar</span>(<span class="mxinfo " id="T102:U1313">:</span>,<span class="mxinfo " id="T49:U1314">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,250" id="srcline250">250</a></span><span class="line"><span class="mxinfo " id="T163:U1315"><span class="var type1" id="S115T163U1661">G3</span> = <span class="mxinfo " id="T163:U1317"><span class="fcn" id="F877N12:B1663">get_G</span>(<span class="mxinfo " id="T72:U1318"><span class="var type1" id="S50T73U1665">R_bar</span>(<span class="mxinfo " id="T102:U1320">:</span>,<span class="mxinfo " id="T49:U1321">3</span>)</span>,<span class="mxinfo " id="T72:U1322"><span class="var type1" id="S47T73U1669">NI</span>(<span class="mxinfo " id="T102:U1324">:</span>,<span class="mxinfo " id="T49:U1325">1</span>)</span>,<span class="var type1" id="S59T72U1672">e1</span>,<span class="var type1" id="S25T7U1673">L</span>,<span class="mxinfo " id="T72:U1328"><span class="var type1" id="S50T73U1675">R_bar</span>(<span class="mxinfo " id="T102:U1330">:</span>,<span class="mxinfo " id="T49:U1331">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,251" id="srcline251">251</a></span><span class="line"><span class="mxinfo " id="T163:U1332"><span class="var type1" id="S116T163U1680">G4</span> = <span class="mxinfo " id="T163:U1334"><span class="fcn" id="F877N12:B1682">get_G</span>(<span class="mxinfo " id="T72:U1335"><span class="var type1" id="S50T73U1684">R_bar</span>(<span class="mxinfo " id="T102:U1337">:</span>,<span class="mxinfo " id="T49:U1338">3</span>)</span>,<span class="mxinfo " id="T72:U1339"><span class="var type1" id="S49T73U1688">NJ</span>(<span class="mxinfo " id="T102:U1341">:</span>,<span class="mxinfo " id="T49:U1342">1</span>)</span>,<span class="var type1" id="S59T72U1691">e1</span>,<span class="var type1" id="S25T7U1692">L</span>,<span class="mxinfo " id="T72:U1345"><span class="var type1" id="S50T73U1694">R_bar</span>(<span class="mxinfo " id="T102:U1347">:</span>,<span class="mxinfo " id="T49:U1348">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,252" id="srcline252">252</a></span><span class="line"><span class="mxinfo " id="T163:U1349"><span class="var type1" id="S117T163U1699">G5</span> = <span class="mxinfo " id="T163:U1351"><span class="fcn" id="F877N12:B1701">get_G</span>(<span class="mxinfo " id="T72:U1352"><span class="var type1" id="S50T73U1703">R_bar</span>(<span class="mxinfo " id="T102:U1354">:</span>,<span class="mxinfo " id="T49:U1355">3</span>)</span>,<span class="mxinfo " id="T72:U1356"><span class="var type1" id="S49T73U1707">NJ</span>(<span class="mxinfo " id="T102:U1358">:</span>,<span class="mxinfo " id="T49:U1359">2</span>)</span>,<span class="var type1" id="S59T72U1710">e1</span>,<span class="var type1" id="S25T7U1711">L</span>,<span class="mxinfo " id="T72:U1362"><span class="var type1" id="S50T73U1713">R_bar</span>(<span class="mxinfo " id="T102:U1364">:</span>,<span class="mxinfo " id="T49:U1365">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,253" id="srcline253">253</a></span><span class="line"><span class="mxinfo " id="T163:U1366"><span class="var type1" id="S118T163U1718">G6</span> = <span class="mxinfo " id="T163:U1368"><span class="fcn" id="F877N12:B1720">get_G</span>(<span class="mxinfo " id="T72:U1369"><span class="var type1" id="S50T73U1722">R_bar</span>(<span class="mxinfo " id="T102:U1371">:</span>,<span class="mxinfo " id="T49:U1372">2</span>)</span>,<span class="mxinfo " id="T72:U1373"><span class="var type1" id="S49T73U1726">NJ</span>(<span class="mxinfo " id="T102:U1375">:</span>,<span class="mxinfo " id="T49:U1376">3</span>)</span>,<span class="var type1" id="S59T72U1729">e1</span>,<span class="var type1" id="S25T7U1730">L</span>,<span class="mxinfo " id="T72:U1379"><span class="var type1" id="S50T73U1732">R_bar</span>(<span class="mxinfo " id="T102:U1381">:</span>,<span class="mxinfo " id="T49:U1382">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,254" id="srcline254">254</a></span><span class="line"><span class="mxinfo " id="T163:U1383"><span class="var type1" id="S119T163U1737">G7</span> = <span class="mxinfo " id="T163:U1385"><span class="fcn" id="F877N12:B1739">get_G</span>(<span class="mxinfo " id="T72:U1386"><span class="var type1" id="S50T73U1741">R_bar</span>(<span class="mxinfo " id="T102:U1388">:</span>,<span class="mxinfo " id="T49:U1389">3</span>)</span>,<span class="mxinfo " id="T72:U1390"><span class="var type1" id="S47T73U1745">NI</span>(<span class="mxinfo " id="T102:U1392">:</span>,<span class="mxinfo " id="T49:U1393">2</span>)</span>,<span class="var type1" id="S59T72U1748">e1</span>,<span class="var type1" id="S25T7U1749">L</span>,<span class="mxinfo " id="T72:U1396"><span class="var type1" id="S50T73U1751">R_bar</span>(<span class="mxinfo " id="T102:U1398">:</span>,<span class="mxinfo " id="T49:U1399">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,255" id="srcline255">255</a></span><span class="line"><span class="mxinfo " id="T163:U1400"><span class="var type1" id="S120T163U1756">G8</span> = <span class="mxinfo " id="T163:U1402"><span class="fcn" id="F877N12:B1758">get_G</span>(<span class="mxinfo " id="T72:U1403"><span class="var type1" id="S50T73U1760">R_bar</span>(<span class="mxinfo " id="T102:U1405">:</span>,<span class="mxinfo " id="T49:U1406">2</span>)</span>,<span class="mxinfo " id="T72:U1407"><span class="var type1" id="S47T73U1764">NI</span>(<span class="mxinfo " id="T102:U1409">:</span>,<span class="mxinfo " id="T49:U1410">3</span>)</span>,<span class="var type1" id="S59T72U1767">e1</span>,<span class="var type1" id="S25T7U1768">L</span>,<span class="mxinfo " id="T72:U1413"><span class="var type1" id="S50T73U1770">R_bar</span>(<span class="mxinfo " id="T102:U1415">:</span>,<span class="mxinfo " id="T49:U1416">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,256" id="srcline256">256</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,257" id="srcline257">257</a></span><span class="line"><span class="comment">% KC</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,258" id="srcline258">258</a></span><span class="line"><span class="mxinfo " id="T163:U1417"><span class="var type1" id="S121T163U1775">KC</span> = <span class="mxinfo " id="T163:U1419"><span class="mxinfo " id="T163:U1420"><span class="mxinfo " id="T163:U1421"><span class="mxinfo " id="T163:U1422"><span class="mxinfo " id="T163:U1423"><span class="mxinfo " id="T163:U1424"><span class="var type1" id="S103T7U1782">m2</span>*<span class="var type1" id="S112T163U1783">G1</span></span> + <span class="mxinfo " id="T163:U1427"><span class="var type1" id="S104T7U1785">m3</span>*<span class="var type1" id="S114T163U1786">G2</span></span></span> - <span class="mxinfo " id="T163:U1430"><span class="var type1" id="S105T7U1788">m4</span>*<span class="var type1" id="S115T163U1789">G3</span></span></span> - <span class="mxinfo " id="T163:U1433"><span class="var type1" id="S106T7U1791">m5</span>*<span class="var type1" id="S116T163U1792">G4</span></span></span> + <span class="mxinfo " id="T163:U1436"><span class="var type1" id="S107T7U1794">m6I</span>*(<span class="mxinfo " id="T163:U1438"><span class="var type1" id="S117T163U1797">G5</span> - <span class="var type1" id="S118T163U1798">G6</span></span>)</span></span> - <span class="mxinfo " id="T163:U1441"><span class="var type1" id="S108T7U1800">m6J</span>*(<span class="mxinfo " id="T163:U1443"><span class="var type1" id="S119T163U1803">G7</span> - <span class="var type1" id="S120T163U1804">G8</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,259" id="srcline259">259</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,260" id="srcline260">260</a></span><span class="line"><span class="comment">% KD</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,261" id="srcline261">261</a></span><span class="line"><span class="mxinfo " id="T162:U1446"><span class="var type1" id="S122T162U1807">KD2</span> = <span class="mxinfo " id="T162:U1448"><span class="mxinfo " id="T162:U1449"><span class="mxinfo " id="T162:U1450">-<span class="var type1" id="S73T162U1811">L_r2</span></span>*(<span class="mxinfo " id="T73:U1452"><span class="mxinfo " id="T73:U1453"><span class="var type1" id="S103T7U1815">m2</span>*<span class="var type1" id="S76T73U1816">S_nI1</span></span> + <span class="mxinfo " id="T73:U1456"><span class="var type1" id="S107T7U1818">m6I</span>*<span class="var type1" id="S79T73U1819">S_nI3</span></span></span>)</span> + <span class="mxinfo " id="T162:U1459"><span class="var type1" id="S75T162U1821">L_r3</span>*(<span class="mxinfo " id="T73:U1461"><span class="mxinfo " id="T73:U1462"><span class="var type1" id="S105T7U1825">m4</span>*<span class="var type1" id="S76T73U1826">S_nI1</span></span> + <span class="mxinfo " id="T73:U1465"><span class="var type1" id="S107T7U1828">m6I</span>*<span class="var type1" id="S78T73U1829">S_nI2</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,262" id="srcline262">262</a></span><span class="line"><span class="mxinfo " id="T162:U1468"><span class="var type1" id="S123T162U1832">KD4</span> = <span class="mxinfo " id="T162:U1470"><span class="mxinfo " id="T162:U1471"><span class="mxinfo " id="T162:U1472">-<span class="var type1" id="S73T162U1836">L_r2</span></span>*(<span class="mxinfo " id="T73:U1474"><span class="mxinfo " id="T73:U1475"><span class="var type1" id="S104T7U1840">m3</span>*<span class="var type1" id="S80T73U1841">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1478"><span class="var type1" id="S108T7U1843">m6J</span>*<span class="var type1" id="S82T73U1844">S_nJ3</span></span></span>)</span> + <span class="mxinfo " id="T162:U1481"><span class="var type1" id="S75T162U1846">L_r3</span>*(<span class="mxinfo " id="T73:U1483"><span class="mxinfo " id="T73:U1484"><span class="var type1" id="S106T7U1850">m5</span>*<span class="var type1" id="S80T73U1851">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1487"><span class="var type1" id="S108T7U1853">m6J</span>*<span class="var type1" id="S81T73U1854">S_nJ2</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,263" id="srcline263">263</a></span><span class="line"><span class="mxinfo " id="T163:U1490"><span class="var type1" id="S124T163U1857">KD</span> = <span class="mxinfo " id="T163:U1492">[<span class="mxinfo " id="T162:U1493">zeros(<span class="mxinfo " id="T7:U1494">12</span>,<span class="mxinfo " id="T7:U1495">3</span>)</span> <span class="var type1" id="S122T162U1864">KD2</span> <span class="mxinfo " id="T162:U1497">zeros(<span class="mxinfo " id="T7:U1498">12</span>,<span class="mxinfo " id="T7:U1499">3</span>)</span> <span class="var type1" id="S123T162U1869">KD4</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,264" id="srcline264">264</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,265" id="srcline265">265</a></span><span class="line"><span class="comment">% KE</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,266" id="srcline266">266</a></span><span class="line"><span class="mxinfo " id="T163:U1501"><span class="var type1" id="S125T163U1872">KE</span> = <span class="mxinfo " id="T163:U1503"><span class="var type1" id="S124T163U1874">KD</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,267" id="srcline267">267</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,268" id="srcline268">268</a></span><span class="line"><span class="comment">% KF</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,269" id="srcline269">269</a></span><span class="line"><span class="comment">% M_nI2 = get_M_mex(NI(:,2),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,270" id="srcline270">270</a></span><span class="line"><span class="comment">% M_nJ2 = get_M_mex(NJ(:,2),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,271" id="srcline271">271</a></span><span class="line"><span class="comment">% M_nI3 = get_M_mex(NI(:,3),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,272" id="srcline272">272</a></span><span class="line"><span class="comment">% M_nJ3 = get_M_mex(NJ(:,3),e1,L);</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,273" id="srcline273">273</a></span><span class="line"><span class="mxinfo " id="T73:U1505"><span class="var type1" id="S71T73U1877">A</span> = <span class="mxinfo " id="T73:U1507"><span class="mxinfo " id="T7:U1508"><span class="mxinfo " id="T7:U1509">1</span>/<span class="var type1" id="S25T7U1881">L</span></span>*(<span class="mxinfo " id="T73:U1511"><span class="mxinfo " id="T73:U1512">[<span class="mxinfo " id="T5:U1513">1 0 0</span>; <span class="mxinfo " id="T5:U1514">0 1 0</span>; <span class="mxinfo " id="T5:U1515">0 0 1</span>]</span> - <span class="mxinfo " id="T73:U1516"><span class="var type1" id="S59T72U1898">e1</span>*<span class="mxinfo " id="T5:U1518"><span class="var type1" id="S59T72U1900">e1</span>'</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,274" id="srcline274">274</a></span><span class="line"><span class="mxinfo " id="T73:U1520"><span class="var type1" id="S126T73U1903">M_nI2</span> = <span class="mxinfo " id="T73:U1522"><span class="mxinfo " id="T7:U1523"><span class="mxinfo " id="T7:U1524">-1</span>/<span class="var type1" id="S25T7U1908">L</span></span>*(<span class="mxinfo " id="T73:U1526"><span class="mxinfo " id="T73:U1527"><span class="mxinfo " id="T73:U1528"><span class="mxinfo " id="T72:U1529"><span class="var type1" id="S71T73U1914">A</span>*<span class="mxinfo " id="T72:U1531"><span class="var type1" id="S47T73U1916">NI</span>(<span class="mxinfo " id="T102:U1533">:</span>,<span class="mxinfo " id="T49:U1534">2</span>)</span></span>*<span class="mxinfo " id="T5:U1535"><span class="var type1" id="S59T72U1920">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1537">(<span class="mxinfo " id="T73:U1538"><span class="mxinfo " id="T72:U1539"><span class="var type1" id="S71T73U1925">A</span>*<span class="mxinfo " id="T72:U1541"><span class="var type1" id="S47T73U1927">NI</span>(<span class="mxinfo " id="T102:U1543">:</span>,<span class="mxinfo " id="T49:U1544">2</span>)</span></span>*<span class="mxinfo " id="T5:U1545"><span class="var type1" id="S59T72U1931">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1547"><span class="var type1" id="S71T73U1933">A</span>*(<span class="mxinfo " id="T7:U1549"><span class="mxinfo " id="T5:U1550"><span class="var type1" id="S59T72U1937">e1</span>'</span>*<span class="mxinfo " id="T72:U1552"><span class="var type1" id="S47T73U1939">NI</span>(<span class="mxinfo " id="T102:U1554">:</span>,<span class="mxinfo " id="T49:U1555">2</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,275" id="srcline275">275</a></span><span class="line"><span class="mxinfo " id="T73:U1556"><span class="var type1" id="S127T73U1944">M_nJ2</span> = <span class="mxinfo " id="T73:U1558"><span class="mxinfo " id="T7:U1559"><span class="mxinfo " id="T7:U1560">-1</span>/<span class="var type1" id="S25T7U1949">L</span></span>*(<span class="mxinfo " id="T73:U1562"><span class="mxinfo " id="T73:U1563"><span class="mxinfo " id="T73:U1564"><span class="mxinfo " id="T72:U1565"><span class="var type1" id="S71T73U1955">A</span>*<span class="mxinfo " id="T72:U1567"><span class="var type1" id="S49T73U1957">NJ</span>(<span class="mxinfo " id="T102:U1569">:</span>,<span class="mxinfo " id="T49:U1570">2</span>)</span></span>*<span class="mxinfo " id="T5:U1571"><span class="var type1" id="S59T72U1961">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1573">(<span class="mxinfo " id="T73:U1574"><span class="mxinfo " id="T72:U1575"><span class="var type1" id="S71T73U1966">A</span>*<span class="mxinfo " id="T72:U1577"><span class="var type1" id="S49T73U1968">NJ</span>(<span class="mxinfo " id="T102:U1579">:</span>,<span class="mxinfo " id="T49:U1580">2</span>)</span></span>*<span class="mxinfo " id="T5:U1581"><span class="var type1" id="S59T72U1972">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1583"><span class="var type1" id="S71T73U1974">A</span>*(<span class="mxinfo " id="T7:U1585"><span class="mxinfo " id="T5:U1586"><span class="var type1" id="S59T72U1978">e1</span>'</span>*<span class="mxinfo " id="T72:U1588"><span class="var type1" id="S49T73U1980">NJ</span>(<span class="mxinfo " id="T102:U1590">:</span>,<span class="mxinfo " id="T49:U1591">2</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,276" id="srcline276">276</a></span><span class="line"><span class="mxinfo " id="T73:U1592"><span class="var type1" id="S128T73U1985">M_nI3</span> = <span class="mxinfo " id="T73:U1594"><span class="mxinfo " id="T7:U1595"><span class="mxinfo " id="T7:U1596">-1</span>/<span class="var type1" id="S25T7U1990">L</span></span>*(<span class="mxinfo " id="T73:U1598"><span class="mxinfo " id="T73:U1599"><span class="mxinfo " id="T73:U1600"><span class="mxinfo " id="T72:U1601"><span class="var type1" id="S71T73U1996">A</span>*<span class="mxinfo " id="T72:U1603"><span class="var type1" id="S47T73U1998">NI</span>(<span class="mxinfo " id="T102:U1605">:</span>,<span class="mxinfo " id="T49:U1606">3</span>)</span></span>*<span class="mxinfo " id="T5:U1607"><span class="var type1" id="S59T72U2002">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1609">(<span class="mxinfo " id="T73:U1610"><span class="mxinfo " id="T72:U1611"><span class="var type1" id="S71T73U2007">A</span>*<span class="mxinfo " id="T72:U1613"><span class="var type1" id="S47T73U2009">NI</span>(<span class="mxinfo " id="T102:U1615">:</span>,<span class="mxinfo " id="T49:U1616">3</span>)</span></span>*<span class="mxinfo " id="T5:U1617"><span class="var type1" id="S59T72U2013">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1619"><span class="var type1" id="S71T73U2015">A</span>*(<span class="mxinfo " id="T7:U1621"><span class="mxinfo " id="T5:U1622"><span class="var type1" id="S59T72U2019">e1</span>'</span>*<span class="mxinfo " id="T72:U1624"><span class="var type1" id="S47T73U2021">NI</span>(<span class="mxinfo " id="T102:U1626">:</span>,<span class="mxinfo " id="T49:U1627">3</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,277" id="srcline277">277</a></span><span class="line"><span class="mxinfo " id="T73:U1628"><span class="var type1" id="S129T73U2026">M_nJ3</span> = <span class="mxinfo " id="T73:U1630"><span class="mxinfo " id="T7:U1631"><span class="mxinfo " id="T7:U1632">-1</span>/<span class="var type1" id="S25T7U2031">L</span></span>*(<span class="mxinfo " id="T73:U1634"><span class="mxinfo " id="T73:U1635"><span class="mxinfo " id="T73:U1636"><span class="mxinfo " id="T72:U1637"><span class="var type1" id="S71T73U2037">A</span>*<span class="mxinfo " id="T72:U1639"><span class="var type1" id="S49T73U2039">NJ</span>(<span class="mxinfo " id="T102:U1641">:</span>,<span class="mxinfo " id="T49:U1642">3</span>)</span></span>*<span class="mxinfo " id="T5:U1643"><span class="var type1" id="S59T72U2043">e1</span>'</span></span> + <span class="mxinfo " id="T73:U1645">(<span class="mxinfo " id="T73:U1646"><span class="mxinfo " id="T72:U1647"><span class="var type1" id="S71T73U2048">A</span>*<span class="mxinfo " id="T72:U1649"><span class="var type1" id="S49T73U2050">NJ</span>(<span class="mxinfo " id="T102:U1651">:</span>,<span class="mxinfo " id="T49:U1652">3</span>)</span></span>*<span class="mxinfo " id="T5:U1653"><span class="var type1" id="S59T72U2054">e1</span>'</span></span>)'</span></span> + <span class="mxinfo " id="T73:U1655"><span class="var type1" id="S71T73U2056">A</span>*(<span class="mxinfo " id="T7:U1657"><span class="mxinfo " id="T5:U1658"><span class="var type1" id="S59T72U2060">e1</span>'</span>*<span class="mxinfo " id="T72:U1660"><span class="var type1" id="S49T73U2062">NJ</span>(<span class="mxinfo " id="T102:U1662">:</span>,<span class="mxinfo " id="T49:U1663">3</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,278" id="srcline278">278</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,279" id="srcline279">279</a></span><span class="line"><span class="mxinfo " id="T73:U1664"><span class="var type1" id="S130T73U2067">S_e2</span> = <span class="mxinfo " id="T73:U1666"><span class="fcn" id="F223N19:B2069">get_S</span>(<span class="var type1" id="S60T72U2070">e2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,280" id="srcline280">280</a></span><span class="line"><span class="mxinfo " id="T73:U1668"><span class="var type1" id="S131T73U2073">S_e1</span> = <span class="mxinfo " id="T73:U1670"><span class="fcn" id="F223N19:B2075">get_S</span>(<span class="var type1" id="S59T72U2076">e1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,281" id="srcline281">281</a></span><span class="line"><span class="mxinfo " id="T73:U1672"><span class="var type1" id="S132T73U2079">S_e3</span> = <span class="mxinfo " id="T73:U1674"><span class="fcn" id="F223N19:B2081">get_S</span>(<span class="var type1" id="S61T72U2082">e3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,282" id="srcline282">282</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,283" id="srcline283">283</a></span><span class="line"><span class="mxinfo " id="T73:U1676"><span class="var type1" id="S133T73U2085">KF11</span> = <span class="mxinfo " id="T73:U1678"><span class="mxinfo " id="T73:U1679"><span class="mxinfo " id="T73:U1680"><span class="mxinfo " id="T73:U1681"><span class="mxinfo " id="T7:U1682">-<span class="var type1" id="S103T7U2091">m2</span></span>*<span class="var type1" id="S126T73U2092">M_nI2</span></span> - <span class="mxinfo " id="T73:U1685"><span class="var type1" id="S104T7U2094">m3</span>*<span class="var type1" id="S127T73U2095">M_nJ2</span></span></span> + <span class="mxinfo " id="T73:U1688"><span class="var type1" id="S105T7U2097">m4</span>*<span class="var type1" id="S128T73U2098">M_nI3</span></span></span> + <span class="mxinfo " id="T73:U1691"><span class="var type1" id="S106T7U2100">m5</span>*<span class="var type1" id="S129T73U2101">M_nJ3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,284" id="srcline284">284</a></span><span class="line"><span class="mxinfo " id="T73:U1694"><span class="var type1" id="S134T73U2104">KF12</span> = <span class="mxinfo " id="T73:U1696"><span class="mxinfo " id="T73:U1697"><span class="mxinfo " id="T73:U1698"><span class="mxinfo " id="T7:U1699">-<span class="var type1" id="S103T7U2109">m2</span></span>*<span class="var type1" id="S71T73U2110">A</span></span>*<span class="var type1" id="S78T73U2111">S_nI2</span></span> + <span class="mxinfo " id="T73:U1703"><span class="mxinfo " id="T73:U1704"><span class="var type1" id="S105T7U2114">m4</span>*<span class="var type1" id="S71T73U2115">A</span></span>*<span class="var type1" id="S79T73U2116">S_nI3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,285" id="srcline285">285</a></span><span class="line"><span class="mxinfo " id="T73:U1708"><span class="var type1" id="S135T73U2119">KF14</span> = <span class="mxinfo " id="T73:U1710"><span class="mxinfo " id="T73:U1711"><span class="mxinfo " id="T73:U1712"><span class="mxinfo " id="T7:U1713">-<span class="var type1" id="S104T7U2124">m3</span></span>*<span class="var type1" id="S71T73U2125">A</span></span>*<span class="var type1" id="S81T73U2126">S_nJ2</span></span> + <span class="mxinfo " id="T73:U1717"><span class="mxinfo " id="T73:U1718"><span class="var type1" id="S106T7U2129">m5</span>*<span class="var type1" id="S71T73U2130">A</span></span>*<span class="var type1" id="S82T73U2131">S_nJ3</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,286" id="srcline286">286</a></span><span class="line"><span class="mxinfo " id="T73:U1722"><span class="var type1" id="S136T73U2134">KF22</span> = <span class="mxinfo " id="T73:U1724"><span class="mxinfo " id="T73:U1725"><span class="mxinfo " id="T73:U1726"><span class="var type1" id="S103T7U2138">m2</span>*(<span class="mxinfo " id="T73:U1728"><span class="mxinfo " id="T73:U1729"><span class="var type1" id="S130T73U2142">S_e2</span>*<span class="var type1" id="S76T73U2143">S_nI1</span></span> - <span class="mxinfo " id="T73:U1732"><span class="var type1" id="S131T73U2145">S_e1</span>*<span class="var type1" id="S78T73U2146">S_nI2</span></span></span>)</span> - <span class="mxinfo " id="T73:U1735"><span class="var type1" id="S105T7U2148">m4</span>*(<span class="mxinfo " id="T73:U1737"><span class="mxinfo " id="T73:U1738"><span class="var type1" id="S132T73U2152">S_e3</span>*<span class="var type1" id="S76T73U2153">S_nI1</span></span> - <span class="mxinfo " id="T73:U1741"><span class="var type1" id="S131T73U2155">S_e1</span>*<span class="var type1" id="S79T73U2156">S_nI3</span></span></span>)</span></span> - <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,287" id="srcline287">287</a></span><span class="line">    <span class="mxinfo " id="T73:U1744"><span class="var type1" id="S107T7U2158">m6I</span>*(<span class="mxinfo " id="T73:U1746"><span class="mxinfo " id="T73:U1747"><span class="var type1" id="S132T73U2162">S_e3</span>*<span class="var type1" id="S78T73U2163">S_nI2</span></span> - <span class="mxinfo " id="T73:U1750"><span class="var type1" id="S130T73U2165">S_e2</span>*<span class="var type1" id="S79T73U2166">S_nI3</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,288" id="srcline288">288</a></span><span class="line"><span class="mxinfo " id="T73:U1753"><span class="var type1" id="S137T73U2169">KF44</span> = <span class="mxinfo " id="T73:U1755"><span class="mxinfo " id="T73:U1756"><span class="mxinfo " id="T73:U1757"><span class="var type1" id="S104T7U2173">m3</span>*(<span class="mxinfo " id="T73:U1759"><span class="mxinfo " id="T73:U1760"><span class="var type1" id="S130T73U2177">S_e2</span>*<span class="var type1" id="S80T73U2178">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1763"><span class="var type1" id="S131T73U2180">S_e1</span>*<span class="var type1" id="S81T73U2181">S_nJ2</span></span></span>)</span> - <span class="mxinfo " id="T73:U1766"><span class="var type1" id="S106T7U2183">m5</span>*(<span class="mxinfo " id="T73:U1768"><span class="mxinfo " id="T73:U1769"><span class="var type1" id="S132T73U2187">S_e3</span>*<span class="var type1" id="S80T73U2188">S_nJ1</span></span> - <span class="mxinfo " id="T73:U1772"><span class="var type1" id="S131T73U2190">S_e1</span>*<span class="var type1" id="S82T73U2191">S_nJ3</span></span></span>)</span></span> + <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,289" id="srcline289">289</a></span><span class="line">    <span class="mxinfo " id="T73:U1775"><span class="var type1" id="S108T7U2193">m6J</span>*(<span class="mxinfo " id="T73:U1777"><span class="mxinfo " id="T73:U1778"><span class="var type1" id="S132T73U2197">S_e3</span>*<span class="var type1" id="S81T73U2198">S_nJ2</span></span> - <span class="mxinfo " id="T73:U1781"><span class="var type1" id="S130T73U2200">S_e2</span>*<span class="var type1" id="S82T73U2201">S_nJ3</span></span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,290" id="srcline290">290</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,291" id="srcline291">291</a></span><span class="line"><span class="mxinfo " id="T163:U1784"><span class="var type1" id="S138T163U2204">KF</span> = <span class="mxinfo " id="T163:U1786">[<span class="mxinfo " id="T171:U1787"><span class="var type1" id="S133T73U2207">KF11</span> <span class="var type1" id="S134T73U2208">KF12</span> <span class="mxinfo " id="T73:U1790">-<span class="var type1" id="S133T73U2210">KF11</span></span> <span class="var type1" id="S135T73U2211">KF14</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="158,292" id="srcline292">292</a></span><span class="line">    <span class="mxinfo " id="T171:U1793"><span class="mxinfo " id="T73:U1794"><span class="var type1" id="S134T73U2214">KF12</span>'</span> <span class="var type1" id="S136T73U2215">KF22</span> <span class="mxinfo " id="T73:U1797">-<span class="mxinfo " id="T73:U1798"><span class="var type1" id="S134T73U2218">KF12</span>'</span></span> <span class="mxinfo " id="T73:U1800">zeros(<span class="mxinfo " id="T7:U1801">3</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="158,293" id="srcline293">293</a></span><span class="line">    <span class="mxinfo " id="T171:U1802"><span class="mxinfo " id="T73:U1803">-<span class="var type1" id="S133T73U2224">KF11</span></span> <span class="mxinfo " id="T73:U1805">-<span class="var type1" id="S134T73U2226">KF12</span></span> <span class="var type1" id="S133T73U2227">KF11</span> <span class="mxinfo " id="T73:U1808">-<span class="var type1" id="S135T73U2229">KF14</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="158,294" id="srcline294">294</a></span><span class="line">    <span class="mxinfo " id="T171:U1810"><span class="mxinfo " id="T73:U1811"><span class="var type1" id="S135T73U2232">KF14</span>'</span> <span class="mxinfo " id="T73:U1813">zeros(<span class="mxinfo " id="T7:U1814">3</span>)</span> <span class="mxinfo " id="T73:U1815">-<span class="mxinfo " id="T73:U1816"><span class="var type1" id="S135T73U2238">KF14</span>'</span></span> <span class="var type1" id="S137T73U2239">KF44</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,295" id="srcline295">295</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,296" id="srcline296">296</a></span><span class="line"><span class="comment">% KG - geometric stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,297" id="srcline297">297</a></span><span class="line"><span class="mxinfo " id="T163:U1819"><span class="var type1" id="S139T163U2242">KG</span> = <span class="mxinfo " id="T163:U1821"><span class="mxinfo " id="T163:U1822"><span class="mxinfo " id="T163:U1823"><span class="mxinfo " id="T163:U1824"><span class="mxinfo " id="T163:U1825"><span class="var type1" id="S109T163U2248">KA</span> + <span class="var type1" id="S110T163U2249">KB</span></span> + <span class="var type1" id="S121T163U2250">KC</span></span> + <span class="var type1" id="S124T163U2251">KD</span></span> + <span class="var type1" id="S125T163U2252">KE</span></span> + <span class="var type1" id="S138T163U2253">KF</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,298" id="srcline298">298</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,299" id="srcline299">299</a></span><span class="line"><span class="comment">% Element global tangent stiffness matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,300" id="srcline300">300</a></span><span class="line"><span class="mxinfo " id="T163:U1832"><span class="var type1" id="S2T163U2256">Kel</span> = <span class="mxinfo " id="T163:U1834"><span class="mxinfo " id="T163:U1835"><span class="mxinfo " id="T165:U1836"><span class="mxinfo " id="T165:U1837"><span class="var type1" id="S98T166U2261">T</span>'</span>*<span class="var type1" id="S101T15U2262">KL</span></span>*<span class="var type1" id="S98T166U2263">T</span></span> + <span class="var type1" id="S139T163U2264">KG</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,301" id="srcline301">301</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,302" id="srcline302">302</a></span><span class="line"><span class="comment">% Element global internal force vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,303" id="srcline303">303</a></span><span class="line"><span class="mxinfo " id="T36:U1842"><span class="var type1" id="S4T36U2267">Fint_i</span> = <span class="mxinfo " id="T36:U1844"><span class="mxinfo " id="T165:U1845"><span class="var type1" id="S98T166U2270">T</span>'</span>*<span class="var type1" id="S102T22U2271">P</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,304" id="srcline304">304</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,305" id="srcline305">305</a></span><span class="line"><span class="comment">% Do not need to save any variables for future iterations</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,306" id="srcline306">306</a></span><span class="line"><span class="mxinfo " id="T168:U1848"><span class="var type1" id="S6T168U2274">el_out</span> = <span class="var type1" id="S9T168U2275">el_in0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,307" id="srcline307">307</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="158,308" id="srcline308">308</a></span><span class="line"><span class="mxinfo " id="T7:U1851"><span class="mxinfo " id="T7:U1852"><span class="var type1" id="S6T168U2279">el_out</span>.break</span> = <span class="mxinfo " id="T7:U1854">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="158,309" id="srcline309">309</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="158,310" id="srcline310">310</a></span><span class="line"></span></span>
</pre>
