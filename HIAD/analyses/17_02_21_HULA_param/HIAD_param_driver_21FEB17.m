% Driver script for parameterized HIAD analysis
% February 21, 2017


%% INPUTS (53)
% Internal inflation pressure (psi)
in.p_i = [1
    1
    1
    1
    1
    1
    1]*10;

% Braid angle (deg)
in.beta_i = [69
    69
    69
    69
    69
    69
    69];

% Location of cords on cross-section (deg)
in.alpha_i = [210 330
    210 330
    210 330
    210 330
    210 330
    210 330
    210 330];

% Cord stiffness factor
in.k_cord_fac_i = [1
    1
    1
    1
    1
    1
    1];

% Number of loop straps (set 1)
in.n_loop1 = [32
    32
    32
    32] + 0;

% Number of loop straps (set 2)
in.n_loop2 = [32
    32
    32] + 0;

% Number of radial strap sets
in.n_rad = 32; % 36; % 

% Loop strap pretension (set 1)
in.PT_loop1 = [100
    100
    100
    100];

% Loop strap pretension (set 2)
in.PT_loop2 = [100
    100
    100];

% Radial strap pretension
in.PT_rad = 200;

% Strap stiffness factor (loop set 1) (scale strap width)
in.k_loop1_fac = [1
    1
    1
    1];

% Strap stiffness factor (loop set 2) (scale strap width)
in.k_loop2_fac = [1
    1
    1];

% Strap stiffness factor (fore radials) (scale strap width)
in.k_rad_fore_fac = 1;

% Strap stiffness factor (aft radials) (scale strap width)
in.k_rad_aft_fac = 1;


%% ANALYSIS
% Run analysis
% [out] = HIAD_param_21FEB17(in);

%%
X0 = [in.p_i
    in.beta_i
    ones(size(in.alpha_i,1),1)*60
    in.k_cord_fac_i
    in.n_loop1
    in.n_loop2
    in.n_rad
    in.PT_loop1
    in.PT_loop2
    in.PT_rad
    in.k_loop1_fac
    in.k_loop2_fac
    in.k_rad_fore_fac
    in.k_rad_aft_fac];

[out1] = HIAD_X_17APR17(X0);
[out1_full] = HIAD_param_21FEB17(in);

%%
X1 = population(1,3:end)';
[out2] = HIAD_X_17APR17(X1);

%%
[param] = build_param(X1);
[out2_full] = HIAD_param_21FEB17(param);


%%
[k,F_soft] = plot_inc(out1_full.FEM_out);
[k,F_soft] = plot_inc(out2_full.FEM_out);

xlim([0 550])
ylim([0 200])


%%
% % % [out] = HIAD_param_F2_28FEB17(in);

% % % FEM = out.FEM_out;
% % % FEM.PLOT.scale = 10;
% % % FEM.PLOT.els = [0 0 1 0]';
% % % FEM.PLOT.view = 3;
% % % for i = 1:size(FEM.OUT.Uinc,2)
% % %     FEM.OUT.U = FEM.OUT.Uinc(:,i);
% % %     FE_plot(FEM);
% % % endR2
[C,r] = HULA_config;
F = 2*pi.*in.p_i.*pi.*r.^2*(1 - 2*cotd(69)^2);
F = F.*(1:7)'/7;
load = define_press(C,r,70,30000);
R2 = [F/2 -load(:,1)*2*pi.*C(2:end,1) load(:,2)*2*pi.*C(2:end,1)];
R3 = sum(R2(2:end,:));
R4 = [R3(1) sqrt(R3(2)^2 + R3(3)^2)];

%%
% March 9, 2017
X1 = [20.7755650372032,19.7558394074917,23.2894628176658,11.3347215606013,5.25640959770599,5.55616091302489,19.7593256507774,69,69,69,69,69,69,69,60,60,60,60,60,60,60,1.42004478369551,1.60298706926404,1.97600613034724,1.59047822832393,1.63372925451476,1.80639147159536,1.87510440260973,44.9692920353760,50.3404097933468,62.4655109945864,16.1502111936339,15.7596236563321,16.3323421412646,64.4704927687055,27.6339093910998,160.678461288028,147.868893951343,77.4074550778681,258.805186481272,96.7054762361750,289.531223331510,288.393511464218,596.304936531411,0.482035841299511,0.251449717558214,0.251994830277097,0.263816089319393,0.685558293461227,0.343635935030236,0.353248379927197,1.67018758724097,0.555249216449767]';

%%
% March 10, 2017
% X1 = [24.9435975735249,11.9605757640699,8.79704109455271,7.55474023271796,8.48739921520401,3.04572065964764,3.34902332991968,69,69,69,69,69,69,69,60,60,60,60,60,60,60,1.99887243100571,1.98934695398389,1.98662362996128,1.99888635154186,1.99856426681958,1.99777947013367,1.62450128816038,18.4168637450994,15.5604946573721,26.4469388741903,15.6749945984303,15.5052582352255,16.2881814704942,15.5649811298022,27.8860671008711,188.698396934832,164.747934063530,121.616500775583,199.122371285396,198.628305098713,199.873847682483,199.995325907144,399.942359052978,0.760273947422740,0.625399829964144,0.256507873918067,0.286297951118333,0.717334269441858,0.801417445367712,1.99490581668316,1.99127907571336,1.99502578574400];
% X1 = [24.9435975735249,11.9605757640699,8.79704109455271,7.55474023271796,8.48739921520401,20,3.34902332991968,69,69,69,69,69,69,69,60,60,60,60,60,60,60,1.99887243100571,1.98934695398389,1.98662362996128,1.99888635154186,1.99856426681958,1.99777947013367,1.62450128816038,18.4168637450994,15.5604946573721,26.4469388741903,15.6749945984303,15.5052582352255,16.2881814704942,15.5649811298022,27.8860671008711,188.698396934832,164.747934063530,121.616500775583,199.122371285396,198.628305098713,199.873847682483,199.995325907144,399.942359052978,0.760273947422740,0.625399829964144,0.256507873918067,0.286297951118333,0.717334269441858,0.801417445367712,1.99490581668316,1.99127907571336,1.99502578574400];
% X1 = [24.9435975735249,30,8.79704109455271,7.55474023271796,8.48739921520401,3.04572065964764,3.34902332991968,69,69,69,69,69,69,69,60,60,60,60,60,60,60,1.99887243100571,1.98934695398389,1.98662362996128,1.99888635154186,1.99856426681958,1.99777947013367,1.62450128816038,18.4168637450994,15.5604946573721,26.4469388741903,15.6749945984303,15.5052582352255,16.2881814704942,15.5649811298022,27.8860671008711,188.698396934832,164.747934063530,121.616500775583,199.122371285396,198.628305098713,199.873847682483,199.995325907144,399.942359052978,0.760273947422740,0.625399829964144,0.256507873918067,0.286297951118333,0.717334269441858,0.801417445367712,1.99490581668316,1.99127907571336,1.99502578574400];

% March 13, 2017
X1 = [24.6861095143501,20.8891293682323,18.2088585957369,22.5684810450333,24.9896661202012,12.5967748219767,11.5252699272449,69,69,69,69,69,69,69,60,60,60,60,60,60,60,1.98014475882183,1.97669578332131,1.98450737641251,1.99692064717539,1.97914755972660,1.99993571455758,1.89841770349348,15.5009178007343,15.6123589191196,15.8601302383230,15.6149197335265,15.5016023545695,15.6743147411368,15.5009958820157,26.8114034495391,134.673737682264,118.989348958715,25.0125190675780,26.0081141705673,189.682956147273,30.8249046244998,25.2299644929924,378.039599062753,0.307999727232271,0.250020741692129,0.251435642270083,0.250079210106447,0.255219969666143,0.253806638876382,0.280149744049154,1.97487607344238,0.250051991529045]';
[in1] = build_param(X1);
[out1] = HIAD_param_21FEB17(in1);

[k,F_soft] = plot_inc(out1.FEM_out);

%%
[C,r] = HULA_config;
F = 2*pi.*X1(1:7)'.*pi.*r.^2*(1 - 2*cotd(69)^2);
F = F.*(1:7)'/7;
load = define_press(C,r,70,10000);
R2 = [F/2 -load(:,1)*2*pi.*C(2:end,1) load(:,2)*2*pi.*C(2:end,1)];
R3 = sum(R2(1:end,:));
R4 = [R3(1) sqrt(R3(2)^2 + R3(3)^2)]



% % % %%
% % % X1 = population(1,3:end)';


