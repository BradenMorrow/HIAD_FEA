% Test driver for preloading HIAD model
% June 15, 2016

% % Baseline HIAD model
% global FEM
global Cout

% Load model
[FEM] = HIAD_PT_preload;

% Strain test input
X0 = [-.000951      % Loop1, aft1
    .0018878        % Loop1, aft2
    .019478         % Loop1, aft3
    .027945         % Loop1, fore1
    .0079268        % Loop1, fore2
    .004279         % Loop1, fore3
    .0025387        % Loop2, aft1
    .020998         % Loop2, aft2
    .030854         % Loop2, aft3
    .018836         % Loop2, fore1
    .041048         % Loop2, fore2
    .027682         % Loop2, fore3
    -.0078438       % Radial, aft
    .034198         % Chevron, aft
    .0022528        % Radial, fore
    .050442];       % Chevron, fore

X0 = [-0.0086778431621972 % From ga_info_17JUN16.mat
    0.0137308035863122
    0.009913390161706
    0.0131378093833262
    0.0131864881589124
    0.00236962998224634
    0.00399147415449283
    0.0149954372289448
    0.0205117129376741
    0.0152200826866842
    0.0139539542780663
    0.0193881258800093
    0.0139926585867476
    0
    0.0243471181373077
    0];

X0 = [-0.0134466325250702 % From opt_21JUN16.mat
    0.0129375913138021
    0.00159976878267775
    0.0161645944453656
    0.0148900465489728
    -0.00767265853022795
    0.00666580190083404
    0.0297759950826779
    0.0213332022559251
    0.018806509014027
    0.0238749775907208
    0.0202092625675408
    0.00462607920965281
    0.021361269328315
    0.0148960843719048
    0.0231469768318158];

X0 = [-0.0127861417409358 % From opt_21JUN16_2.mat
    0.0129589234050599
    0.00136904560389544
    0.0165588484071837
    0.0149350425617064
    -0.00797036711719973
    0.00610550486601814
    0.0299780328116627
    0.0218392818781633
    0.0183715903098878
    0.0239615469040091
    0.0206831388094069
    0.0190889494692929
    0.00275010279043496
    0.0325551371071943
    0.000403781717819612];

X0 = [-0.0296736629334107 % From opt_21JUN16_148.mat
    0.0301137134303293
    -0.00359485243717294
    0.0509193122180131
    0.0350719909085986
    -0.0290629956211161
    0.00979401063857021
    0.0807517399241194
    0.0662286397447295
    0.0410092376702989
    0.0673984778245228
    0.0623852243992454
    0.0474777972018095
    0.00737109716524152
    0.0829407654264884
    0.00268908005021083];


X0 = [-0.0134391718019738 % From opt_23JUN16_48.mat
    0.0129521548286767
    0.00152032488912141
    0.01617336729262
    0.0148818120879623
    -0.00774898846496717
    0.00665421855246958
    0.0298268857076248
    0.0213429481522681
    0.018853755638744
    0.023893024167849
    0.0203092389854977
    0.0131567515026935
    0.0104099029088964
    0.0196107608569695
    0.0171169666583283];

% X0 = X;

% Apply pretension to straps and analyze
[strap_F,Cout] = apply_preten(FEM,X0);

% Strap forces
[obj] = get_strap_obj(strap_F);

% Torus locations
[def_con,def_eqcon] = get_def_con(X0);




%% Plotting
% HIAD geometry
C = [185.185453 84.342298
	213.724769 94.729760
	242.558759 105.224474
	271.650278 115.812921
	300.963157 126.481936
	322.382105 124.113612];
r = [31.837/2 % Minor radii of tori
    31.837/2
    31.837/2
    31.837/2
    31.837/2
    12.735/2];

theta = linspace(0,2*pi,20)';

figure(11)
clf
box on
hold on
axis equal
axis off
% xlim([0 350])
% ylim([0 150])
for i = 1:size(r,1)
    plot(r(i)*cos(theta) + C(i,1),r(i)*sin(theta) + C(i,2),'b-')
    plot(r(i)*cos(theta) + Cout(i,1),r(i)*sin(theta) + Cout(i,2),'k--')
end




















